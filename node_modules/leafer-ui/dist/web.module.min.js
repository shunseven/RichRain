var t,e;!function(t){t[t.none=1]="none",t[t.free=2]="free",t[t.mirrorAngle=3]="mirrorAngle",t[t.mirror=4]="mirror"}(t||(t={})),function(t){t[t.No=0]="No",t[t.Yes=1]="Yes",t[t.NoAndSkip=2]="NoAndSkip",t[t.YesAndSkip=3]="YesAndSkip"}(e||(e={}));const i={};function s(t){return void 0===t}function r(t){return null==t}function n(t){return"string"==typeof t}const{isFinite:o}=Number;function a(t){return"number"==typeof t}const h=/^-?\d+(?:\.\d+)?$/;function l(t){return"string"==typeof t&&h.test(t)?+t:t}const{isArray:d}=Array;function c(t){return t&&"object"==typeof t}function u(t){return c(t)&&!d(t)}function _(t){return"{}"===JSON.stringify(t)}const p={default:(t,e)=>(g(e,t),g(t,e),t),assign(t,e,i){let s;Object.keys(e).forEach(r=>{var n,o;if(s=e[r],(null==s?void 0:s.constructor)===Object&&(null===(n=t[r])||void 0===n?void 0:n.constructor)===Object)return g(t[r],e[r],i&&i[r]);i&&r in i?(null===(o=i[r])||void 0===o?void 0:o.constructor)===Object&&g(t[r]={},e[r],i[r]):t[r]=e[r]})},copyAttrs:(t,e,i)=>(i.forEach(i=>{s(e[i])||(t[i]=e[i])}),t),clone:t=>JSON.parse(JSON.stringify(t)),toMap(t){const e={};for(let i=0,s=t.length;i<s;i++)e[t[i]]=!0;return e},stintSet(t,e,i){i||(i=void 0),t[e]!==i&&(t[e]=i)}},{assign:g}=p;class f{get __useNaturalRatio(){return!0}get __isLinePath(){const{path:t}=this;return t&&6===t.length&&1===t[0]}get __usePathBox(){return this.__pathInputed}get __blendMode(){if(this.eraser&&"path"!==this.eraser)return"destination-out";const{blendMode:t}=this;return"pass-through"===t?null:t}constructor(t){this.__leaf=t}__get(t){if(this.__input){const e=this.__input[t];if(!s(e))return e}return this[t]}__getData(){const t={tag:this.__leaf.tag},{__input:e}=this;let i;for(let r in this)"_"!==r[0]&&(i=e?e[r]:void 0,t[r]=s(i)?this[r]:i);return t}__setInput(t,e){this.__input||(this.__input={}),this.__input[t]=e}__getInput(t){if(this.__input){const e=this.__input[t];if(!s(e))return e}if("path"!==t||this.__pathInputed)return this["_"+t]}__removeInput(t){this.__input&&!s(this.__input[t])&&(this.__input[t]=void 0)}__getInputData(t,e){const i={};if(t)if(d(t))for(let e of t)i[e]=this.__getInput(e);else for(let e in t)i[e]=this.__getInput(e);else{let t,e,{__input:r}=this;i.tag=this.__leaf.tag;for(let n in this)if("_"!==n[0]&&(t=this["_"+n],!s(t))){if("path"===n&&!this.__pathInputed)continue;e=r?r[n]:void 0,i[n]=s(e)?t:e}}if(e&&e.matrix){const{a:t,b:e,c:s,d:r,e:n,f:o}=this.__leaf.__localMatrix;i.matrix={a:t,b:e,c:s,d:r,e:n,f:o}}return i}__setMiddle(t,e){this.__middle||(this.__middle={}),this.__middle[t]=e}__getMiddle(t){return this.__middle&&this.__middle[t]}__checkSingle(){const t=this;if("pass-through"===t.blendMode){const e=this.__leaf;t.opacity<1&&(e.isBranch||t.__hasMultiPaint)||e.__hasEraser||t.eraser||t.filter?t.__single=!0:t.__single&&(t.__single=!1)}else t.__single=!0}__removeNaturalSize(){this.__naturalWidth=this.__naturalHeight=void 0}destroy(){this.__input=this.__middle=null}}const y={RUNTIME:"runtime",LEAF:"leaf",TASK:"task",CNAVAS:"canvas",IMAGE:"image",types:{},create(t){const{types:e}=m;return e[t]?e[t]++:(e[t]=1,0)}},m=y;let v,w,x;const{max:b}=Math,k=[0,0,0,0],B={zero:[...k],tempFour:k,set:(t,e,i,s,r)=>(void 0===i&&(i=s=r=e),t[0]=e,t[1]=i,t[2]=s,t[3]=r,t),setTemp:(t,e,i,s)=>S(k,t,e,i,s),toTempAB(t,e,i){x=i?a(t)?e:t:[],a(t)?(v=R(t),w=e):a(e)?(v=t,w=R(e)):(v=t,w=e),4!==v.length&&(v=P(v)),4!==w.length&&(w=P(w))},get(t,e){let i;if(!a(t))switch(t.length){case 4:i=s(e)?t:[...t];break;case 2:i=[t[0],t[1],t[0],t[1]];break;case 3:i=[t[0],t[1],t[2],t[1]];break;case 1:t=t[0];break;default:t=0}if(i||(i=[t,t,t,t]),!s(e))for(let t=0;t<4;t++)i[t]>e&&(i[t]=e);return i},max:(t,e,i)=>a(t)&&a(e)?b(t,e):(C(t,e,i),S(x,b(v[0],w[0]),b(v[1],w[1]),b(v[2],w[2]),b(v[3],w[3]))),add:(t,e,i)=>a(t)&&a(e)?t+e:(C(t,e,i),S(x,v[0]+w[0],v[1]+w[1],v[2]+w[2],v[3]+w[3])),swapAndScale(t,e,i,s){if(a(t))return e===i?t*e:[t*i,t*e];const r=s?t:[],[n,o,h,l]=4===t.length?t:P(t);return S(r,h*i,l*e,n*i,o*e)}},{set:S,get:P,setTemp:R,toTempAB:C}=B,{round:T,pow:E,max:L,floor:O,PI:A}=Math,D={within:(t,e,i)=>(c(e)&&(i=e.max,e=e.min),!s(e)&&t<e&&(t=e),!s(i)&&t>i&&(t=i),t),fourNumber:B.get,formatRotation:(t,e)=>(t%=360,e?t<0&&(t+=360):(t>180&&(t-=360),t<-180&&(t+=360)),D.float(t)),getGapRotation(t,e,i=0){let s=t+i;if(e>1){const t=Math.abs(s%e);(t<1||t>e-1)&&(s=Math.round(s/e)*e)}return s-i},float(t,e){const i=s(e)?1e12:E(10,e);return-0===(t=T(t*i)/i)?0:t},sign:t=>t<0?-1:1,getScaleData(t,e,i,s){if(s||(s={}),e){const t=(a(e)?e:e.width||0)/i.width,r=(a(e)?e:e.height||0)/i.height;s.scaleX=t||r||1,s.scaleY=r||t||1}else t&&D.assignScale(s,t);return s},assignScale(t,e){a(e)?t.scaleX=t.scaleY=e:(t.scaleX=e.x,t.scaleY=e.y)},getFloorScale:(t,e=1)=>L(O(t),e)/t,randInt:M,randColor:t=>`rgba(${M(255)},${M(255)},${M(255)},${t||1})`};function M(t){return Math.round(Math.random()*t)}const I=A/180,W=2*A,F=A/2;function z(){return{x:0,y:0}}function N(){return{x:0,y:0,width:0,height:0}}function Y(){return{a:1,b:0,c:0,d:1,e:0,f:0}}const{sin:X,cos:U,acos:H,sqrt:j}=Math,{float:V}=D,G={};function K(){return Object.assign(Object.assign(Object.assign({},{a:1,b:0,c:0,d:1,e:0,f:0}),{x:0,y:0,width:0,height:0}),{scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0})}const q={defaultMatrix:{a:1,b:0,c:0,d:1,e:0,f:0},defaultWorld:K(),tempMatrix:{},set(t,e=1,i=0,s=0,r=1,n=0,o=0){t.a=e,t.b=i,t.c=s,t.d=r,t.e=n,t.f=o},get:Y,getWorld:K,copy(t,e){t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.e=e.e,t.f=e.f},translate(t,e,i){t.e+=e,t.f+=i},translateInner(t,e,i,s){t.e+=t.a*e+t.c*i,t.f+=t.b*e+t.d*i,s&&(t.e-=e,t.f-=i)},scale(t,e,i=e){t.a*=e,t.b*=e,t.c*=i,t.d*=i},pixelScale(t,e,i){i||(i=t),i.a=t.a*e,i.b=t.b*e,i.c=t.c*e,i.d=t.d*e,i.e=t.e*e,i.f=t.f*e},scaleOfOuter(t,e,i,s){$.toInnerPoint(t,e,G),$.scaleOfInner(t,G,i,s)},scaleOfInner(t,e,i,s=i){$.translateInner(t,e.x,e.y),$.scale(t,i,s),$.translateInner(t,-e.x,-e.y)},rotate(t,e){const{a:i,b:s,c:r,d:n}=t,o=U(e*=I),a=X(e);t.a=i*o-s*a,t.b=i*a+s*o,t.c=r*o-n*a,t.d=r*a+n*o},rotateOfOuter(t,e,i){$.toInnerPoint(t,e,G),$.rotateOfInner(t,G,i)},rotateOfInner(t,e,i){$.translateInner(t,e.x,e.y),$.rotate(t,i),$.translateInner(t,-e.x,-e.y)},skew(t,e,i){const{a:s,b:r,c:n,d:o}=t;i&&(i*=I,t.a=s+n*i,t.b=r+o*i),e&&(e*=I,t.c=n+s*e,t.d=o+r*e)},skewOfOuter(t,e,i,s){$.toInnerPoint(t,e,G),$.skewOfInner(t,G,i,s)},skewOfInner(t,e,i,s=0){$.translateInner(t,e.x,e.y),$.skew(t,i,s),$.translateInner(t,-e.x,-e.y)},multiply(t,e){const{a:i,b:s,c:r,d:n,e:o,f:a}=t;t.a=e.a*i+e.b*r,t.b=e.a*s+e.b*n,t.c=e.c*i+e.d*r,t.d=e.c*s+e.d*n,t.e=e.e*i+e.f*r+o,t.f=e.e*s+e.f*n+a},multiplyParent(t,e,i,r,n){const{e:o,f:a}=t;if(i||(i=t),s(r)&&(r=1!==t.a||t.b||t.c||1!==t.d),r){const{a:s,b:r,c:o,d:a}=t;i.a=s*e.a+r*e.c,i.b=s*e.b+r*e.d,i.c=o*e.a+a*e.c,i.d=o*e.b+a*e.d,n&&(i.scaleX=e.scaleX*n.scaleX,i.scaleY=e.scaleY*n.scaleY)}else i.a=e.a,i.b=e.b,i.c=e.c,i.d=e.d,n&&(i.scaleX=e.scaleX,i.scaleY=e.scaleY);i.e=o*e.a+a*e.c+e.e,i.f=o*e.b+a*e.d+e.f},divide(t,e){$.multiply(t,$.tempInvert(e))},divideParent(t,e){$.multiplyParent(t,$.tempInvert(e))},tempInvert(t){const{tempMatrix:e}=$;return $.copy(e,t),$.invert(e),e},invert(t){const{a:e,b:i,c:s,d:r,e:n,f:o}=t;if(i||s){const a=1/(e*r-i*s);t.a=r*a,t.b=-i*a,t.c=-s*a,t.d=e*a,t.e=-(n*r-o*s)*a,t.f=-(o*e-n*i)*a}else if(1===e&&1===r)t.e=-n,t.f=-o;else{const i=1/(e*r);t.a=r*i,t.d=e*i,t.e=-n*r*i,t.f=-o*e*i}},toOuterPoint(t,e,i,s){const{x:r,y:n}=e;i||(i=e),i.x=r*t.a+n*t.c,i.y=r*t.b+n*t.d,s||(i.x+=t.e,i.y+=t.f)},toInnerPoint(t,e,i,s){const{a:r,b:n,c:o,d:a}=t,h=1/(r*a-n*o),{x:l,y:d}=e;if(i||(i=e),i.x=(l*a-d*o)*h,i.y=(d*r-l*n)*h,!s){const{e:e,f:s}=t;i.x-=(e*a-s*o)*h,i.y-=(s*r-e*n)*h}},setLayout(t,e,i,r,n){const{x:o,y:a,scaleX:h,scaleY:l}=e;if(s(n)&&(n=e.rotation||e.skewX||e.skewY),n){const{rotation:i,skewX:s,skewY:r}=e,n=i*I,o=U(n),a=X(n);if(s||r){const e=s*I,i=r*I;t.a=(o+i*-a)*h,t.b=(a+i*o)*h,t.c=(e*o-a)*l,t.d=(o+e*a)*l}else t.a=o*h,t.b=a*h,t.c=-a*l,t.d=o*l}else t.a=h,t.b=0,t.c=0,t.d=l;t.e=o,t.f=a,(i=i||r)&&$.translateInner(t,-i.x,-i.y,!r)},getLayout(t,e,i,s){const{a:r,b:n,c:o,d:a,e:h,f:l}=t;let d,c,u,_,p,g=h,f=l;if(n||o){const t=r*a-n*o;if(o&&!s){d=j(r*r+n*n),c=t/d;const e=r/d;u=n>0?H(e):-H(e)}else{c=j(o*o+a*a),d=t/c;const e=o/c;u=F-(a>0?H(-e):-H(e))}const e=V(U(u)),i=X(u);d=V(d),c=V(c),_=e?V((o/c+i)/e/I,9):0,p=e?V((n/d-i)/e/I,9):0,u=V(u/I)}else d=r,c=a,u=_=p=0;return(e=i||e)&&(g+=e.x*r+e.y*o,f+=e.x*n+e.y*a,i||(g-=e.x,f-=e.y)),{x:g,y:f,scaleX:d,scaleY:c,rotation:u,skewX:_,skewY:p}},withScale(t,e,i=e){const s=t;if(!e||!i){const{a:s,b:r,c:n,d:o}=t;r||n?i=(s*o-r*n)/(e=j(s*s+r*r)):(e=s,i=o)}return s.scaleX=e,s.scaleY=i,s},reset(t){$.set(t)}},$=q,{float:Q}=D,{toInnerPoint:J,toOuterPoint:Z}=q,{sin:tt,cos:et,abs:it,sqrt:st,atan2:rt,min:nt,round:ot}=Math,at={defaultPoint:{x:0,y:0},tempPoint:{},tempRadiusPoint:{},set(t,e=0,i=0){t.x=e,t.y=i},setRadius(t,e,i){t.radiusX=e,t.radiusY=s(i)?e:i},copy(t,e){t.x=e.x,t.y=e.y},copyFrom(t,e,i){t.x=e,t.y=i},round(t,e){t.x=e?ot(t.x-.5)+.5:ot(t.x),t.y=e?ot(t.y-.5)+.5:ot(t.y)},move(t,e,i){c(e)?(t.x+=e.x,t.y+=e.y):(t.x+=e,t.y+=i)},scale(t,e,i=e){t.x&&(t.x*=e),t.y&&(t.y*=i)},scaleOf(t,e,i,s=i){t.x+=(t.x-e.x)*(i-1),t.y+=(t.y-e.y)*(s-1)},rotate(t,e,i){i||(i=ht.defaultPoint);const s=et(e*=I),r=tt(e),n=t.x-i.x,o=t.y-i.y;t.x=i.x+n*s-o*r,t.y=i.y+n*r+o*s},tempToInnerOf(t,e){const{tempPoint:i}=ht;return dt(i,t),J(e,i,i),i},tempToOuterOf(t,e){const{tempPoint:i}=ht;return dt(i,t),Z(e,i,i),i},tempToInnerRadiusPointOf(t,e){const{tempRadiusPoint:i}=ht;return dt(i,t),ht.toInnerRadiusPointOf(t,e,i),i},copyRadiusPoint:(t,e,i,s)=>(dt(t,e),ct(t,i,s),t),toInnerRadiusPointOf(t,e,i){i||(i=t),J(e,t,i),i.radiusX=Math.abs(t.radiusX/e.scaleX),i.radiusY=Math.abs(t.radiusY/e.scaleY)},toInnerOf(t,e,i){J(e,t,i)},toOuterOf(t,e,i){Z(e,t,i)},getCenter:(t,e)=>({x:t.x+(e.x-t.x)/2,y:t.y+(e.y-t.y)/2}),getCenterX:(t,e)=>t+(e-t)/2,getCenterY:(t,e)=>t+(e-t)/2,getDistance:(t,e)=>lt(t.x,t.y,e.x,e.y),getDistanceFrom(t,e,i,s){const r=it(i-t),n=it(s-e);return st(r*r+n*n)},getMinDistanceFrom:(t,e,i,s,r,n)=>nt(lt(t,e,i,s),lt(i,s,r,n)),getAngle:(t,e)=>ut(t,e)/I,getRotation:(t,e,i,s)=>(s||(s=e),ht.getRadianFrom(t.x,t.y,e.x,e.y,i.x,i.y,s.x,s.y)/I),getRadianFrom(t,e,i,r,n,o,a,h){s(a)&&(a=i,h=r);const l=t-i,d=e-r,c=n-a,u=o-h;return Math.atan2(l*u-d*c,l*c+d*u)},getAtan2:(t,e)=>rt(e.y-t.y,e.x-t.x),getDistancePoint(t,e,i,s,r){const n=ut(t,e);return r&&(t=e),s||(e={}),e.x=t.x+et(n)*i,e.y=t.y+tt(n)*i,e},toNumberPoints(t){let e=t;return c(t[0])&&(e=[],t.forEach(t=>e.push(t.x,t.y))),e},isSame:(t,e)=>Q(t.x)===Q(e.x)&&Q(t.y)===Q(e.y),reset(t){ht.reset(t)}},ht=at,{getDistanceFrom:lt,copy:dt,setRadius:ct,getAtan2:ut}=ht;class _t{constructor(t,e){this.set(t,e)}set(t,e){return c(t)?at.copy(this,t):at.set(this,t,e),this}get(){const{x:t,y:e}=this;return{x:t,y:e}}clone(){return new _t(this)}move(t,e){return at.move(this,t,e),this}scale(t,e){return at.scale(this,t,e),this}scaleOf(t,e,i){return at.scaleOf(this,t,e,i),this}rotate(t,e){return at.rotate(this,t,e),this}rotateOf(t,e){return at.rotate(this,e,t),this}getRotation(t,e,i){return at.getRotation(this,t,e,i)}toInnerOf(t,e){return at.toInnerOf(this,t,e),this}toOuterOf(t,e){return at.toOuterOf(this,t,e),this}getCenter(t){return new _t(at.getCenter(this,t))}getDistance(t){return at.getDistance(this,t)}getDistancePoint(t,e,i,s){return new _t(at.getDistancePoint(this,t,e,i,s))}getAngle(t){return at.getAngle(this,t)}getAtan2(t){return at.getAtan2(this,t)}isSame(t){return at.isSame(this,t)}reset(){return at.reset(this),this}}const pt=new _t;class gt{constructor(t,e,i,s,r,n){this.set(t,e,i,s,r,n)}set(t,e,i,s,r,n){return c(t)?q.copy(this,t):q.set(this,t,e,i,s,r,n),this}setWith(t){return q.copy(this,t),this.scaleX=t.scaleX,this.scaleY=t.scaleY,this}get(){const{a:t,b:e,c:i,d:s,e:r,f:n}=this;return{a:t,b:e,c:i,d:s,e:r,f:n}}clone(){return new gt(this)}translate(t,e){return q.translate(this,t,e),this}translateInner(t,e){return q.translateInner(this,t,e),this}scale(t,e){return q.scale(this,t,e),this}scaleWith(t,e){return q.scale(this,t,e),this.scaleX*=t,this.scaleY*=e||t,this}pixelScale(t){return q.pixelScale(this,t),this}scaleOfOuter(t,e,i){return q.scaleOfOuter(this,t,e,i),this}scaleOfInner(t,e,i){return q.scaleOfInner(this,t,e,i),this}rotate(t){return q.rotate(this,t),this}rotateOfOuter(t,e){return q.rotateOfOuter(this,t,e),this}rotateOfInner(t,e){return q.rotateOfInner(this,t,e),this}skew(t,e){return q.skew(this,t,e),this}skewOfOuter(t,e,i){return q.skewOfOuter(this,t,e,i),this}skewOfInner(t,e,i){return q.skewOfInner(this,t,e,i),this}multiply(t){return q.multiply(this,t),this}multiplyParent(t){return q.multiplyParent(this,t),this}divide(t){return q.divide(this,t),this}divideParent(t){return q.divideParent(this,t),this}invert(){return q.invert(this),this}invertWith(){return q.invert(this),this.scaleX=1/this.scaleX,this.scaleY=1/this.scaleY,this}toOuterPoint(t,e,i){q.toOuterPoint(this,t,e,i)}toInnerPoint(t,e,i){q.toInnerPoint(this,t,e,i)}setLayout(t,e,i){return q.setLayout(this,t,e,i),this}getLayout(t,e,i){return q.getLayout(this,t,e,i)}withScale(t,e){return q.withScale(this,t,e)}reset(){q.reset(this)}}const ft=new gt,yt={tempPointBounds:{},setPoint(t,e,i){t.minX=t.maxX=e,t.minY=t.maxY=i},addPoint(t,e,i){t.minX=e<t.minX?e:t.minX,t.minY=i<t.minY?i:t.minY,t.maxX=e>t.maxX?e:t.maxX,t.maxY=i>t.maxY?i:t.maxY},addBounds(t,e,i,s,r){mt(t,e,i),mt(t,e+s,i+r)},copy(t,e){t.minX=e.minX,t.minY=e.minY,t.maxX=e.maxX,t.maxY=e.maxY},addPointBounds(t,e){t.minX=e.minX<t.minX?e.minX:t.minX,t.minY=e.minY<t.minY?e.minY:t.minY,t.maxX=e.maxX>t.maxX?e.maxX:t.maxX,t.maxY=e.maxY>t.maxY?e.maxY:t.maxY},toBounds(t,e){e.x=t.minX,e.y=t.minY,e.width=t.maxX-t.minX,e.height=t.maxY-t.minY}},{addPoint:mt}=yt;var vt,wt;!function(t){t[t.top=0]="top",t[t.right=1]="right",t[t.bottom=2]="bottom",t[t.left=3]="left"}(vt||(vt={})),function(t){t[t.topLeft=0]="topLeft",t[t.top=1]="top",t[t.topRight=2]="topRight",t[t.right=3]="right",t[t.bottomRight=4]="bottomRight",t[t.bottom=5]="bottom",t[t.bottomLeft=6]="bottomLeft",t[t.left=7]="left",t[t.center=8]="center",t[t["top-left"]=0]="top-left",t[t["top-right"]=2]="top-right",t[t["bottom-right"]=4]="bottom-right",t[t["bottom-left"]=6]="bottom-left"}(wt||(wt={}));const xt=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:1,y:.5},{x:1,y:1},{x:.5,y:1},{x:0,y:1},{x:0,y:.5},{x:.5,y:.5}];xt.forEach(t=>t.type="percent");const bt={directionData:xt,tempPoint:{},get:kt,toPoint(t,e,i,s,r,n){const o=kt(t);i.x=o.x,i.y=o.y,"percent"===o.type&&(i.x*=e.width,i.y*=e.height,r&&(n||(i.x-=r.x,i.y-=r.y),o.x&&(i.x-=1===o.x?r.width:.5===o.x?o.x*r.width:0),o.y&&(i.y-=1===o.y?r.height:.5===o.y?o.y*r.height:0))),s||(i.x+=e.x,i.y+=e.y)},getPoint:(t,e,i)=>(i||(i={}),bt.toPoint(t,e,i,!0),i)};function kt(t){return n(t)?xt[wt[t]]:t}const{toPoint:Bt}=bt,St={toPoint(t,e,i,s,r,n){Bt(t,i,s,r,e,n)}},{tempPointBounds:Pt,setPoint:Rt,addPoint:Ct,toBounds:Tt}=yt,{toOuterPoint:Et}=q,{float:Lt,fourNumber:Ot}=D,{floor:At,ceil:Dt}=Math;let Mt,It,Wt,Ft;const zt={},Nt={},Yt={},Xt={tempBounds:Yt,set(t,e=0,i=0,s=0,r=0){t.x=e,t.y=i,t.width=s,t.height=r},copy(t,e){t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height},copyAndSpread(t,e,i,s,r){const{x:n,y:o,width:a,height:h}=e;if(d(i)){const e=Ot(i);s?Ut.set(t,n+e[3],o+e[0],a-e[1]-e[3],h-e[2]-e[0]):Ut.set(t,n-e[3],o-e[0],a+e[1]+e[3],h+e[2]+e[0])}else s&&(i=-i),Ut.set(t,n-i,o-i,a+2*i,h+2*i);r&&("width"===r?(t.y=o,t.height=h):(t.x=n,t.width=a))},minX:t=>t.width>0?t.x:t.x+t.width,minY:t=>t.height>0?t.y:t.y+t.height,maxX:t=>t.width>0?t.x+t.width:t.x,maxY:t=>t.height>0?t.y+t.height:t.y,move(t,e,i){t.x+=e,t.y+=i},scroll(t,e){t.x+=e.scrollX,t.y+=e.scrollY},getByMove:(t,e,i)=>(t=Object.assign({},t),Ut.move(t,e,i),t),toOffsetOutBounds(t,e,i){e?jt(e,t):e=t,i||(i=t),e.offsetX=Ut.maxX(i),e.offsetY=Ut.maxY(i),Ut.move(e,-e.offsetX,-e.offsetY)},scale(t,e,i=e,s){s||at.scale(t,e,i),t.width*=e,t.height*=i},scaleOf(t,e,i,s=i){at.scaleOf(t,e,i,s),t.width*=i,t.height*=s},tempToOuterOf:(t,e)=>(Ut.copy(Yt,t),Ut.toOuterOf(Yt,e),Yt),getOuterOf:(t,e)=>(t=Object.assign({},t),Ut.toOuterOf(t,e),t),toOuterOf(t,e,i){if(i||(i=t),0===e.b&&0===e.c){const{a:s,d:r,e:n,f:o}=e;s>0?(i.width=t.width*s,i.x=n+t.x*s):(i.width=t.width*-s,i.x=n+t.x*s-i.width),r>0?(i.height=t.height*r,i.y=o+t.y*r):(i.height=t.height*-r,i.y=o+t.y*r-i.height)}else zt.x=t.x,zt.y=t.y,Et(e,zt,Nt),Rt(Pt,Nt.x,Nt.y),zt.x=t.x+t.width,Et(e,zt,Nt),Ct(Pt,Nt.x,Nt.y),zt.y=t.y+t.height,Et(e,zt,Nt),Ct(Pt,Nt.x,Nt.y),zt.x=t.x,Et(e,zt,Nt),Ct(Pt,Nt.x,Nt.y),Tt(Pt,i)},toInnerOf(t,e,i){i||(i=t),Ut.move(i,-e.e,-e.f),Ut.scale(i,1/e.a,1/e.d)},getFitMatrix(t,e,i=1){const s=Math.min(i,Ut.getFitScale(t,e));return new gt(s,0,0,s,-e.x*s,-e.y*s)},getFitScale(t,e,i){const s=t.width/e.width,r=t.height/e.height;return i?Math.max(s,r):Math.min(s,r)},put(t,e,i="center",s=1,r=!0,o){o||(o=e),n(s)&&(s=Ut.getFitScale(t,e,"cover"===s)),Yt.width=r?e.width*=s:e.width*s,Yt.height=r?e.height*=s:e.height*s,St.toPoint(i,Yt,t,o,!0,!0)},getSpread(t,e,i){const s={};return Ut.copyAndSpread(s,t,e,!1,i),s},spread(t,e,i){Ut.copyAndSpread(t,t,e,!1,i)},shrink(t,e,i){Ut.copyAndSpread(t,t,e,!0,i)},ceil(t){const{x:e,y:i}=t;t.x=At(t.x),t.y=At(t.y),t.width=e>t.x?Dt(t.width+e-t.x):Dt(t.width),t.height=i>t.y?Dt(t.height+i-t.y):Dt(t.height)},unsign(t){t.width<0&&(t.x+=t.width,t.width=-t.width),t.height<0&&(t.y+=t.height,t.height=-t.height)},float(t,e){t.x=Lt(t.x,e),t.y=Lt(t.y,e),t.width=Lt(t.width,e),t.height=Lt(t.height,e)},add(t,e,i){Mt=t.x+t.width,It=t.y+t.height,Wt=e.x,Ft=e.y,i||(Wt+=e.width,Ft+=e.height),Mt=Mt>Wt?Mt:Wt,It=It>Ft?It:Ft,t.x=t.x<e.x?t.x:e.x,t.y=t.y<e.y?t.y:e.y,t.width=Mt-t.x,t.height=It-t.y},addList(t,e){Ut.setListWithFn(t,e,void 0,!0)},setList(t,e,i=!1){Ut.setListWithFn(t,e,void 0,i)},addListWithFn(t,e,i){Ut.setListWithFn(t,e,i,!0)},setListWithFn(t,e,i,s=!1){let r,n=!0;for(let o=0,a=e.length;o<a;o++)r=i?i(e[o],o):e[o],r&&(r.width||r.height)&&(n?(n=!1,s||jt(t,r)):Ht(t,r));n&&Ut.reset(t)},setPoints(t,e){e.forEach((t,e)=>0===e?Rt(Pt,t.x,t.y):Ct(Pt,t.x,t.y)),Tt(Pt,t)},setPoint(t,e){Ut.set(t,e.x,e.y)},addPoint(t,e){Ht(t,e,!0)},getPoints(t){const{x:e,y:i,width:s,height:r}=t;return[{x:e,y:i},{x:e+s,y:i},{x:e+s,y:i+r},{x:e,y:i+r}]},hitRadiusPoint:(t,e,i)=>(i&&(e=at.tempToInnerRadiusPointOf(e,i)),e.x>=t.x-e.radiusX&&e.x<=t.x+t.width+e.radiusX&&e.y>=t.y-e.radiusY&&e.y<=t.y+t.height+e.radiusY),hitPoint:(t,e,i)=>(i&&(e=at.tempToInnerOf(e,i)),e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height),hit:(t,e,i)=>(i&&(e=Ut.tempToOuterOf(e,i)),!(t.y+t.height<e.y||e.y+e.height<t.y||t.x+t.width<e.x||e.x+e.width<t.x)),includes:(t,e,i)=>(i&&(e=Ut.tempToOuterOf(e,i)),t.x<=e.x&&t.y<=e.y&&t.x+t.width>=e.x+e.width&&t.y+t.height>=e.y+e.height),getIntersectData(t,e,i){if(i&&(e=Ut.tempToOuterOf(e,i)),!Ut.hit(t,e))return{x:0,y:0,width:0,height:0};let{x:s,y:r,width:n,height:o}=e;return Mt=s+n,It=r+o,Wt=t.x+t.width,Ft=t.y+t.height,s=s>t.x?s:t.x,r=r>t.y?r:t.y,Mt=Mt<Wt?Mt:Wt,It=It<Ft?It:Ft,n=Mt-s,o=It-r,{x:s,y:r,width:n,height:o}},intersect(t,e,i){Ut.copy(t,Ut.getIntersectData(t,e,i))},isSame:(t,e)=>t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height,isEmpty:t=>0===t.x&&0===t.y&&0===t.width&&0===t.height,hasSize:t=>t.width&&t.height,reset(t){Ut.set(t)}},Ut=Xt,{add:Ht,copy:jt}=Ut;class Vt{get minX(){return Xt.minX(this)}get minY(){return Xt.minY(this)}get maxX(){return Xt.maxX(this)}get maxY(){return Xt.maxY(this)}constructor(t,e,i,s){this.set(t,e,i,s)}set(t,e,i,s){return c(t)?Xt.copy(this,t):Xt.set(this,t,e,i,s),this}get(){const{x:t,y:e,width:i,height:s}=this;return{x:t,y:e,width:i,height:s}}clone(){return new Vt(this)}move(t,e){return Xt.move(this,t,e),this}scale(t,e,i){return Xt.scale(this,t,e,i),this}scaleOf(t,e,i){return Xt.scaleOf(this,t,e,i),this}toOuterOf(t,e){return Xt.toOuterOf(this,t,e),this}toInnerOf(t,e){return Xt.toInnerOf(this,t,e),this}getFitMatrix(t,e){return Xt.getFitMatrix(this,t,e)}put(t,e,i){Xt.put(this,t,e,i)}spread(t,e){return Xt.spread(this,t,e),this}shrink(t,e){return Xt.shrink(this,t,e),this}ceil(){return Xt.ceil(this),this}unsign(){return Xt.unsign(this),this}float(t){return Xt.float(this,t),this}add(t){return Xt.add(this,t),this}addList(t){return Xt.setList(this,t,!0),this}setList(t){return Xt.setList(this,t),this}addListWithFn(t,e){return Xt.setListWithFn(this,t,e,!0),this}setListWithFn(t,e){return Xt.setListWithFn(this,t,e),this}setPoint(t){return Xt.setPoint(this,t),this}setPoints(t){return Xt.setPoints(this,t),this}addPoint(t){return Xt.addPoint(this,t),this}getPoints(){return Xt.getPoints(this)}hitPoint(t,e){return Xt.hitPoint(this,t,e)}hitRadiusPoint(t,e){return Xt.hitRadiusPoint(this,t,e)}hit(t,e){return Xt.hit(this,t,e)}includes(t,e){return Xt.includes(this,t,e)}intersect(t,e){return Xt.intersect(this,t,e),this}getIntersect(t,e){return new Vt(Xt.getIntersectData(this,t,e))}isSame(t){return Xt.isSame(this,t)}isEmpty(){return Xt.isEmpty(this)}reset(){Xt.reset(this)}}const Gt=new Vt;class Kt{constructor(t,e,i,s,r,n){c(t)?this.copy(t):this.set(t,e,i,s,r,n)}set(t=0,e=0,i=0,s=0,r=0,n=0){this.top=t,this.right=e,this.bottom=i,this.left=s,this.width=r,this.height=n}copy(t){const{top:e,right:i,bottom:s,left:r,width:n,height:o}=t;this.set(e,i,s,r,n,o)}getBoundsFrom(t){const{top:e,right:i,bottom:s,left:r,width:n,height:o}=this;return new Vt(r,e,n||t.width-r-i,o||t.height-e-s)}}const qt={number:(t,e)=>c(t)?"percent"===t.type?t.value*e:t.value:t},$t={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,".":1,e:1,E:1},{floor:Qt,max:Jt}=Math,Zt={toURL(t,e){let i=encodeURIComponent(t);return"text"===e?i="data:text/plain;charset=utf-8,"+i:"svg"===e&&(i="data:image/svg+xml,"+i),i},image:{hitCanvasSize:100,maxCacheSize:4096e3,maxPatternSize:8847360,crossOrigin:"anonymous",isLarge:(t,e,i,s)=>t.width*t.height*(e?e*i:1)>(s||te.maxCacheSize),isSuperLarge:(t,e,i)=>te.isLarge(t,e,i,te.maxPatternSize),getRealURL(t){const{prefix:e,suffix:i}=te;return!i||t.startsWith("data:")||t.startsWith("blob:")||(t+=(t.includes("?")?"&":"?")+i),e&&"/"===t[0]&&(t=e+t),t},resize(t,e,i,s,r,n,o,a,h,l){const d=Jt(Qt(e+(s||0)),1),c=Jt(Qt(i+(r||0)),1);let u,_,p;l&&(p=qt.number(l.offset,(u="x"===l.type)?e:i))&&(u||(_=!0));const g=Zt.origin.createCanvas(_?2*d:d,u?2*c:c),f=g.getContext("2d");if(a&&(f.globalAlpha=a),f.imageSmoothingEnabled=!1!==o,te.canUse(t)){if(n){const s=e/n.width,r=i/n.height;f.setTransform(s,0,0,r,-n.x*s,-n.y*r),f.drawImage(t,0,0,t.width,t.height)}else f.drawImage(t,0,0,e,i);p&&(f.drawImage(g,0,0,d,c,u?p-d:d,u?c:p-c,d,c),f.drawImage(g,0,0,d,c,u?p:d,u?c:p,d,c))}return g},canUse:t=>t&&t.width&&!t.__closed,setPatternTransform(t,e,i){try{e&&t.setTransform&&(t.setTransform(e),e=void 0)}catch(t){}i&&p.stintSet(i,"transform",e)}}},{image:te}=Zt,{randColor:ee}=D;class ie{constructor(t){this.repeatMap={},this.name=t}static get(t){return new ie(t)}static set filter(t){this.filterList=se(t)}static set exclude(t){this.excludeList=se(t)}static drawRepaint(t,e){const i=ee();t.fillWorld(e,i.replace("1)",".1)")),t.strokeWorld(e,i)}static drawBounds(t,e,i){const s="hit"===ie.showBounds,r=t.__nowWorld,n=ee();s&&(e.setWorld(r),t.__drawHitPath(e),e.fillStyle=n.replace("1)",".2)"),e.fill()),e.resetTransform(),e.setStroke(n,2),s?e.stroke():e.strokeWorld(r,n)}log(...t){if(re.enable){if(re.filterList.length&&re.filterList.every(t=>t!==this.name))return;if(re.excludeList.length&&re.excludeList.some(t=>t===this.name))return;console.log("%c"+this.name,"color:#21ae62",...t)}}tip(...t){re.enable&&this.warn(...t)}warn(...t){re.showWarn&&console.warn(this.name,...t)}repeat(t,...e){this.repeatMap[t]||(this.warn("repeat:"+t,...e),this.repeatMap[t]=!0)}error(...t){try{throw new Error}catch(e){console.error(this.name,...t,e)}}}function se(t){return t?n(t)&&(t=[t]):t=[],t}ie.filterList=[],ie.excludeList=[],ie.showWarn=!0;const re=ie,ne=ie.get("RunTime"),oe={currentId:0,currentName:"",idMap:{},nameMap:{},nameToIdMap:{},start(t,e){const i=y.create(y.RUNTIME);return ae.currentId=ae.idMap[i]=e?performance.now():Date.now(),ae.currentName=ae.nameMap[i]=t,ae.nameToIdMap[t]=i,i},end(t,e){const i=ae.idMap[t],s=ae.nameMap[t],r=e?(performance.now()-i)/1e3:Date.now()-i;ae.idMap[t]=ae.nameMap[t]=ae.nameToIdMap[s]=void 0,ne.log(s,r,"ms")},endOfName(t,e){const i=ae.nameToIdMap[t];s(i)||ae.end(i,e)}},ae=oe,he=[],le={list:{},add(t,...e){this.list[t]=!0,he.push(...e)},has(t,e){const i=this.list[t];return!i&&e&&this.need(t),i},need(t){console.error("please install and import plugin: "+(t.includes("-x")?"":"@leafer-in/")+t)}};setTimeout(()=>he.forEach(t=>le.has(t,!0)));const de={editor:t=>le.need("editor")},ce=ie.get("UICreator"),ue={list:{},register(t){const{__tag:e}=t.prototype;_e[e]&&ce.repeat(e),_e[e]=t},get(t,e,i,r,n,o){_e[t]||ce.error("not register "+t);const a=new _e[t](e);return s(i)||(a.x=i,r&&(a.y=r),n&&(a.width=n),o&&(a.height=o)),a}},{list:_e}=ue,pe=ie.get("EventCreator"),ge={nameList:{},register(t){let e;Object.keys(t).forEach(i=>{e=t[i],n(e)&&(fe[e]&&pe.repeat(e),fe[e]=t)})},changeName(t,e){const i=fe[t];if(i){const s=Object.keys(i).find(e=>i[e]===t);s&&(i[s]=e,fe[e]=i)}},has(t){return!!this.nameList[t]},get:(t,...e)=>new fe[t](...e)},{nameList:fe}=ge;class ye{constructor(){this.list=[]}add(t){t.manager=this,this.list.push(t)}get(t){let e;const{list:i}=this;for(let s=0,r=i.length;s<r;s++)if(e=i[s],e.recycled&&e.isSameSize(t))return e.recycled=!1,e.manager||(e.manager=this),e;const s=de.canvas(t);return this.add(s),s}recycle(t){t.recycled=!0}clearRecycled(){let t;const e=[];for(let i=0,s=this.list.length;i<s;i++)t=this.list[i],t.recycled?t.destroy():e.push(t);this.list=e}clear(){this.list.forEach(t=>{t.destroy()}),this.list.length=0}destroy(){this.clear()}}function me(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o}function ve(t,e,i,s){return new(i||(i=Promise))(function(r,n){function o(t){try{h(s.next(t))}catch(t){n(t)}}function a(t){try{h(s.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}h((s=s.apply(t,e||[])).next())})}function we(t){return(e,i)=>{t||(t=i);const s={get(){return this.context[t]},set(e){this.context[t]=e}};"strokeCap"===i&&(s.set=function(e){this.context[t]="none"===e?"butt":e}),Object.defineProperty(e,i,s)}}"function"==typeof SuppressedError&&SuppressedError;const xe=[];function be(){return(t,e)=>{xe.push(e)}}const ke=[];let Be=class{set blendMode(t){"normal"===t&&(t="source-over"),this.context.globalCompositeOperation=t}get blendMode(){return this.context.globalCompositeOperation}set dashPattern(t){this.context.setLineDash(t||ke)}get dashPattern(){return this.context.getLineDash()}__bindContext(){let t;xe.forEach(e=>{t=this.context[e],t&&(this[e]=t.bind(this.context))}),this.textBaseline="alphabetic"}setTransform(t,e,i,s,r,n){}resetTransform(){}getTransform(){}save(){}restore(){}transform(t,e,i,s,r,n){c(t)?this.context.transform(t.a,t.b,t.c,t.d,t.e,t.f):this.context.transform(t,e,i,s,r,n)}translate(t,e){}scale(t,e){}rotate(t){}fill(t,e){}stroke(t){}clip(t,e){}fillRect(t,e,i,s){}strokeRect(t,e,i,s){}clearRect(t,e,i,s){}drawImage(t,e,i,s,r,n,o,a,h){switch(arguments.length){case 9:if(e<0){const t=-e/s*a;s+=e,e=0,n+=t,a-=t}if(i<0){const t=-i/r*h;r+=i,i=0,o+=t,h-=t}this.context.drawImage(t,e,i,s,r,n,o,a,h);break;case 5:this.context.drawImage(t,e,i,s,r);break;case 3:this.context.drawImage(t,e,i)}}beginPath(){}moveTo(t,e){}lineTo(t,e){}bezierCurveTo(t,e,i,s,r,n){}quadraticCurveTo(t,e,i,s){}closePath(){}arc(t,e,i,s,r,n){}arcTo(t,e,i,s,r){}ellipse(t,e,i,s,r,n,o,a){}rect(t,e,i,s){}roundRect(t,e,i,s,r){}createConicGradient(t,e,i){}createLinearGradient(t,e,i,s){}createPattern(t,e){}createRadialGradient(t,e,i,s,r,n){}fillText(t,e,i,s){}measureText(t){}strokeText(t,e,i,s){}destroy(){this.context=null}};me([we("imageSmoothingEnabled")],Be.prototype,"smooth",void 0),me([we("imageSmoothingQuality")],Be.prototype,"smoothLevel",void 0),me([we("globalAlpha")],Be.prototype,"opacity",void 0),me([we()],Be.prototype,"fillStyle",void 0),me([we()],Be.prototype,"strokeStyle",void 0),me([we("lineWidth")],Be.prototype,"strokeWidth",void 0),me([we("lineCap")],Be.prototype,"strokeCap",void 0),me([we("lineJoin")],Be.prototype,"strokeJoin",void 0),me([we("lineDashOffset")],Be.prototype,"dashOffset",void 0),me([we()],Be.prototype,"miterLimit",void 0),me([we()],Be.prototype,"shadowBlur",void 0),me([we()],Be.prototype,"shadowColor",void 0),me([we()],Be.prototype,"shadowOffsetX",void 0),me([we()],Be.prototype,"shadowOffsetY",void 0),me([we()],Be.prototype,"filter",void 0),me([we()],Be.prototype,"font",void 0),me([we()],Be.prototype,"fontKerning",void 0),me([we()],Be.prototype,"fontStretch",void 0),me([we()],Be.prototype,"fontVariantCaps",void 0),me([we()],Be.prototype,"textAlign",void 0),me([we()],Be.prototype,"textBaseline",void 0),me([we()],Be.prototype,"textRendering",void 0),me([we()],Be.prototype,"wordSpacing",void 0),me([we()],Be.prototype,"letterSpacing",void 0),me([we()],Be.prototype,"direction",void 0),me([be()],Be.prototype,"setTransform",null),me([be()],Be.prototype,"resetTransform",null),me([be()],Be.prototype,"getTransform",null),me([be()],Be.prototype,"save",null),me([be()],Be.prototype,"restore",null),me([be()],Be.prototype,"translate",null),me([be()],Be.prototype,"scale",null),me([be()],Be.prototype,"rotate",null),me([be()],Be.prototype,"fill",null),me([be()],Be.prototype,"stroke",null),me([be()],Be.prototype,"clip",null),me([be()],Be.prototype,"fillRect",null),me([be()],Be.prototype,"strokeRect",null),me([be()],Be.prototype,"clearRect",null),me([be()],Be.prototype,"beginPath",null),me([be()],Be.prototype,"moveTo",null),me([be()],Be.prototype,"lineTo",null),me([be()],Be.prototype,"bezierCurveTo",null),me([be()],Be.prototype,"quadraticCurveTo",null),me([be()],Be.prototype,"closePath",null),me([be()],Be.prototype,"arc",null),me([be()],Be.prototype,"arcTo",null),me([be()],Be.prototype,"ellipse",null),me([be()],Be.prototype,"rect",null),me([be()],Be.prototype,"roundRect",null),me([be()],Be.prototype,"createConicGradient",null),me([be()],Be.prototype,"createLinearGradient",null),me([be()],Be.prototype,"createPattern",null),me([be()],Be.prototype,"createRadialGradient",null),me([be()],Be.prototype,"fillText",null),me([be()],Be.prototype,"measureText",null),me([be()],Be.prototype,"strokeText",null);const{copy:Se,multiplyParent:Pe,pixelScale:Re}=q,{round:Ce}=Math,Te=new Vt,Ee=new Vt,Le={width:1,height:1,pixelRatio:1},Oe=["width","height","pixelRatio"];class Ae extends Be{get width(){return this.size.width}get height(){return this.size.height}get pixelRatio(){return this.size.pixelRatio}get pixelWidth(){return this.width*this.pixelRatio||0}get pixelHeight(){return this.height*this.pixelRatio||0}get pixelSnap(){return this.config.pixelSnap}set pixelSnap(t){this.config.pixelSnap=t}get allowBackgroundColor(){return this.view&&this.parentView}constructor(t,e){super(),this.size={},this.worldTransform={},t||(t=Le),this.manager=e,this.innerId=y.create(y.CNAVAS);const{width:i,height:s,pixelRatio:r}=t;this.autoLayout=!i||!s,this.size.pixelRatio=r||Zt.devicePixelRatio,this.config=t,this.init()}init(){}__createContext(){const{view:t}=this,{contextSettings:e}=this.config;this.context=e?t.getContext("2d",e):t.getContext("2d"),this.__bindContext()}export(t,e){}toBlob(t,e){}toDataURL(t,e){}saveAs(t,e){}resize(t,e=!0){if(this.isSameSize(t))return;let i;this.context&&!this.unreal&&e&&this.width&&(i=this.getSameCanvas(),i.copyWorld(this));const s=this.size;p.copyAttrs(s,t,Oe),Oe.forEach(t=>s[t]||(s[t]=1)),this.bounds=new Vt(0,0,this.width,this.height),this.updateViewSize(),this.updateClientBounds(),this.context&&(this.smooth=this.config.smooth,!this.unreal&&i&&(this.clearWorld(i.bounds),this.copyWorld(i),i.recycle()))}updateViewSize(){}updateClientBounds(){}getClientBounds(t){return t&&this.updateClientBounds(),this.clientBounds||this.bounds}startAutoLayout(t,e){}stopAutoLayout(){}setCursor(t){}setWorld(t,e){const{pixelRatio:i,pixelSnap:s}=this,r=this.worldTransform;e&&Pe(t,e,r),Re(t,i,r),s&&!t.ignorePixelSnap&&(t.half&&t.half*i%2?(r.e=Ce(r.e-.5)+.5,r.f=Ce(r.f-.5)+.5):(r.e=Ce(r.e),r.f=Ce(r.f))),this.setTransform(r.a,r.b,r.c,r.d,r.e,r.f)}useWorldTransform(t){t&&(this.worldTransform=t);const e=this.worldTransform;e&&this.setTransform(e.a,e.b,e.c,e.d,e.e,e.f)}setStroke(t,e,i,s){e&&(this.strokeWidth=e),t&&(this.strokeStyle=t),i&&this.setStrokeOptions(i,s)}setStrokeOptions(t,e){let{strokeCap:i,strokeJoin:r,dashPattern:n,dashOffset:o,miterLimit:a}=t;e&&(e.strokeCap&&(i=e.strokeCap),e.strokeJoin&&(r=e.strokeJoin),s(e.dashPattern)||(n=e.dashPattern),s(e.dashOffset)||(o=e.dashOffset),e.miterLimit&&(a=e.miterLimit)),this.strokeCap=i,this.strokeJoin=r,this.dashPattern=n,this.dashOffset=o,this.miterLimit=a}saveBlendMode(t){this.savedBlendMode=this.blendMode,this.blendMode=t}restoreBlendMode(){this.blendMode=this.savedBlendMode}hitFill(t,e){return!0}hitStroke(t,e){return!0}hitPixel(t,e,i=1){return!0}setWorldShadow(t,e,i,s){const{pixelRatio:r}=this;this.shadowOffsetX=t*r,this.shadowOffsetY=e*r,this.shadowBlur=i*r,this.shadowColor=s||"black"}setWorldBlur(t){const{pixelRatio:e}=this;this.filter=`blur(${t*e}px)`}copyWorld(t,e,i,s,r){s&&(this.blendMode=s),e?(this.setTempPixelBounds(e,r),i?(this.setTempPixelBounds2(i,r),i=Ee):i=Te,this.drawImage(t.view,Te.x,Te.y,Te.width,Te.height,i.x,i.y,i.width,i.height)):this.drawImage(t.view,0,0),s&&(this.blendMode="source-over")}copyWorldToInner(t,e,i,s,r){e.b||e.c?(this.save(),this.resetTransform(),this.copyWorld(t,e,Xt.tempToOuterOf(i,e),s,r),this.restore()):(s&&(this.blendMode=s),this.setTempPixelBounds(e,r),this.drawImage(t.view,Te.x,Te.y,Te.width,Te.height,i.x,i.y,i.width,i.height),s&&(this.blendMode="source-over"))}copyWorldByReset(t,e,i,s,r,n){this.resetTransform(),this.copyWorld(t,e,i,s,n),r||this.useWorldTransform()}useGrayscaleAlpha(t){let e,i;this.setTempPixelBounds(t,!0,!0);const{context:s}=this,r=s.getImageData(Te.x,Te.y,Te.width,Te.height),{data:n}=r;for(let t=0,s=n.length;t<s;t+=4)i=.299*n[t]+.587*n[t+1]+.114*n[t+2],(e=n[t+3])&&(n[t+3]=255===e?i:e*(i/255));s.putImageData(r,Te.x,Te.y)}useMask(t,e,i){this.copyWorld(t,e,i,"destination-in")}useEraser(t,e,i){this.copyWorld(t,e,i,"destination-out")}fillWorld(t,e,i,s){i&&(this.blendMode=i),this.fillStyle=e,this.setTempPixelBounds(t,s),this.fillRect(Te.x,Te.y,Te.width,Te.height),i&&(this.blendMode="source-over")}strokeWorld(t,e,i,s){i&&(this.blendMode=i),this.strokeStyle=e,this.setTempPixelBounds(t,s),this.strokeRect(Te.x,Te.y,Te.width,Te.height),i&&(this.blendMode="source-over")}clipWorld(t,e=!0){this.beginPath(),this.setTempPixelBounds(t,e),this.rect(Te.x,Te.y,Te.width,Te.height),this.clip()}clipUI(t){t.windingRule?this.clip(t.windingRule):this.clip()}clearWorld(t,e=!0){this.setTempPixelBounds(t,e),this.clearRect(Te.x,Te.y,Te.width,Te.height)}clear(){const{pixelRatio:t}=this;this.clearRect(0,0,this.width*t+2,this.height*t+2)}setTempPixelBounds(t,e,i){this.copyToPixelBounds(Te,t,e,i)}setTempPixelBounds2(t,e,i){this.copyToPixelBounds(Ee,t,e,i)}copyToPixelBounds(t,e,i,s){t.set(e),s&&t.intersect(this.bounds),t.scale(this.pixelRatio),i&&t.ceil()}isSameSize(t){return this.width===t.width&&this.height===t.height&&(!t.pixelRatio||this.pixelRatio===t.pixelRatio)}getSameCanvas(t,e){const{size:i,pixelSnap:s}=this,r=this.manager?this.manager.get(i):de.canvas(Object.assign({},i));return r.save(),t&&(Se(r.worldTransform,this.worldTransform),r.useWorldTransform()),e&&(r.smooth=this.smooth),r.pixelSnap!==s&&(r.pixelSnap=s),r}recycle(t){this.recycled||(this.restore(),t?this.clearWorld(t):this.clear(),this.manager?this.manager.recycle(this):this.destroy())}updateRender(t){}unrealCanvas(){}destroy(){this.manager=this.view=this.parentView=null}}const De={creator:{},parse(t,e){},convertToCanvasData(t,e){}},Me={N:21,D:22,X:23,G:24,F:25,O:26,P:27,U:28},Ie=Object.assign({M:1,m:10,L:2,l:20,H:3,h:30,V:4,v:40,C:5,c:50,S:6,s:60,Q:7,q:70,T:8,t:80,A:9,a:90,Z:11,z:11,R:12},Me),We={M:3,m:3,L:3,l:3,H:2,h:2,V:2,v:2,C:7,c:7,S:5,s:5,Q:5,q:5,T:3,t:3,A:8,a:8,Z:1,z:1,N:5,D:9,X:6,G:9,F:5,O:7,P:4,U:6},Fe={m:10,l:20,H:3,h:30,V:4,v:40,c:50,S:6,s:60,q:70,T:8,t:80,A:9,a:90},ze=Object.assign(Object.assign({},Fe),Me),Ne=Ie,Ye={};for(let t in Ne)Ye[Ne[t]]=t;const Xe={};for(let t in Ne)Xe[Ne[t]]=We[t];const Ue={drawRoundRect(t,e,i,s,r,n){const o=D.fourNumber(n,Math.min(s/2,r/2)),a=e+s,h=i+r;o[0]?t.moveTo(e+o[0],i):t.moveTo(e,i),o[1]?t.arcTo(a,i,a,h,o[1]):t.lineTo(a,i),o[2]?t.arcTo(a,h,e,h,o[2]):t.lineTo(a,h),o[3]?t.arcTo(e,h,e,i,o[3]):t.lineTo(e,h),o[0]?t.arcTo(e,i,a,i,o[0]):t.lineTo(e,i)}},{sin:He,cos:je,hypot:Ve,atan2:Ge,ceil:Ke,abs:qe,PI:$e,sqrt:Qe,pow:Je}=Math,{setPoint:Ze,addPoint:ti}=yt,{set:ei,toNumberPoints:ii}=at,{M:si,L:ri,C:ni,Q:oi,Z:ai}=Ie,hi={},li={points(t,e,i,s){let r=ii(e);if(t.push(si,r[0],r[1]),i&&r.length>5){let e,n,o,a,h,l,d,c,u,_,p,g,f,y,m,v=r.length;const w=!0===i?.5:i;s&&(r=[r[v-2],r[v-1],...r,r[0],r[1],r[2],r[3]],v=r.length);for(let i=2;i<v-2;i+=2)e=r[i-2],n=r[i-1],o=r[i],a=r[i+1],h=r[i+2],l=r[i+3],p=o-e,g=a-n,f=Qe(Je(p,2)+Je(g,2)),y=Qe(Je(h-o,2)+Je(l-a,2)),(f||y)&&(m=f+y,f=w*f/m,y=w*y/m,h-=e,l-=n,d=o-f*h,c=a-f*l,2===i?s||t.push(oi,d,c,o,a):(p||g)&&t.push(ni,u,_,d,c,o,a),u=o+y*h,_=a+y*l);s||t.push(oi,u,_,r[v-2],r[v-1])}else for(let e=2,i=r.length;e<i;e+=2)t.push(ri,r[e],r[e+1]);s&&t.push(ai)},rect(t,e,i,s,r){De.creator.path=t,De.creator.moveTo(e,i).lineTo(e+s,i).lineTo(e+s,i+r).lineTo(e,i+r).lineTo(e,i)},roundRect(t,e,i,s,r,n){De.creator.path=[],Ue.drawRoundRect(De.creator,e,i,s,r,n),t.push(...De.convertToCanvasData(De.creator.path,!0))},arcTo(t,e,i,s,r,n,o,a,h,l,d){const c=s-e,u=r-i,_=n-s,p=o-r;let g=Ge(u,c),f=Ge(p,_);const y=Ve(c,u),m=Ve(_,p);let v=f-g;if(v<0&&(v+=W),y<1e-12||m<1e-12||v<1e-12||qe(v-$e)<1e-12)return t&&t.push(ri,s,r),h&&(Ze(h,e,i),ti(h,s,r)),d&&ei(d,e,i),void(l&&ei(l,s,r));const w=c*p-_*u<0,x=w?-1:1,b=a/je(v/2),k=s+b*je(g+v/2+F*x),B=r+b*He(g+v/2+F*x);return g-=F*x,f-=F*x,ui(t,k,B,a,a,0,g/I,f/I,w,h,l,d)},arc:(t,e,i,s,r,n,o,a,h,l)=>ui(t,e,i,s,s,0,r,n,o,a,h,l),ellipse(t,e,i,s,r,n,o,a,h,l,d,c){const u=n*I,_=He(u),p=je(u);let g=o*I,f=a*I;g>$e&&(g-=W),f<0&&(f+=W);let y=f-g;y<0?y+=W:y>W&&(y-=W),h&&(y-=W);const m=Ke(qe(y/F)),v=y/m,w=He(v/4),x=8/3*w*w/He(v/2);f=g+v;let b,k,B,S,P,R,C,T,E=je(g),L=He(g),O=B=p*s*E-_*r*L,A=S=_*s*E+p*r*L,D=e+B,M=i+S;t&&t.push(t.length?ri:si,D,M),l&&Ze(l,D,M),c&&ei(c,D,M);for(let n=0;n<m;n++)b=je(f),k=He(f),B=p*s*b-_*r*k,S=_*s*b+p*r*k,P=e+O-x*(p*s*L+_*r*E),R=i+A-x*(_*s*L-p*r*E),C=e+B+x*(p*s*k+_*r*b),T=i+S+x*(_*s*k-p*r*b),t&&t.push(ni,P,R,C,T,e+B,i+S),l&&ci(e+O,i+A,P,R,C,T,e+B,i+S,l,!0),O=B,A=S,E=b,L=k,g=f,f+=v;d&&ei(d,e+B,i+S)},quadraticCurveTo(t,e,i,s,r,n,o){t.push(ni,(e+2*s)/3,(i+2*r)/3,(n+2*s)/3,(o+2*r)/3,n,o)},toTwoPointBoundsByQuadraticCurve(t,e,i,s,r,n,o,a){ci(t,e,(t+2*i)/3,(e+2*s)/3,(r+2*i)/3,(n+2*s)/3,r,n,o,a)},toTwoPointBounds(t,e,i,s,r,n,o,a,h,l){const d=[];let c,u,_,p,g,f,y,m,v=t,w=i,x=r,b=o;for(let t=0;t<2;++t)if(1==t&&(v=e,w=s,x=n,b=a),c=-3*v+9*w-9*x+3*b,u=6*v-12*w+6*x,_=3*w-3*v,Math.abs(c)<1e-12){if(Math.abs(u)<1e-12)continue;p=-_/u,0<p&&p<1&&d.push(p)}else y=u*u-4*_*c,m=Math.sqrt(y),y<0||(g=(-u+m)/(2*c),0<g&&g<1&&d.push(g),f=(-u-m)/(2*c),0<f&&f<1&&d.push(f));l?ti(h,t,e):Ze(h,t,e),ti(h,o,a);for(let l=0,c=d.length;l<c;l++)di(d[l],t,e,i,s,r,n,o,a,hi),ti(h,hi.x,hi.y)},getPointAndSet(t,e,i,s,r,n,o,a,h,l){const d=1-t,c=d*d*d,u=3*d*d*t,_=3*d*t*t,p=t*t*t;l.x=c*e+u*s+_*n+p*a,l.y=c*i+u*r+_*o+p*h},getPoint(t,e,i,s,r,n,o,a,h){const l={};return di(t,e,i,s,r,n,o,a,h,l),l},getDerivative(t,e,i,s,r){const n=1-t;return 3*n*n*(i-e)+6*n*t*(s-i)+3*t*t*(r-s)}},{getPointAndSet:di,toTwoPointBounds:ci,ellipse:ui}=li,{sin:_i,cos:pi,sqrt:gi,atan2:fi}=Math,{ellipse:yi}=li,mi={ellipticalArc(t,e,i,s,r,n,o,a,h,l,d){const c=(h-e)/2,u=(l-i)/2,_=n*I,p=_i(_),g=pi(_),f=-g*c-p*u,y=-g*u+p*c,m=s*s,v=r*r,w=y*y,x=f*f,b=m*v-m*w-v*x;let k=0;if(b<0){const t=gi(1-b/(m*v));s*=t,r*=t}else k=(o===a?-1:1)*gi(b/(m*w+v*x));const B=k*s*y/r,S=-k*r*f/s,P=fi((y-S)/r,(f-B)/s),R=fi((-y-S)/r,(-f-B)/s);let C=R-P;0===a&&C>0?C-=W:1===a&&C<0&&(C+=W);const T=e+c+g*B-p*S,E=i+u+p*B+g*S,L=C<0?1:0;d||Zt.ellipseToCurve?yi(t,T,E,s,r,n,P/I,R/I,L):s!==r||n?t.push(Ie.G,T,E,s,r,n,P/I,R/I,L):t.push(Ie.O,T,E,s,P/I,R/I,L)}},vi={toCommand:t=>[],toNode:t=>[]},{M:wi,m:xi,L:bi,l:ki,H:Bi,h:Si,V:Pi,v:Ri,C:Ci,c:Ti,S:Ei,s:Li,Q:Oi,q:Ai,T:Di,t:Mi,A:Ii,a:Wi,Z:Fi,z:zi,N:Ni,D:Yi,X:Xi,G:Ui,F:Hi,O:ji,P:Vi,U:Gi}=Ie,{rect:Ki,roundRect:qi,arcTo:$i,arc:Qi,ellipse:Ji,quadraticCurveTo:Zi}=li,{ellipticalArc:ts}=mi,es=ie.get("PathConvert"),is={},ss={current:{dot:0},stringify(t,e){let i,s,r,n=0,o=t.length,a="";for(;n<o;){s=t[n],i=Xe[s],a+=s===r?" ":Ye[s];for(let s=1;s<i;s++)a+=D.float(t[n+s],e),s===i-1||(a+=" ");r=s,n+=i}return a},parse(t,e){let i,s,r,n="";const o=[],a=e?ze:Fe;for(let e=0,h=t.length;e<h;e++)s=t[e],$t[s]?("."===s&&(rs.dot&&(ns(o,n),n=""),rs.dot++),"0"===n&&"."!==s&&(ns(o,n),n=""),n+=s):Ie[s]?(n&&(ns(o,n),n=""),rs.name=Ie[s],rs.length=We[s],rs.index=0,ns(o,rs.name),!i&&a[s]&&(i=!0)):"-"===s||"+"===s?"e"===r||"E"===r?n+=s:(n&&ns(o,n),n=s):n&&(ns(o,n),n=""),r=s;return n&&ns(o,n),i?ss.toCanvasData(o,e):o},toCanvasData(t,e){let i,s,r,n,o,a=0,h=0,l=0,d=0,c=0,u=t.length;const _=[];for(;c<u;){switch(r=t[c],r){case xi:t[c+1]+=a,t[c+2]+=h;case wi:a=t[c+1],h=t[c+2],_.push(wi,a,h),c+=3;break;case Si:t[c+1]+=a;case Bi:a=t[c+1],_.push(bi,a,h),c+=2;break;case Ri:t[c+1]+=h;case Pi:h=t[c+1],_.push(bi,a,h),c+=2;break;case ki:t[c+1]+=a,t[c+2]+=h;case bi:a=t[c+1],h=t[c+2],_.push(bi,a,h),c+=3;break;case Li:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,r=Ei;case Ei:o=n===Ci||n===Ei,l=o?2*a-i:t[c+1],d=o?2*h-s:t[c+2],i=t[c+1],s=t[c+2],a=t[c+3],h=t[c+4],_.push(Ci,l,d,i,s,a,h),c+=5;break;case Ti:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,t[c+5]+=a,t[c+6]+=h,r=Ci;case Ci:i=t[c+3],s=t[c+4],a=t[c+5],h=t[c+6],_.push(Ci,t[c+1],t[c+2],i,s,a,h),c+=7;break;case Mi:t[c+1]+=a,t[c+2]+=h,r=Di;case Di:o=n===Oi||n===Di,i=o?2*a-i:t[c+1],s=o?2*h-s:t[c+2],e?Zi(_,a,h,i,s,t[c+1],t[c+2]):_.push(Oi,i,s,t[c+1],t[c+2]),a=t[c+1],h=t[c+2],c+=3;break;case Ai:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,r=Oi;case Oi:i=t[c+1],s=t[c+2],e?Zi(_,a,h,i,s,t[c+3],t[c+4]):_.push(Oi,i,s,t[c+3],t[c+4]),a=t[c+3],h=t[c+4],c+=5;break;case Wi:t[c+6]+=a,t[c+7]+=h;case Ii:ts(_,a,h,t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],t[c+7],e),a=t[c+6],h=t[c+7],c+=8;break;case zi:case Fi:_.push(Fi),c++;break;case Ni:a=t[c+1],h=t[c+2],e?Ki(_,a,h,t[c+3],t[c+4]):os(_,t,c,5),c+=5;break;case Yi:a=t[c+1],h=t[c+2],e?qi(_,a,h,t[c+3],t[c+4],[t[c+5],t[c+6],t[c+7],t[c+8]]):os(_,t,c,9),c+=9;break;case Xi:a=t[c+1],h=t[c+2],e?qi(_,a,h,t[c+3],t[c+4],t[c+5]):os(_,t,c,6),c+=6;break;case Ui:Ji(e?_:os(_,t,c,9),t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],t[c+7],t[c+8],null,is),a=is.x,h=is.y,c+=9;break;case Hi:e?Ji(_,t[c+1],t[c+2],t[c+3],t[c+4],0,0,360,!1):os(_,t,c,5),a=t[c+1]+t[c+3],h=t[c+2],c+=5;break;case ji:Qi(e?_:os(_,t,c,7),t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],null,is),a=is.x,h=is.y,c+=7;break;case Vi:e?Qi(_,t[c+1],t[c+2],t[c+3],0,360,!1):os(_,t,c,4),a=t[c+1]+t[c+3],h=t[c+2],c+=4;break;case Gi:$i(e?_:os(_,t,c,6),a,h,t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],null,is),a=is.x,h=is.y,c+=6;break;default:return es.error(`command: ${r} [index:${c}]`,t),_}n=r}return _},objectToCanvasData(t){if(t[0].name.length>1)return vi.toCommand(t);{const e=[];return t.forEach(t=>{switch(t.name){case"M":e.push(wi,t.x,t.y);break;case"L":e.push(bi,t.x,t.y);break;case"C":e.push(Ci,t.x1,t.y1,t.x2,t.y2,t.x,t.y);break;case"Q":e.push(Oi,t.x1,t.y1,t.x,t.y);break;case"Z":e.push(Fi)}}),e}},copyData(t,e,i,s){for(let r=i,n=i+s;r<n;r++)t.push(e[r])},pushData(t,e){rs.index===rs.length&&(rs.index=1,t.push(rs.name)),t.push(Number(e)),rs.index++,rs.dot=0}},{current:rs,pushData:ns,copyData:os}=ss,{M:as,L:hs,C:ls,Q:ds,Z:cs,N:us,D:_s,X:ps,G:gs,F:fs,O:ys,P:ms,U:vs}=Ie,{getMinDistanceFrom:ws,getRadianFrom:xs}=at,{tan:bs,min:ks,abs:Bs}=Math,Ss={},Ps={beginPath(t){t.length=0},moveTo(t,e,i){t.push(as,e,i)},lineTo(t,e,i){t.push(hs,e,i)},bezierCurveTo(t,e,i,s,r,n,o){t.push(ls,e,i,s,r,n,o)},quadraticCurveTo(t,e,i,s,r){t.push(ds,e,i,s,r)},closePath(t){t.push(cs)},rect(t,e,i,s,r){t.push(us,e,i,s,r)},roundRect(t,e,i,s,r,n){if(a(n))t.push(ps,e,i,s,r,n);else{const o=D.fourNumber(n);o?t.push(_s,e,i,s,r,...o):t.push(us,e,i,s,r)}},ellipse(t,e,i,s,n,o,a,h,l){if(s===n)return Cs(t,e,i,s,a,h,l);r(o)?t.push(fs,e,i,s,n):(r(a)&&(a=0),r(h)&&(h=360),t.push(gs,e,i,s,n,o,a,h,l?1:0))},arc(t,e,i,s,n,o,a){r(n)?t.push(ms,e,i,s):(r(n)&&(n=0),r(o)&&(o=360),t.push(ys,e,i,s,n,o,a?1:0))},arcTo(t,e,i,r,n,o,a,h){if(!s(a)){const t=ws(a,h,e,i,r,n);o=ks(o,ks(t/2,t/2*Bs(bs(xs(a,h,e,i,r,n)/2))))}t.push(vs,e,i,r,n,o)},drawEllipse(t,e,i,s,n,o,a,h,l){li.ellipse(null,e,i,s,n,r(o)?0:o,r(a)?0:a,r(h)?360:h,l,null,null,Ss),t.push(as,Ss.x,Ss.y),Rs(t,e,i,s,n,o,a,h,l)},drawArc(t,e,i,s,n,o,a){li.arc(null,e,i,s,r(n)?0:n,r(o)?360:o,a,null,null,Ss),t.push(as,Ss.x,Ss.y),Cs(t,e,i,s,n,o,a)},drawPoints(t,e,i,s){li.points(t,e,i,s)}},{ellipse:Rs,arc:Cs}=Ps,{moveTo:Ts,lineTo:Es,quadraticCurveTo:Ls,bezierCurveTo:Os,closePath:As,beginPath:Ds,rect:Ms,roundRect:Is,ellipse:Ws,arc:Fs,arcTo:zs,drawEllipse:Ns,drawArc:Ys,drawPoints:Xs}=Ps;class Us{set path(t){this.__path=t}get path(){return this.__path}constructor(t){this.set(t)}set(t){return this.__path=t?n(t)?De.parse(t):t:[],this}beginPath(){return Ds(this.__path),this.paint(),this}moveTo(t,e){return Ts(this.__path,t,e),this.paint(),this}lineTo(t,e){return Es(this.__path,t,e),this.paint(),this}bezierCurveTo(t,e,i,s,r,n){return Os(this.__path,t,e,i,s,r,n),this.paint(),this}quadraticCurveTo(t,e,i,s){return Ls(this.__path,t,e,i,s),this.paint(),this}closePath(){return As(this.__path),this.paint(),this}rect(t,e,i,s){return Ms(this.__path,t,e,i,s),this.paint(),this}roundRect(t,e,i,s,r){return Is(this.__path,t,e,i,s,r),this.paint(),this}ellipse(t,e,i,s,r,n,o,a){return Ws(this.__path,t,e,i,s,r,n,o,a),this.paint(),this}arc(t,e,i,s,r,n){return Fs(this.__path,t,e,i,s,r,n),this.paint(),this}arcTo(t,e,i,s,r){return zs(this.__path,t,e,i,s,r),this.paint(),this}drawEllipse(t,e,i,s,r,n,o,a){return Ns(this.__path,t,e,i,s,r,n,o,a),this.paint(),this}drawArc(t,e,i,s,r,n){return Ys(this.__path,t,e,i,s,r,n),this.paint(),this}drawPoints(t,e,i){return Xs(this.__path,t,e,i),this.paint(),this}clearPath(){return this.beginPath()}paint(){}}const{M:Hs,L:js,C:Vs,Q:Gs,Z:Ks,N:qs,D:$s,X:Qs,G:Js,F:Zs,O:tr,P:er,U:ir}=Ie,sr=ie.get("PathDrawer"),rr={drawPathByData(t,e){if(!e)return;let i,s=0,r=e.length;for(;s<r;)switch(i=e[s],i){case Hs:t.moveTo(e[s+1],e[s+2]),s+=3;break;case js:t.lineTo(e[s+1],e[s+2]),s+=3;break;case Vs:t.bezierCurveTo(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5],e[s+6]),s+=7;break;case Gs:t.quadraticCurveTo(e[s+1],e[s+2],e[s+3],e[s+4]),s+=5;break;case Ks:t.closePath(),s+=1;break;case qs:t.rect(e[s+1],e[s+2],e[s+3],e[s+4]),s+=5;break;case $s:t.roundRect(e[s+1],e[s+2],e[s+3],e[s+4],[e[s+5],e[s+6],e[s+7],e[s+8]]),s+=9;break;case Qs:t.roundRect(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]),s+=6;break;case Js:t.ellipse(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]*I,e[s+6]*I,e[s+7]*I,e[s+8]),s+=9;break;case Zs:t.ellipse(e[s+1],e[s+2],e[s+3],e[s+4],0,0,W,!1),s+=5;break;case tr:t.arc(e[s+1],e[s+2],e[s+3],e[s+4]*I,e[s+5]*I,e[s+6]),s+=7;break;case er:t.arc(e[s+1],e[s+2],e[s+3],0,W,!1),s+=4;break;case ir:t.arcTo(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]),s+=6;break;default:return void sr.error(`command: ${i} [index:${s}]`,e)}}},{M:nr,L:or,C:ar,Q:hr,Z:lr,N:dr,D:cr,X:ur,G:_r,F:pr,O:gr,P:fr,U:yr}=Ie,{toTwoPointBounds:mr,toTwoPointBoundsByQuadraticCurve:vr,arcTo:wr,arc:xr,ellipse:br}=li,{addPointBounds:kr,copy:Br,addPoint:Sr,setPoint:Pr,addBounds:Rr,toBounds:Cr}=yt,Tr=ie.get("PathBounds");let Er,Lr,Or;const Ar={},Dr={},Mr={},Ir={toBounds(t,e){Ir.toTwoPointBounds(t,Dr),Cr(Dr,e)},toTwoPointBounds(t,e){if(!t||!t.length)return Pr(e,0,0);let i,s,r,n,o,a=0,h=0,l=0;const d=t.length;for(;a<d;)switch(o=t[a],0===a&&(o===lr||o===ar||o===hr?Pr(e,h,l):Pr(e,t[a+1],t[a+2])),o){case nr:case or:h=t[a+1],l=t[a+2],Sr(e,h,l),a+=3;break;case ar:r=t[a+5],n=t[a+6],mr(h,l,t[a+1],t[a+2],t[a+3],t[a+4],r,n,Ar),kr(e,Ar),h=r,l=n,a+=7;break;case hr:i=t[a+1],s=t[a+2],r=t[a+3],n=t[a+4],vr(h,l,i,s,r,n,Ar),kr(e,Ar),h=r,l=n,a+=5;break;case lr:a+=1;break;case dr:h=t[a+1],l=t[a+2],Rr(e,h,l,t[a+3],t[a+4]),a+=5;break;case cr:case ur:h=t[a+1],l=t[a+2],Rr(e,h,l,t[a+3],t[a+4]),a+=o===cr?9:6;break;case _r:br(null,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],t[a+6],t[a+7],t[a+8],Ar,Mr),0===a?Br(e,Ar):kr(e,Ar),h=Mr.x,l=Mr.y,a+=9;break;case pr:h=t[a+1],l=t[a+2],Lr=t[a+3],Or=t[a+4],Rr(e,h-Lr,l-Or,2*Lr,2*Or),h+=Lr,a+=5;break;case gr:xr(null,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],t[a+6],Ar,Mr),0===a?Br(e,Ar):kr(e,Ar),h=Mr.x,l=Mr.y,a+=7;break;case fr:h=t[a+1],l=t[a+2],Er=t[a+3],Rr(e,h-Er,l-Er,2*Er,2*Er),h+=Er,a+=4;break;case yr:wr(null,h,l,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],Ar,Mr),0===a?Br(e,Ar):kr(e,Ar),h=Mr.x,l=Mr.y,a+=6;break;default:return void Tr.error(`command: ${o} [index:${a}]`,t)}}},{M:Wr,L:Fr,Z:zr}=Ie,{getCenterX:Nr,getCenterY:Yr}=at,{arcTo:Xr}=Ps,Ur={smooth(t,e,i){let s,r,n,o=0,a=0,h=0,l=0,c=0,u=0,_=0,p=0,g=0;d(e)&&(e=e[0]||0);const f=t.length,y=[];for(;o<f;){switch(s=t[o],s){case Wr:l=p=t[o+1],c=g=t[o+2],o+=3,t[o]===Fr?(u=t[o+1],_=t[o+2],y.push(Wr,Nr(l,u),Yr(c,_))):y.push(Wr,l,c);break;case Fr:switch(a=t[o+1],h=t[o+2],o+=3,t[o]){case Fr:Xr(y,a,h,t[o+1],t[o+2],e,p,g);break;case zr:Xr(y,a,h,l,c,e,p,g);break;default:y.push(Fr,a,h)}p=a,g=h;break;case zr:r!==zr&&(Xr(y,l,c,u,_,e,p,g),y.push(zr)),o+=1;break;default:n=Xe[s];for(let e=0;e<n;e++)y.push(t[o+e]);o+=n}r=s}return s!==zr&&(y[1]=l,y[2]=c),y}};function Hr(t){return new Us(t)}const jr=Hr();De.creator=Hr(),De.parse=ss.parse,De.convertToCanvasData=ss.toCanvasData;const{drawRoundRect:Vr}=Ue;function Gr(t){!function(t){t&&!t.roundRect&&(t.roundRect=function(t,e,i,s,r){Vr(this,t,e,i,s,r)})}(t)}const Kr={alphaPixelTypes:["png","webp","svg"],upperCaseTypeMap:{},mineType:t=>!t||t.startsWith("image")?t:("jpg"===t&&(t="jpeg"),"image/"+t),fileType(t){const e=t.split(".");return e[e.length-1]},isOpaqueImage(t){const e=qr.fileType(t);return["jpg","jpeg"].some(t=>t===e)},getExportOptions(t){switch(typeof t){case"object":return t;case"number":return{quality:t};case"boolean":return{blob:t};default:return{}}}},qr=Kr;qr.alphaPixelTypes.forEach(t=>qr.upperCaseTypeMap[t]=t.toUpperCase());const $r=ie.get("TaskProcessor");class Qr{constructor(t){this.parallel=!0,this.time=1,this.id=y.create(y.TASK),this.task=t}run(){return ve(this,void 0,void 0,function*(){try{if(this.isComplete||this.runing)return;if(this.runing=!0,this.canUse&&!this.canUse())return this.cancel();this.task&&(yield this.task())}catch(t){$r.error(t)}})}complete(){this.isComplete=!0,this.parent=this.task=this.canUse=null}cancel(){this.isCancel=!0,this.complete()}}class Jr{get total(){return this.list.length+this.delayNumber}get finishedIndex(){return this.isComplete?0:this.index+this.parallelSuccessNumber}get remain(){return this.isComplete?this.total:this.total-this.finishedIndex}get percent(){const{total:t}=this;let e=0,i=0;for(let s=0;s<t;s++)s<=this.finishedIndex?(i+=this.list[s].time,s===this.finishedIndex&&(e=i)):e+=this.list[s].time;return this.isComplete?1:i/e}constructor(t){this.config={parallel:6},this.list=[],this.running=!1,this.isComplete=!0,this.index=0,this.delayNumber=0,t&&p.assign(this.config,t),this.empty()}add(t,e,i){let r,n,o,h;const l=new Qr(t);return l.parent=this,a(e)?h=e:e&&(n=e.parallel,r=e.start,o=e.time,h=e.delay,i||(i=e.canUse)),o&&(l.time=o),!1===n&&(l.parallel=!1),i&&(l.canUse=i),s(h)?this.push(l,r):(this.delayNumber++,setTimeout(()=>{this.delayNumber&&(this.delayNumber--,this.push(l,r))},h)),this.isComplete=!1,l}push(t,e){this.list.push(t),!1===e||this.timer||(this.timer=setTimeout(()=>this.start()))}empty(){this.index=0,this.parallelSuccessNumber=0,this.list=[],this.parallelList=[],this.delayNumber=0}start(){this.running||(this.running=!0,this.isComplete=!1,this.run())}pause(){clearTimeout(this.timer),this.timer=null,this.running=!1}resume(){this.start()}skip(){this.index++,this.resume()}stop(){this.isComplete=!0,this.list.forEach(t=>{t.isComplete||t.run()}),this.pause(),this.empty()}run(){this.running&&(this.setParallelList(),this.parallelList.length>1?this.runParallelTasks():this.remain?this.runTask():this.onComplete())}runTask(){const t=this.list[this.index];t?t.run().then(()=>{this.onTask(t),this.index++,t.isCancel?this.runTask():this.nextTask()}).catch(t=>{this.onError(t)}):this.timer=setTimeout(()=>this.nextTask())}runParallelTasks(){this.parallelList.forEach(t=>this.runParallelTask(t))}runParallelTask(t){t.run().then(()=>{this.onTask(t),this.fillParallelTask()}).catch(t=>{this.onParallelError(t)})}nextTask(){this.total===this.finishedIndex?this.onComplete():this.timer=setTimeout(()=>this.run())}setParallelList(){let t;const{config:e,list:i,index:s}=this;this.parallelList=[],this.parallelSuccessNumber=0;let r=s+e.parallel;if(r>i.length&&(r=i.length),e.parallel>1)for(let e=s;e<r&&(t=i[e],t.parallel);e++)this.parallelList.push(t)}fillParallelTask(){let t;const e=this.parallelList;this.parallelSuccessNumber++,e.pop();const i=e.length,s=this.finishedIndex+i;if(e.length){if(!this.running)return;s<this.total&&(t=this.list[s],t&&t.parallel&&(e.push(t),this.runParallelTask(t)))}else this.index+=this.parallelSuccessNumber,this.parallelSuccessNumber=0,this.nextTask()}onComplete(){this.stop(),this.config.onComplete&&this.config.onComplete()}onTask(t){t.complete(),this.config.onTask&&this.config.onTask()}onParallelError(t){this.parallelList.forEach(t=>{t.parallel=!1}),this.parallelList.length=0,this.parallelSuccessNumber=0,this.onError(t)}onError(t){this.pause(),this.config.onError&&this.config.onError(t)}destroy(){this.stop()}}const Zr=ie.get("Resource"),tn={tasker:new Jr,map:{},get isComplete(){return en.tasker.isComplete},set(t,e){en.map[t]&&Zr.repeat(t),en.map[t]=e},get:t=>en.map[t],remove(t){const e=en.map[t];e&&(e.destroy&&e.destroy(),delete en.map[t])},loadImage(t,e){return new Promise((i,s)=>{const r=this.setImage(t,t,e);r.load(()=>i(r),t=>s(t))})},setImage(t,e,i){let s;return n(e)?s={url:e}:e.url||(s={url:t,view:e}),s&&(i&&(s.format=i),e=de.image(s)),en.set(t,e),e},destroy(){en.map={}}},en=tn,sn={maxRecycled:10,recycledList:[],patternTasker:new Jr({parallel:1}),get(t){let e=tn.get(t.url);return e||tn.set(t.url,e=de.image(t)),e.use++,e},recycle(t){t.use--,setTimeout(()=>{t.use||(Zt.image.isLarge(t)?t.url&&tn.remove(t.url):(t.clearLevels(),rn.recycledList.push(t)))})},recyclePaint(t){rn.recycle(t.image)},clearRecycled(t){const e=rn.recycledList;(e.length>rn.maxRecycled||t)&&(e.forEach(e=>(!e.use||t)&&e.url&&tn.remove(e.url)),e.length=0)},clearLevels(){},hasAlphaPixel:t=>Kr.alphaPixelTypes.some(e=>rn.isFormat(e,t)),isFormat(t,e){if(e.format)return e.format===t;const{url:i}=e;if(i.startsWith("data:")){if(i.startsWith("data:"+Kr.mineType(t)))return!0}else{if(i.includes("."+t)||i.includes("."+Kr.upperCaseTypeMap[t]))return!0;if("png"===t&&!i.includes("."))return!0}return!1},destroy(){this.clearRecycled(!0)}},rn=sn,{IMAGE:nn,create:on}=y;class an{get url(){return this.config.url}get crossOrigin(){const{crossOrigin:t}=this.config;return s(t)?Zt.image.crossOrigin:t}get completed(){return this.ready||!!this.error}constructor(t){if(this.use=0,this.waitComplete=[],this.innerId=on(nn),this.config=t||(t={url:""}),t.view){const{view:e}=t;this.setView(e.config?e.view:e)}sn.isFormat("svg",t)&&(this.isSVG=!0),sn.hasAlphaPixel(t)&&(this.hasAlphaPixel=!0)}load(t,e,i){return this.loading||(this.loading=!0,tn.tasker.add(()=>ve(this,void 0,void 0,function*(){return yield Zt.origin.loadImage(this.getLoadUrl(i),this.crossOrigin,this).then(t=>{i&&this.setThumbView(t),this.setView(t)}).catch(t=>{this.error=t,this.onComplete(!1)})}))),this.waitComplete.push(t,e),this.waitComplete.length-2}unload(t,e){const i=this.waitComplete;if(e){const e=i[t+1];e&&e({type:"stop"})}i[t]=i[t+1]=void 0}setView(t){this.ready=!0,this.width||(this.width=t.width,this.height=t.height,this.view=t),this.onComplete(!0)}onComplete(t){let e;this.waitComplete.forEach((i,s)=>{e=s%2,i&&(t?e||i(this):e&&i(this.error))}),this.waitComplete.length=0,this.loading=!1}getFull(t){return this.view}getCanvas(t,e,i,s,r,n,o,a){if(t||(t=this.width),e||(e=this.height),this.cache){let{params:t,data:e}=this.cache;for(let i in t)if(t[i]!==arguments[i]){e=null;break}if(e)return e}const h=Zt.image.resize(this.view,t,e,r,n,void 0,o,i,s,a);return this.cache=this.use>1?{data:h,params:arguments}:null,h}getPattern(t,e,i,s){const r=Zt.canvas.createPattern(t,e);return Zt.image.setPatternTransform(r,i,s),r}getLoadUrl(t){return this.url}setThumbView(t){}getThumbSize(t){}getMinLevel(){}getLevelData(t,e,i){}clearLevels(t){}destroy(){this.clearLevels();const{view:t}=this;t&&t.close&&t.close(),this.config={url:""},this.cache=this.view=null,this.waitComplete.length=0}}function hn(t,e,i,s){s||(i.configurable=i.enumerable=!0),Object.defineProperty(t,e,i)}function ln(t,e){return Object.getOwnPropertyDescriptor(t,e)}function dn(t,e){const i="_"+t;return{get(){const t=this[i];return null==t?e:t},set(t){this[i]=t}}}function cn(t,e){return(i,s)=>_n(i,s,t,e&&e(s))}function un(t){return t}function _n(t,e,i,s){const r={get(){return this.__getAttr(e)},set(t){this.__setAttr(e,t)}};hn(t,e,Object.assign(r,s||{})),Xn(t,e,i)}function pn(t){return cn(t)}function gn(t,e){return cn(t,t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.matrixChanged||this.__layout.matrixChange())}}))}function fn(t,e){return cn(t,t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.matrixChanged||this.__layout.matrixChange(),this.__scrollWorld||(this.__scrollWorld={}))}}))}function yn(t){return cn(t,t=>({set(e){this.__setAttr(t,e)&&(this.__hasAutoLayout=!!(this.origin||this.around||this.flow),this.__local||this.__layout.createLocal(),bn(this))}}))}function mn(t,e){return cn(t,t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.scaleChanged||this.__layout.scaleChange())}}))}function vn(t,e){return cn(t,t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.rotationChanged||this.__layout.rotationChange())}}))}function wn(t,e){return cn(t,t=>({set(i){this.__setAttr(t,i,e)&&bn(this)}}))}function xn(t){return cn(t,t=>({set(e){this.__setAttr(t,e)&&(bn(this),this.__.__removeNaturalSize())}}))}function bn(t){t.__layout.boxChanged||t.__layout.boxChange(),t.__hasAutoLayout&&(t.__layout.matrixChanged||t.__layout.matrixChange())}function kn(t){return cn(t,t=>({set(e){const i=this.__;2!==i.__pathInputed&&(i.__pathInputed=e?1:0),e||(i.__pathForRender=void 0),this.__setAttr(t,e),bn(this)}}))}const Bn=wn;function Sn(t,e){return cn(t,t=>({set(i){this.__setAttr(t,i)&&(Pn(this),e&&(this.__.__useStroke=!0))}}))}function Pn(t){t.__layout.strokeChanged||t.__layout.strokeChange(),t.__.__useArrow&&bn(t)}const Rn=Sn;function Cn(t){return cn(t,t=>({set(e){this.__setAttr(t,e),this.__layout.renderChanged||this.__layout.renderChange()}}))}function Tn(t){return cn(t,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange())}}))}function En(t){return cn(t,t=>({set(e){if(this.__setAttr(t,e)){const t=this.__;p.stintSet(t,"__useDim",t.dim||t.bright||t.dimskip),this.__layout.surfaceChange()}}}))}function Ln(t){return cn(t,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.opacityChanged||this.__layout.opacityChange()),this.mask&&An(this)}}))}function On(t){return cn(t,t=>({set(e){const i=this.visible;if(!0===i&&0===e){if(this.animationOut)return this.__runAnimation("out",()=>Dn(this,t,e,i))}else 0===i&&!0===e&&this.animation&&this.__runAnimation("in");Dn(this,t,e,i),this.mask&&An(this)}}))}function An(t){const{parent:e}=t;if(e){const{__hasMask:t}=e;e.__updateMask(),t!==e.__hasMask&&e.forceUpdate()}}function Dn(t,e,i,s){t.__setAttr(e,i)&&(t.__layout.opacityChanged||t.__layout.opacityChange(),0!==s&&0!==i||bn(t))}function Mn(t){return cn(t,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.surfaceChange(),this.waitParent(()=>{this.parent.__layout.childrenSortChange()}))}}))}function In(t){return cn(t,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.boxChanged||this.__layout.boxChange(),this.waitParent(()=>{this.parent.__updateMask(e)}))}}))}function Wn(t){return cn(t,t=>({set(e){this.__setAttr(t,e)&&this.waitParent(()=>{this.parent.__updateEraser(e)})}}))}function Fn(t){return cn(t,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.hitCanvasChanged=!0,"hit"===ie.showBounds&&this.__layout.surfaceChange(),this.leafer&&this.leafer.updateCursor())}}))}function zn(t){return cn(t,t=>({set(e){this.__setAttr(t,e),this.leafer&&this.leafer.updateCursor()}}))}function Nn(t){return(e,i)=>{hn(e,"__DataProcessor",{get:()=>t})}}function Yn(t){return(e,i)=>{hn(e,"__LayoutProcessor",{get:()=>t})}}function Xn(t,e,i){const r=t.__DataProcessor.prototype,n="_"+e,o=function(t){return"set"+t.charAt(0).toUpperCase()+t.slice(1)}(e),a=dn(e,i);if(s(i))a.get=function(){return this[n]};else if("function"==typeof i)a.get=function(){const t=this[n];return null==t?i(this.__leaf):t};else if(c(i)){const t=_(i);a.get=function(){const e=this[n];return null==e?this[n]=t?{}:p.clone(i):e}}const h=t.isBranchLeaf;"width"===e?a.get=function(){const t=this[n];if(null==t){const t=this,e=t.__naturalWidth,s=t.__leaf;return!i||s.pathInputed?s.boxBounds.width:e?t._height&&t.__useNaturalRatio?t._height*e/t.__naturalHeight:e:h&&s.children.length?s.boxBounds.width:i}return t}:"height"===e&&(a.get=function(){const t=this[n];if(null==t){const t=this,e=t.__naturalHeight,s=t.__leaf;return!i||s.pathInputed?s.boxBounds.height:e?t._width&&t.__useNaturalRatio?t._width*e/t.__naturalWidth:e:h&&s.children.length?s.boxBounds.height:i}return t});let l,d=r;for(;!l&&d;)l=ln(d,e),d=d.__proto__;l&&l.set&&(a.set=l.set),r[o]&&(a.set=r[o],delete r[o]),hn(r,e,a)}const Un=new ie("rewrite"),Hn=[],jn=["destroy","constructor"];function Vn(t){return(e,i)=>{Hn.push({name:e.constructor.name+"."+i,run:()=>{e[i]=t}})}}function Gn(){return t=>{Kn()}}function Kn(t){Hn.length&&(Hn.forEach(e=>{t&&Un.error(e.name,"Class@rewriteAble()"),e.run()}),Hn.length=0)}function qn(t,e){return i=>{var s;(t.prototype?(s=t.prototype,Object.getOwnPropertyNames(s)):Object.keys(t)).forEach(s=>{if(!(jn.includes(s)||e&&e.includes(s)))if(t.prototype){ln(t.prototype,s).writable&&(i.prototype[s]=t.prototype[s])}else i.prototype[s]=t[s]})}}function $n(){return t=>{ue.register(t)}}function Qn(){return t=>{ge.register(t)}}setTimeout(()=>Kn(!0));const{copy:Jn,toInnerPoint:Zn,toOuterPoint:to,scaleOfOuter:eo,rotateOfOuter:io,skewOfOuter:so,multiplyParent:ro,divideParent:no,getLayout:oo}=q,ao={},{round:ho}=Math,lo={updateAllMatrix(t,e,i){if(e&&t.__hasAutoLayout&&t.__layout.matrixChanged&&(i=!0),_o(t,e,i),t.isBranch){const{children:s}=t;for(let t=0,r=s.length;t<r;t++)uo(s[t],e,i)}},updateMatrix(t,e,i){const s=t.__layout;e?i&&(s.waitAutoLayout=!0,t.__hasAutoLayout&&(s.matrixChanged=!1)):s.waitAutoLayout&&(s.waitAutoLayout=!1),s.matrixChanged&&t.__updateLocalMatrix(),s.waitAutoLayout||t.__updateWorldMatrix()},updateBounds(t){const e=t.__layout;e.boundsChanged&&t.__updateLocalBounds(),e.waitAutoLayout||t.__updateWorldBounds()},updateAllWorldOpacity(t){if(t.__updateWorldOpacity(),t.isBranch){const{children:e}=t;for(let t=0,i=e.length;t<i;t++)po(e[t])}},updateChange(t){const e=t.__layout;e.stateStyleChanged&&t.updateState(),e.opacityChanged&&po(t),t.__updateChange()},updateAllChange(t){if(fo(t),t.isBranch){const{children:e}=t;for(let t=0,i=e.length;t<i;t++)go(e[t])}},worldHittable(t){for(;t;){if(!t.__.hittable)return!1;t=t.parent}return!0},draggable:t=>(t.draggable||t.editable)&&t.hitSelf&&!t.locked,copyCanvasByWorld(t,e,i,s,r,n){s||(s=t.__nowWorld),t.__worldFlipped||Zt.fullImageShadow?e.copyWorldByReset(i,s,t.__nowWorld,r,n):e.copyWorldToInner(i,s,t.__layout.renderBounds,r)},moveWorld(t,e,i=0,s,r){const n=c(e)?Object.assign({},e):{x:e,y:i};s?to(t.localTransform,n,n,!0):t.parent&&Zn(t.parent.scrollWorldTransform,n,n,!0),co.moveLocal(t,n.x,n.y,r)},moveLocal(t,e,i=0,s){c(e)&&(i=e.y,e=e.x),e+=t.x,i+=t.y,t.leafer&&t.leafer.config.pointSnap&&(e=ho(e),i=ho(i)),s?t.animate({x:e,y:i},s):(t.x=e,t.y=i)},zoomOfWorld(t,e,i,s,r,n){co.zoomOfLocal(t,yo(t,e),i,s,r,n)},zoomOfLocal(t,e,i,s=i,r,n){const o=t.__localMatrix;if(a(s)||(s&&(n=s),s=i),Jn(ao,o),eo(ao,e,i,s),co.hasHighPosition(t))co.setTransform(t,ao,r,n);else{const e=t.x+ao.e-o.e,a=t.y+ao.f-o.f;n&&!r?t.animate({x:e,y:a,scaleX:t.scaleX*i,scaleY:t.scaleY*s},n):(t.x=e,t.y=a,t.scaleResize(i,s,!0!==r))}},rotateOfWorld(t,e,i,s){co.rotateOfLocal(t,yo(t,e),i,s)},rotateOfLocal(t,e,i,s){const r=t.__localMatrix;Jn(ao,r),io(ao,e,i),co.hasHighPosition(t)?co.setTransform(t,ao,!1,s):t.set({x:t.x+ao.e-r.e,y:t.y+ao.f-r.f,rotation:D.formatRotation(t.rotation+i)},s)},skewOfWorld(t,e,i,s,r,n){co.skewOfLocal(t,yo(t,e),i,s,r,n)},skewOfLocal(t,e,i,s=0,r,n){Jn(ao,t.__localMatrix),so(ao,e,i,s),co.setTransform(t,ao,r,n)},transformWorld(t,e,i,s){Jn(ao,t.worldTransform),ro(ao,e),t.parent&&no(ao,t.parent.scrollWorldTransform),co.setTransform(t,ao,i,s)},transform(t,e,i,s){Jn(ao,t.localTransform),ro(ao,e),co.setTransform(t,ao,i,s)},setTransform(t,e,i,s){const r=t.__,n=r.origin&&co.getInnerOrigin(t,r.origin),o=oo(e,n,r.around&&co.getInnerOrigin(t,r.around));if(co.hasOffset(t)&&(o.x-=r.offsetX,o.y-=r.offsetY),i){const e=o.scaleX/t.scaleX,i=o.scaleY/t.scaleY;if(delete o.scaleX,delete o.scaleY,n){Xt.scale(t.boxBounds,Math.abs(e),Math.abs(i));const s=co.getInnerOrigin(t,r.origin);at.move(o,n.x-s.x,n.y-s.y)}t.set(o),t.scaleResize(e,i,!1)}else t.set(o,s)},getFlipTransform(t,e){const i={a:1,b:0,c:0,d:1,e:0,f:0},s="x"===e?1:-1;return eo(i,co.getLocalOrigin(t,"center"),-1*s,1*s),i},getLocalOrigin:(t,e)=>at.tempToOuterOf(co.getInnerOrigin(t,e),t.localTransform),getInnerOrigin(t,e){const i={};return bt.toPoint(e,t.boxBounds,i),i},getRelativeWorld:(t,e,i)=>(Jn(ao,t.worldTransform),no(ao,e.scrollWorldTransform),i?ao:Object.assign({},ao)),drop(t,e,i,s){t.setTransform(co.getRelativeWorld(t,e,!0),s),e.add(t,i)},hasHighPosition:t=>t.origin||t.around||co.hasOffset(t),hasOffset:t=>t.offsetX||t.offsetY,hasParent(t,e){if(!e)return!1;for(;t;){if(e===t)return!0;t=t.parent}},animateMove(t,e,i=.3){if(e.x||e.y)if(Math.abs(e.x)<1&&Math.abs(e.y)<1)t.move(e);else{const s=e.x*i,r=e.y*i;e.x-=s,e.y-=r,t.move(s,r),Zt.requestRender(()=>co.animateMove(t,e,i))}}},co=lo,{updateAllMatrix:uo,updateMatrix:_o,updateAllWorldOpacity:po,updateAllChange:go,updateChange:fo}=co;function yo(t,e){return t.updateLayout(),t.parent?at.tempToInnerOf(e,t.parent.scrollWorldTransform):e}const mo={worldBounds:t=>t.__world,localBoxBounds:t=>t.__.eraser||0===t.__.visible?null:t.__local||t.__layout,localStrokeBounds:t=>t.__.eraser||0===t.__.visible?null:t.__layout.localStrokeBounds,localRenderBounds:t=>t.__.eraser||0===t.__.visible?null:t.__layout.localRenderBounds,maskLocalBoxBounds:(t,e)=>wo(t,e)&&t.__localBoxBounds,maskLocalStrokeBounds:(t,e)=>wo(t,e)&&t.__layout.localStrokeBounds,maskLocalRenderBounds:(t,e)=>wo(t,e)&&t.__layout.localRenderBounds,excludeRenderBounds:(t,e)=>!(!e.bounds||e.bounds.hit(t.__world,e.matrix))||!(!e.hideBounds||!e.hideBounds.includes(t.__world,e.matrix))};let vo;function wo(t,e){return e||(vo=0),t.__.mask&&(vo=1),vo<0?null:(vo&&(vo=-1),!0)}const{updateBounds:xo}=lo,bo={sort:(t,e)=>t.__.zIndex===e.__.zIndex?t.__tempNumber-e.__tempNumber:t.__.zIndex-e.__.zIndex,pushAllChildBranch(t,e){if(t.__tempNumber=1,t.__.__childBranchNumber){const{children:i}=t;for(let s=0,r=i.length;s<r;s++)(t=i[s]).isBranch&&(t.__tempNumber=1,e.add(t),ko(t,e))}},pushAllParent(t,e){const{keys:i}=e;if(i)for(;t.parent&&s(i[t.parent.innerId]);)e.add(t.parent),t=t.parent;else for(;t.parent;)e.add(t.parent),t=t.parent},pushAllBranchStack(t,e){let i=e.length;const{children:s}=t;for(let t=0,i=s.length;t<i;t++)s[t].isBranch&&e.push(s[t]);for(let t=i,s=e.length;t<s;t++)Bo(e[t],e)},updateBounds(t,e){const i=[t];Bo(t,i),So(i,e)},updateBoundsByBranchStack(t,e){let i,s;for(let r=t.length-1;r>-1;r--){i=t[r],s=i.children;for(let t=0,e=s.length;t<e;t++)xo(s[t]);e&&e===i||xo(i)}},move(t,e,i){let s;const{children:r}=t;for(let n=0,o=r.length;n<o;n++)s=(t=r[n]).__world,s.e+=e,s.f+=i,s.x+=e,s.y+=i,t.isBranch&&Po(t,e,i)},scale(t,e,i,s,r,n,o){let a;const{children:h}=t,l=s-1,d=r-1;for(let c=0,u=h.length;c<u;c++)a=(t=h[c]).__world,a.a*=s,a.d*=r,(a.b||a.c)&&(a.b*=s,a.c*=r),a.e===a.x&&a.f===a.y?(a.x=a.e+=(a.e-n)*l+e,a.y=a.f+=(a.f-o)*d+i):(a.e+=(a.e-n)*l+e,a.f+=(a.f-o)*d+i,a.x+=(a.x-n)*l+e,a.y+=(a.y-o)*d+i),a.width*=s,a.height*=r,a.scaleX*=s,a.scaleY*=r,t.isBranch&&Ro(t,e,i,s,r,n,o)}},{pushAllChildBranch:ko,pushAllBranchStack:Bo,updateBoundsByBranchStack:So,move:Po,scale:Ro}=bo,Co={run(t){if(t&&t.length){const e=t.length;for(let i=0;i<e;i++)t[i]();t.length===e?t.length=0:t.splice(0,e)}}},{getRelativeWorld:To,updateBounds:Eo}=lo,{toOuterOf:Lo,getPoints:Oo,copy:Ao}=Xt,Do="_localContentBounds",Mo="_worldContentBounds",Io="_worldBoxBounds",Wo="_worldStrokeBounds";class Fo{get contentBounds(){return this._contentBounds||this.boxBounds}set contentBounds(t){this._contentBounds=t}get strokeBounds(){return this._strokeBounds||this.boxBounds}get renderBounds(){return this._renderBounds||this.boxBounds}set renderBounds(t){this._renderBounds=t}get localContentBounds(){return Lo(this.contentBounds,this.leaf.__localMatrix,this[Do]||(this[Do]={})),this[Do]}get localStrokeBounds(){return this._localStrokeBounds||this}get localRenderBounds(){return this._localRenderBounds||this}get worldContentBounds(){return Lo(this.contentBounds,this.leaf.__world,this[Mo]||(this[Mo]={})),this[Mo]}get worldBoxBounds(){return Lo(this.boxBounds,this.leaf.__world,this[Io]||(this[Io]={})),this[Io]}get worldStrokeBounds(){return Lo(this.strokeBounds,this.leaf.__world,this[Wo]||(this[Wo]={})),this[Wo]}get a(){return 1}get b(){return 0}get c(){return 0}get d(){return 1}get e(){return this.leaf.__.x}get f(){return this.leaf.__.y}get x(){return this.e+this.boxBounds.x}get y(){return this.f+this.boxBounds.y}get width(){return this.boxBounds.width}get height(){return this.boxBounds.height}constructor(t){this.leaf=t,this.leaf.__local&&(this._localRenderBounds=this._localStrokeBounds=this.leaf.__local),t.__world&&(this.boxBounds={x:0,y:0,width:0,height:0},this.boxChange(),this.matrixChange())}createLocal(){const t=this.leaf.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0};this._localStrokeBounds||(this._localStrokeBounds=t),this._localRenderBounds||(this._localRenderBounds=t)}update(){const{leaf:t}=this,{leafer:e}=t;if(t.isApp)return Eo(t);if(e)e.ready?e.watcher.changed&&e.layouter.layout():e.start();else{let e=t;for(;e.parent&&!e.parent.leafer;)e=e.parent;const i=e;if(i.__fullLayouting)return;i.__fullLayouting=!0,Zt.layout(i),delete i.__fullLayouting}}getTransform(t="world"){this.update();const{leaf:e}=this;switch(t){case"world":return e.__world;case"local":return e.__localMatrix;case"inner":return q.defaultMatrix;case"page":t=e.zoomLayer;default:return To(e,t)}}getBounds(t,e="world"){switch(this.update(),e){case"world":return this.getWorldBounds(t);case"local":return this.getLocalBounds(t);case"inner":return this.getInnerBounds(t);case"page":e=this.leaf.zoomLayer;default:return new Vt(this.getInnerBounds(t)).toOuterOf(this.getTransform(e))}}getInnerBounds(t="box"){switch(t){case"render":return this.renderBounds;case"content":if(this.contentBounds)return this.contentBounds;case"box":return this.boxBounds;case"stroke":return this.strokeBounds}}getLocalBounds(t="box"){switch(t){case"render":return this.localRenderBounds;case"stroke":return this.localStrokeBounds;case"content":if(this.contentBounds)return this.localContentBounds;case"box":return this.leaf.__localBoxBounds}}getWorldBounds(t="box"){switch(t){case"render":return this.leaf.__world;case"stroke":return this.worldStrokeBounds;case"content":if(this.contentBounds)return this.worldContentBounds;case"box":return this.worldBoxBounds}}getLayoutBounds(t,e="world",i){const{leaf:s}=this;let r,n,o,a=this.getInnerBounds(t);switch(e){case"world":r=s.getWorldPoint(a),n=s.__world;break;case"local":const{scaleX:t,scaleY:i,rotation:h,skewX:l,skewY:d}=s.__;o={scaleX:t,scaleY:i,rotation:h,skewX:l,skewY:d},r=s.getLocalPointByInner(a);break;case"inner":r=a,n=q.defaultMatrix;break;case"page":e=s.zoomLayer;default:r=s.getWorldPoint(a,e),n=To(s,e,!0)}if(o||(o=q.getLayout(n)),Ao(o,a),at.copy(o,r),i){const{scaleX:t,scaleY:e}=o,i=Math.abs(t),s=Math.abs(e);1===i&&1===s||(o.scaleX/=i,o.scaleY/=s,o.width*=i,o.height*=s)}return o}getLayoutPoints(t,e="world"){const{leaf:i}=this,r=Oo(this.getInnerBounds(t));let n;switch(e){case"world":n=null;break;case"local":n=i.parent;break;case"inner":break;case"page":e=i.zoomLayer;default:n=e}return s(n)||r.forEach(t=>i.innerToWorld(t,null,!1,n)),r}shrinkContent(){const{x:t,y:e,width:i,height:s}=this.boxBounds;this._contentBounds={x:t,y:e,width:i,height:s}}spreadStroke(){const{x:t,y:e,width:i,height:s}=this.strokeBounds;this._strokeBounds={x:t,y:e,width:i,height:s},this._localStrokeBounds={x:t,y:e,width:i,height:s},this.renderSpread||this.spreadRenderCancel()}spreadRender(){const{x:t,y:e,width:i,height:s}=this.renderBounds;this._renderBounds={x:t,y:e,width:i,height:s},this._localRenderBounds={x:t,y:e,width:i,height:s}}shrinkContentCancel(){this._contentBounds=void 0}spreadStrokeCancel(){const t=this.renderBounds===this.strokeBounds;this._strokeBounds=this.boxBounds,this._localStrokeBounds=this.leaf.__localBoxBounds,t&&this.spreadRenderCancel()}spreadRenderCancel(){this._renderBounds=this._strokeBounds,this._localRenderBounds=this._localStrokeBounds}boxChange(){this.boxChanged=!0,this.localBoxChanged?this.boundsChanged||(this.boundsChanged=!0):this.localBoxChange(),this.hitCanvasChanged=!0}localBoxChange(){this.localBoxChanged=!0,this.boundsChanged=!0}strokeChange(){this.strokeChanged=!0,this.strokeSpread||(this.strokeSpread=1),this.boundsChanged=!0,this.hitCanvasChanged=!0}renderChange(){this.renderChanged=!0,this.renderSpread||(this.renderSpread=1),this.boundsChanged=!0}scaleChange(){this.scaleChanged=!0,this._scaleOrRotationChange()}rotationChange(){this.rotationChanged=!0,this.affectRotation=!0,this._scaleOrRotationChange()}_scaleOrRotationChange(){this.affectScaleOrRotation=!0,this.matrixChange(),this.leaf.__local||this.createLocal()}matrixChange(){this.matrixChanged=!0,this.localBoxChanged?this.boundsChanged||(this.boundsChanged=!0):this.localBoxChange()}surfaceChange(){this.surfaceChanged=!0}opacityChange(){this.opacityChanged=!0,this.surfaceChanged||this.surfaceChange()}childrenSortChange(){this.childrenSortChanged||(this.childrenSortChanged=this.affectChildrenSort=!0,this.leaf.forceUpdate("surface"))}destroy(){}}class zo{constructor(t,e){this.bubbles=!1,this.type=t,e&&(this.target=e)}stopDefault(){this.isStopDefault=!0,this.origin&&Zt.event.stopDefault(this.origin)}stopNow(){this.isStopNow=!0,this.isStop=!0,this.origin&&Zt.event.stopNow(this.origin)}stop(){this.isStop=!0,this.origin&&Zt.event.stop(this.origin)}}class No extends zo{constructor(t,e,i){super(t,e),this.parent=i,this.child=e}}No.ADD="child.add",No.REMOVE="child.remove",No.CREATED="created",No.MOUNTED="mounted",No.UNMOUNTED="unmounted",No.DESTROY="destroy";const Yo="property.scroll";class Xo extends zo{constructor(t,e,i,s,r){super(t,e),this.attrName=i,this.oldValue=s,this.newValue=r}}Xo.CHANGE="property.change",Xo.LEAFER_CHANGE="property.leafer_change",Xo.SCROLL=Yo;const Uo={scrollX:Yo,scrollY:Yo};class Ho extends zo{constructor(t,e){super(t),Object.assign(this,e)}}Ho.LOAD="image.load",Ho.LOADED="image.loaded",Ho.ERROR="image.error";class jo extends zo{static checkHas(t,e,i){"on"===i?e===qo?t.__hasWorldEvent=!0:t.__hasLocalEvent=!0:(t.__hasLocalEvent=t.hasEvent(Vo)||t.hasEvent(Go)||t.hasEvent(Ko),t.__hasWorldEvent=t.hasEvent(qo))}static emitLocal(t){if(t.leaferIsReady){const{resized:e}=t.__layout;"local"!==e&&(t.emit(Vo,t),"inner"===e&&t.emit(Go,t)),t.emit(Ko,t)}}static emitWorld(t){t.leaferIsReady&&t.emit(qo,this)}}jo.RESIZE="bounds.resize",jo.INNER="bounds.inner",jo.LOCAL="bounds.local",jo.WORLD="bounds.world";const{RESIZE:Vo,INNER:Go,LOCAL:Ko,WORLD:qo}=jo,$o={};[Vo,Go,Ko,qo].forEach(t=>$o[t]=1);class Qo extends zo{get bigger(){if(!this.old)return!0;const{width:t,height:e}=this.old;return this.width>=t&&this.height>=e}get smaller(){return!this.bigger}get samePixelRatio(){return!this.old||this.pixelRatio===this.old.pixelRatio}constructor(t,e){c(t)?(super(Qo.RESIZE),Object.assign(this,t)):super(t),this.old=e}static isResizing(t){return this.resizingKeys&&!s(this.resizingKeys[t.innerId])}}Qo.RESIZE="resize";class Jo extends zo{constructor(t,e){super(t),this.data=e}}Jo.REQUEST="watch.request",Jo.DATA="watch.data";class Zo extends zo{constructor(t,e,i){super(t),e&&(this.data=e,this.times=i)}}Zo.REQUEST="layout.request",Zo.START="layout.start",Zo.BEFORE="layout.before",Zo.LAYOUT="layout",Zo.AFTER="layout.after",Zo.AGAIN="layout.again",Zo.END="layout.end";class ta extends zo{constructor(t,e,i,s){super(t),e&&(this.times=e),i&&(this.renderBounds=i,this.renderOptions=s)}}ta.REQUEST="render.request",ta.CHILD_START="render.child_start",ta.CHILD_END="render.child_end",ta.START="render.start",ta.BEFORE="render.before",ta.RENDER="render",ta.AFTER="render.after",ta.AGAIN="render.again",ta.END="render.end",ta.NEXT="render.next";class ea extends zo{}ea.START="leafer.start",ea.BEFORE_READY="leafer.before_ready",ea.READY="leafer.ready",ea.AFTER_READY="leafer.after_ready",ea.VIEW_READY="leafer.view_ready",ea.VIEW_COMPLETED="leafer.view_completed",ea.STOP="leafer.stop",ea.RESTART="leafer.restart",ea.END="leafer.end",ea.UPDATE_MODE="leafer.update_mode",ea.TRANSFORM="leafer.transform",ea.MOVE="leafer.move",ea.SCALE="leafer.scale",ea.ROTATE="leafer.rotate",ea.SKEW="leafer.skew";const{MOVE:ia,SCALE:sa,ROTATE:ra,SKEW:na}=ea,oa={x:ia,y:ia,scaleX:sa,scaleY:sa,rotation:ra,skewX:na,skewY:na},aa={};class ha{set event(t){this.on(t)}on(t,e,i){if(!e){let e;if(d(t))t.forEach(t=>this.on(t[0],t[1],t[2]));else for(let i in t)d(e=t[i])?this.on(i,e[0],e[1]):this.on(i,e);return}let s,r,o;i&&("once"===i?r=!0:"boolean"==typeof i?s=i:(s=i.capture,r=i.once));const a=la(this,s,!0),h=n(t)?t.split(" "):t,l=r?{listener:e,once:r}:{listener:e};h.forEach(t=>{t&&(o=a[t],o?-1===o.findIndex(t=>t.listener===e)&&o.push(l):a[t]=[l],$o[t]&&jo.checkHas(this,t,"on"))})}off(t,e,i){if(t){const s=n(t)?t.split(" "):t;if(e){let t,r,n;i&&(t="boolean"==typeof i?i:"once"!==i&&i.capture);const o=la(this,t);s.forEach(t=>{t&&(r=o[t],r&&(n=r.findIndex(t=>t.listener===e),n>-1&&r.splice(n,1),r.length||delete o[t],$o[t]&&jo.checkHas(this,t,"off")))})}else{const{__bubbleMap:t,__captureMap:e}=this;s.forEach(i=>{t&&delete t[i],e&&delete e[i]})}}else this.__bubbleMap=this.__captureMap=void 0}on_(t,e,i,s){return e?this.on(t,i?e=e.bind(i):e,s):d(t)&&t.forEach(t=>this.on(t[0],t[2]?t[1]=t[1].bind(t[2]):t[1],t[3])),{type:t,current:this,listener:e,options:s}}off_(t){if(!t)return;const e=d(t)?t:[t];e.forEach(t=>{t&&(t.listener?t.current.off(t.type,t.listener,t.options):d(t.type)&&t.type.forEach(e=>t.current.off(e[0],e[1],e[3])))}),e.length=0}once(t,e,i,s){if(!e)return d(t)&&t.forEach(t=>this.once(t[0],t[1],t[2],t[3]));c(i)?e=e.bind(i):s=i,this.on(t,e,{once:!0,capture:s})}emit(t,e,i){!e&&ge.has(t)&&(e=ge.get(t,{type:t,target:this,current:this}));const s=la(this,i)[t];if(s){let r;for(let n=0,o=s.length;n<o&&!((r=s[n])&&(r.listener(e),r.once&&(this.off(t,r.listener,i),n--,o--),e&&e.isStopNow));n++);}this.syncEventer&&this.syncEventer.emitEvent(e,i)}emitEvent(t,e){t.current=this,this.emit(t.type,t,e)}hasEvent(t,e){if(this.syncEventer&&this.syncEventer.hasEvent(t,e))return!0;const{__bubbleMap:i,__captureMap:r}=this,n=i&&i[t],o=r&&r[t];return!!(s(e)?n||o:e?o:n)}destroy(){this.__captureMap=this.__bubbleMap=this.syncEventer=null}}function la(t,e,i){if(e){const{__captureMap:e}=t;return e||(i?t.__captureMap={}:aa)}{const{__bubbleMap:e}=t;return e||(i?t.__bubbleMap={}:aa)}}const{on:da,on_:ca,off:ua,off_:_a,once:pa,emit:ga,emitEvent:fa,hasEvent:ya,destroy:ma}=ha.prototype,va={on:da,on_:ca,off:ua,off_:_a,once:pa,emit:ga,emitEvent:fa,hasEvent:ya,destroyEventer:ma},wa=ie.get("setAttr"),xa={__setAttr(t,e,i){if(this.leaferIsCreated){const r=this.__.__getInput(t);if(!i||o(e)||s(e)||(wa.warn(this.innerName,t,e),e=void 0),c(e)||r!==e){if(this.__realSetAttr(t,e),this.isLeafer){this.emitEvent(new Xo(Xo.LEAFER_CHANGE,this,t,r,e));const i=oa[t];i&&(this.emitEvent(new ea(i,this)),this.emitEvent(new ea(ea.TRANSFORM,this)))}this.emitPropertyEvent(Xo.CHANGE,t,r,e);const i=Uo[t];return i&&this.emitPropertyEvent(i,t,r,e),!0}return!1}return this.__realSetAttr(t,e),!0},emitPropertyEvent(t,e,i,s){const r=new Xo(t,this,e,i,s);this.isLeafer||this.hasEvent(t)&&this.emitEvent(r),this.leafer.emitEvent(r)},__realSetAttr(t,e){const i=this.__;i[t]=e,this.__proxyData&&this.setProxyAttr(t,e),i.normalStyle&&(this.lockNormalStyle||s(i.normalStyle[t])||(i.normalStyle[t]=e))},__getAttr(t){return this.__proxyData?this.getProxyAttr(t):this.__.__get(t)}},{setLayout:ba,multiplyParent:ka,translateInner:Ba,defaultWorld:Sa}=q,{toPoint:Pa,tempPoint:Ra}=bt,Ca={__updateWorldMatrix(){const{parent:t,__layout:e,__world:i,__scrollWorld:s,__:r}=this;ka(this.__local||e,t?t.__scrollWorld||t.__world:Sa,i,!!e.affectScaleOrRotation,r),s&&Ba(Object.assign(s,i),r.scrollX,r.scrollY)},__updateLocalMatrix(){if(this.__local){const t=this.__layout,e=this.__local,i=this.__;t.affectScaleOrRotation&&(t.scaleChanged&&(t.resized||(t.resized="scale"))||t.rotationChanged)&&(ba(e,i,null,null,t.affectRotation),t.scaleChanged=t.rotationChanged=void 0),e.e=i.x+i.offsetX,e.f=i.y+i.offsetY,(i.around||i.origin)&&(Pa(i.around||i.origin,t.boxBounds,Ra),Ba(e,-Ra.x,-Ra.y,!i.around))}this.__layout.matrixChanged=void 0}},{updateMatrix:Ta,updateAllMatrix:Ea}=lo,{updateBounds:La}=bo,{toOuterOf:Oa,copyAndSpread:Aa,copy:Da}=Xt,{toBounds:Ma}=Ir,Ia={__updateWorldBounds(){const{__layout:t,__world:e}=this;Oa(t.renderBounds,e,e),t.resized&&("inner"===t.resized&&this.__onUpdateSize(),this.__hasLocalEvent&&jo.emitLocal(this),t.resized=void 0),this.__hasWorldEvent&&jo.emitWorld(this)},__updateLocalBounds(){const t=this.__layout;t.boxChanged&&(this.__.__pathInputed||this.__updatePath(),this.__updateRenderPath(),this.__updateBoxBounds(),t.resized="inner"),t.localBoxChanged&&(this.__local&&this.__updateLocalBoxBounds(),t.localBoxChanged=void 0,t.strokeSpread&&(t.strokeChanged=!0),t.renderSpread&&(t.renderChanged=!0),this.parent&&this.parent.__layout.boxChange()),t.boxChanged=void 0,t.strokeChanged&&(t.strokeSpread=this.__updateStrokeSpread(),t.strokeSpread?(t.strokeBounds===t.boxBounds&&t.spreadStroke(),this.__updateStrokeBounds(),this.__updateLocalStrokeBounds()):t.spreadStrokeCancel(),t.strokeChanged=void 0,(t.renderSpread||t.strokeSpread!==t.strokeBoxSpread)&&(t.renderChanged=!0),this.parent&&this.parent.__layout.strokeChange(),t.resized="inner"),t.renderChanged&&(t.renderSpread=this.__updateRenderSpread(),t.renderSpread?(t.renderBounds!==t.boxBounds&&t.renderBounds!==t.strokeBounds||t.spreadRender(),this.__updateRenderBounds(),this.__updateLocalRenderBounds()):t.spreadRenderCancel(),t.renderChanged=void 0,this.parent&&this.parent.__layout.renderChange()),t.resized||(t.resized="local"),t.boundsChanged=void 0},__updateLocalBoxBounds(){this.__hasMotionPath&&this.__updateMotionPath(),this.__hasAutoLayout&&this.__updateAutoLayout(),Oa(this.__layout.boxBounds,this.__local,this.__local)},__updateLocalStrokeBounds(){Oa(this.__layout.strokeBounds,this.__localMatrix,this.__layout.localStrokeBounds)},__updateLocalRenderBounds(){Oa(this.__layout.renderBounds,this.__localMatrix,this.__layout.localRenderBounds)},__updateBoxBounds(t,e){const i=this.__layout.boxBounds,s=this.__;s.__usePathBox?Ma(s.path,i):(i.x=0,i.y=0,i.width=s.width,i.height=s.height)},__updateAutoLayout(){this.__layout.matrixChanged=!0,this.isBranch?(this.__extraUpdate(),this.__.flow?(this.__layout.boxChanged&&this.__updateFlowLayout(),Ea(this),La(this,this),this.__.__autoSide&&this.__updateBoxBounds(!0)):(Ea(this),La(this,this))):Ta(this)},__updateNaturalSize(){const{__:t,__layout:e}=this;t.__naturalWidth=e.boxBounds.width,t.__naturalHeight=e.boxBounds.height},__updateStrokeBounds(t){const e=this.__layout;Aa(e.strokeBounds,e.boxBounds,e.strokeBoxSpread)},__updateRenderBounds(t){const e=this.__layout,{renderSpread:i}=e;a(i)&&i<=0?Da(e.renderBounds,e.strokeBounds):Aa(e.renderBounds,e.boxBounds,i)}},Wa={__render(t,e){if(e.shape)return this.__renderShape(t,e);if((!e.cellList||e.cellList.has(this))&&this.__worldOpacity){const i=this.__;if(i.bright&&!e.topRendering)return e.topList.add(this);if(t.setWorld(this.__nowWorld=this.__getNowWorld(e)),t.opacity=e.dimOpacity&&!i.dimskip?i.opacity*e.dimOpacity:i.opacity,this.__.__single){if("path"===i.eraser)return this.__renderEraser(t,e);const s=t.getSameCanvas(!0,!0);this.__draw(s,e,t),lo.copyCanvasByWorld(this,t,s,this.__nowWorld,i.__blendMode,!0),s.recycle(this.__nowWorld)}else this.__draw(t,e);ie.showBounds&&ie.drawBounds(this,t,e)}},__renderShape(t,e){this.__worldOpacity&&(t.setWorld(this.__nowWorld=this.__getNowWorld(e)),this.__drawShape(t,e))},__clip(t,e){this.__worldOpacity&&(t.setWorld(this.__nowWorld=this.__getNowWorld(e)),this.__drawRenderPath(t),t.clipUI(this))},__updateWorldOpacity(){this.__worldOpacity=this.__.visible?this.parent?this.parent.__worldOpacity*this.__.opacity:this.__.opacity:0,this.__layout.opacityChanged&&(this.__layout.opacityChanged=!1)}},{excludeRenderBounds:Fa}=mo,{hasSize:za}=Xt,Na={__updateChange(){const{__layout:t}=this;t.childrenSortChanged&&(this.__updateSortChildren(),t.childrenSortChanged=!1),this.__.__checkSingle()},__render(t,e){const i=this.__nowWorld=this.__getNowWorld(e);if(this.__worldOpacity&&za(i)){const s=this.__;if(s.__useDim)if(s.dim)e.dimOpacity=!0===s.dim?.2:s.dim;else{if(s.bright&&!e.topRendering)return e.topList.add(this);s.dimskip&&e.dimOpacity&&(e.dimOpacity=0)}if(s.__single&&!this.isBranchLeaf){if("path"===s.eraser)return this.__renderEraser(t,e);const r=t.getSameCanvas(!1,!0);this.__renderBranch(r,e),t.opacity=e.dimOpacity?s.opacity*e.dimOpacity:s.opacity,t.copyWorldByReset(r,i,i,s.__blendMode,!0),r.recycle(i)}else this.__renderBranch(t,e)}},__renderBranch(t,e){if(this.__hasMask)this.__renderMask(t,e);else{const{children:i}=this;for(let s=0,r=i.length;s<r;s++)Fa(i[s],e)||i[s].__render(t,e)}},__clip(t,e){if(this.__worldOpacity){const{children:i}=this;for(let s=0,r=i.length;s<r;s++)Fa(i[s],e)||i[s].__clip(t,e)}}},Ya={},{LEAF:Xa,create:Ua}=y,{stintSet:Ha}=p,{toInnerPoint:ja,toOuterPoint:Va,multiplyParent:Ga}=q,{toOuterOf:Ka}=Xt,{copy:qa,move:$a}=at,{moveLocal:Qa,zoomOfLocal:Ja,rotateOfLocal:Za,skewOfLocal:th,moveWorld:eh,zoomOfWorld:ih,rotateOfWorld:sh,skewOfWorld:rh,transform:nh,transformWorld:oh,setTransform:ah,getFlipTransform:hh,getLocalOrigin:lh,getRelativeWorld:dh,drop:ch}=lo;let uh=class{get tag(){return this.__tag}set tag(t){}get __tag(){return"Leaf"}get innerName(){return this.__.name||this.tag+this.innerId}get __DataProcessor(){return f}get __LayoutProcessor(){return Fo}get leaferIsCreated(){return this.leafer&&this.leafer.created}get leaferIsReady(){return this.leafer&&this.leafer.ready}get isLeafer(){return!1}get isBranch(){return!1}get isBranchLeaf(){return!1}get __localMatrix(){return this.__local||this.__layout}get __localBoxBounds(){return this.__local||this.__layout}get worldTransform(){return this.__layout.getTransform("world")}get localTransform(){return this.__layout.getTransform("local")}get scrollWorldTransform(){return this.updateLayout(),this.__scrollWorld||this.__world}get boxBounds(){return this.getBounds("box","inner")}get renderBounds(){return this.getBounds("render","inner")}get worldBoxBounds(){return this.getBounds("box")}get worldStrokeBounds(){return this.getBounds("stroke")}get worldRenderBounds(){return this.getBounds("render")}get worldOpacity(){return this.updateLayout(),this.__worldOpacity}get __worldFlipped(){return this.__world.scaleX<0||this.__world.scaleY<0}get __onlyHitMask(){return this.__hasMask&&!this.__.hitChildren}get __ignoreHitWorld(){return(this.__hasMask||this.__hasEraser)&&this.__.hitChildren}get __inLazyBounds(){return this.leaferIsCreated&&this.leafer.lazyBounds.hit(this.__world)}get pathInputed(){return this.__.__pathInputed}set event(t){this.on(t)}constructor(t){this.innerId=Ua(Xa),this.reset(t),this.__bubbleMap&&this.__emitLifeEvent(No.CREATED)}reset(t){this.leafer&&this.leafer.forceRender(this.__world),0!==t&&(this.__world={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},null!==t&&(this.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0})),this.__worldOpacity=1,this.__=new this.__DataProcessor(this),this.__layout=new this.__LayoutProcessor(this),this.__level&&this.resetCustom(),t&&(t.__&&(t=t.toJSON()),t.children?this.set(t):Object.assign(this,t))}resetCustom(){this.__hasMask=this.__hasEraser=null,this.forceUpdate()}waitParent(t,e){e&&(t=t.bind(e)),this.parent?t():this.on(No.ADD,t,"once")}waitLeafer(t,e){e&&(t=t.bind(e)),this.leafer?t():this.on(No.MOUNTED,t,"once")}nextRender(t,e,i){this.leafer?this.leafer.nextRender(t,e,i):this.waitLeafer(()=>this.leafer.nextRender(t,e,i))}removeNextRender(t){this.nextRender(t,null,"off")}__bindLeafer(t){if(this.isLeafer&&null!==t&&(t=this),this.leafer&&!t&&this.leafer.leafs--,this.leafer=t,t?(t.leafs++,this.__level=this.parent?this.parent.__level+1:1,this.animation&&this.__runAnimation("in"),this.__bubbleMap&&this.__emitLifeEvent(No.MOUNTED)):this.__emitLifeEvent(No.UNMOUNTED),this.isBranch){const{children:e}=this;for(let i=0,s=e.length;i<s;i++)e[i].__bindLeafer(t)}}set(t,e){}get(t){}setAttr(t,e){this[t]=e}getAttr(t){return this[t]}getComputedAttr(t){return this.__[t]}toJSON(t){return t&&this.__layout.update(),this.__.__getInputData(null,t)}toString(t){return JSON.stringify(this.toJSON(t))}toSVG(){}__SVG(t){}toHTML(){}__setAttr(t,e){return!0}__getAttr(t){}setProxyAttr(t,e){}getProxyAttr(t){}find(t,e){}findTag(t){}findOne(t,e){}findId(t){}focus(t){}updateState(){}updateLayout(){this.__layout.update()}forceUpdate(t){s(t)?t="width":"surface"===t&&(t="blendMode");const e=this.__.__getInput(t);this.__[t]=s(e)?null:void 0,this[t]=e}forceRender(t,e){this.forceUpdate("surface")}__extraUpdate(){this.leaferIsReady&&this.leafer.layouter.addExtra(this)}__updateWorldMatrix(){}__updateLocalMatrix(){}__updateWorldBounds(){}__updateLocalBounds(){}__updateLocalBoxBounds(){}__updateLocalStrokeBounds(){}__updateLocalRenderBounds(){}__updateBoxBounds(t,e){}__updateContentBounds(){}__updateStrokeBounds(t){}__updateRenderBounds(t){}__updateAutoLayout(){}__updateFlowLayout(){}__updateNaturalSize(){}__updateStrokeSpread(){return 0}__updateRenderSpread(){return 0}__onUpdateSize(){}__updateEraser(t){this.__hasEraser=!!t||this.children.some(t=>t.__.eraser)}__renderEraser(t,e){t.save(),this.__clip(t,e);const{renderBounds:i}=this.__layout;t.clearRect(i.x,i.y,i.width,i.height),t.restore()}__updateMask(t){this.__hasMask=this.children.some(t=>t.__.mask&&t.__.visible&&t.__.opacity)}__renderMask(t,e){}__getNowWorld(t){if(t.matrix){this.__cameraWorld||(this.__cameraWorld={});const e=this.__cameraWorld,i=this.__world;return Ga(i,t.matrix,e,void 0,i),Ka(this.__layout.renderBounds,e,e),Ha(e,"half",i.half),Ha(e,"ignorePixelSnap",i.ignorePixelSnap),e}return this.__world}getClampRenderScale(){let{scaleX:t}=this.__nowWorld||this.__world;return t<0&&(t=-t),t>1?t:1}getRenderScaleData(t,e){let{scaleX:i,scaleY:s}=sn.patternLocked?this.__world:this.__nowWorld;return t&&(i<0&&(i=-i),s<0&&(s=-s)),(!0===e||"zoom-in"===e&&i>1&&s>1)&&(i=s=1),Ya.scaleX=i,Ya.scaleY=s,Ya}getTransform(t){return this.__layout.getTransform(t||"local")}getBounds(t,e){return this.__layout.getBounds(t,e)}getLayoutBounds(t,e,i){return this.__layout.getLayoutBounds(t,e,i)}getLayoutPoints(t,e){return this.__layout.getLayoutPoints(t,e)}getWorldBounds(t,e,i){const s=e?dh(this,e):this.worldTransform,r=i?t:{};return Ka(t,s,r),r}worldToLocal(t,e,i,s){this.parent?this.parent.worldToInner(t,e,i,s):e&&qa(e,t)}localToWorld(t,e,i,s){this.parent?this.parent.innerToWorld(t,e,i,s):e&&qa(e,t)}worldToInner(t,e,i,s){s&&(s.innerToWorld(t,e,i),t=e||t),ja(this.scrollWorldTransform,t,e,i)}innerToWorld(t,e,i,s){Va(this.scrollWorldTransform,t,e,i),s&&s.worldToInner(e||t,null,i)}getBoxPoint(t,e,i,s){return this.getBoxPointByInner(this.getInnerPoint(t,e,i,s),null,null,!0)}getBoxPointByInner(t,e,i,s){const r=s?t:Object.assign({},t),{x:n,y:o}=this.boxBounds;return $a(r,-n,-o),r}getInnerPoint(t,e,i,s){const r=s?t:{};return this.worldToInner(t,r,i,e),r}getInnerPointByBox(t,e,i,s){const r=s?t:Object.assign({},t),{x:n,y:o}=this.boxBounds;return $a(r,n,o),r}getInnerPointByLocal(t,e,i,s){return this.getInnerPoint(t,this.parent,i,s)}getLocalPoint(t,e,i,s){const r=s?t:{};return this.worldToLocal(t,r,i,e),r}getLocalPointByInner(t,e,i,s){return this.getWorldPoint(t,this.parent,i,s)}getPagePoint(t,e,i,s){return(this.leafer?this.leafer.zoomLayer:this).getInnerPoint(t,e,i,s)}getWorldPoint(t,e,i,s){const r=s?t:{};return this.innerToWorld(t,r,i,e),r}getWorldPointByBox(t,e,i,s){return this.getWorldPoint(this.getInnerPointByBox(t,null,null,s),e,i,!0)}getWorldPointByLocal(t,e,i,s){const r=s?t:{};return this.localToWorld(t,r,i,e),r}getWorldPointByPage(t,e,i,s){return(this.leafer?this.leafer.zoomLayer:this).getWorldPoint(t,e,i,s)}setTransform(t,e,i){ah(this,t,e,i)}transform(t,e,i){nh(this,t,e,i)}move(t,e,i){Qa(this,t,e,i)}moveInner(t,e,i){eh(this,t,e,!0,i)}scaleOf(t,e,i,s,r){Ja(this,lh(this,t),e,i,s,r)}rotateOf(t,e,i){Za(this,lh(this,t),e,i)}skewOf(t,e,i,s,r){th(this,lh(this,t),e,i,s,r)}transformWorld(t,e,i){oh(this,t,e,i)}moveWorld(t,e,i){eh(this,t,e,!1,i)}scaleOfWorld(t,e,i,s,r){ih(this,t,e,i,s,r)}rotateOfWorld(t,e){sh(this,t,e)}skewOfWorld(t,e,i,s,r){rh(this,t,e,i,s,r)}flip(t,e){nh(this,hh(this,t),!1,e)}scaleResize(t,e=t,i){this.scaleX*=t,this.scaleY*=e}__scaleResize(t,e){}resizeWidth(t){}resizeHeight(t){}hit(t,e){return!0}__hitWorld(t,e){return!0}__hit(t,e){return!0}__hitFill(t){return!0}__hitStroke(t,e){return!0}__hitPixel(t){return!0}__drawHitPath(t){}__updateHitCanvas(){}__render(t,e){}__drawFast(t,e){}__draw(t,e,i){}__clip(t,e){}__renderShape(t,e){}__drawShape(t,e){}__updateWorldOpacity(){}__updateChange(){}__drawPath(t){}__drawRenderPath(t){}__updatePath(){}__updateRenderPath(){}getMotionPathData(){return le.need("path")}getMotionPoint(t){return le.need("path")}getMotionTotal(){return 0}__updateMotionPath(){}__runAnimation(t,e){}__updateSortChildren(){}add(t,e){}remove(t,e){this.parent&&this.parent.remove(this,e)}dropTo(t,e,i){ch(this,t,e,i)}on(t,e,i){}off(t,e,i){}on_(t,e,i,s){}off_(t){}once(t,e,i,s){}emit(t,e,i){}emitEvent(t,e){}hasEvent(t,e){return!1}static changeAttr(t,e,i){i?this.addAttr(t,e,i):Xn(this.prototype,t,e)}static addAttr(t,e,i,s){i||(i=wn),i(e,s)(this.prototype,t)}__emitLifeEvent(t){this.hasEvent(t)&&this.emitEvent(new No(t,this,this.parent))}destroy(){this.destroyed||(this.parent&&this.remove(),this.children&&this.clear(),this.__emitLifeEvent(No.DESTROY),this.__.destroy(),this.__layout.destroy(),this.destroyEventer(),this.destroyed=!0)}};uh=me([qn(xa),qn(Ca),qn(Ia),qn(va),qn(Wa)],uh);const{setListWithFn:_h}=Xt,{sort:ph}=bo,{localBoxBounds:gh,localStrokeBounds:fh,localRenderBounds:yh,maskLocalBoxBounds:mh,maskLocalStrokeBounds:vh,maskLocalRenderBounds:wh}=mo,xh=new ie("Branch");let bh=class extends uh{__updateStrokeSpread(){const{children:t}=this;for(let e=0,i=t.length;e<i;e++)if(t[e].__layout.strokeSpread)return 1;return 0}__updateRenderSpread(){const{children:t}=this;for(let e=0,i=t.length;e<i;e++)if(t[e].__layout.renderSpread)return 1;return 0}__updateBoxBounds(t,e){_h(e||this.__layout.boxBounds,this.children,this.__hasMask?mh:gh)}__updateStrokeBounds(t){_h(t||this.__layout.strokeBounds,this.children,this.__hasMask?vh:fh)}__updateRenderBounds(t){_h(t||this.__layout.renderBounds,this.children,this.__hasMask?wh:yh)}__updateSortChildren(){let t;const{children:e}=this;if(e.length>1){for(let i=0,s=e.length;i<s;i++)e[i].__tempNumber=i,e[i].__.zIndex&&(t=!0);e.sort(ph),this.__layout.affectChildrenSort=t}}add(t,e){if(t===this||t.destroyed)return xh.warn("add self or destroyed");const i=s(e);if(!t.__){if(d(t))return t.forEach(t=>{this.add(t,e),i||e++});t=ue.get(t.tag,t)}t.parent&&t.parent.remove(t),t.parent=this,i?this.children.push(t):this.children.splice(e,0,t),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||0)+1);const r=t.__layout;r.boxChanged||r.boxChange(),r.matrixChanged||r.matrixChange(),t.__bubbleMap&&t.__emitLifeEvent(No.ADD),this.leafer&&(t.__bindLeafer(this.leafer),this.leafer.created&&this.__emitChildEvent(No.ADD,t)),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}addMany(...t){this.add(t)}remove(t,e){t?t.__?t.animationOut?t.__runAnimation("out",()=>this.__remove(t,e)):this.__remove(t,e):this.find(t).forEach(t=>this.remove(t,e)):s(t)&&super.remove(null,e)}removeAll(t){const{children:e}=this;e.length&&(this.children=[],this.__preRemove(),this.__.__childBranchNumber=0,e.forEach(e=>{this.__realRemoveChild(e),t&&e.destroy()}))}clear(){this.removeAll(!0)}__remove(t,e){const i=this.children.indexOf(t);i>-1&&(this.children.splice(i,1),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||1)-1),this.__preRemove(),this.__realRemoveChild(t),e&&t.destroy())}__preRemove(){this.__hasMask&&this.__updateMask(),this.__hasEraser&&this.__updateEraser(),this.__layout.boxChange(),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}__realRemoveChild(t){t.__emitLifeEvent(No.REMOVE),t.parent=null,this.leafer&&(t.__bindLeafer(null),this.leafer.created&&(this.__emitChildEvent(No.REMOVE,t),this.leafer.hitCanvasManager&&this.leafer.hitCanvasManager.clear()))}__emitChildEvent(t,e){const i=new No(t,e,this);this.hasEvent(t)&&!this.isLeafer&&this.emitEvent(i),this.leafer.emitEvent(i)}};bh=me([qn(Na)],bh);class kh{get length(){return this.list.length}constructor(t){this.reset(),t&&(d(t)?this.addList(t):this.add(t))}has(t){return t&&!s(this.keys[t.innerId])}indexAt(t){return this.list[t]}indexOf(t){const e=this.keys[t.innerId];return s(e)?-1:e}add(t){const{list:e,keys:i}=this;s(i[t.innerId])&&(e.push(t),i[t.innerId]=e.length-1)}addAt(t,e=0){const{keys:i}=this;if(s(i[t.innerId])){const{list:s}=this;for(let t=e,r=s.length;t<r;t++)i[s[t].innerId]++;0===e?s.unshift(t):(e>s.length&&(e=s.length),s.splice(e,0,t)),i[t.innerId]=e}}addList(t){for(let e=0;e<t.length;e++)this.add(t[e])}remove(t){const{list:e}=this;let i;for(let r=0,n=e.length;r<n;r++)s(i)?e[r].innerId===t.innerId&&(i=r,delete this.keys[t.innerId]):this.keys[e[r].innerId]=r-1;s(i)||e.splice(i,1)}sort(t){const{list:e}=this;t?e.sort((t,e)=>e.__level-t.__level):e.sort((t,e)=>t.__level-e.__level)}forEach(t){this.list.forEach(t)}clone(){const t=new kh;return t.list=[...this.list],t.keys=Object.assign({},this.keys),t}update(){this.keys={};const{list:t,keys:e}=this;for(let i=0,s=t.length;i<s;i++)e[t[i].innerId]=i}reset(){this.list=[],this.keys={}}destroy(){this.reset()}}class Bh{get length(){return this._length}constructor(t){this._length=0,this.reset(),t&&(d(t)?this.addList(t):this.add(t))}has(t){return!s(this.keys[t.innerId])}without(t){return s(this.keys[t.innerId])}sort(t){const{levels:e}=this;t?e.sort((t,e)=>e-t):e.sort((t,e)=>t-e)}addList(t){t.forEach(t=>{this.add(t)})}add(t){const{keys:e,levelMap:i}=this;e[t.innerId]||(e[t.innerId]=1,i[t.__level]?i[t.__level].push(t):(i[t.__level]=[t],this.levels.push(t.__level)),this._length++)}forEach(t){let e;this.levels.forEach(i=>{e=this.levelMap[i];for(let i=0,s=e.length;i<s;i++)t(e[i])})}reset(){this.levelMap={},this.keys={},this.levels=[],this._length=0}destroy(){this.levelMap=null}}const Sh="2.0.0",Ph=ie.get("LeaferCanvas");class Rh extends Ae{set zIndex(t){const{style:e}=this.view;e.zIndex=t,this.setAbsolute(this.view)}set childIndex(t){const{view:e,parentView:i}=this;if(e&&i){const s=i.children[t];s?(this.setAbsolute(s),i.insertBefore(e,s)):i.appendChild(s)}}init(){const{config:t}=this,e=t.view||t.canvas;e?this.__createViewFrom(e):this.__createView();const{style:i}=this.view;if(i.display||(i.display="block"),this.parentView=this.view.parentElement,this.parentView){const t=this.parentView.style;t.webkitUserSelect=t.userSelect="none",this.view.classList.add("leafer-canvas-view")}Zt.syncDomFont&&!this.parentView&&(i.display="none",document.body&&document.body.appendChild(this.view)),this.__createContext(),this.autoLayout||this.resize(t)}set backgroundColor(t){this.view.style.backgroundColor=t}get backgroundColor(){return this.view.style.backgroundColor}set hittable(t){this.view.style.pointerEvents=t?"auto":"none"}get hittable(){return"none"!==this.view.style.pointerEvents}__createView(){this.view=document.createElement("canvas")}__createViewFrom(t){let e=n(t)?document.getElementById(t):t;if(e)if(e instanceof HTMLCanvasElement)this.view=e;else{let t=e;if(e===window||e===document){const e=document.createElement("div"),{style:i}=e;i.position="absolute",i.top=i.bottom=i.left=i.right="0px",document.body.appendChild(e),t=e}this.__createView();const i=this.view;t.hasChildNodes()&&(this.setAbsolute(i),t.style.position||(t.style.position="relative")),t.appendChild(i)}else Ph.error(`no id: ${t}`),this.__createView()}setAbsolute(t){const{style:e}=t;e.position="absolute",e.top=e.left="0px"}updateViewSize(){const{width:t,height:e,pixelRatio:i}=this,{style:s}=this.view;s.width=t+"px",s.height=e+"px",this.unreal||(this.view.width=Math.ceil(t*i),this.view.height=Math.ceil(e*i))}updateClientBounds(){this.view.parentElement&&(this.clientBounds=this.view.getBoundingClientRect())}startAutoLayout(t,e){if(this.resizeListener=e,t){if(this.autoBounds=t,this.resizeObserver)return;try{this.resizeObserver=new ResizeObserver(t=>{this.updateClientBounds();for(const e of t)this.checkAutoBounds(e.contentRect)});const t=this.parentView;t?(this.resizeObserver.observe(t),this.checkAutoBounds(t.getBoundingClientRect())):(this.checkAutoBounds(this.view),Ph.warn("no parent"))}catch(t){this.imitateResizeObserver()}this.stopListenPixelRatio()}else this.listenPixelRatio(),this.unreal&&this.updateViewSize()}imitateResizeObserver(){this.autoLayout&&(this.parentView&&this.checkAutoBounds(this.parentView.getBoundingClientRect()),Zt.requestRender(this.imitateResizeObserver.bind(this)))}listenPixelRatio(){this.windowListener||window.addEventListener("resize",this.windowListener=()=>{const t=Zt.devicePixelRatio;if(!this.config.pixelRatio&&this.pixelRatio!==t){const{width:e,height:i}=this;this.emitResize({width:e,height:i,pixelRatio:t})}})}stopListenPixelRatio(){this.windowListener&&(window.removeEventListener("resize",this.windowListener),this.windowListener=null)}checkAutoBounds(t){const e=this.view,{x:i,y:s,width:r,height:n}=this.autoBounds.getBoundsFrom(t),o={width:r,height:n,pixelRatio:this.config.pixelRatio?this.pixelRatio:Zt.devicePixelRatio};if(!this.isSameSize(o)){const{style:t}=e;t.marginLeft=i+"px",t.marginTop=s+"px",this.emitResize(o)}}stopAutoLayout(){this.autoLayout=!1,this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeListener=this.resizeObserver=null}emitResize(t){const e={};p.copyAttrs(e,this,Oe),this.resize(t),this.resizeListener&&!s(this.width)&&this.resizeListener(new Qo(t,e))}unrealCanvas(){if(!this.unreal&&this.parentView){let t=this.view;t&&t.remove(),t=this.view=document.createElement("div"),this.parentView.appendChild(this.view),t.classList.add("leafer-app-view"),this.unreal=!0}}destroy(){const{view:t}=this;t&&(this.stopAutoLayout(),this.stopListenPixelRatio(),t.parentElement&&t.remove(),super.destroy())}}Gr(CanvasRenderingContext2D.prototype),Gr(Path2D.prototype);const{mineType:Ch,fileType:Th}=Kr;function Eh(t,e){Zt.origin={createCanvas(t,e){const i=document.createElement("canvas");return i.width=t,i.height=e,i},canvasToDataURL:(t,e,i)=>{const s=Ch(e),r=t.toDataURL(s,i);return"image/bmp"===s?r.replace("image/png;","image/bmp;"):r},canvasToBolb:(t,e,i)=>new Promise(s=>t.toBlob(s,Ch(e),i)),canvasSaveAs:(t,e,i)=>{const s=t.toDataURL(Ch(Th(e)),i);return Zt.origin.download(s,e)},download:(t,e)=>new Promise(i=>{let s=document.createElement("a");s.href=t,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),i()}),loadImage:t=>new Promise((e,i)=>{const s=new Zt.origin.Image,{crossOrigin:r}=Zt.image;r&&(s.setAttribute("crossOrigin",r),s.crossOrigin=r),s.onload=()=>{e(s)},s.onerror=t=>{i(t)},s.src=Zt.image.getRealURL(t)}),Image:Image,PointerEvent:PointerEvent,DragEvent:DragEvent},Zt.event={stopDefault(t){t.preventDefault()},stopNow(t){t.stopImmediatePropagation()},stop(t){t.stopPropagation()}},Zt.canvas=de.canvas(),Zt.conicGradientSupport=!!Zt.canvas.context.createConicGradient}Object.assign(de,{canvas:(t,e)=>new Rh(t,e),image:t=>new an(t)}),Zt.name="web",Zt.isMobile="ontouchstart"in window,Zt.requestRender=function(t){window.requestAnimationFrame(t)},hn(Zt,"devicePixelRatio",{get:()=>devicePixelRatio});const{userAgent:Lh}=navigator;Lh.indexOf("Firefox")>-1?(Zt.conicGradientRotate90=!0,Zt.intWheelDeltaY=!0,Zt.syncDomFont=!0):(/iPhone|iPad|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent))&&(Zt.fullImageShadow=!0),Lh.indexOf("Windows")>-1?(Zt.os="Windows",Zt.intWheelDeltaY=!0):Lh.indexOf("Mac")>-1?Zt.os="Mac":Lh.indexOf("Linux")>-1&&(Zt.os="Linux");class Oh{get childrenChanged(){return this.hasAdd||this.hasRemove||this.hasVisible}get updatedList(){if(this.hasRemove&&this.config.usePartLayout){const t=new kh;return this.__updatedList.list.forEach(e=>{e.leafer&&t.add(e)}),t}return this.__updatedList}constructor(t,e){this.totalTimes=0,this.config={},this.__updatedList=new kh,this.target=t,e&&(this.config=p.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}update(){this.changed=!0,this.running&&this.target.emit(ta.REQUEST)}__onAttrChange(t){this.config.usePartLayout&&this.__updatedList.add(t.target),this.update()}__onChildEvent(t){this.config.usePartLayout&&(t.type===No.ADD?(this.hasAdd=!0,this.__pushChild(t.child)):(this.hasRemove=!0,this.__updatedList.add(t.parent))),this.update()}__pushChild(t){this.__updatedList.add(t),t.isBranch&&this.__loopChildren(t)}__loopChildren(t){const{children:e}=t;for(let t=0,i=e.length;t<i;t++)this.__pushChild(e[t])}__onRquestData(){this.target.emitEvent(new Jo(Jo.DATA,{updatedList:this.updatedList})),this.__updatedList=new kh,this.totalTimes++,this.changed=this.hasVisible=this.hasRemove=this.hasAdd=!1}__listenEvents(){this.__eventIds=[this.target.on_([[Xo.CHANGE,this.__onAttrChange,this],[[No.ADD,No.REMOVE],this.__onChildEvent,this],[Jo.REQUEST,this.__onRquestData,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.__updatedList=null)}}const{updateAllMatrix:Ah,updateBounds:Dh,updateChange:Mh}=lo,{pushAllChildBranch:Ih,pushAllParent:Wh}=bo;const{worldBounds:Fh}=mo;class zh{constructor(t){this.updatedBounds=new Vt,this.beforeBounds=new Vt,this.afterBounds=new Vt,d(t)&&(t=new kh(t)),this.updatedList=t}setBefore(){this.beforeBounds.setListWithFn(this.updatedList.list,Fh)}setAfter(){this.afterBounds.setListWithFn(this.updatedList.list,Fh),this.updatedBounds.setList([this.beforeBounds,this.afterBounds])}merge(t){this.updatedList.addList(t.updatedList.list),this.beforeBounds.add(t.beforeBounds),this.afterBounds.add(t.afterBounds),this.updatedBounds.add(t.updatedBounds)}destroy(){this.updatedList=null}}const{updateAllMatrix:Nh,updateAllChange:Yh}=lo,Xh=ie.get("Layouter");class Uh{constructor(t,e){this.totalTimes=0,this.config={usePartLayout:!0},this.__levelList=new Bh,this.target=t,e&&(this.config=p.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}layout(){if(this.layouting||!this.running)return;const{target:t}=this;this.times=0;try{t.emit(Zo.START),this.layoutOnce(),t.emitEvent(new Zo(Zo.END,this.layoutedBlocks,this.times))}catch(t){Xh.error(t)}this.layoutedBlocks=null}layoutAgain(){this.layouting?this.waitAgain=!0:this.layoutOnce()}layoutOnce(){return this.layouting?Xh.warn("layouting"):this.times>3?Xh.warn("layout max times"):(this.times++,this.totalTimes++,this.layouting=!0,this.target.emit(Jo.REQUEST),this.totalTimes>1&&this.config.usePartLayout?this.partLayout():this.fullLayout(),this.layouting=!1,void(this.waitAgain&&(this.waitAgain=!1,this.layoutOnce())))}partLayout(){var t;if(!(null===(t=this.__updatedList)||void 0===t?void 0:t.length))return;const e=oe.start("PartLayout"),{target:i,__updatedList:s}=this,{BEFORE:r,LAYOUT:n,AFTER:o}=Zo,a=this.getBlocks(s);a.forEach(t=>t.setBefore()),i.emitEvent(new Zo(r,a,this.times)),this.extraBlock=null,s.sort(),function(t,e){let i;t.list.forEach(t=>{i=t.__layout,e.without(t)&&!i.proxyZoom&&(i.matrixChanged?(Ah(t,!0),e.add(t),t.isBranch&&Ih(t,e),Wh(t,e)):i.boundsChanged&&(e.add(t),t.isBranch&&(t.__tempNumber=0),Wh(t,e)))})}(s,this.__levelList),function(t){let e,i,s;t.sort(!0),t.levels.forEach(r=>{e=t.levelMap[r];for(let t=0,r=e.length;t<r;t++){if(i=e[t],i.isBranch&&i.__tempNumber){s=i.children;for(let t=0,e=s.length;t<e;t++)s[t].isBranch||Dh(s[t])}Dh(i)}})}(this.__levelList),function(t){t.list.forEach(Mh)}(s),this.extraBlock&&a.push(this.extraBlock),a.forEach(t=>t.setAfter()),i.emitEvent(new Zo(n,a,this.times)),i.emitEvent(new Zo(o,a,this.times)),this.addBlocks(a),this.__levelList.reset(),this.__updatedList=null,oe.end(e)}fullLayout(){const t=oe.start("FullLayout"),{target:e}=this,{BEFORE:i,LAYOUT:s,AFTER:r}=Zo,n=this.getBlocks(new kh(e));e.emitEvent(new Zo(i,n,this.times)),Uh.fullLayout(e),n.forEach(t=>{t.setAfter()}),e.emitEvent(new Zo(s,n,this.times)),e.emitEvent(new Zo(r,n,this.times)),this.addBlocks(n),oe.end(t)}static fullLayout(t){Nh(t,!0),t.isBranch?bo.updateBounds(t):lo.updateBounds(t),Yh(t)}addExtra(t){if(!this.__updatedList.has(t)){const{updatedList:e,beforeBounds:i}=this.extraBlock||(this.extraBlock=new zh([]));e.length?i.add(t.__world):i.set(t.__world),e.add(t)}}createBlock(t){return new zh(t)}getBlocks(t){return[this.createBlock(t)]}addBlocks(t){this.layoutedBlocks?this.layoutedBlocks.push(...t):this.layoutedBlocks=t}__onReceiveWatchData(t){this.__updatedList=t.data.updatedList}__listenEvents(){this.__eventIds=[this.target.on_([[Zo.REQUEST,this.layout,this],[Zo.AGAIN,this.layoutAgain,this],[Jo.DATA,this.__onReceiveWatchData,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.config=null)}}const Hh=ie.get("Renderer");class jh{get needFill(){return!(this.canvas.allowBackgroundColor||!this.config.fill)}constructor(t,e,i){this.FPS=60,this.totalTimes=0,this.times=0,this.config={usePartRender:!0,ceilPartPixel:!0,maxFPS:120},this.frames=[],this.target=t,this.canvas=e,i&&(this.config=p.default(i,this.config)),this.__listenEvents()}start(){this.running=!0,this.update(!1)}stop(){this.running=!1}update(t=!0){this.changed||(this.changed=t),this.requestTime||this.__requestRender()}requestLayout(){this.target.emit(Zo.REQUEST)}checkRender(){if(this.running){const{target:t}=this;t.isApp&&(t.emit(ta.CHILD_START,t),t.children.forEach(t=>{t.renderer.FPS=this.FPS,t.renderer.checkRender()}),t.emit(ta.CHILD_END,t)),this.changed&&this.canvas.view&&this.render(),this.target.emit(ta.NEXT)}}render(t){if(!this.running||!this.canvas.view)return this.update();const{target:e}=this;this.times=0,this.totalBounds=new Vt,Hh.log(e.innerName,"---\x3e");try{this.emitRender(ta.START),this.renderOnce(t),this.emitRender(ta.END,this.totalBounds),sn.clearRecycled()}catch(t){this.rendering=!1,Hh.error(t)}Hh.log("-------------|")}renderAgain(){this.rendering?this.waitAgain=!0:this.renderOnce()}renderOnce(t){if(this.rendering)return Hh.warn("rendering");if(this.times>3)return Hh.warn("render max times");if(this.times++,this.totalTimes++,this.rendering=!0,this.changed=!1,this.renderBounds=new Vt,this.renderOptions={},t)this.emitRender(ta.BEFORE),t();else{if(this.requestLayout(),this.ignore)return void(this.ignore=this.rendering=!1);this.emitRender(ta.BEFORE),this.config.usePartRender&&this.totalTimes>1?this.partRender():this.fullRender()}this.emitRender(ta.RENDER,this.renderBounds,this.renderOptions),this.emitRender(ta.AFTER,this.renderBounds,this.renderOptions),this.updateBlocks=null,this.rendering=!1,this.waitAgain&&(this.waitAgain=!1,this.renderOnce())}partRender(){const{canvas:t,updateBlocks:e}=this;e&&(this.mergeBlocks(),e.forEach(e=>{t.bounds.hit(e)&&!e.isEmpty()&&this.clipRender(e)}))}clipRender(t){const e=oe.start("PartRender"),{canvas:i}=this,s=t.getIntersect(i.bounds),r=new Vt(s);i.save(),s.spread(jh.clipSpread).ceil();const{ceilPartPixel:n}=this.config;i.clipWorld(s,n),i.clearWorld(s,n),this.__render(s,r),i.restore(),oe.end(e)}fullRender(){const t=oe.start("FullRender"),{canvas:e}=this;e.save(),e.clear(),this.__render(e.bounds),e.restore(),oe.end(t)}__render(t,e){const{canvas:i,target:s}=this,r=t.includes(s.__world),n=r?{includes:r}:{bounds:t,includes:r};this.needFill&&i.fillWorld(t,this.config.fill),ie.showRepaint&&ie.drawRepaint(i,t),this.config.useCellRender&&(n.cellList=this.getCellList()),Zt.render(s,i,n),this.renderBounds=e=e||t,this.renderOptions=n,this.totalBounds.isEmpty()?this.totalBounds=e:this.totalBounds.add(e),i.updateRender(e)}getCellList(){}addBlock(t){this.updateBlocks||(this.updateBlocks=[]),this.updateBlocks.push(t)}mergeBlocks(){const{updateBlocks:t}=this;if(t){const e=new Vt;e.setList(t),t.length=0,t.push(e)}}__requestRender(){const t=this.target;if(this.requestTime||!t)return;if(t.parentApp)return t.parentApp.requestRender(!1);this.requestTime=this.frameTime||Date.now();const e=()=>{const t=1e3/((this.frameTime=Date.now())-this.requestTime),{maxFPS:i}=this.config;if(i&&t>i)return Zt.requestRender(e);const{frames:s}=this;s.length>30&&s.shift(),s.push(t),this.FPS=Math.round(s.reduce((t,e)=>t+e,0)/s.length),this.requestTime=0,this.checkRender()};Zt.requestRender(e)}__onResize(t){if(!this.canvas.unreal){if(t.bigger||!t.samePixelRatio){const{width:e,height:i}=t.old;if(!new Vt(0,0,e,i).includes(this.target.__world)||this.needFill||!t.samePixelRatio)return this.addBlock(this.canvas.bounds),void this.target.forceUpdate("surface")}this.addBlock(new Vt(0,0,1,1)),this.update()}}__onLayoutEnd(t){t.data&&t.data.map(t=>{let e;t.updatedList&&t.updatedList.list.some(t=>(e=!t.__world.width||!t.__world.height,e&&(t.isLeafer||Hh.tip(t.innerName,": empty"),e=!t.isBranch||t.isBranchLeaf),e)),this.addBlock(e?this.canvas.bounds:t.updatedBounds)})}emitRender(t,e,i){this.target.emitEvent(new ta(t,this.times,e,i))}__listenEvents(){this.__eventIds=[this.target.on_([[ta.REQUEST,this.update,this],[Zo.END,this.__onLayoutEnd,this],[ta.AGAIN,this.renderAgain,this],[Qo.RESIZE,this.__onResize,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.config={},this.target=this.canvas=null)}}jh.clipSpread=10;const Vh={},{copyRadiusPoint:Gh}=at,{hitRadiusPoint:Kh}=Xt;class qh{constructor(t,e){this.target=t,this.selector=e}getByPoint(t,e,i){e||(e=0),i||(i={});const s=i.through||!1,r=i.ignoreHittable||!1,n=i.target||this.target;this.exclude=i.exclude||null,this.point={x:t.x,y:t.y,radiusX:e,radiusY:e},this.findList=new kh(i.findList),i.findList||this.hitBranch(n.isBranchLeaf?{children:[n]}:n);const{list:o}=this.findList,a=this.getBestMatchLeaf(o,i.bottomList,r,!!i.findList),h=r?this.getPath(a):this.getHitablePath(a);return this.clear(),s?{path:h,target:a,throughPath:o.length?this.getThroughPath(o):h}:{path:h,target:a}}hitPoint(t,e,i){return!!this.getByPoint(t,e,i).target}getBestMatchLeaf(t,e,i,s){const r=this.findList=new kh;if(t.length){let e;const{x:s,y:n}=this.point,o={x:s,y:n,radiusX:0,radiusY:0};for(let s=0,n=t.length;s<n;s++)if(e=t[s],(i||lo.worldHittable(e))&&(this.hitChild(e,o),r.length)){if(e.isBranchLeaf&&t.some(t=>t!==e&&lo.hasParent(t,e))){r.reset();break}return r.list[0]}}if(e)for(let t=0,i=e.length;t<i;t++)if(this.hitChild(e[t].target,this.point,e[t].proxy),r.length)return r.list[0];return s?null:i?t[0]:t.find(t=>lo.worldHittable(t))}getPath(t){const e=new kh,i=[],{target:s}=this;for(;t&&(t.syncEventer&&i.push(t.syncEventer),e.add(t),(t=t.parent)!==s););return i.length&&i.forEach(t=>{for(;t&&(t.__.hittable&&e.add(t),(t=t.parent)!==s););}),s&&e.add(s),e}getHitablePath(t){const e=this.getPath(t&&t.hittable?t:null);let i,s=new kh;for(let t=e.list.length-1;t>-1&&(i=e.list[t],i.__.hittable)&&(s.addAt(i,0),i.__.hitChildren&&(!i.isLeafer||"draw"!==i.mode));t--);return s}getThroughPath(t){const e=new kh,i=[];for(let e=t.length-1;e>-1;e--)i.push(this.getPath(t[e]));let s,r,n;for(let t=0,o=i.length;t<o;t++){s=i[t],r=i[t+1];for(let t=0,i=s.length;t<i&&(n=s.list[t],!r||!r.has(n));t++)e.add(n)}return e}hitBranch(t){this.eachFind(t.children,t.__onlyHitMask)}eachFind(t,e){let i,s,r;const{point:n}=this;for(let o=t.length-1;o>-1;o--)if(i=t[o],r=i.__,r.visible&&(!e||r.mask))if(s=Kh(i.__world,r.hitRadius?Gh(Vh,n,r.hitRadius):n),i.isBranch){if(s||i.__ignoreHitWorld){if(i.isBranchLeaf&&r.__clipAfterFill&&!i.__hitWorld(n,!0))continue;i.topChildren&&this.eachFind(i.topChildren,!1),this.eachFind(i.children,i.__onlyHitMask),i.isBranchLeaf&&this.hitChild(i,n)}}else s&&this.hitChild(i,n)}hitChild(t,e,i){if((!this.exclude||!this.exclude.has(t))&&t.__hitWorld(e)){const{parent:s}=t;if(s&&s.__hasMask&&!t.__.mask){let i,r=[];const{children:n}=s;for(let s=0,o=n.length;s<o;s++)if(i=n[s],i.__.mask&&r.push(i),i===t){if(r&&!r.every(t=>t.__hitWorld(e)))return;break}}this.findList.add(i||t)}}clear(){this.point=null,this.findList=null,this.exclude=null}destroy(){this.clear()}}class $h{constructor(t,e){this.config={},e&&(this.config=p.default(e,this.config)),this.picker=new qh(this.target=t,this),this.finder=de.finder&&de.finder()}getByPoint(t,e,i){const{target:s,picker:r}=this;return Zt.backgrounder&&s&&s.updateLayout(),r.getByPoint(t,e,i)}hitPoint(t,e,i){return this.picker.hitPoint(t,e,i)}getBy(t,e,i,s){return this.finder?this.finder.getBy(t,e,i,s):le.need("find")}destroy(){this.picker.destroy(),this.finder&&this.finder.destroy()}}function Qh(t){return cn(t,t=>({set(e){this.__setAttr(t,e),e&&(this.__.__useEffect=!0),this.__layout.renderChanged||this.__layout.renderChange()}}))}function Jh(t){return cn(t,t=>({set(e){this.__setAttr(t,e),this.__layout.boxChanged||this.__layout.boxChange(),this.__updateSize()}}))}function Zh(){return(t,e)=>{const i="_"+e;hn(t,e,{set(t){this.isLeafer&&(this[i]=t)},get(){return this.isApp?this.tree.zoomLayer:this.isLeafer?this[i]||this:this.leafer&&this.leafer.zoomLayer}})}}function tl(t){return(e,i)=>{hn(e,i,dn(i,t))}}Object.assign(de,{watcher:(t,e)=>new Oh(t,e),layouter:(t,e)=>new Uh(t,e),renderer:(t,e,i)=>new jh(t,e,i),selector:(t,e)=>new $h(t,e)}),Zt.layout=Uh.fullLayout,Zt.render=function(t,e,i){const s=Object.assign(Object.assign({},i),{topRendering:!0});i.topList=new kh,t.__render(e,i),i.topList.length&&i.topList.forEach(t=>t.__render(e,s))};const el={},il={hasTransparent:function(t){if(!t||7===t.length||4===t.length)return!1;if("transparent"===t)return!0;const e=t[0];if("#"===e)switch(t.length){case 5:return"f"!==t[4]&&"F"!==t[4];case 9:return"f"!==t[7]&&"F"!==t[7]||"f"!==t[8]&&"F"!==t[8]}else if(("r"===e||"h"===e)&&"a"===t[3]){const e=t.lastIndexOf(",");if(e>-1)return parseFloat(t.slice(e+1))<1}return!1}},sl=qt,rl={},nl={},ol={},al={},hl={},ll={apply(){le.need("filter")}},dl={},cl={setStyleName:()=>le.need("state"),set:()=>le.need("state")},ul={list:{},register(t,e){ul.list[t]=e},get:t=>ul.list[t]},{parse:_l,objectToCanvasData:pl}=ss,{stintSet:gl}=p,{hasTransparent:fl}=il,yl={originPaint:{}},ml=ie.get("UIData");class vl extends f{get scale(){const{scaleX:t,scaleY:e}=this;return t!==e?{x:t,y:e}:t}get __strokeWidth(){return this.__getRealStrokeWidth()}get __maxStrokeWidth(){const t=this;return t.__hasMultiStrokeStyle?Math.max(t.__hasMultiStrokeStyle,t.strokeWidth):t.strokeWidth}get __hasMultiPaint(){const t=this;return t.fill&&this.__useStroke||t.__isFills&&t.fill.length>1||t.__isStrokes&&t.stroke.length>1||t.__useEffect}get __clipAfterFill(){const t=this;return t.cornerRadius||t.innerShadow||t.__pathInputed}get __hasSurface(){return this.fill||this.stroke}get __autoWidth(){return!this._width}get __autoHeight(){return!this._height}get __autoSide(){return!this._width||!this._height}get __autoSize(){return!this._width&&!this._height}setVisible(t){this._visible=t;const{leafer:e}=this.__leaf;e&&(e.watcher.hasVisible=!0)}setWidth(t){t<0?(this._width=-t,this.__leaf.scaleX*=-1,ml.warn("width < 0, instead -scaleX ",this)):this._width=t}setHeight(t){t<0?(this._height=-t,this.__leaf.scaleY*=-1,ml.warn("height < 0, instead -scaleY",this)):this._height=t}setFill(t){this.__naturalWidth&&this.__removeNaturalSize(),n(t)||!t?(gl(this,"__isTransparentFill",fl(t)),this.__isFills&&this.__removePaint("fill",!0),this._fill=t):c(t)&&this.__setPaint("fill",t)}setStroke(t){n(t)||!t?(gl(this,"__isTransparentStroke",fl(t)),this.__isStrokes&&this.__removePaint("stroke",!0),this._stroke=t):c(t)&&this.__setPaint("stroke",t)}setPath(t){const e=n(t);e||t&&c(t[0])?(this.__setInput("path",t),this._path=e?_l(t):pl(t)):(this.__input&&this.__removeInput("path"),this._path=t)}setShadow(t){wl(this,"shadow",t)}setInnerShadow(t){wl(this,"innerShadow",t)}setFilter(t){wl(this,"filter",t)}__computePaint(){const{fill:t,stroke:e}=this.__input;t&&nl.compute("fill",this.__leaf),e&&nl.compute("stroke",this.__leaf),this.__needComputePaint=void 0}__getRealStrokeWidth(t){let{strokeWidth:e,strokeWidthFixed:i}=this;if(t&&(t.strokeWidth&&(e=t.strokeWidth),s(t.strokeWidthFixed)||(i=t.strokeWidthFixed)),i){const t=this.__leaf.getClampRenderScale();return t>1?e/t:e}return e}__setPaint(t,e){this.__setInput(t,e);const i=this.__leaf.__layout;i.boxChanged||i.boxChange(),d(e)&&!e.length?this.__removePaint(t):"fill"===t?(this.__isFills=!0,this._fill||(this._fill=yl)):(this.__isStrokes=!0,this._stroke||(this._stroke=yl))}__removePaint(t,e){e&&this.__removeInput(t),ol.recycleImage(t,this),"fill"===t?(gl(this,"__isAlphaPixelFill",void 0),this._fill=this.__isFills=void 0):(gl(this,"__isAlphaPixelStroke",void 0),gl(this,"__hasMultiStrokeStyle",void 0),this._stroke=this.__isStrokes=void 0)}}function wl(t,e,i){t.__setInput(e,i),d(i)?(i.some(t=>!1===t.visible)&&(i=i.filter(t=>!1!==t.visible)),i.length||(i=void 0)):i=i&&!1!==i.visible?[i]:void 0,t["_"+e]=i}class xl extends vl{}class bl extends xl{get __boxStroke(){return!this.__pathInputed}get __drawAfterFill(){return this.__single||this.__clipAfterFill}get __clipAfterFill(){const t=this;return"show"!==t.overflow&&t.__leaf.children.length&&(t.__leaf.isOverflow||super.__clipAfterFill)}}class kl extends xl{__getInputData(t,e){const i=super.__getInputData(t,e);return Oe.forEach(t=>delete i[t]),i}}class Bl extends bl{}class Sl extends vl{get __usePathBox(){return this.points||this.__pathInputed}}class Pl extends vl{get __boxStroke(){return!this.__pathInputed}}class Rl extends vl{get __boxStroke(){return!this.__pathInputed}}class Cl extends Sl{}class Tl extends vl{}class El extends vl{get __pathInputed(){return 2}}class Ll extends xl{}const Ol={thin:100,"extra-light":200,light:300,normal:400,medium:500,"semi-bold":600,bold:700,"extra-bold":800,black:900};class Al extends vl{get __useNaturalRatio(){return!1}setFontWeight(t){n(t)?(this.__setInput("fontWeight",t),t=Ol[t]||400):this.__input&&this.__removeInput("fontWeight"),this._fontWeight=t}setBoxStyle(t){let e=this.__leaf,i=e.__box;if(t){const{boxStyle:s}=this;if(i)for(let t in s)i[t]=void 0;else i=e.__box=ue.get("Rect",0);const r=e.__layout,n=i.__layout;s||(i.parent=e,i.__world=e.__world,n.boxBounds=r.boxBounds),i.set(t),n.strokeChanged&&r.strokeChange()}else i&&(e.__box=i.parent=null,i.destroy());this._boxStyle=t}__getInputData(t,e){const i=super.__getInputData(t,e);return i.textEditing&&delete i.textEditing,i}}class Dl extends Pl{setUrl(t){this.__setImageFill(t),this._url=t}__setImageFill(t){this.fill=t?{type:"image",mode:"stretch",url:t}:void 0}__getData(){const t=super.__getData();return t.url&&delete t.fill,t}__getInputData(t,e){const i=super.__getInputData(t,e);return i.url&&delete i.fill,i}}class Ml extends Pl{get __isCanvas(){return!0}get __drawAfterFill(){return!0}__getInputData(t,e){const i=super.__getInputData(t,e);return i.url=this.__leaf.canvas.toDataURL("image/png"),i}}const{max:Il,add:Wl}=B,Fl={__updateStrokeSpread(){let t=0,e=0;const i=this.__,{strokeAlign:s,__maxStrokeWidth:r}=i,n=this.__box;if((i.stroke||"all"===i.hitStroke)&&r&&"inside"!==s&&(e=t="center"===s?r/2:r,!i.__boxStroke)){const e=i.__isLinePath?0:10*t,s="none"===i.strokeCap?0:r;t+=Math.max(e,s)}return i.__useArrow&&(t+=5*r),n&&(t=Il(t,n.__layout.strokeSpread=n.__updateStrokeSpread()),e=Math.max(e,n.__layout.strokeBoxSpread)),this.__layout.strokeBoxSpread=e,t},__updateRenderSpread(){let t=0;const{shadow:e,innerShadow:i,blur:s,backgroundBlur:r,filter:n,renderSpread:o}=this.__,{strokeSpread:a}=this.__layout,h=this.__box;e&&(t=hl.getShadowRenderSpread(this,e)),s&&(t=Il(t,s)),n&&(t=Wl(t,ll.getSpread(n))),o&&(t=Wl(t,o)),a&&(t=Wl(t,a));let l=t;return i&&(l=Il(l,hl.getInnerShadowSpread(this,i))),r&&(l=Il(l,r)),this.__layout.renderShapeSpread=l,h?Il(h.__updateRenderSpread(),t):t}},{stintSet:zl}=p,Nl={__updateChange(){const t=this.__;if(t.__useStroke){const e=t.__useStroke=!(!t.stroke||!t.strokeWidth);zl(this.__world,"half",e&&"center"===t.strokeAlign&&t.strokeWidth%2),zl(t,"__fillAfterStroke",e&&"outside"===t.strokeAlign&&t.fill&&!t.__isTransparentFill)}if(t.__useEffect){const{shadow:e,fill:i,stroke:s}=t,r=t.innerShadow||t.blur||t.backgroundBlur||t.filter;zl(t,"__isFastShadow",e&&!r&&e.length<2&&!e[0].spread&&!hl.isTransformShadow(e[0])&&i&&!t.__isTransparentFill&&!(d(i)&&i.length>1)&&(this.useFastShadow||!s||s&&"inside"===t.strokeAlign)),t.__useEffect=!(!e&&!r)}t.__checkSingle(),zl(t,"__complex",t.__isFills||t.__isStrokes||t.cornerRadius||t.__useEffect)},__drawFast(t,e){Yl(this,t,e)},__draw(t,e,i){const s=this.__;if(s.__complex){s.__needComputePaint&&s.__computePaint();const{fill:r,stroke:n,__drawAfterFill:o,__fillAfterStroke:a,__isFastShadow:h}=s;if(this.__drawRenderPath(t),s.__useEffect&&!h){const h=nl.shape(this,t,e);this.__nowWorld=this.__getNowWorld(e);const{shadow:l,innerShadow:d,filter:c}=s;l&&hl.shadow(this,t,h),a&&(s.__isStrokes?nl.strokes(n,this,t,e):nl.stroke(n,this,t,e)),r&&(s.__isFills?nl.fills(r,this,t,e):nl.fill(r,this,t,e)),o&&this.__drawAfterFill(t,e),d&&hl.innerShadow(this,t,h),n&&!a&&(s.__isStrokes?nl.strokes(n,this,t,e):nl.stroke(n,this,t,e)),c&&ll.apply(c,this,this.__nowWorld,t,i,h),h.worldCanvas&&h.worldCanvas.recycle(),h.canvas.recycle()}else{if(a&&(s.__isStrokes?nl.strokes(n,this,t,e):nl.stroke(n,this,t,e)),h){const e=s.shadow[0],{scaleX:i,scaleY:r}=this.getRenderScaleData(!0,e.scaleFixed);t.save(),t.setWorldShadow(e.x*i,e.y*r,e.blur*i,il.string(e.color))}r&&(s.__isFills?nl.fills(r,this,t,e):nl.fill(r,this,t,e)),h&&t.restore(),o&&this.__drawAfterFill(t,e),n&&!a&&(s.__isStrokes?nl.strokes(n,this,t,e):nl.stroke(n,this,t,e))}}else s.__pathForRender?Yl(this,t,e):this.__drawFast(t,e)},__drawShape(t,e){this.__drawRenderPath(t);const i=this.__,{fill:s,stroke:r}=i;s&&!e.ignoreFill&&(i.__isAlphaPixelFill?nl.fills(s,this,t,e):nl.fill("#000000",this,t,e)),i.__isCanvas&&this.__drawAfterFill(t,e),r&&!e.ignoreStroke&&(i.__isAlphaPixelStroke?nl.strokes(r,this,t,e):nl.stroke("#000000",this,t,e))},__drawAfterFill(t,e){this.__.__clipAfterFill?(t.save(),t.clipUI(this),this.__drawContent(t,e),t.restore()):this.__drawContent(t,e)}};function Yl(t,e,i){const{fill:s,stroke:r,__drawAfterFill:n,__fillAfterStroke:o}=t.__;t.__drawRenderPath(e),o&&nl.stroke(r,t,e,i),s&&nl.fill(s,t,e,i),n&&t.__drawAfterFill(e,i),r&&!o&&nl.stroke(r,t,e,i)}const Xl={__drawFast(t,e){let{x:i,y:s,width:r,height:n}=this.__layout.boxBounds;const{fill:o,stroke:a,__drawAfterFill:h}=this.__;if(o&&(t.fillStyle=o,t.fillRect(i,s,r,n)),h&&this.__drawAfterFill(t,e),a){const{strokeAlign:o,__strokeWidth:h}=this.__;if(!h)return;t.setStroke(a,h,this.__);const l=h/2;switch(o){case"center":t.strokeRect(0,0,r,n);break;case"inside":r-=h,n-=h,r<0||n<0?(t.save(),this.__clip(t,e),t.strokeRect(i+l,s+l,r,n),t.restore()):t.strokeRect(i+l,s+l,r,n);break;case"outside":t.strokeRect(i-l,s-l,r+h,n+h)}}}};var Ul;let Hl=Ul=class extends uh{get app(){return this.leafer&&this.leafer.app}get isFrame(){return!1}set scale(t){D.assignScale(this,t)}get scale(){return this.__.scale}get isAutoWidth(){const t=this.__;return t.__autoWidth||t.autoWidth}get isAutoHeight(){const t=this.__;return t.__autoHeight||t.autoHeight}get pen(){const{path:t}=this.__;return jr.set(this.path=t||[]),t||this.__drawPathByBox(jr),jr}reset(t){}set(t,e){t&&Object.assign(this,t)}get(t){return n(t)?this.__.__getInput(t):this.__.__getInputData(t)}createProxyData(){}find(t,e){return le.need("find")}findTag(t){return this.find({tag:t})}findOne(t,e){return le.need("find")}findId(t){return this.findOne({id:t})}getPath(t,e){this.__layout.update();let i=e?this.__.__pathForRender:this.__.path;return i||(jr.set(i=[]),this.__drawPathByBox(jr,!e)),t?ss.toCanvasData(i,!0):i}getPathString(t,e,i){return ss.stringify(this.getPath(t,e),i)}load(){this.__.__computePaint()}__onUpdateSize(){if(this.__.__input){const t=this.__;!t.lazy||this.__inLazyBounds||dl.running?t.__computePaint():t.__needComputePaint=!0}}__updateRenderPath(){const t=this.__;t.path?(t.__pathForRender=t.cornerRadius?Ur.smooth(t.path,t.cornerRadius,t.cornerSmoothing):t.path,t.__useArrow&&rl.addArrows(this)):t.__pathForRender&&(t.__pathForRender=void 0)}__drawRenderPath(t){t.beginPath(),this.__drawPathByData(t,this.__.__pathForRender)}__drawPath(t){t.beginPath(),this.__drawPathByData(t,this.__.path,!0)}__drawPathByData(t,e,i){e?rr.drawPathByData(t,e):this.__drawPathByBox(t,i)}__drawPathByBox(t,e){const{x:i,y:s,width:r,height:n}=this.__layout.boxBounds;if(this.__.cornerRadius&&!e){const{cornerRadius:e}=this.__;t.roundRect(i,s,r,n,a(e)?[e]:e)}else t.rect(i,s,r,n);t.closePath()}drawImagePlaceholder(t,e,i){nl.fill(this.__.placeholderColor,this,e,i)}animate(t,e,i,s){return this.set(t),le.need("animate")}killAnimate(t,e){}export(t,e){return le.need("export")}syncExport(t,e){return le.need("export")}clone(t){const e=p.clone(this.toJSON());return t&&Object.assign(e,t),Ul.one(e)}static one(t,e,i,s,r){return ue.get(t.tag||this.prototype.__tag,t,e,i,s,r)}static registerUI(){$n()(this)}static registerData(t){Nn(t)(this.prototype)}static setEditConfig(t){}static setEditOuter(t){}static setEditInner(t){}destroy(){this.fill=this.stroke=null,this.__animate&&this.killAnimate(),super.destroy()}};me([Nn(vl)],Hl.prototype,"__",void 0),me([Zh()],Hl.prototype,"zoomLayer",void 0),me([pn("")],Hl.prototype,"id",void 0),me([pn("")],Hl.prototype,"name",void 0),me([pn("")],Hl.prototype,"className",void 0),me([Tn("pass-through")],Hl.prototype,"blendMode",void 0),me([Ln(1)],Hl.prototype,"opacity",void 0),me([On(!0)],Hl.prototype,"visible",void 0),me([Tn(!1)],Hl.prototype,"locked",void 0),me([En(!1)],Hl.prototype,"dim",void 0),me([En(!1)],Hl.prototype,"dimskip",void 0),me([Mn(0)],Hl.prototype,"zIndex",void 0),me([In(!1)],Hl.prototype,"mask",void 0),me([Wn(!1)],Hl.prototype,"eraser",void 0),me([gn(0,!0)],Hl.prototype,"x",void 0),me([gn(0,!0)],Hl.prototype,"y",void 0),me([wn(100,!0)],Hl.prototype,"width",void 0),me([wn(100,!0)],Hl.prototype,"height",void 0),me([mn(1,!0)],Hl.prototype,"scaleX",void 0),me([mn(1,!0)],Hl.prototype,"scaleY",void 0),me([vn(0,!0)],Hl.prototype,"rotation",void 0),me([vn(0,!0)],Hl.prototype,"skewX",void 0),me([vn(0,!0)],Hl.prototype,"skewY",void 0),me([gn(0,!0)],Hl.prototype,"offsetX",void 0),me([gn(0,!0)],Hl.prototype,"offsetY",void 0),me([fn(0,!0)],Hl.prototype,"scrollX",void 0),me([fn(0,!0)],Hl.prototype,"scrollY",void 0),me([yn()],Hl.prototype,"origin",void 0),me([yn()],Hl.prototype,"around",void 0),me([pn(!1)],Hl.prototype,"lazy",void 0),me([xn(1)],Hl.prototype,"pixelRatio",void 0),me([Cn(0)],Hl.prototype,"renderSpread",void 0),me([kn()],Hl.prototype,"path",void 0),me([Bn()],Hl.prototype,"windingRule",void 0),me([Bn(!0)],Hl.prototype,"closed",void 0),me([wn(0)],Hl.prototype,"padding",void 0),me([wn(!1)],Hl.prototype,"lockRatio",void 0),me([wn()],Hl.prototype,"widthRange",void 0),me([wn()],Hl.prototype,"heightRange",void 0),me([pn(!1)],Hl.prototype,"draggable",void 0),me([pn()],Hl.prototype,"dragBounds",void 0),me([pn("auto")],Hl.prototype,"dragBoundsType",void 0),me([pn(!1)],Hl.prototype,"editable",void 0),me([Fn(!0)],Hl.prototype,"hittable",void 0),me([Fn("path")],Hl.prototype,"hitFill",void 0),me([Rn("path")],Hl.prototype,"hitStroke",void 0),me([Fn(!1)],Hl.prototype,"hitBox",void 0),me([Fn(!0)],Hl.prototype,"hitChildren",void 0),me([Fn(!0)],Hl.prototype,"hitSelf",void 0),me([Fn()],Hl.prototype,"hitRadius",void 0),me([zn("")],Hl.prototype,"cursor",void 0),me([Tn()],Hl.prototype,"fill",void 0),me([Rn(void 0,!0)],Hl.prototype,"stroke",void 0),me([Rn("inside")],Hl.prototype,"strokeAlign",void 0),me([Rn(1,!0)],Hl.prototype,"strokeWidth",void 0),me([Rn(!1)],Hl.prototype,"strokeWidthFixed",void 0),me([Rn("none")],Hl.prototype,"strokeCap",void 0),me([Rn("miter")],Hl.prototype,"strokeJoin",void 0),me([Rn()],Hl.prototype,"dashPattern",void 0),me([Rn(0)],Hl.prototype,"dashOffset",void 0),me([Rn(10)],Hl.prototype,"miterLimit",void 0),me([Bn(0)],Hl.prototype,"cornerRadius",void 0),me([Bn()],Hl.prototype,"cornerSmoothing",void 0),me([Qh()],Hl.prototype,"shadow",void 0),me([Qh()],Hl.prototype,"innerShadow",void 0),me([Qh()],Hl.prototype,"blur",void 0),me([Qh()],Hl.prototype,"backgroundBlur",void 0),me([Qh()],Hl.prototype,"grayscale",void 0),me([Qh()],Hl.prototype,"filter",void 0),me([Tn()],Hl.prototype,"placeholderColor",void 0),me([pn(100)],Hl.prototype,"placeholderDelay",void 0),me([pn({})],Hl.prototype,"data",void 0),me([Vn(uh.prototype.reset)],Hl.prototype,"reset",null),Hl=Ul=me([qn(Fl),qn(Nl),Gn()],Hl);let jl=class extends Hl{get __tag(){return"Group"}get isBranch(){return!0}reset(t){this.__setBranch(),super.reset(t)}__setBranch(){this.children||(this.children=[])}set(t,e){if(t)if(t.children){const{children:i}=t;delete t.children,this.children?this.clear():this.__setBranch(),super.set(t,e),i.forEach(t=>this.add(t)),t.children=i}else super.set(t,e)}toJSON(t){const e=super.toJSON(t);return this.childlessJSON||(e.children=this.children.map(e=>e.toJSON(t))),e}pick(t,e){}addAt(t,e){this.add(t,e)}addAfter(t,e){this.add(t,this.children.indexOf(e)+1)}addBefore(t,e){this.add(t,this.children.indexOf(e))}add(t,e){}addMany(...t){}remove(t,e){}removeAll(t){}clear(){}};var Vl;me([Nn(xl)],jl.prototype,"__",void 0),me([wn(0)],jl.prototype,"width",void 0),me([wn(0)],jl.prototype,"height",void 0),jl=me([qn(bh),$n()],jl);const Gl=ie.get("Leafer");let Kl=Vl=class extends jl{get __tag(){return"Leafer"}get isApp(){return!1}get app(){return this.parent||this}get isLeafer(){return!0}get imageReady(){return this.viewReady&&tn.isComplete}get layoutLocked(){return!this.layouter.running}get view(){return this.canvas&&this.canvas.view}get FPS(){return this.renderer?this.renderer.FPS:60}get cursorPoint(){return this.interaction&&this.interaction.hoverData||{x:this.width/2,y:this.height/2}}get clientBounds(){return this.canvas&&this.canvas.getClientBounds(!0)||{x:0,y:0,width:0,height:0}}constructor(t,e){super(e),this.config={start:!0,hittable:!0,smooth:!0,lazySpeard:100},this.leafs=0,this.__eventIds=[],this.__controllers=[],this.__readyWait=[],this.__viewReadyWait=[],this.__viewCompletedWait=[],this.__nextRenderWait=[],this.userConfig=t,t&&(t.view||t.width)&&this.init(t),Vl.list.add(this)}init(t,e){if(this.canvas)return;let i;const{config:s}=this;this.__setLeafer(this),e&&(this.parentApp=e,this.__bindApp(e),i=e.running),t&&(this.parent=e,this.initType(t.type),this.parent=void 0,p.assign(s,t));const r=this.canvas=de.canvas(s);this.__controllers.push(this.renderer=de.renderer(this,r,s),this.watcher=de.watcher(this,s),this.layouter=de.layouter(this,s)),this.isApp&&this.__setApp(),this.__checkAutoLayout(),e||(this.selector=de.selector(this),this.interaction=de.interaction(this,r,this.selector,s),this.interaction&&(this.__controllers.unshift(this.interaction),this.hitCanvasManager=de.hitCanvasManager()),this.canvasManager=new ye,i=s.start),this.hittable=s.hittable,this.fill=s.fill,this.canvasManager.add(r),this.__listenEvents(),i&&(this.__startTimer=setTimeout(this.start.bind(this))),Co.run(this.__initWait),this.onInit()}onInit(){}initType(t){}set(t,e){this.waitInit(()=>{super.set(t,e)})}start(){clearTimeout(this.__startTimer),!this.running&&this.canvas&&(this.running=!0,this.ready?this.emitLeafer(ea.RESTART):this.emitLeafer(ea.START),this.__controllers.forEach(t=>t.start()),this.isApp||this.renderer.render())}stop(){clearTimeout(this.__startTimer),this.running&&this.canvas&&(this.__controllers.forEach(t=>t.stop()),this.running=!1,this.emitLeafer(ea.STOP))}unlockLayout(){this.layouter.start(),this.updateLayout()}lockLayout(){this.updateLayout(),this.layouter.stop()}resize(t){const e=p.copyAttrs({},t,Oe);Object.keys(e).forEach(t=>this[t]=e[t])}forceRender(t,e){const{renderer:i}=this;i&&(i.addBlock(t?new Vt(t):this.canvas.bounds),this.viewReady&&(e?i.render():i.update()))}requestRender(t=!1){this.renderer&&this.renderer.update(t)}updateCursor(t){const e=this.interaction;e&&(t?e.setCursor(t):e.updateCursor())}updateLazyBounds(){this.lazyBounds=this.canvas.bounds.clone().spread(this.config.lazySpeard)}__doResize(t){const{canvas:e}=this;if(!e||e.isSameSize(t))return;const i=p.copyAttrs({},this.canvas,Oe);e.resize(t),this.updateLazyBounds(),this.__onResize(new Qo(t,i))}__onResize(t){this.emitEvent(t),p.copyAttrs(this.__,t,Oe),setTimeout(()=>{this.canvasManager&&this.canvasManager.clearRecycled()},0)}__setApp(){}__bindApp(t){this.selector=t.selector,this.interaction=t.interaction,this.canvasManager=t.canvasManager,this.hitCanvasManager=t.hitCanvasManager}__setLeafer(t){this.leafer=t,this.__level=1}__checkAutoLayout(){const{config:t,parentApp:e}=this;e||(t.width&&t.height||(this.autoLayout=new Kt(t)),this.canvas.startAutoLayout(this.autoLayout,this.__onResize.bind(this)))}__setAttr(t,e){return this.canvas&&(Oe.includes(t)?this.__changeCanvasSize(t,e):"fill"===t?this.__changeFill(e):"hittable"===t?this.parent||(this.canvas.hittable=e):"zIndex"===t?(this.canvas.zIndex=e,setTimeout(()=>this.parent&&this.parent.__updateSortChildren())):"mode"===t&&this.emit(ea.UPDATE_MODE,{mode:e})),super.__setAttr(t,e)}__getAttr(t){return this.canvas&&Oe.includes(t)?this.canvas[t]:super.__getAttr(t)}__changeCanvasSize(t,e){const{config:i,canvas:s}=this,r=p.copyAttrs({},s,Oe);r[t]=i[t]=e,i.width&&i.height?s.stopAutoLayout():this.__checkAutoLayout(),this.__doResize(r)}__changeFill(t){this.config.fill=t,this.canvas.allowBackgroundColor?this.canvas.backgroundColor=t:this.forceRender()}__onCreated(){this.created=!0}__onReady(){this.ready=!0,this.emitLeafer(ea.BEFORE_READY),this.emitLeafer(ea.READY),this.emitLeafer(ea.AFTER_READY),Co.run(this.__readyWait)}__onViewReady(){this.viewReady||(this.viewReady=!0,this.emitLeafer(ea.VIEW_READY),Co.run(this.__viewReadyWait))}__onLayoutEnd(){const{grow:t,width:e,height:i}=this.config;if(t){let{width:s,height:r,pixelRatio:n}=this;const o="box"===t?this.worldBoxBounds:this.__world;e||(s=Math.max(1,o.x+o.width)),i||(r=Math.max(1,o.y+o.height)),this.__doResize({width:s,height:r,pixelRatio:n})}this.ready||this.__onReady()}__onNextRender(){if(this.viewReady){Co.run(this.__nextRenderWait);const{imageReady:t}=this;t&&!this.viewCompleted&&this.__checkViewCompleted(),t||(this.viewCompleted=!1,this.requestRender())}else this.requestRender()}__checkViewCompleted(t=!0){this.nextRender(()=>{this.imageReady&&(t&&this.emitLeafer(ea.VIEW_COMPLETED),Co.run(this.__viewCompletedWait),this.viewCompleted=!0)})}__onWatchData(){this.watcher.childrenChanged&&this.interaction&&this.nextRender(()=>this.interaction.updateCursor())}waitInit(t,e){e&&(t=t.bind(e)),this.__initWait||(this.__initWait=[]),this.canvas?t():this.__initWait.push(t)}waitReady(t,e){e&&(t=t.bind(e)),this.ready?t():this.__readyWait.push(t)}waitViewReady(t,e){e&&(t=t.bind(e)),this.viewReady?t():this.__viewReadyWait.push(t)}waitViewCompleted(t,e){e&&(t=t.bind(e)),this.__viewCompletedWait.push(t),this.viewCompleted?this.__checkViewCompleted(!1):this.running||this.start()}nextRender(t,e,i){e&&(t=t.bind(e));const s=this.__nextRenderWait;if(i){for(let e=0;e<s.length;e++)if(s[e]===t){s.splice(e,1);break}}else s.push(t);this.requestRender()}zoom(t,e,i,s){return le.need("view")}getValidMove(t,e,i){return{x:t,y:e}}getValidScale(t){return t}getWorldPointByClient(t,e){return this.interaction&&this.interaction.getLocal(t,e)}getPagePointByClient(t,e){return this.getPagePoint(this.getWorldPointByClient(t,e))}getClientPointByWorld(t){const{x:e,y:i}=this.clientBounds;return{x:e+t.x,y:i+t.y}}updateClientBounds(){this.canvas&&this.canvas.updateClientBounds()}receiveEvent(t){}emitLeafer(t){this.emitEvent(new ea(t,this))}__listenEvents(){const t=oe.start("FirstCreate "+this.innerName);this.once([[ea.START,()=>oe.end(t)],[Zo.START,this.updateLazyBounds,this],[ta.START,this.__onCreated,this],[ta.END,this.__onViewReady,this]]),this.__eventIds.push(this.on_([[Jo.DATA,this.__onWatchData,this],[Zo.END,this.__onLayoutEnd,this],[ta.NEXT,this.__onNextRender,this]]))}__removeListenEvents(){this.off_(this.__eventIds)}destroy(t){const e=()=>{if(!this.destroyed){Vl.list.remove(this);try{this.stop(),this.emitLeafer(ea.END),this.__removeListenEvents(),this.__controllers.forEach(t=>!(this.parent&&t===this.interaction)&&t.destroy()),this.__controllers.length=0,this.parent||(this.selector&&this.selector.destroy(),this.hitCanvasManager&&this.hitCanvasManager.destroy(),this.canvasManager&&this.canvasManager.destroy()),this.canvas&&this.canvas.destroy(),this.config.view=this.parentApp=null,this.userConfig&&(this.userConfig.view=null),super.destroy(),setTimeout(()=>{sn.clearRecycled()},100)}catch(t){Gl.error(t)}}};t?e():setTimeout(e)}};Kl.list=new kh,me([Nn(kl)],Kl.prototype,"__",void 0),me([wn()],Kl.prototype,"pixelRatio",void 0),me([pn("normal")],Kl.prototype,"mode",void 0),Kl=Vl=me([$n()],Kl);let ql=class extends Hl{get __tag(){return"Rect"}};me([Nn(Pl)],ql.prototype,"__",void 0),ql=me([qn(Xl),Gn(),$n()],ql);const{add:$l,includes:Ql,scroll:Jl}=Xt,Zl=ql.prototype,td=jl.prototype;let ed=class extends jl{get __tag(){return"Box"}get isBranchLeaf(){return!0}constructor(t){super(t),this.__layout.renderChanged||this.__layout.renderChange()}__updateStrokeSpread(){return 0}__updateRectRenderSpread(){return 0}__updateRenderSpread(){return this.__updateRectRenderSpread()||-1}__updateRectBoxBounds(){}__updateBoxBounds(t){if(this.children.length&&!this.pathInputed){const t=this.__;if(t.__autoSide){t.__hasSurface&&this.__extraUpdate(),super.__updateBoxBounds();const{boxBounds:e}=this.__layout;t.__autoSize||(t.__autoWidth?(e.width+=e.x,e.x=0,e.height=t.height,e.y=0):(e.height+=e.y,e.y=0,e.width=t.width,e.x=0)),this.__updateNaturalSize()}else this.__updateRectBoxBounds()}else this.__updateRectBoxBounds()}__updateStrokeBounds(){}__updateRenderBounds(){let t,e;if(this.children.length){const i=this.__,s=this.__layout,{renderBounds:r,boxBounds:n}=s,{overflow:o}=i,a=s.childrenRenderBounds||(s.childrenRenderBounds={x:0,y:0,width:0,height:0});super.__updateRenderBounds(a),(e=o&&o.includes("scroll"))&&($l(a,n),Jl(a,i)),this.__updateRectRenderBounds(),t=!Ql(n,a),t&&"show"===o&&$l(r,a)}else this.__updateRectRenderBounds();p.stintSet(this,"isOverflow",t),this.__checkScroll(e)}__updateRectRenderBounds(){}__checkScroll(t){}__updateRectChange(){}__updateChange(){super.__updateChange(),this.__updateRectChange()}__renderRect(t,e){}__renderGroup(t,e){}__render(t,e){this.__.__drawAfterFill?this.__renderRect(t,e):(this.__renderRect(t,e),this.children.length&&this.__renderGroup(t,e)),this.hasScroller&&this.scroller.__render(t,e)}__drawContent(t,e){this.__renderGroup(t,e),(this.__.__useStroke||this.__.__useEffect)&&(t.setWorld(this.__nowWorld),this.__drawRenderPath(t))}};me([Nn(bl)],ed.prototype,"__",void 0),me([wn(100)],ed.prototype,"width",void 0),me([wn(100)],ed.prototype,"height",void 0),me([pn(!1)],ed.prototype,"resizeChildren",void 0),me([Cn("show")],ed.prototype,"overflow",void 0),me([Vn(Zl.__updateStrokeSpread)],ed.prototype,"__updateStrokeSpread",null),me([Vn(Zl.__updateRenderSpread)],ed.prototype,"__updateRectRenderSpread",null),me([Vn(Zl.__updateBoxBounds)],ed.prototype,"__updateRectBoxBounds",null),me([Vn(Zl.__updateStrokeBounds)],ed.prototype,"__updateStrokeBounds",null),me([Vn(Zl.__updateRenderBounds)],ed.prototype,"__updateRectRenderBounds",null),me([Vn(Zl.__updateChange)],ed.prototype,"__updateRectChange",null),me([Vn(Zl.__render)],ed.prototype,"__renderRect",null),me([Vn(td.__render)],ed.prototype,"__renderGroup",null),ed=me([Gn(),$n()],ed);let id=class extends ed{get __tag(){return"Frame"}get isFrame(){return!0}};me([Nn(Bl)],id.prototype,"__",void 0),me([Tn("#FFFFFF")],id.prototype,"fill",void 0),me([Cn("hide")],id.prototype,"overflow",void 0),id=me([$n()],id);const{moveTo:sd,closePath:rd,ellipse:nd}=Ps;let od=class extends Hl{get __tag(){return"Ellipse"}__updatePath(){const{width:t,height:e,innerRadius:i,startAngle:s,endAngle:r}=this.__,n=t/2,o=e/2,a=this.__.path=[];let h;i?s||r?(i<1?nd(a,n,o,n*i,o*i,0,s,r,!1):h=!0,nd(a,n,o,n,o,0,r,s,!0)):(i<1&&(nd(a,n,o,n*i,o*i),sd(a,t,o)),nd(a,n,o,n,o,0,360,0,!0)):s||r?(sd(a,n,o),nd(a,n,o,n,o,0,s,r,!1)):nd(a,n,o,n,o),h||rd(a),Zt.ellipseToCurve&&(this.__.path=this.getPath(!0))}};me([Nn(Rl)],od.prototype,"__",void 0),me([Bn(0)],od.prototype,"innerRadius",void 0),me([Bn(0)],od.prototype,"startAngle",void 0),me([Bn(0)],od.prototype,"endAngle",void 0),od=me([$n()],od);const{sin:ad,cos:hd,PI:ld}=Math,{moveTo:dd,lineTo:cd,closePath:ud,drawPoints:_d}=Ps;let pd=class extends Hl{get __tag(){return"Polygon"}__updatePath(){const t=this.__,e=t.path=[];if(t.points)_d(e,t.points,t.curve,!0);else{const{width:i,height:s,sides:r}=t,n=i/2,o=s/2;dd(e,n,0);for(let t=1;t<r;t++)cd(e,n+n*ad(2*t*ld/r),o-o*hd(2*t*ld/r));ud(e)}}};me([Nn(Cl)],pd.prototype,"__",void 0),me([Bn(3)],pd.prototype,"sides",void 0),me([Bn()],pd.prototype,"points",void 0),me([Bn(0)],pd.prototype,"curve",void 0),pd=me([Gn(),$n()],pd);const{sin:gd,cos:fd,PI:yd}=Math,{moveTo:md,lineTo:vd,closePath:wd}=Ps;let xd=class extends Hl{get __tag(){return"Star"}__updatePath(){const{width:t,height:e,corners:i,innerRadius:s}=this.__,r=t/2,n=e/2,o=this.__.path=[];md(o,r,0);for(let t=1;t<2*i;t++)vd(o,r+(t%2==0?r:r*s)*gd(t*yd/i),n-(t%2==0?n:n*s)*fd(t*yd/i));wd(o)}};me([Nn(Tl)],xd.prototype,"__",void 0),me([Bn(5)],xd.prototype,"corners",void 0),me([Bn(.382)],xd.prototype,"innerRadius",void 0),xd=me([$n()],xd);const{moveTo:bd,lineTo:kd,drawPoints:Bd}=Ps,{rotate:Sd,getAngle:Pd,getDistance:Rd,defaultPoint:Cd}=at;let Td=class extends Hl{get __tag(){return"Line"}get toPoint(){const{width:t,rotation:e}=this.__,i={x:0,y:0};return t&&(i.x=t),e&&Sd(i,e),i}set toPoint(t){this.width=Rd(Cd,t),this.rotation=Pd(Cd,t),this.height&&(this.height=0)}__updatePath(){const t=this.__,e=t.path=[];t.points?Bd(e,t.points,t.curve,t.closed):(bd(e,0,0),kd(e,this.width,0))}};me([Nn(Sl)],Td.prototype,"__",void 0),me([Sn("center")],Td.prototype,"strokeAlign",void 0),me([wn(0)],Td.prototype,"height",void 0),me([Bn()],Td.prototype,"points",void 0),me([Bn(0)],Td.prototype,"curve",void 0),me([Bn(!1)],Td.prototype,"closed",void 0),Td=me([$n()],Td);let Ed=class extends ql{get __tag(){return"Image"}get ready(){const{image:t}=this;return t&&t.ready}get image(){const{fill:t}=this.__;return d(t)&&t[0].image}};me([Nn(Dl)],Ed.prototype,"__",void 0),me([wn("")],Ed.prototype,"url",void 0),Ed=me([$n()],Ed);const Ld=Ed;let Od=class extends ql{get __tag(){return"Canvas"}get context(){return this.canvas.context}get ready(){return!this.url}constructor(t){super(t),this.canvas=de.canvas(this.__),t&&t.url&&this.drawImage(t.url)}drawImage(t){new an({url:t}).load(t=>{this.context.drawImage(t.view,0,0),this.url=void 0,this.paint(),this.emitEvent(new Ho(Ho.LOADED,{image:t}))})}draw(t,e,i,s){const r=new gt(t.worldTransform).invert(),n=new gt;e&&n.translate(e.x,e.y),i&&(a(i)?n.scale(i):n.scale(i.x,i.y)),s&&n.rotate(s),r.multiplyParent(n),t.__render(this.canvas,{matrix:r.withScale()}),this.paint()}paint(){this.forceRender()}__drawContent(t,e){const{width:i,height:s}=this.__,{view:r}=this.canvas;t.drawImage(r,0,0,r.width,r.height,0,0,i,s)}__updateSize(){const{canvas:t}=this;if(t){const{smooth:e,safeResize:i}=this.__;t.resize(this.__,i),t.smooth!==e&&(t.smooth=e)}}destroy(){this.canvas&&(this.canvas.destroy(),this.canvas=null),super.destroy()}};me([Nn(Ml)],Od.prototype,"__",void 0),me([Jh(100)],Od.prototype,"width",void 0),me([Jh(100)],Od.prototype,"height",void 0),me([Jh(1)],Od.prototype,"pixelRatio",void 0),me([Jh(!0)],Od.prototype,"smooth",void 0),me([pn(!1)],Od.prototype,"safeResize",void 0),me([Jh()],Od.prototype,"contextSettings",void 0),Od=me([$n()],Od);const{copyAndSpread:Ad,includes:Dd,spread:Md,setList:Id}=Xt,{stintSet:Wd}=p;let Fd=class extends Hl{get __tag(){return"Text"}get textDrawData(){return this.updateLayout(),this.__.__textDrawData}__updateTextDrawData(){const t=this.__,{lineHeight:e,letterSpacing:i,fontFamily:s,fontSize:r,fontWeight:n,italic:o,textCase:a,textOverflow:h,padding:l,width:d,height:c}=t;t.__lineHeight=sl.number(e,r),t.__letterSpacing=sl.number(i,r),t.__baseLine=t.__lineHeight-(t.__lineHeight-.7*r)/2,t.__font=`${o?"italic ":""}${"small-caps"===a?"small-caps ":""}${"normal"!==n?n+" ":""}${r||12}px ${s||"caption"}`,Wd(t,"__padding",l&&D.fourNumber(l)),Wd(t,"__clipText","show"!==h&&!t.__autoSize),Wd(t,"__isCharMode",d||c||t.__letterSpacing||"none"!==a),t.__textDrawData=el.getDrawData((t.__isPlacehold=t.placeholder&&""===t.text)?t.placeholder:t.text,this.__)}__updateBoxBounds(){const t=this.__,e=this.__layout,{fontSize:i,italic:s,padding:r,__autoWidth:n,__autoHeight:o}=t;this.__updateTextDrawData();const{bounds:a}=t.__textDrawData,h=e.boxBounds;if(e.contentBounds=a,t.__lineHeight<i&&Md(a,i/2),n||o){if(h.x=n?a.x:0,h.y=o?a.y:0,h.width=n?a.width:t.width,h.height=o?a.height:t.height,r){const[e,i,s,r]=t.__padding;n&&(h.x-=r,h.width+=i+r),o&&(h.y-=e,h.height+=s+e)}this.__updateNaturalSize()}else super.__updateBoxBounds();s&&(h.width+=.16*i),p.stintSet(this,"isOverflow",!Dd(h,a)),this.isOverflow?(Id(t.__textBoxBounds={},[h,a]),e.renderChanged=!0):t.__textBoxBounds=h}__updateRenderSpread(){let t=super.__updateRenderSpread();return t||(t=this.isOverflow?1:0),t}__updateRenderBounds(){const{renderBounds:t,renderSpread:e}=this.__layout;Ad(t,this.__.__textBoxBounds,e),this.__box&&(this.__box.__layout.renderBounds=t)}__updateChange(){super.__updateChange();const t=this.__box;t&&(t.__onUpdateSize(),t.__updateChange())}__drawRenderPath(t){t.font=this.__.__font}__draw(t,e,i){const s=this.__box;s&&(s.__nowWorld=this.__nowWorld,s.__draw(t,e,i)),this.textEditing&&!e.exporting||super.__draw(t,e,i)}__drawShape(t,e){e.shape&&this.__box&&this.__box.__drawShape(t,e),super.__drawShape(t,e)}destroy(){this.boxStyle&&(this.boxStyle=null),super.destroy()}};me([Nn(Al)],Fd.prototype,"__",void 0),me([wn(0)],Fd.prototype,"width",void 0),me([wn(0)],Fd.prototype,"height",void 0),me([Tn()],Fd.prototype,"boxStyle",void 0),me([pn(!1)],Fd.prototype,"resizeFontSize",void 0),me([Tn("#000000")],Fd.prototype,"fill",void 0),me([Sn("outside")],Fd.prototype,"strokeAlign",void 0),me([Fn("all")],Fd.prototype,"hitFill",void 0),me([wn("")],Fd.prototype,"text",void 0),me([wn("")],Fd.prototype,"placeholder",void 0),me([wn("caption")],Fd.prototype,"fontFamily",void 0),me([wn(12)],Fd.prototype,"fontSize",void 0),me([wn("normal")],Fd.prototype,"fontWeight",void 0),me([wn(!1)],Fd.prototype,"italic",void 0),me([wn("none")],Fd.prototype,"textCase",void 0),me([wn("none")],Fd.prototype,"textDecoration",void 0),me([wn(0)],Fd.prototype,"letterSpacing",void 0),me([wn({type:"percent",value:1.5})],Fd.prototype,"lineHeight",void 0),me([wn(0)],Fd.prototype,"paraIndent",void 0),me([wn(0)],Fd.prototype,"paraSpacing",void 0),me([wn("x")],Fd.prototype,"writingMode",void 0),me([wn("left")],Fd.prototype,"textAlign",void 0),me([wn("top")],Fd.prototype,"verticalAlign",void 0),me([wn(!0)],Fd.prototype,"autoSizeAlign",void 0),me([wn("normal")],Fd.prototype,"textWrap",void 0),me([wn("show")],Fd.prototype,"textOverflow",void 0),me([Tn(!1)],Fd.prototype,"textEditing",void 0),Fd=me([$n()],Fd);let zd=class extends Hl{get __tag(){return"Path"}};me([Nn(El)],zd.prototype,"__",void 0),me([Sn("center")],zd.prototype,"strokeAlign",void 0),zd=me([$n()],zd);let Nd=class extends jl{get __tag(){return"Pen"}setStyle(t){const e=this.pathElement=new zd(t);return this.pathStyle=t,this.__path=e.path||(e.path=[]),this.add(e),this}beginPath(){return this}moveTo(t,e){return this}lineTo(t,e){return this}bezierCurveTo(t,e,i,s,r,n){return this}quadraticCurveTo(t,e,i,s){return this}closePath(){return this}rect(t,e,i,s){return this}roundRect(t,e,i,s,r){return this}ellipse(t,e,i,s,r,n,o,a){return this}arc(t,e,i,s,r,n){return this}arcTo(t,e,i,s,r){return this}drawEllipse(t,e,i,s,r,n,o,a){return this}drawArc(t,e,i,s,r,n){return this}drawPoints(t,e,i){return this}clearPath(){return this}paint(){this.pathElement.__layout.boxChanged||this.pathElement.forceUpdate("path")}};me([Nn(Ll)],Nd.prototype,"__",void 0),me([(t,e)=>{hn(t,e,{get(){return this.__path}})}],Nd.prototype,"path",void 0),Nd=me([qn(Us,["set","path","paint"]),$n()],Nd);let Yd=class extends Kl{get __tag(){return"App"}get isApp(){return!0}constructor(t,e){super(t,e)}init(t,e){if(super.init(t,e),t){const{ground:e,tree:i,sky:s,editor:r}=t;e&&(this.ground=this.addLeafer(e)),(i||r)&&(this.tree=this.addLeafer(i||{type:t.type||"design"})),(s||r)&&(this.sky=this.addLeafer(s)),r&&de.editor(r,this)}}__setApp(){const{canvas:t}=this,{realCanvas:e,view:i}=this.config;e||i===this.canvas.view||!t.parentView?this.realCanvas=!0:t.unrealCanvas(),this.leafer=this,this.watcher.disable(),this.layouter.disable()}__updateLocalBounds(){this.forEach(t=>t.updateLayout()),super.__updateLocalBounds()}start(){super.start(),this.forEach(t=>t.start())}stop(){this.forEach(t=>t.stop()),super.stop()}unlockLayout(){super.unlockLayout(),this.forEach(t=>t.unlockLayout())}lockLayout(){super.lockLayout(),this.forEach(t=>t.lockLayout())}forceRender(t,e){this.forEach(i=>i.forceRender(t,e))}addLeafer(t){const e=new Kl(t);return this.add(e),e}add(t,e){if(!t.view){if(this.realCanvas&&!this.canvas.bounds)return void setTimeout(()=>this.add(t,e),10);t.init(this.__getChildConfig(t.userConfig),this)}super.add(t,e),s(e)||(t.canvas.childIndex=e),this.__listenChildEvents(t)}forEach(t){this.children.forEach(t)}__onCreated(){this.created=this.children.every(t=>t.created)}__onReady(){this.children.every(t=>t.ready)&&super.__onReady()}__onViewReady(){this.children.every(t=>t.viewReady)&&super.__onViewReady()}__onChildRenderEnd(t){this.renderer.addBlock(t.renderBounds),this.viewReady&&this.renderer.update()}__render(t,e){t.context&&this.forEach(i=>e.matrix?i.__render(t,e):t.copyWorld(i.canvas,e.bounds))}__onResize(t){this.forEach(e=>e.resize(t)),super.__onResize(t)}updateLayout(){this.forEach(t=>t.updateLayout())}__getChildConfig(t){const e=Object.assign({},this.config);return e.hittable=e.realCanvas=void 0,t&&p.assign(e,t),this.autoLayout&&p.copyAttrs(e,this,Oe),e.view=this.realCanvas?void 0:this.view,e.fill=void 0,e}__listenChildEvents(t){t.once([[Zo.END,this.__onReady,this],[ta.START,this.__onCreated,this],[ta.END,this.__onViewReady,this]]),this.realCanvas&&this.__eventIds.push(t.on_(ta.END,this.__onChildRenderEnd,this))}};Yd=me([$n()],Yd);const Xd={},Ud={isHoldSpaceKey:()=>Ud.isHold("Space"),isHold:t=>Xd[t],isHoldKeys:(t,e)=>e?t(e):void 0,setDownCode(t){Xd[t]||(Xd[t]=!0)},setUpCode(t){Xd[t]=!1}},Hd={LEFT:1,RIGHT:2,MIDDLE:4,defaultLeft(t){t.buttons||(t.buttons=1)},left:t=>1===t.buttons,right:t=>2===t.buttons,middle:t=>4===t.buttons};class jd extends zo{get spaceKey(){return Ud.isHoldSpaceKey()}get left(){return Hd.left(this)}get right(){return Hd.right(this)}get middle(){return Hd.middle(this)}constructor(t){super(t.type),this.bubbles=!0,Object.assign(this,t)}isHoldKeys(t){return Ud.isHoldKeys(t,this)}getBoxPoint(t){return(t||this.current).getBoxPoint(this)}getInnerPoint(t){return(t||this.current).getInnerPoint(this)}getLocalPoint(t){return(t||this.current).getLocalPoint(this)}getPagePoint(){return this.current.getPagePoint(this)}getInner(t){return this.getInnerPoint(t)}getLocal(t){return this.getLocalPoint(t)}getPage(){return this.getPagePoint()}static changeName(t,e){ge.changeName(t,e)}}const{min:Vd,max:Gd,abs:Kd}=Math,{float:qd,sign:$d}=D,{minX:Qd,maxX:Jd,minY:Zd,maxY:tc}=Xt,ec=new Vt,ic=new Vt,sc={limitMove(t,e){const{dragBounds:i,dragBoundsType:s}=t;i&&rc.getValidMove(t.__localBoxBounds,rc.getDragBounds(t),s,e,!0),rc.axisMove(t,e)},limitScaleOf(t,e,i,s){const{dragBounds:r,dragBoundsType:n}=t;r&&rc.getValidScaleOf(t.__localBoxBounds,rc.getDragBounds(t),n,t.getLocalPointByInner(t.getInnerPointByBox(e)),i,s,!0)},axisMove(t,e){const{draggable:i}=t;"x"===i&&(e.y=0),"y"===i&&(e.x=0)},getDragBounds(t){const{dragBounds:e}=t;return"parent"===e?t.parent.boxBounds:e},isInnerMode:(t,e,i,s)=>"inner"===i||"auto"===i&&t[s]>e[s],getValidMove(t,e,i,s,r){const n=t.x+s.x,o=t.y+s.y,a=n+t.width,h=o+t.height,l=e.x+e.width,d=e.y+e.height;return r||(s=Object.assign({},s)),rc.isInnerMode(t,e,i,"width")?n>e.x?s.x+=e.x-n:a<l&&(s.x+=l-a):n<e.x?s.x+=e.x-n:a>l&&(s.x+=l-a),rc.isInnerMode(t,e,i,"height")?o>e.y?s.y+=e.y-o:h<d&&(s.y+=d-h):o<e.y?s.y+=e.y-o:h>d&&(s.y+=d-h),s.x=qd(s.x),s.y=qd(s.y),s},getValidScaleOf(t,e,i,s,r,n,a){a||(r=Object.assign({},r)),ic.set(e),ec.set(t).scaleOf(s,r.x,r.y);const h=(s.x-t.x)/t.width,l=1-h,d=(s.y-t.y)/t.height,c=1-d;let u,_,p,g,f=1,y=1;return rc.isInnerMode(t,e,i,"width")?(r.x<0&&ec.scaleOf(s,f=1/r.x,1),p=qd(ec.minX-ic.minX),g=qd(ic.maxX-ec.maxX),u=h&&p>0?1+p/(h*ec.width):1,_=l&&g>0?1+g/(l*ec.width):1,f*=Gd(u,_)):(r.x<0&&((qd(Qd(t)-Qd(e))<=0||qd(Jd(e)-Jd(t))<=0)&&ec.scaleOf(s,f=1/r.x,1),ec.unsign()),p=qd(ic.minX-ec.minX),g=qd(ec.maxX-ic.maxX),u=h&&p>0?1-p/(h*ec.width):1,_=l&&g>0?1-g/(l*ec.width):1,f*=Vd(u,_)),rc.isInnerMode(t,e,i,"height")?(r.y<0&&ec.scaleOf(s,1,y=1/r.y),p=qd(ec.minY-ic.minY),g=qd(ic.maxY-ec.maxY),u=d&&p>0?1+p/(d*ec.height):1,_=c&&g>0?1+g/(c*ec.height):1,y*=Gd(u,_),n&&(u=Gd(Kd(f),Kd(y)),f=$d(f)*u,y=$d(y)*u)):(r.y<0&&((qd(Zd(t)-Zd(e))<=0||qd(tc(e)-tc(t))<=0)&&ec.scaleOf(s,1,y=1/r.y),ec.unsign()),p=qd(ic.minY-ec.minY),g=qd(ec.maxY-ic.maxY),u=d&&p>0?1-p/(d*ec.height):1,_=c&&g>0?1-g/(c*ec.height):1,y*=Vd(u,_)),r.x*=o(f)?f:1,r.y*=o(y)?y:1,r}},rc=sc;let nc=class extends jd{};nc.POINTER="pointer",nc.BEFORE_DOWN="pointer.before_down",nc.BEFORE_MOVE="pointer.before_move",nc.BEFORE_UP="pointer.before_up",nc.DOWN="pointer.down",nc.MOVE="pointer.move",nc.UP="pointer.up",nc.OVER="pointer.over",nc.OUT="pointer.out",nc.ENTER="pointer.enter",nc.LEAVE="pointer.leave",nc.TAP="tap",nc.DOUBLE_TAP="double_tap",nc.CLICK="click",nc.DOUBLE_CLICK="double_click",nc.LONG_PRESS="long_press",nc.LONG_TAP="long_tap",nc.MENU="pointer.menu",nc.MENU_TAP="pointer.menu_tap",nc=me([Qn()],nc);const oc=nc,ac={};let hc=class extends nc{static setList(t){this.list=t instanceof kh?t:new kh(t)}static setData(t){this.data=t}static getValidMove(t,e,i,s=!0){const r=t.getLocalPoint(i,null,!0);return at.move(r,e.x-t.x,e.y-t.y),s&&this.limitMove(t,r),sc.axisMove(t,r),r}static limitMove(t,e){sc.limitMove(t,e)}getPageMove(t){return this.assignMove(t),this.current.getPagePoint(ac,null,!0)}getInnerMove(t,e){return t||(t=this.current),this.assignMove(e),t.getInnerPoint(ac,null,!0)}getLocalMove(t,e){return t||(t=this.current),this.assignMove(e),t.getLocalPoint(ac,null,!0)}getPageTotal(){return this.getPageMove(!0)}getInnerTotal(t){return this.getInnerMove(t,!0)}getLocalTotal(t){return this.getLocalMove(t,!0)}getPageBounds(){const t=this.getPageTotal(),e=this.getPagePoint(),i={};return Xt.set(i,e.x-t.x,e.y-t.y,t.x,t.y),Xt.unsign(i),i}assignMove(t){ac.x=t?this.totalX:this.moveX,ac.y=t?this.totalY:this.moveY}};hc.BEFORE_DRAG="drag.before_drag",hc.START="drag.start",hc.DRAG="drag",hc.END="drag.end",hc.OVER="drag.over",hc.OUT="drag.out",hc.ENTER="drag.enter",hc.LEAVE="drag.leave",hc=me([Qn()],hc);const lc=hc;let dc=class extends nc{static setList(t){hc.setList(t)}static setData(t){hc.setData(t)}};dc.DROP="drop",dc=me([Qn()],dc);let cc=class extends hc{};cc.BEFORE_MOVE="move.before_move",cc.START="move.start",cc.MOVE="move",cc.DRAG_ANIMATE="move.drag_animate",cc.END="move.end",cc.PULL_DOWN="move.pull_down",cc.REACH_BOTTOM="move.reach_bottom",cc=me([Qn()],cc);let uc=class extends jd{};uc=me([Qn()],uc);const _c=uc;let pc=class extends nc{};pc.BEFORE_ROTATE="rotate.before_rotate",pc.START="rotate.start",pc.ROTATE="rotate",pc.END="rotate.end",pc=me([Qn()],pc);let gc=class extends hc{};gc.SWIPE="swipe",gc.LEFT="swipe.left",gc.RIGHT="swipe.right",gc.UP="swipe.up",gc.DOWN="swipe.down",gc=me([Qn()],gc);let fc=class extends nc{};fc.BEFORE_ZOOM="zoom.before_zoom",fc.START="zoom.start",fc.ZOOM="zoom",fc.END="zoom.end",fc=me([Qn()],fc);let yc=class extends jd{};yc.BEFORE_DOWN="key.before_down",yc.BEFORE_UP="key.before_up",yc.DOWN="key.down",yc.HOLD="key.hold",yc.UP="key.up",yc=me([Qn()],yc);const mc={getDragEventData:(t,e,i)=>Object.assign(Object.assign({},i),{x:i.x,y:i.y,moveX:i.x-e.x,moveY:i.y-e.y,totalX:i.x-t.x,totalY:i.y-t.y}),getDropEventData:(t,e,i)=>Object.assign(Object.assign({},t),{list:e,data:i}),getSwipeDirection:t=>t<-45&&t>-135?gc.UP:t>45&&t<135?gc.DOWN:t<=45&&t>=-45?gc.RIGHT:gc.LEFT,getSwipeEventData:(t,e,i)=>Object.assign(Object.assign({},i),{moveX:e.moveX,moveY:e.moveY,totalX:i.x-t.x,totalY:i.y-t.y,type:vc.getSwipeDirection(at.getAngle(t,i))}),getBase(t){const e=1===t.button?4:t.button;return{altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,time:Date.now(),buttons:s(t.buttons)?1:0===t.buttons?e:t.buttons,origin:t}},pathHasEventType(t,e){const{list:i}=t;for(let t=0,s=i.length;t<s;t++)if(i[t].hasEvent(e))return!0;return!1},filterPathByEventType(t,e){const i=new kh,{list:s}=t;for(let t=0,r=s.length;t<r;t++)s[t].hasEvent(e)&&i.add(s[t]);return i},pathCanDrag:t=>t&&t.list.some(t=>lo.draggable(t)||!t.isLeafer&&t.hasEvent(hc.DRAG)),pathHasOutside:t=>t&&t.list.some(t=>t.isOutside)},vc=mc,wc=new kh,{getDragEventData:xc,getDropEventData:bc,getSwipeEventData:kc}=mc;class Bc{constructor(t){this.dragDataList=[],this.interaction=t}setDragData(t){this.animateWait&&this.dragEndReal(),this.downData=this.interaction.downData,this.dragData=xc(t,t,t),this.canAnimate=this.canDragOut=!0}getList(t,e){const{proxy:i}=this.interaction.selector,s=i&&i.list.length,r=hc.list||this.draggableList||wc;return this.dragging&&(s?t?wc:new kh(e?[...i.list,...i.dragHoverExclude]:i.list):r)}checkDrag(t,e){const{interaction:i}=this;if(this.moving&&t.buttons<1)return this.canAnimate=!1,void i.pointerCancel();!this.moving&&e&&(this.moving=i.canMove(this.downData)||i.isHoldRightKey||i.isMobileDragEmpty)&&(this.dragData.moveType="drag",i.emit(cc.START,this.dragData)),this.moving||this.dragStart(t,e),this.drag(t)}dragStart(t,e){this.dragging||(this.dragging=e&&Hd.left(t),this.dragging&&(this.interaction.emit(hc.START,this.dragData),this.getDraggableList(this.dragData.path),this.setDragStartPoints(this.realDraggableList=this.getList(!0))))}setDragStartPoints(t){this.dragStartPoints={},t.forEach(t=>this.dragStartPoints[t.innerId]={x:t.x,y:t.y})}getDraggableList(t){let e;for(let i=0,s=t.length;i<s;i++)if(e=t.list[i],lo.draggable(e)){this.draggableList=new kh(e);break}}drag(t){const{interaction:e,dragData:i,downData:s}=this,{path:r,throughPath:n}=s;this.dragData=xc(s,i,t),n&&(this.dragData.throughPath=n),this.dragData.path=r,this.dragDataList.push(this.dragData),this.moving?(t.moving=!0,this.dragData.moveType="drag",e.emit(cc.BEFORE_MOVE,this.dragData),e.emit(cc.MOVE,this.dragData)):this.dragging&&(t.dragging=!0,this.dragReal(),e.emit(hc.BEFORE_DRAG,this.dragData),e.emit(hc.DRAG,this.dragData))}dragReal(t){const{interaction:e}=this,{running:i}=e,s=this.realDraggableList;if(s.length&&i){const{totalX:i,totalY:r}=this.dragData,{dragLimitAnimate:o}=e.p,h=!o||!!t;s.forEach(e=>{if(e.draggable){const s=n(e.draggable),l=hc.getValidMove(e,this.dragStartPoints[e.innerId],{x:i,y:r},h||s);o&&!s&&t?lo.animateMove(e,l,a(o)?o:.3):e.move(l)}})}}dragOverOrOut(t){const{interaction:e}=this,{dragOverPath:i}=this,{path:s}=t;this.dragOverPath=s,i?s.indexAt(0)!==i.indexAt(0)&&(e.emit(hc.OUT,t,i),e.emit(hc.OVER,t,s)):e.emit(hc.OVER,t,s)}dragEnterOrLeave(t){const{interaction:e}=this,{dragEnterPath:i}=this,{path:s}=t;e.emit(hc.LEAVE,t,i,s),e.emit(hc.ENTER,t,s,i),this.dragEnterPath=s}dragEnd(t){(this.dragging||this.moving)&&(this.checkDragEndAnimate(t)||this.dragEndReal(t))}dragEndReal(t){const{interaction:e,downData:i,dragData:s}=this;t||(t=s);const{path:r,throughPath:n}=i,o=xc(i,t,t);if(n&&(o.throughPath=n),o.path=r,this.moving&&(this.moving=!1,o.moveType="drag",e.emit(cc.END,o)),this.dragging){const r=this.getList();this.dragging=!1,e.p.dragLimitAnimate&&this.dragReal(!0),e.emit(hc.END,o),this.swipe(t,i,s,o),this.drop(t,r,this.dragEnterPath)}this.autoMoveCancel(),this.dragReset(),this.animate(null,"off")}swipe(t,e,i,s){const{interaction:r}=this;if(at.getDistance(e,t)>r.config.pointer.swipeDistance){const t=kc(e,i,s);this.interaction.emit(t.type,t)}}drop(t,e,i){const s=bc(t,e,hc.data);s.path=i,this.interaction.emit(dc.DROP,s),this.interaction.emit(hc.LEAVE,t,i)}dragReset(){hc.list=hc.data=this.draggableList=this.dragData=this.downData=this.dragOverPath=this.dragEnterPath=null,this.dragDataList=[]}checkDragEndAnimate(t,e){return!1}animate(t,e){}stopAnimate(){}checkDragOut(t){}autoMoveOnDragOut(t){}autoMoveCancel(){}destroy(){this.dragReset()}}const Sc=ie.get("emit");const Pc=["move","zoom","rotate","key"];function Rc(t,e,i,s,r){if(Pc.some(t=>e.startsWith(t))&&t.__.hitChildren&&!Tc(t,r)){let n;for(let o=0,a=t.children.length;o<a;o++)n=t.children[o],!i.path.has(n)&&n.__.hittable&&Cc(n,e,i,s,r)}}function Cc(t,e,i,s,r){if(t.destroyed)return!1;if(t.__.hitSelf&&!Tc(t,r)&&(cl.updateEventStyle&&!s&&cl.updateEventStyle(t,e),t.hasEvent(e,s))){i.phase=s?1:t===i.target?2:3;const r=ge.get(e,i);if(t.emitEvent(r,s),r.isStop)return!0}return!1}function Tc(t,e){return e&&e.has(t)}const Ec={wheel:{zoomSpeed:.5,moveSpeed:.5,rotateSpeed:.5,delta:{x:20,y:8}},pointer:{type:"pointer",snap:!0,hitRadius:5,tapTime:120,longPressTime:800,transformTime:500,hover:!0,dragHover:!0,dragDistance:2,swipeDistance:20},touch:{preventDefault:"auto"},multiTouch:{},move:{autoDistance:2},zoom:{},cursor:!0,keyEvent:!0},{pathHasEventType:Lc,pathCanDrag:Oc,pathHasOutside:Ac}=mc;class Dc{get dragging(){return this.dragger.dragging}get transforming(){return this.transformer.transforming}get moveMode(){return!0===this.m.drag||this.isHoldSpaceKey||this.isHoldMiddleKey||this.isHoldRightKey&&this.dragger.moving||this.isDragEmpty}get canHover(){return this.p.hover&&!this.config.mobile}get isDragEmpty(){return this.m.dragEmpty&&this.isRootPath(this.hoverData)&&(!this.downData||this.isRootPath(this.downData))}get isMobileDragEmpty(){return this.m.dragEmpty&&!this.canHover&&this.downData&&this.isTreePath(this.downData)}get isHoldMiddleKey(){return this.m.holdMiddleKey&&this.downData&&Hd.middle(this.downData)}get isHoldRightKey(){return this.m.holdRightKey&&this.downData&&Hd.right(this.downData)}get isHoldSpaceKey(){return this.m.holdSpaceKey&&Ud.isHoldSpaceKey()}get m(){return this.config.move}get p(){return this.config.pointer}get hitRadius(){return this.p.hitRadius}constructor(t,e,i,s){this.config=p.clone(Ec),this.tapCount=0,this.downKeyMap={},this.target=t,this.canvas=e,this.selector=i,this.defaultPath=new kh(t),this.createTransformer(),this.dragger=new Bc(this),s&&(this.config=p.default(s,this.config)),this.__listenEvents()}start(){this.running=!0}stop(){this.running=!1}receive(t){}pointerDown(t,e){t||(t=this.hoverData),t&&(Hd.defaultLeft(t),this.updateDownData(t),this.checkPath(t,e),this.downTime=Date.now(),this.emit(nc.BEFORE_DOWN,t),this.emit(nc.DOWN,t),Hd.left(t)&&(this.tapWait(),this.longPressWait(t)),this.waitRightTap=Hd.right(t),this.dragger.setDragData(t),this.isHoldRightKey||this.updateCursor(t))}pointerMove(t){if(t||(t=this.hoverData),!t)return;const{downData:e}=this;e&&Hd.defaultLeft(t);(this.canvas.bounds.hitPoint(t)||e)&&(this.pointerMoveReal(t),e&&this.dragger.checkDragOut(t))}pointerMoveReal(t){if(this.emit(nc.BEFORE_MOVE,t,this.defaultPath),this.downData){const e=at.getDistance(this.downData,t)>this.p.dragDistance;e&&(this.pointerWaitCancel(),this.waitRightTap=!1),this.dragger.checkDrag(t,e)}this.dragger.moving||(this.updateHoverData(t),this.checkPath(t),this.emit(nc.MOVE,t),this.pointerHover(t),this.dragging&&(this.dragger.dragOverOrOut(t),this.dragger.dragEnterOrLeave(t))),this.updateCursor(this.downData||t)}pointerUp(t){const{downData:e}=this;if(t||(t=e),!e)return;Hd.defaultLeft(t),t.multiTouch=e.multiTouch,this.findPath(t);const i=Object.assign(Object.assign({},t),{path:t.path.clone()});t.path.addList(e.path.list),this.checkPath(t),this.downData=null,this.emit(nc.BEFORE_UP,t),this.emit(nc.UP,t),this.touchLeave(t),t.isCancel||(this.tap(t),this.menuTap(t)),this.dragger.dragEnd(t),this.updateCursor(i)}pointerCancel(){const t=Object.assign({},this.dragger.dragData);t.isCancel=!0,this.pointerUp(t)}menu(t){this.findPath(t),this.emit(nc.MENU,t),this.waitMenuTap=!0,!this.downData&&this.waitRightTap&&this.menuTap(t)}menuTap(t){this.waitRightTap&&this.waitMenuTap&&(this.emit(nc.MENU_TAP,t),this.waitRightTap=this.waitMenuTap=!1)}createTransformer(){}move(t){}zoom(t){}rotate(t){}transformEnd(){}wheel(t){}multiTouch(t,e){}keyDown(t){if(!this.config.keyEvent)return;this.emit(yc.BEFORE_DOWN,t,this.defaultPath);const{code:e}=t;this.downKeyMap[e]||(this.downKeyMap[e]=!0,Ud.setDownCode(e),this.emit(yc.HOLD,t,this.defaultPath),this.moveMode&&(this.cancelHover(),this.updateCursor())),this.emit(yc.DOWN,t,this.defaultPath)}keyUp(t){if(!this.config.keyEvent)return;this.emit(yc.BEFORE_UP,t,this.defaultPath);const{code:e}=t;this.downKeyMap[e]=!1,Ud.setUpCode(e),this.emit(yc.UP,t,this.defaultPath),"grab"===this.cursor&&this.updateCursor()}pointerHover(t){!this.canHover||this.dragging&&!this.p.dragHover||(t.path||(t.path=new kh),this.pointerOverOrOut(t),this.pointerEnterOrLeave(t))}pointerOverOrOut(t){const{path:e}=t,{overPath:i}=this;this.overPath=e,i?e.indexAt(0)!==i.indexAt(0)&&(this.emit(nc.OUT,t,i),this.emit(nc.OVER,t,e)):this.emit(nc.OVER,t,e)}pointerEnterOrLeave(t){let{path:e}=t;this.downData&&!this.moveMode&&(e=e.clone(),this.downData.path.forEach(t=>e.add(t)));const{enterPath:i}=this;this.enterPath=e,this.emit(nc.LEAVE,t,i,e),this.emit(nc.ENTER,t,e,i)}touchLeave(t){"touch"===t.pointerType&&this.enterPath&&(this.emit(nc.LEAVE,t),this.dragger.dragging&&this.emit(dc.LEAVE,t))}tap(t){const{pointer:e}=this.config,i=this.longTap(t);if(!e.tapMore&&i)return;if(!this.waitTap)return;e.tapMore&&this.emitTap(t);const s=Date.now()-this.downTime,r=[nc.DOUBLE_TAP,nc.DOUBLE_CLICK].some(e=>Lc(t.path,e));s<e.tapTime+50&&r?(this.tapCount++,2===this.tapCount?(this.tapWaitCancel(),this.emitDoubleTap(t)):(clearTimeout(this.tapTimer),this.tapTimer=setTimeout(()=>{e.tapMore||(this.tapWaitCancel(),this.emitTap(t))},e.tapTime))):e.tapMore||(this.tapWaitCancel(),this.emitTap(t))}findPath(t,e){const{hitRadius:i,through:s}=this.p,{bottomList:r,target:n}=this;Zt.backgrounder||t.origin||n&&n.updateLayout();const o=this.selector.getByPoint(t,i,Object.assign({bottomList:r,name:t.type},e||{through:s}));return o.throughPath&&(t.throughPath=o.throughPath),t.path=o.path,o.path}isRootPath(t){return t&&t.path.list[0].isLeafer}isTreePath(t){const e=this.target.app;return!(!e||!e.isApp)&&(e.editor&&!t.path.has(e.editor)&&t.path.has(e.tree)&&!t.target.syncEventer)}checkPath(t,e){(e||this.moveMode&&!Ac(t.path))&&(t.path=this.defaultPath)}canMove(t){return t&&(this.moveMode||"auto"===this.m.drag&&!Oc(t.path))&&!Ac(t.path)}isDrag(t){return this.dragger.getList().has(t)}isPress(t){return this.downData&&this.downData.path.has(t)}isHover(t){return this.enterPath&&this.enterPath.has(t)}isFocus(t){return this.focusData===t}cancelHover(){const{hoverData:t}=this;t&&(t.path=this.defaultPath,this.pointerHover(t))}stopDragAnimate(){this.dragger.stopAnimate()}updateDownData(t,e,i){const{downData:s}=this;!t&&s&&(t=s),t&&(this.findPath(t,e),i&&s&&t.path.addList(s.path.list),this.downData=t)}updateHoverData(t){t||(t=this.hoverData),t&&(this.findPath(t,{exclude:this.dragger.getList(!1,!0),name:nc.MOVE}),this.hoverData=t)}updateCursor(t){if(!this.config.cursor||!this.canHover)return;if(t||(this.updateHoverData(),t=this.downData||this.hoverData),this.dragger.moving)return this.setCursor("grabbing");if(this.canMove(t))return this.setCursor(this.downData?"grabbing":"grab");if(!t)return;let e,i;const{path:s}=t;for(let t=0,r=s.length;t<r&&(e=s.list[t],i=e.syncEventer&&e.syncEventer.cursor||e.cursor,!i);t++);this.setCursor(i)}setCursor(t){this.cursor=t}getLocal(t,e){const i=this.canvas.getClientBounds(e),s={x:t.clientX-i.x,y:t.clientY-i.y},{bounds:r}=this.canvas;return s.x*=r.width/i.width,s.y*=r.height/i.height,this.p.snap&&at.round(s),s}emitTap(t){this.emit(nc.TAP,t),this.emit(nc.CLICK,t)}emitDoubleTap(t){this.emit(nc.DOUBLE_TAP,t),this.emit(nc.DOUBLE_CLICK,t)}pointerWaitCancel(){this.tapWaitCancel(),this.longPressWaitCancel()}tapWait(){clearTimeout(this.tapTimer),this.waitTap=!0}tapWaitCancel(){this.waitTap&&(clearTimeout(this.tapTimer),this.waitTap=!1,this.tapCount=0)}longPressWait(t){clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout(()=>{this.longPressed=!0,this.emit(nc.LONG_PRESS,t)},this.p.longPressTime)}longTap(t){let e;return this.longPressed&&(this.emit(nc.LONG_TAP,t),(Lc(t.path,nc.LONG_TAP)||Lc(t.path,nc.LONG_PRESS))&&(e=!0)),this.longPressWaitCancel(),e}longPressWaitCancel(){this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressed=!1)}__onResize(){const{dragOut:t}=this.m;this.shrinkCanvasBounds=new Vt(this.canvas.bounds),this.shrinkCanvasBounds.spread(-(a(t)?t:2))}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Qo.RESIZE,this.__onResize,this)],t.once(ea.READY,()=>this.__onResize())}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}emit(t,e,i,s){this.running&&function(t,e,i,s){if(!i&&!e.path)return;let r;e.type=t,i?e=Object.assign(Object.assign({},e),{path:i}):i=e.path,e.target=i.indexAt(0);try{for(let n=i.length-1;n>-1;n--){if(r=i.list[n],Cc(r,t,e,!0,s))return;r.isApp&&Rc(r,t,e,!0,s)}for(let n=0,o=i.length;n<o;n++)if(r=i.list[n],r.isApp&&Rc(r,t,e,!1,s),Cc(r,t,e,!1,s))return}catch(t){Sc.error(t)}}(t,e,i,s)}destroy(){this.__eventIds.length&&(this.stop(),this.__removeListenEvents(),this.dragger.destroy(),this.transformer&&this.transformer.destroy(),this.downData=this.overPath=this.enterPath=null)}}class Mc{static set(t,e){this.custom[t]=e}static get(t){return this.custom[t]}}Mc.custom={};class Ic extends ye{constructor(){super(...arguments),this.maxTotal=1e3,this.pathList=new kh,this.pixelList=new kh}getPixelType(t,e){return this.__autoClear(),this.pixelList.add(t),de.hitCanvas(e)}getPathType(t){return this.__autoClear(),this.pathList.add(t),de.hitCanvas()}clearImageType(){this.__clearLeafList(this.pixelList)}clearPathType(){this.__clearLeafList(this.pathList)}__clearLeafList(t){t.length&&(t.forEach(t=>{t.__hitCanvas&&(t.__hitCanvas.destroy(),t.__hitCanvas=null)}),t.reset())}__autoClear(){this.pathList.length+this.pixelList.length>this.maxTotal&&this.clear()}clear(){this.clearPathType(),this.clearImageType()}}Zt.getSelector=function(t){return t.leafer?t.leafer.selector:Zt.selector||(Zt.selector=de.selector())};const{toInnerRadiusPointOf:Wc,copyRadiusPoint:Fc}=at,{hitRadiusPoint:zc,hitPoint:Nc}=Xt,Yc={},Xc={},Uc=uh.prototype;Uc.hit=function(t,e=0){this.updateLayout(),Fc(Xc,t,e);const i=this.__world;return!!(e?zc(i,Xc):Nc(i,Xc))&&(this.isBranch?Zt.getSelector(this).hitPoint(Object.assign({},Xc),e,{target:this}):this.__hitWorld(Xc))},Uc.__hitWorld=function(t,e){const i=this.__;if(!i.hitSelf)return!1;const s=this.__world,r=this.__layout,n=s.width<10&&s.height<10;if(i.hitRadius&&(Fc(Yc,t,i.hitRadius),t=Yc),Wc(t,s,Yc),i.hitBox||n){if(Xt.hitRadiusPoint(r.boxBounds,Yc))return!0;if(n)return!1}return!r.hitCanvasChanged&&this.__hitCanvas||(this.__updateHitCanvas(),r.boundsChanged||(r.hitCanvasChanged=!1)),this.__hit(Yc,e)},Uc.__hitFill=function(t){const e=this.__hitCanvas;return e&&e.hitFill(t,this.__.windingRule)},Uc.__hitStroke=function(t,e){const i=this.__hitCanvas;return i&&i.hitStroke(t,e)},Uc.__hitPixel=function(t){const e=this.__hitCanvas;return e&&e.hitPixel(t,this.__layout.renderBounds,e.hitScale)},Uc.__drawHitPath=function(t){t&&this.__drawRenderPath(t)};const Hc=new gt,jc=Hl.prototype;jc.__updateHitCanvas=function(){this.__box&&this.__box.__updateHitCanvas();const{hitCanvasManager:t}=this.leafer||this.parent&&this.parent.leafer||{};if(!t)return;const e=this.__,i=(e.__isAlphaPixelFill||e.__isCanvas)&&"pixel"===e.hitFill,s=e.__isAlphaPixelStroke&&"pixel"===e.hitStroke,r=i||s;this.__hitCanvas||(this.__hitCanvas=r?t.getPixelType(this,{contextSettings:{willReadFrequently:!0}}):t.getPathType(this));const n=this.__hitCanvas;if(r){const{renderBounds:t}=this.__layout,r=Zt.image.hitCanvasSize,o=n.hitScale=Gt.set(0,0,r,r).getFitMatrix(t).a,{x:a,y:h,width:l,height:d}=Gt.set(t).scale(o);n.resize({width:l,height:d,pixelRatio:1}),n.clear(),sn.patternLocked=!0,this.__renderShape(n,{matrix:Hc.setWith(this.__world).scaleWith(1/o).invertWith().translate(-a,-h),snapshot:!0,ignoreFill:!i,ignoreStroke:!s}),sn.patternLocked=!1,n.resetTransform(),e.__isHitPixel=!0}else e.__isHitPixel&&(e.__isHitPixel=!1);this.__drawHitPath(n),n.setStrokeOptions(e)},jc.__hit=function(t,e){if(this.__box&&this.__box.__hit(t))return!0;const i=this.__;if(i.__isHitPixel&&this.__hitPixel(t))return!0;const{hitFill:s}=i,r=(i.fill||i.__isCanvas)&&("path"===s||"pixel"===s&&!(i.__isAlphaPixelFill||i.__isCanvas))||"all"===s||e;if(r&&this.__hitFill(t))return!0;const{hitStroke:n,__maxStrokeWidth:o}=i,a=i.stroke&&("path"===n||"pixel"===n&&!i.__isAlphaPixelStroke)||"all"===n;if(!r&&!a)return!1;const h=2*t.radiusX;let l=h;if(a)switch(i.strokeAlign){case"inside":if(l+=2*o,!r&&this.__hitFill(t)&&this.__hitStroke(t,l))return!0;l=h;break;case"center":l+=o;break;case"outside":if(l+=2*o,!r){if(!this.__hitFill(t)&&this.__hitStroke(t,l))return!0;l=h}}return!!l&&this.__hitStroke(t,l)};const Vc=Hl.prototype,Gc=ql.prototype,Kc=ed.prototype;Gc.__updateHitCanvas=Kc.__updateHitCanvas=function(){this.stroke||this.cornerRadius||(this.fill||this.__.__isCanvas)&&"pixel"===this.hitFill||"all"===this.hitStroke?Vc.__updateHitCanvas.call(this):this.__hitCanvas&&(this.__hitCanvas=null)},Gc.__hitFill=Kc.__hitFill=function(t){return this.__hitCanvas?Vc.__hitFill.call(this,t):Xt.hitRadiusPoint(this.__layout.boxBounds,t)},Fd.prototype.__drawHitPath=function(t){const{__lineHeight:e,fontSize:i,__baseLine:s,__letterSpacing:r,__textDrawData:n}=this.__;t.beginPath(),r<0?this.__drawPathByBox(t):n.rows.forEach(r=>t.rect(r.x,r.y-s,r.width,e<i?i:e))},jl.prototype.pick=function(t,e){return e||(e=i),this.updateLayout(),Zt.getSelector(this).getByPoint(t,e.hitRadius||0,Object.assign(Object.assign({},e),{target:this}))};const qc=Ae.prototype;qc.hitFill=function(t,e){return e?this.context.isPointInPath(t.x,t.y,e):this.context.isPointInPath(t.x,t.y)},qc.hitStroke=function(t,e){return this.strokeWidth=e,this.context.isPointInStroke(t.x,t.y)},qc.hitPixel=function(t,e,i=1){let{x:s,y:r,radiusX:n,radiusY:o}=t;e&&(s-=e.x,r-=e.y),Gt.set(s-n,r-o,2*n,2*o).scale(i).ceil();const{data:a}=this.context.getImageData(Gt.x,Gt.y,Gt.width||1,Gt.height||1);for(let t=0,e=a.length;t<e;t+=4)if(a[t+3]>0)return!0;return a[3]>0};const $c={convert(t,e){const i=mc.getBase(t),{x:s,y:r}=e,n=Object.assign(Object.assign({},i),{x:s,y:r,width:t.width,height:t.height,pointerType:t.pointerType,pressure:t.pressure});return"pen"===n.pointerType&&(n.tangentialPressure=t.tangentialPressure,n.tiltX=t.tiltX,n.tiltY=t.tiltY,n.twist=t.twist),n},convertMouse(t,e){const i=mc.getBase(t),{x:s,y:r}=e;return Object.assign(Object.assign({},i),{x:s,y:r,width:1,height:1,pointerType:"mouse",pressure:.5})},convertTouch(t,e){const i=$c.getTouch(t),s=mc.getBase(t),{x:r,y:n}=e;return Object.assign(Object.assign({},s),{x:r,y:n,width:1,height:1,pointerType:"touch",multiTouch:t.touches.length>1,pressure:i.force})},getTouch:t=>t.targetTouches[0]||t.changedTouches[0]},Qc={convert(t){const e=mc.getBase(t);return Object.assign(Object.assign({},e),{code:t.code,key:t.key})}},{pathCanDrag:Jc}=mc;class Zc extends Dc{get notPointer(){const{p:t}=this;return"pointer"!==t.type||t.touch||this.useMultiTouch}get notTouch(){const{p:t}=this;return"mouse"===t.type||this.usePointer}get notMouse(){return this.usePointer||this.useTouch}__listenEvents(){super.__listenEvents();const t=this.view=this.canvas.view;this.viewEvents={pointerdown:this.onPointerDown,mousedown:this.onMouseDown,touchstart:this.onTouchStart,pointerleave:this.onPointerLeave,contextmenu:this.onContextMenu,wheel:this.onWheel,gesturestart:this.onGesturestart,gesturechange:this.onGesturechange,gestureend:this.onGestureend},this.windowEvents={pointermove:this.onPointerMove,pointerup:this.onPointerUp,pointercancel:this.onPointerCancel,mousemove:this.onMouseMove,mouseup:this.onMouseUp,touchmove:this.onTouchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchCancel,keydown:this.onKeyDown,keyup:this.onKeyUp,scroll:this.onScroll};const{viewEvents:e,windowEvents:i}=this;for(let i in e)e[i]=e[i].bind(this),t.addEventListener(i,e[i]);for(let t in i)i[t]=i[t].bind(this),window.addEventListener(t,i[t])}__removeListenEvents(){super.__removeListenEvents();const{viewEvents:t,windowEvents:e}=this;for(let e in t)this.view.removeEventListener(e,t[e]),this.viewEvents={};for(let t in e)window.removeEventListener(t,e[t]),this.windowEvents={}}getTouches(t){const e=[];for(let i=0,s=t.length;i<s;i++)e.push(t[i]);return e}preventDefaultPointer(t){const{pointer:e}=this.config;e.preventDefault&&t.preventDefault()}preventDefaultWheel(t){const{wheel:e}=this.config;e.preventDefault&&t.preventDefault()}preventWindowPointer(t){return!this.downData&&t.target!==this.view}onKeyDown(t){this.keyDown(Qc.convert(t))}onKeyUp(t){this.keyUp(Qc.convert(t))}onContextMenu(t){this.config.pointer.preventDefaultMenu&&t.preventDefault(),this.menu($c.convert(t,this.getLocal(t)))}onScroll(){this.canvas.updateClientBounds()}onPointerDown(t){this.preventDefaultPointer(t),this.notPointer||(this.usePointer||(this.usePointer=!0),this.pointerDown($c.convert(t,this.getLocal(t))))}onPointerMove(t,e){if(this.notPointer||this.preventWindowPointer(t))return;this.usePointer||(this.usePointer=!0);const i=$c.convert(t,this.getLocal(t,!0));e?this.pointerHover(i):this.pointerMove(i)}onPointerLeave(t){this.onPointerMove(t,!0)}onPointerUp(t){this.downData&&this.preventDefaultPointer(t),this.notPointer||this.preventWindowPointer(t)||this.pointerUp($c.convert(t,this.getLocal(t)))}onPointerCancel(){this.useMultiTouch||this.pointerCancel()}onMouseDown(t){this.preventDefaultPointer(t),this.notMouse||this.pointerDown($c.convertMouse(t,this.getLocal(t)))}onMouseMove(t){this.notMouse||this.preventWindowPointer(t)||this.pointerMove($c.convertMouse(t,this.getLocal(t,!0)))}onMouseUp(t){this.downData&&this.preventDefaultPointer(t),this.notMouse||this.preventWindowPointer(t)||this.pointerUp($c.convertMouse(t,this.getLocal(t)))}onMouseCancel(){this.notMouse||this.pointerCancel()}onTouchStart(t){const e=$c.getTouch(t),i=this.getLocal(e,!0),{preventDefault:s}=this.config.touch;(!0===s||"auto"===s&&Jc(this.findPath(i)))&&t.preventDefault(),this.multiTouchStart(t),this.notTouch||(this.touchTimer&&(window.clearTimeout(this.touchTimer),this.touchTimer=0),this.useTouch=!0,this.pointerDown($c.convertTouch(t,i)))}onTouchMove(t){if(this.multiTouchMove(t),this.notTouch||this.preventWindowPointer(t))return;const e=$c.getTouch(t);this.pointerMove($c.convertTouch(t,this.getLocal(e)))}onTouchEnd(t){if(this.multiTouchEnd(),this.notTouch||this.preventWindowPointer(t))return;this.touchTimer&&clearTimeout(this.touchTimer),this.touchTimer=setTimeout(()=>{this.useTouch=!1},500);const e=$c.getTouch(t);this.pointerUp($c.convertTouch(t,this.getLocal(e)))}onTouchCancel(){this.notTouch||this.pointerCancel()}multiTouchStart(t){this.useMultiTouch=t.touches.length>1,this.touches=this.useMultiTouch?this.getTouches(t.touches):void 0,this.useMultiTouch&&this.pointerCancel()}multiTouchMove(t){if(this.useMultiTouch&&t.touches.length>1){const e=this.getTouches(t.touches),i=this.getKeepTouchList(this.touches,e);i.length>1&&(this.multiTouch(mc.getBase(t),i),this.touches=e)}}multiTouchEnd(){this.touches=null,this.useMultiTouch=!1,this.transformEnd()}getKeepTouchList(t,e){let i;const s=[];return t.forEach(t=>{i=e.find(e=>e.identifier===t.identifier),i&&s.push({from:this.getLocal(t),to:this.getLocal(i)})}),s}getLocalTouchs(t){return t.map(t=>this.getLocal(t))}onWheel(t){this.preventDefaultWheel(t),this.wheel(Object.assign(Object.assign(Object.assign({},mc.getBase(t)),this.getLocal(t)),{deltaX:t.deltaX,deltaY:t.deltaY}))}onGesturestart(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.lastGestureScale=1,this.lastGestureRotation=0)}onGesturechange(t){if(this.useMultiTouch)return;this.preventDefaultWheel(t);const e=mc.getBase(t);Object.assign(e,this.getLocal(t));const i=t.scale/this.lastGestureScale,s=(t.rotation-this.lastGestureRotation)/Math.PI*180*(D.within(this.config.wheel.rotateSpeed,0,1)/4+.1);this.zoom(Object.assign(Object.assign({},e),{scale:i*i})),this.rotate(Object.assign(Object.assign({},e),{rotation:s})),this.lastGestureScale=t.scale,this.lastGestureRotation=t.rotation}onGestureend(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.transformEnd())}setCursor(t){super.setCursor(t);const e=[];this.eachCursor(t,e),c(e[e.length-1])&&e.push("default"),this.canvas.view.style.cursor=e.map(t=>c(t)?`url(${t.url}) ${t.x||0} ${t.y||0}`:t).join(",")}eachCursor(t,e,i=0){if(i++,d(t))t.forEach(t=>this.eachCursor(t,e,i));else{const s=n(t)&&Mc.get(t);s&&i<2?this.eachCursor(s,e,i):e.push(t)}}destroy(){this.view&&(super.destroy(),this.view=null,this.touches=null)}}function tu(t,e,i){t.__.__font?nl.fillText(t,e,i):t.__.windingRule?e.fill(t.__.windingRule):e.fill()}function eu(t,e,i,s,r){const n=i.__;c(t)?nl.drawStrokesStyle(t,e,!1,i,s,r):(s.setStroke(t,n.__strokeWidth*e,n),s.stroke()),n.__useArrow&&nl.strokeArrow(t,i,s,r)}function iu(t,e,i,s,r){const n=i.__;c(t)?nl.drawStrokesStyle(t,e,!0,i,s,r):(s.setStroke(t,n.__strokeWidth*e,n),nl.drawTextStroke(i,s,r))}function su(t,e,i,s,r){const n=s.getSameCanvas(!0,!0);n.font=i.__.__font,iu(t,2,i,n,r),n.blendMode="outside"===e?"destination-out":"destination-in",nl.fillText(i,n,r),n.blendMode="normal",lo.copyCanvasByWorld(i,s,n),n.recycle(i.__nowWorld)}const{getSpread:ru,copyAndSpread:nu,toOuterOf:ou,getOuterOf:au,getByMove:hu,move:lu,getIntersectData:du}=Xt,cu={};let uu;const{stintSet:_u}=p,{hasTransparent:pu}=il;function gu(t,e,i){if(!c(e)||!1===e.visible||0===e.opacity)return;let r;const{boxBounds:o}=i.__layout;switch(e.type){case"image":if(!e.url)return;r=ol.image(i,t,e,o,!uu||!uu[e.url]);break;case"linear":r=al.linearGradient(e,o);break;case"radial":r=al.radialGradient(e,o);break;case"angular":r=al.conicGradient(e,o);break;case"solid":const{type:n,color:a,opacity:h}=e;r={type:n,style:il.string(a,h)};break;default:s(e.r)||(r={type:"solid",style:il.string(e)})}if(r&&(r.originPaint=e,n(r.style)&&pu(r.style)&&(r.isTransparent=!0),e.style)){if(0===e.style.strokeWidth)return;r.strokeStyle=e.style}return r}const fu={compute:function(t,e){const i=e.__,s=[];let r,n,o,a=i.__input[t];d(a)||(a=[a]),uu=ol.recycleImage(t,i);for(let i,r=0,n=a.length;r<n;r++)(i=gu(t,a[r],e))&&(s.push(i),i.strokeStyle&&(o||(o=1),i.strokeStyle.strokeWidth&&(o=Math.max(o,i.strokeStyle.strokeWidth))));i["_"+t]=s.length?s:void 0,s.length?(s.every(t=>t.isTransparent)&&(s.some(t=>t.image)&&(r=!0),n=!0),"fill"===t?(_u(i,"__isAlphaPixelFill",r),_u(i,"__isTransparentFill",n)):(_u(i,"__isAlphaPixelStroke",r),_u(i,"__isTransparentStroke",n),_u(i,"__hasMultiStrokeStyle",o))):i.__removePaint(t,!1)},fill:function(t,e,i,s){i.fillStyle=t,tu(e,i,s)},fills:function(t,e,i,s){let r,n,o;for(let a=0,h=t.length;a<h;a++){if(r=t[a],n=r.originPaint,r.image){if(o?o++:o=1,ol.checkImage(r,!e.__.__font,e,i,s))continue;if(!r.style){1===o&&r.image.isPlacehold&&e.drawImagePlaceholder(r,i,s);continue}}if(i.fillStyle=r.style,r.transform||n.scaleFixed){if(i.save(),r.transform&&i.transform(r.transform),n.scaleFixed){const{scaleX:t,scaleY:s}=e.getRenderScaleData(!0);(!0===n.scaleFixed||"zoom-in"===n.scaleFixed&&t>1&&s>1)&&i.scale(1/t,1/s)}n.blendMode&&(i.blendMode=n.blendMode),tu(e,i,s),i.restore()}else n.blendMode?(i.saveBlendMode(n.blendMode),tu(e,i,s),i.restoreBlendMode()):tu(e,i,s)}},fillPathOrText:tu,fillText:function(t,e,i){const s=t.__,{rows:r,decorationY:n}=s.__textDrawData;let o;s.__isPlacehold&&s.placeholderColor&&(e.fillStyle=s.placeholderColor);for(let t=0,i=r.length;t<i;t++)o=r[t],o.text?e.fillText(o.text,o.x,o.y):o.data&&o.data.forEach(t=>{e.fillText(t.char,t.x,o.y)});if(n){const{decorationColor:t,decorationHeight:i}=s.__textDrawData;t&&(e.fillStyle=t),r.forEach(t=>n.forEach(s=>e.fillRect(t.x,t.y+s,t.width,i)))}},stroke:function(t,e,i,s){const r=e.__;if(r.__strokeWidth)if(r.__font)nl.strokeText(t,e,i,s);else switch(r.strokeAlign){case"center":eu(t,1,e,i,s);break;case"inside":!function(t,e,i,s){i.save(),i.clipUI(e),eu(t,2,e,i,s),i.restore()}(t,e,i,s);break;case"outside":!function(t,e,i,s){const r=e.__;if(r.__fillAfterStroke)eu(t,2,e,i,s);else{const{renderBounds:n}=e.__layout,o=i.getSameCanvas(!0,!0);e.__drawRenderPath(o),eu(t,2,e,o,s),o.clipUI(r),o.clearWorld(n),lo.copyCanvasByWorld(e,i,o),o.recycle(e.__nowWorld)}}(t,e,i,s)}},strokes:function(t,e,i,s){nl.stroke(t,e,i,s)},strokeText:function(t,e,i,s){switch(e.__.strokeAlign){case"center":iu(t,1,e,i,s);break;case"inside":su(t,"inside",e,i,s);break;case"outside":e.__.__fillAfterStroke?iu(t,2,e,i,s):su(t,"outside",e,i,s)}},drawTextStroke:function(t,e,i){let s,r=t.__.__textDrawData;const{rows:n,decorationY:o}=r;for(let t=0,i=n.length;t<i;t++)s=n[t],s.text?e.strokeText(s.text,s.x,s.y):s.data&&s.data.forEach(t=>{e.strokeText(t.char,t.x,s.y)});if(o){const{decorationHeight:t}=r;n.forEach(i=>o.forEach(s=>e.strokeRect(i.x,i.y+s,i.width,t)))}},drawStrokesStyle:function(t,e,i,s,r,n){let o;const a=s.__,{__hasMultiStrokeStyle:h}=a;h||r.setStroke(void 0,a.__strokeWidth*e,a);for(let l=0,d=t.length;l<d;l++)if(o=t[l],(!o.image||!ol.checkImage(o,!1,s,r,n))&&o.style){if(h){const{strokeStyle:t}=o;t?r.setStroke(o.style,a.__getRealStrokeWidth(t)*e,a,t):r.setStroke(o.style,a.__strokeWidth*e,a)}else r.strokeStyle=o.style;o.originPaint.blendMode?(r.saveBlendMode(o.originPaint.blendMode),i?nl.drawTextStroke(s,r,n):r.stroke(),r.restoreBlendMode()):i?nl.drawTextStroke(s,r,n):r.stroke()}},shape:function(t,e,i){const s=e.getSameCanvas(),r=e.bounds,n=t.__nowWorld,o=t.__layout,a=t.__nowWorldShapeBounds||(t.__nowWorldShapeBounds={});let h,l,d,c,u,_;ou(o.strokeSpread?(nu(cu,o.boxBounds,o.strokeSpread),cu):o.boxBounds,n,a);let{scaleX:p,scaleY:g}=t.getRenderScaleData(!0);if(r.includes(a))_=s,h=u=a,l=n;else{let s;if(Zt.fullImageShadow)s=a;else{const t=o.renderShapeSpread?ru(r,B.swapAndScale(o.renderShapeSpread,p,g)):r;s=du(t,a)}c=r.getFitMatrix(s);let{a:f,d:y}=c;c.a<1&&(_=e.getSameCanvas(),t.__renderShape(_,i),p*=f,g*=y),u=au(a,c),h=hu(u,-c.e,-c.f),l=au(n,c),lu(l,-c.e,-c.f);const m=i.matrix;m?(d=new gt(c),d.multiply(m),f*=m.scaleX,y*=m.scaleY):d=c,d.withScale(f,y),i=Object.assign(Object.assign({},i),{matrix:d})}return t.__renderShape(s,i),{canvas:s,matrix:d,fitMatrix:c,bounds:h,renderBounds:l,worldCanvas:_,shapeBounds:u,scaleX:p,scaleY:g}}};let yu,mu=new Vt;const{isSame:vu}=Xt;function wu(t,e,i,s,r,n){if("fill"===e&&!t.__.__naturalWidth){const e=t.__;if(e.__naturalWidth=s.width/e.pixelRatio,e.__naturalHeight=s.height/e.pixelRatio,e.__autoSide)return t.forceUpdate("width"),t.__proxyData&&(t.setProxyAttr("width",e.width),t.setProxyAttr("height",e.height)),!1}return r.data||ol.createData(r,s,i,n),!0}function xu(t,e){Bu(t,Ho.LOAD,e)}function bu(t,e){Bu(t,Ho.LOADED,e)}function ku(t,e,i){e.error=i,t.forceUpdate("surface"),Bu(t,Ho.ERROR,e)}function Bu(t,e,i){t.hasEvent(e)&&t.emitEvent(new Ho(e,i))}function Su(t,e){const{leafer:i}=t;i&&i.viewReady&&(i.renderer.ignore=e)}const{get:Pu,translate:Ru}=q,Cu=new Vt,Tu={},Eu={};function Lu(t,e,i,s){const r=n(t)||s?(s?i-s*e:i%e)/((s||Math.floor(i/e))-1):t;return"auto"===t&&r<0?0:r}let Ou={},Au={a:1,b:0,c:0,d:1,e:0,f:0};const{get:Du,set:Mu,rotateOfOuter:Iu,translate:Wu,scaleOfOuter:Fu,multiplyParent:zu,scale:Nu,rotate:Yu,skew:Xu}=q;function Uu(t,e,i,s,r,n,o,a){o&&Yu(t,o),a&&Xu(t,a.x,a.y),r&&Nu(t,r,n),Wu(t,e.x+i,e.y+s)}const{get:Hu,scale:ju,copy:Vu}=q,{getFloorScale:Gu}=D,{abs:Ku}=Math;const qu={image:function(t,e,i,s,r){let n,o;const a=sn.get(i);return yu&&i===yu.paint&&vu(s,yu.boxBounds)?n=yu.leafPaint:(n={type:i.type,image:a},a.hasAlphaPixel&&(n.isTransparent=!0),yu=a.use>1?{leafPaint:n,paint:i,boxBounds:mu.set(s)}:null),(r||a.loading)&&(o={image:a,attrName:e,attrValue:i}),a.ready?(wu(t,e,i,a,n,s),r&&(xu(t,o),bu(t,o))):a.error?r&&ku(t,o,a.error):(r&&(Su(t,!0),xu(t,o)),n.loadId=a.load(()=>{Su(t,!1),t.destroyed||(wu(t,e,i,a,n,s)&&(a.hasAlphaPixel&&(t.__layout.hitCanvasChanged=!0),t.forceUpdate("surface")),bu(t,o)),n.loadId=void 0},e=>{Su(t,!1),ku(t,o,e),n.loadId=void 0},i.lod&&a.getThumbSize(i.lod)),t.placeholderColor&&(t.placeholderDelay?setTimeout(()=>{a.ready||(a.isPlacehold=!0,t.forceUpdate("surface"))},t.placeholderDelay):a.isPlacehold=!0)),n},checkImage:function(t,e,i,s,r){const{scaleX:n,scaleY:o}=ol.getImageRenderScaleData(t,i,s,r),{image:a,data:h,originPaint:l}=t,{exporting:d,snapshot:c}=r;return!(!h||t.patternId===n+"-"+o&&!d||c)&&(e&&(h.repeat?e=!1:l.changeful||"miniapp"===Zt.name&&Qo.isResizing(i)||d||(e=Zt.image.isLarge(a,n,o)||a.width*n>8096||a.height*o>8096)),e?(i.__.__isFastShadow&&(s.fillStyle=t.style||"#000",s.fill()),ol.drawImage(t,n,o,i,s,r),!0):(!t.style||l.sync||d?ol.createPattern(t,i,s,r):ol.createPatternTask(t,i,s,r),!1))},drawImage:function(t,e,i,s,r,n){const{data:o,image:a}=t,{blendMode:h}=t.originPaint,{opacity:l,transform:d}=o,c=a.getFull(o.filters),u=s.__;let _,{width:p,height:g}=a;(_=d&&!d.onlyScale||u.path||u.cornerRadius)||l||h?(r.save(),_&&r.clipUI(s),h&&(r.blendMode=h),l&&(r.opacity*=l),d&&r.transform(d),r.drawImage(c,0,0,p,g),r.restore()):(o.scaleX&&(p*=o.scaleX,g*=o.scaleY),r.drawImage(c,0,0,p,g))},getImageRenderScaleData:function(t,e,i,s){const r=e.getRenderScaleData(!0,t.originPaint.scaleFixed),{data:n}=t;if(i){const{pixelRatio:t}=i;r.scaleX*=t,r.scaleY*=t}return n&&n.scaleX&&(r.scaleX*=Math.abs(n.scaleX),r.scaleY*=Math.abs(n.scaleY)),r},recycleImage:function(t,e){const i=e["_"+t];if(d(i)){let s,r,n,o,a;for(let h=0,l=i.length;h<l;h++)s=i[h],r=s.image,a=r&&r.url,a&&(n||(n={}),n[a]=!0,sn.recyclePaint(s),r.loading&&(o||(o=e.__input&&e.__input[t]||[],d(o)||(o=[o])),r.unload(i[h].loadId,!o.some(t=>t.url===a))));return n}return null},createPatternTask:function(t,e,i,s){t.patternTask||(t.patternTask=sn.patternTasker.add(()=>ve(this,void 0,void 0,function*(){ol.createPattern(t,e,i,s),e.forceUpdate("surface")}),0,()=>(t.patternTask=null,i.bounds.hit(e.__nowWorld))))},createPattern:function(t,e,i,s){let{scaleX:r,scaleY:n}=ol.getImageRenderScaleData(t,e,i,s),o=r+"-"+n;if(t.patternId!==o&&!e.destroyed&&(!Zt.image.isLarge(t.image,r,n)||t.data.repeat)){const{image:i,data:s}=t,{transform:a,gap:h}=s,l=ol.getPatternFixScale(t,r,n);let d,c,u,{width:_,height:p}=i;l&&(r*=l,n*=l),_*=r,p*=n,h&&(c=h.x*r/Ku(s.scaleX||1),u=h.y*n/Ku(s.scaleY||1)),(a||1!==r||1!==n)&&(r*=Gu(_+(c||0)),n*=Gu(p+(u||0)),d=Hu(),a&&Vu(d,a),ju(d,1/r,1/n));const g=i.getCanvas(_,p,s.opacity,s.filters,c,u,e.leafer&&e.leafer.config.smooth,s.interlace),f=i.getPattern(g,s.repeat||Zt.origin.noRepeat||"no-repeat",d,t);t.style=f,t.patternId=o}},getPatternFixScale:function(t,e,i){const{image:s}=t;let r,n=Zt.image.maxPatternSize,o=s.width*s.height;return s.isSVG?e>1&&(r=Math.ceil(e)/e):n>o&&(n=o),(o*=e*i)>n&&(r=Math.sqrt(n/o)),r},createData:function(t,e,i,s){t.data=ol.getPatternData(i,s,e)},getPatternData:function(t,e,i){t.padding&&(e=Cu.set(e).shrink(t.padding)),"strench"===t.mode&&(t.mode="stretch");const{width:s,height:r}=i,{opacity:o,mode:h,align:l,offset:d,scale:u,size:_,rotation:p,skew:g,clipSize:f,repeat:y,gap:m,filters:v,interlace:w}=t,x=e.width===s&&e.height===r,b={mode:h},k="center"!==l&&(p||0)%180==90;let B,S;switch(Xt.set(Eu,0,0,k?r:s,k?s:r),h&&"cover"!==h&&"fit"!==h?((u||_)&&(D.getScaleData(u,_,i,Tu),B=Tu.scaleX,S=Tu.scaleY),(l||m||y)&&(B&&Xt.scale(Eu,B,S,!0),l&&St.toPoint(l,Eu,e,Eu,!0,!0))):x&&!p||(B=S=Xt.getFitScale(e,Eu,"fit"!==h),Xt.put(e,i,l,B,!1,Eu),Xt.scale(Eu,B,S,!0)),d&&at.move(Eu,d),h){case"stretch":x?B&&(B=S=void 0):(B=e.width/s,S=e.height/r,ol.stretchMode(b,e,B,S));break;case"normal":case"clip":if(Eu.x||Eu.y||B||f||p||g){let t,i;f&&(t=e.width/f.width,i=e.height/f.height),ol.clipMode(b,e,Eu.x,Eu.y,B,S,p,g,t,i),t&&(B=B?B*t:t,S=S?S*i:i)}break;case"repeat":(!x||B||p||g)&&ol.repeatMode(b,e,s,r,Eu.x,Eu.y,B,S,p,g,l,t.freeTransform),y||(b.repeat="repeat");const i=c(y);(m||i)&&(b.gap=function(t,e,i,s,r){let n,o;c(t)?(n=t.x,o=t.y):n=o=t;return{x:Lu(n,i,r.width,e&&e.x),y:Lu(o,s,r.height,e&&e.y)}}(m,i&&y,Eu.width,Eu.height,e));break;default:B&&ol.fillOrFitMode(b,e,Eu.x,Eu.y,B,S,p)}return b.transform||(e.x||e.y)&&Ru(b.transform=Pu(),e.x,e.y),B&&(b.scaleX=B,b.scaleY=S),o&&o<1&&(b.opacity=o),v&&(b.filters=v),y&&(b.repeat=n(y)?"x"===y?"repeat-x":"repeat-y":"repeat"),w&&(b.interlace=a(w)||"percent"===w.type?{type:"x",offset:w}:w),b},stretchMode:function(t,e,i,s){const r=Du(),{x:n,y:o}=e;n||o?Wu(r,n,o):r.onlyScale=!0,Nu(r,i,s),t.transform=r},fillOrFitMode:function(t,e,i,s,r,n,o){const a=Du();Wu(a,e.x+i,e.y+s),Nu(a,r,n),o&&Iu(a,{x:e.x+e.width/2,y:e.y+e.height/2},o),t.transform=a},clipMode:function(t,e,i,s,r,n,o,a,h,l){const d=Du();Uu(d,e,i,s,r,n,o,a),h&&(o||a?(Mu(Au),Fu(Au,e,h,l),zu(d,Au)):Fu(d,e,h,l)),t.transform=d},repeatMode:function(t,e,i,s,r,n,o,a,h,l,d,c){const u=Du();if(c)Uu(u,e,r,n,o,a,h,l);else{if(h)if("center"===d)Iu(u,{x:i/2,y:s/2},h);else switch(Yu(u,h),h){case 90:Wu(u,s,0);break;case 180:Wu(u,i,s);break;case 270:Wu(u,0,i)}Ou.x=e.x+r,Ou.y=e.y+n,Wu(u,Ou.x,Ou.y),o&&Fu(u,Ou,o,a)}t.transform=u}},{toPoint:$u}=bt,{hasTransparent:Qu}=il,Ju={},Zu={};function t_(t,e,i,s){if(i){let r,o,a,h;for(let t=0,l=i.length;t<l;t++)r=i[t],n(r)?(a=t/(l-1),o=il.string(r,s)):(a=r.offset,o=il.string(r.color,s)),e.addColorStop(a,o),!h&&Qu(o)&&(h=!0);h&&(t.isTransparent=!0)}}const{getAngle:e_,getDistance:i_}=at,{get:s_,rotateOfOuter:r_,scaleOfOuter:n_}=q,{toPoint:o_}=bt,a_={},h_={};function l_(t,e,i,s,r){let n;const{width:o,height:a}=t;if(o!==a||s){const t=e_(e,i);n=s_(),r?(n_(n,e,o/a*(s||1),1),r_(n,e,t+90)):(n_(n,e,1,o/a*(s||1)),r_(n,e,t))}return n}const{getDistance:d_}=at,{toPoint:c_}=bt,u_={},__={};const p_={linearGradient:function(t,e){let{from:i,to:s,type:r,opacity:n}=t;$u(i||"top",e,Ju),$u(s||"bottom",e,Zu);const o=Zt.canvas.createLinearGradient(Ju.x,Ju.y,Zu.x,Zu.y),a={type:r,style:o};return t_(a,o,t.stops,n),a},radialGradient:function(t,e){let{from:i,to:s,type:r,opacity:n,stretch:o}=t;o_(i||"center",e,a_),o_(s||"bottom",e,h_);const a=Zt.canvas.createRadialGradient(a_.x,a_.y,0,a_.x,a_.y,i_(a_,h_)),h={type:r,style:a};t_(h,a,t.stops,n);const l=l_(e,a_,h_,o,!0);return l&&(h.transform=l),h},conicGradient:function(t,e){let{from:i,to:s,type:r,opacity:n,stretch:o}=t;c_(i||"center",e,u_),c_(s||"bottom",e,__);const a=Zt.conicGradientSupport?Zt.canvas.createConicGradient(0,u_.x,u_.y):Zt.canvas.createRadialGradient(u_.x,u_.y,0,u_.x,u_.y,d_(u_,__)),h={type:r,style:a};t_(h,a,t.stops,n);const l=l_(e,u_,__,o||1,Zt.conicGradientRotate90);return l&&(h.transform=l),h},getTransform:l_},{copy:g_,move:f_,toOffsetOutBounds:y_}=Xt,{max:m_,abs:v_}=Math,w_={},x_=new gt,b_={};function k_(t,e){let i,s,r,n,o=0,a=0,h=0,l=0;return e.forEach(t=>{i=t.x||0,s=t.y||0,n=1.5*(t.blur||0),r=v_(t.spread||0),o=m_(o,r+n-s),a=m_(a,r+n+i),h=m_(h,r+n+s),l=m_(l,r+n-i)}),o===a&&a===h&&h===l?o:[o,a,h,l]}function B_(t,e,i){const{shapeBounds:s}=i;let r,n;Zt.fullImageShadow?(g_(w_,t.bounds),f_(w_,e.x-s.x,e.y-s.y),r=t.bounds,n=w_):(r=s,n=e),t.copyWorld(i.canvas,r,n)}const{toOffsetOutBounds:S_}=Xt,P_={};const R_=k_;const C_={shadow:function(t,e,i){let s,r;const{__nowWorld:n}=t,{shadow:o}=t.__,{worldCanvas:a,bounds:h,renderBounds:l,shapeBounds:d,scaleX:c,scaleY:u}=i,_=e.getSameCanvas(),p=o.length-1;y_(h,b_,l),o.forEach((o,g)=>{let f=1;if(o.scaleFixed){const t=Math.abs(n.scaleX);t>1&&(f=1/t)}_.setWorldShadow(b_.offsetX+(o.x||0)*c*f,b_.offsetY+(o.y||0)*u*f,(o.blur||0)*c*f,il.string(o.color)),r=hl.getShadowTransform(t,_,i,o,b_,f),r&&_.setTransform(r),B_(_,b_,i),r&&_.resetTransform(),s=l,o.box&&(_.restore(),_.save(),a&&(_.copyWorld(_,l,n,"copy"),s=n),a?_.copyWorld(a,n,n,"destination-out"):_.copyWorld(i.canvas,d,h,"destination-out")),lo.copyCanvasByWorld(t,e,_,s,o.blendMode),p&&g<p&&_.clearWorld(s)}),_.recycle(s)},innerShadow:function(t,e,i){let s,r;const{__nowWorld:n}=t,{innerShadow:o}=t.__,{worldCanvas:a,bounds:h,renderBounds:l,shapeBounds:d,scaleX:c,scaleY:u}=i,_=e.getSameCanvas(),p=o.length-1;S_(h,P_,l),o.forEach((o,g)=>{let f=1;if(o.scaleFixed){const t=Math.abs(n.scaleX);t>1&&(f=1/t)}_.save(),_.setWorldShadow(P_.offsetX+(o.x||0)*c*f,P_.offsetY+(o.y||0)*u*f,(o.blur||0)*c*f),r=hl.getShadowTransform(t,_,i,o,P_,f,!0),r&&_.setTransform(r),B_(_,P_,i),_.restore(),a?(_.copyWorld(_,l,n,"copy"),_.copyWorld(a,n,n,"source-out"),s=n):(_.copyWorld(i.canvas,d,h,"source-out"),s=l),_.fillWorld(s,il.string(o.color),"source-in"),lo.copyCanvasByWorld(t,e,_,s,o.blendMode),p&&g<p&&_.clearWorld(s)}),_.recycle(s)},blur:function(t,e,i){const{blur:s}=t.__;i.setWorldBlur(s*t.__nowWorld.a),i.copyWorldToInner(e,t.__nowWorld,t.__layout.renderBounds),i.filter="none"},backgroundBlur:function(t,e,i){},getShadowRenderSpread:k_,getShadowTransform:function(t,e,i,s,r,n,o){if(s.spread){const i=2*s.spread*n*(o?-1:1),{width:a,height:h}=t.__layout.strokeBounds;return x_.set().scaleOfOuter({x:(r.x+r.width/2)*e.pixelRatio,y:(r.y+r.height/2)*e.pixelRatio},1+i/a,1+i/h),x_}},isTransformShadow(t){},getInnerShadowSpread:R_},{excludeRenderBounds:T_}=mo;let E_;function L_(t,e,i,s,r,n,o,a){switch(e){case"grayscale":E_||(E_=!0,r.useGrayscaleAlpha(t.__nowWorld));case"alpha":!function(t,e,i,s,r,n){const o=t.__nowWorld;i.resetTransform(),i.opacity=1,i.useMask(s,o),n&&s.recycle(o);A_(t,e,i,1,r,n)}(t,i,s,r,o,a);break;case"opacity-path":A_(t,i,s,n,o,a);break;case"path":a&&i.restore()}}function O_(t){return t.getSameCanvas(!1,!0)}function A_(t,e,i,s,r,n){const o=t.__nowWorld;e.resetTransform(),e.opacity=s,e.copyWorld(i,o,void 0,r),n?i.recycle(o):i.clearWorld(o)}jl.prototype.__renderMask=function(t,e){let i,s,r,n,o,a;const{children:h}=this;for(let l=0,d=h.length;l<d;l++){if(i=h[l],a=i.__.mask,a){o&&(L_(this,o,t,r,s,n,void 0,!0),s=r=null),"clipping"!==a&&"clipping-path"!==a||T_(i,e)||i.__render(t,e),n=i.__.opacity,E_=!1,"path"===a||"clipping-path"===a?(n<1?(o="opacity-path",r||(r=O_(t))):(o="path",t.save()),i.__clip(r||t,e)):(o="grayscale"===a?"grayscale":"alpha",s||(s=O_(t)),r||(r=O_(t)),i.__render(s,e));continue}const d=1===n&&i.__.__blendMode;d&&L_(this,o,t,r,s,n,void 0,!1),T_(i,e)||i.__render(r||t,e),d&&L_(this,o,t,r,s,n,d,!1)}L_(this,o,t,r,s,n,void 0,!0)};const D_=">)]}%!?,.:;'\"",M_=D_+"_#~&*+\\=|",I_=new RegExp([[19968,40959],[13312,19903],[131072,173791],[173824,177983],[177984,178207],[178208,183983],[183984,191471],[196608,201551],[201552,205743],[11904,12031],[12032,12255],[12272,12287],[12288,12351],[12736,12783],[12800,13055],[13056,13311],[63744,64255],[65072,65103],[127488,127743],[194560,195103]].map(([t,e])=>`[\\u${t.toString(16)}-\\u${e.toString(16)}]`).join("|"));function W_(t){const e={};return t.split("").forEach(t=>e[t]=!0),e}const F_=W_("ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz"),z_=W_("{[(<'\""),N_=W_(D_),Y_=W_(M_),X_=W_("- ");var U_;!function(t){t[t.Letter=0]="Letter",t[t.Single=1]="Single",t[t.Before=2]="Before",t[t.After=3]="After",t[t.Symbol=4]="Symbol",t[t.Break=5]="Break"}(U_||(U_={}));const{Letter:H_,Single:j_,Before:V_,After:G_,Symbol:K_,Break:q_}=U_;function $_(t){return F_[t]?H_:X_[t]?q_:z_[t]?V_:N_[t]?G_:Y_[t]?K_:I_.test(t)?j_:H_}const Q_={trimRight(t){const{words:e}=t;let i,s=0,r=e.length;for(let n=r-1;n>-1&&(i=e[n].data[0]," "===i.char);n--)s++,t.width-=i.width;s&&e.splice(r-s,s)}};function J_(t,e,i){switch(e){case"title":return i?t.toUpperCase():t;case"upper":return t.toUpperCase();case"lower":return t.toLowerCase();default:return t}}const{trimRight:Z_}=Q_,{Letter:tp,Single:ep,Before:ip,After:sp,Symbol:rp,Break:np}=U_;let op,ap,hp,lp,dp,cp,up,_p,pp,gp,fp,yp,mp,vp,wp,xp,bp,kp=[];function Bp(t,e){pp&&!_p&&(_p=pp),op.data.push({char:t,width:e}),hp+=e}function Sp(){lp+=hp,op.width=hp,ap.words.push(op),op={data:[]},hp=0}function Pp(){vp&&(wp.paraNumber++,ap.paraStart=!0,vp=!1),pp&&(ap.startCharSize=_p,ap.endCharSize=pp,_p=0),ap.width=lp,xp.width?Z_(ap):bp&&Rp(),kp.push(ap),ap={words:[]},lp=0}function Rp(){lp>(wp.maxWidth||0)&&(wp.maxWidth=lp)}const{top:Cp,right:Tp,bottom:Ep,left:Lp}=vt;function Op(t,e,i){const{bounds:s,rows:r}=t;s[e]+=i;for(let t=0;t<r.length;t++)r[t][e]+=i}const Ap={getDrawData:function(t,e){n(t)||(t=String(t));let i=0,s=0,r=e.__getInput("width")||0,o=e.__getInput("height")||0;const{__padding:a}=e;a&&(r?(i=a[Lp],r-=a[Tp]+a[Lp],!r&&(r=.01)):e.autoSizeAlign||(i=a[Lp]),o?(s=a[Cp],o-=a[Cp]+a[Ep],!o&&(o=.01)):e.autoSizeAlign||(s=a[Cp]));const h={bounds:{x:i,y:s,width:r,height:o},rows:[],paraNumber:0,font:Zt.canvas.font=e.__font};return function(t,e,i){wp=t,kp=t.rows,xp=t.bounds,bp=!xp.width&&!i.autoSizeAlign;const{__letterSpacing:s,paraIndent:r,textCase:n}=i,{canvas:o}=Zt,{width:a}=xp;if(i.__isCharMode){const t="none"!==i.textWrap,h="break"===i.textWrap;vp=!0,fp=null,_p=up=pp=hp=lp=0,op={data:[]},ap={words:[]},s&&(e=[...e]);for(let i=0,l=e.length;i<l;i++)cp=e[i],"\n"===cp?(hp&&Sp(),ap.paraEnd=!0,Pp(),vp=!0):(gp=$_(cp),gp===tp&&"none"!==n&&(cp=J_(cp,n,!hp)),up=o.measureText(cp).width,s&&(s<0&&(pp=up),up+=s),yp=gp===ep&&(fp===ep||fp===tp)||fp===ep&&gp!==sp,mp=!(gp!==ip&&gp!==ep||fp!==rp&&fp!==sp),dp=vp&&r?a-r:a,t&&a&&lp+hp+up>dp&&(h?(hp&&Sp(),lp&&Pp()):(mp||(mp=gp===tp&&fp==sp),yp||mp||gp===np||gp===ip||gp===ep||hp+up>dp?(hp&&Sp(),lp&&Pp()):lp&&Pp()))," "===cp&&!0!==vp&&lp+hp===0||(gp===np?(" "===cp&&hp&&Sp(),Bp(cp,up),Sp()):yp||mp?(hp&&Sp(),Bp(cp,up)):Bp(cp,up)),fp=gp);hp&&Sp(),lp&&Pp(),kp.length>0&&(kp[kp.length-1].paraEnd=!0)}else e.split("\n").forEach(t=>{wp.paraNumber++,lp=o.measureText(t).width,kp.push({x:r||0,text:t,width:lp,paraStart:!0}),bp&&Rp()})}(h,t,e),a&&function(t,e,i,s,r){if(!s&&i.autoSizeAlign)switch(i.textAlign){case"left":Op(e,"x",t[Lp]);break;case"right":Op(e,"x",-t[Tp])}if(!r&&i.autoSizeAlign)switch(i.verticalAlign){case"top":Op(e,"y",t[Cp]);break;case"bottom":Op(e,"y",-t[Ep])}}(a,h,e,r,o),function(t,e){const{rows:i,bounds:s}=t,r=i.length,{__lineHeight:n,__baseLine:o,__letterSpacing:a,__clipText:h,textAlign:l,verticalAlign:d,paraSpacing:c,autoSizeAlign:u}=e;let{x:_,y:p,width:g,height:f}=s,y=n*r+(c?c*(t.paraNumber-1):0),m=o;if(h&&y>f)y=Math.max(f,n),r>1&&(t.overflow=r);else if(f||u)switch(d){case"middle":p+=(f-y)/2;break;case"bottom":p+=f-y}m+=p;let v,w,x,b=g||u?g:t.maxWidth;for(let o=0,d=r;o<d;o++){if(v=i[o],v.x=_,v.width<g||v.width>g&&!h)switch(l){case"center":v.x+=(b-v.width)/2;break;case"right":v.x+=b-v.width}v.paraStart&&c&&o>0&&(m+=c),v.y=m,m+=n,t.overflow>o&&m>y&&(v.isOverflow=!0,t.overflow=o+1),w=v.x,x=v.width,a<0&&(v.width<0?(x=-v.width+e.fontSize+a,w-=x,x+=e.fontSize):x-=a),w<s.x&&(s.x=w),x>s.width&&(s.width=x),h&&g&&g<x&&(v.isOverflow=!0,t.overflow||(t.overflow=i.length))}s.y=p,s.height=y}(h,e),e.__isCharMode&&function(t,e,i){const{rows:s}=t,{textAlign:r,paraIndent:n,__letterSpacing:o}=e,a=i&&r.includes("both"),h=a||i&&r.includes("justify"),l=h&&r.includes("letter");let d,c,u,_,p,g,f,y,m,v;s.forEach(t=>{t.words&&(p=n&&t.paraStart?n:0,y=t.words.length,h&&(v=!t.paraEnd||a,c=i-t.width-p,l?_=c/(t.words.reduce((t,e)=>t+e.data.length,0)-1):u=y>1?c/(y-1):0),g=o||t.isOverflow||l?0:u?1:2,t.isOverflow&&!o&&(t.textMode=!0),2===g?(t.x+=p,function(t){t.text="",t.words.forEach(e=>{e.data.forEach(e=>{t.text+=e.char})})}(t)):(t.x+=p,d=t.x,t.data=[],t.words.forEach((e,i)=>{1===g?(f={char:"",x:d},d=function(t,e,i){return t.forEach(t=>{i.char+=t.char,e+=t.width}),e}(e.data,d,f),(t.isOverflow||" "!==f.char)&&t.data.push(f)):d=function(t,e,i,s,r){return t.forEach(t=>{(s||" "!==t.char)&&(t.x=e,i.push(t)),e+=t.width,r&&(e+=r)}),e}(e.data,d,t.data,t.isOverflow,v&&_),v&&(m=i===y-1,u?m||(d+=u,t.width+=u):_&&(t.width+=_*(e.data.length-(m?1:0))))})),t.words=null)})}(h,e,r),h.overflow&&function(t,e,i,s){if(!s)return;const{rows:r,overflow:n}=t;let{textOverflow:o}=e;if(r.splice(n),o&&"show"!==o){let t,a;"hide"===o?o="":"ellipsis"===o&&(o="...");const h=o?Zt.canvas.measureText(o).width:0,l=i+s-h;("none"===e.textWrap?r:[r[n-1]]).forEach(e=>{if(e.isOverflow&&e.data){let i=e.data.length-1;for(let s=i;s>-1&&(t=e.data[s],a=t.x+t.width,!(s===i&&a<l));s--){if(a<l&&" "!==t.char||!s){e.data.splice(s+1),e.width-=t.width;break}e.width-=t.width}e.width+=h,e.data.push({char:o,x:a}),e.textMode&&function(t){t.text="",t.data.forEach(e=>{t.text+=e.char}),t.data=null}(e)}})}}(h,e,i,r),"none"!==e.textDecoration&&function(t,e){let i,s=0;const{fontSize:r,textDecoration:n}=e;switch(t.decorationHeight=r/11,c(n)?(i=n.type,n.color&&(t.decorationColor=il.string(n.color)),n.offset&&(s=Math.min(.3*r,Math.max(n.offset,.15*-r)))):i=n,i){case"under":t.decorationY=[.15*r+s];break;case"delete":t.decorationY=[.35*-r];break;case"under-delete":t.decorationY=[.15*r+s,.35*-r]}}(h,e),h}};const Dp={string:function(t,e){if(!t)return"#000";const i=a(e)&&e<1;if(n(t)){if(!i||!il.object)return t;t=il.object(t)}let r=s(t.a)?1:t.a;i&&(r*=e);const o=t.r+","+t.g+","+t.b;return 1===r?"rgb("+o+")":"rgba("+o+","+r+")"}};Object.assign(el,Ap),Object.assign(il,Dp),Object.assign(nl,fu),Object.assign(ol,qu),Object.assign(al,p_),Object.assign(hl,C_),Object.assign(de,{interaction:(t,e,i,s)=>new Zc(t,e,i,s),hitCanvas:(t,e)=>new Rh(t,e),hitCanvasManager:()=>new Ic}),Eh();export{St as AlignHelper,e as Answer,Yd as App,bt as AroundHelper,Kt as AutoBounds,li as BezierHelper,Vt as Bounds,jo as BoundsEvent,Xt as BoundsHelper,ed as Box,bl as BoxData,bh as Branch,bo as BranchHelper,Na as BranchRender,Od as Canvas,Ml as CanvasData,ye as CanvasManager,No as ChildEvent,il as ColorConvert,de as Creator,Mc as Cursor,p as DataHelper,ie as Debug,vt as Direction4,wt as Direction9,sc as DragBoundsHelper,hc as DragEvent,Bc as Dragger,dc as DropEvent,hl as Effect,od as Ellipse,Rl as EllipseData,mi as EllipseHelper,zo as Event,ge as EventCreator,ha as Eventer,dl as Export,Kr as FileHelper,ll as Filter,B as FourNumberHelper,id as Frame,Bl as FrameData,jl as Group,xl as GroupData,Ic as HitCanvasManager,Ed as Image,Dl as ImageData,Ho as ImageEvent,sn as ImageManager,y as IncrementId,Zc as Interaction,Dc as InteractionBase,mc as InteractionHelper,yc as KeyEvent,Ud as Keyboard,Zo as LayoutEvent,Uh as Layouter,uh as Leaf,Ia as LeafBounds,mo as LeafBoundsHelper,f as LeafData,xa as LeafDataProxy,va as LeafEventer,lo as LeafHelper,Fo as LeafLayout,Bh as LeafLevelList,kh as LeafList,Ca as LeafMatrix,Wa as LeafRender,Kl as Leafer,Rh as LeaferCanvas,Ae as LeaferCanvasBase,kl as LeaferData,ea as LeaferEvent,an as LeaferImage,Td as Line,Sl as LineData,D as MathHelper,gt as Matrix,q as MatrixHelper,cc as MoveEvent,lc as MyDragEvent,Ld as MyImage,oc as MyPointerEvent,_c as MyTouchEvent,Fe as NeedConvertToCanvasCommandMap,I as OneRadian,W as PI2,F as PI_2,nl as Paint,al as PaintGradient,ol as PaintImage,zd as Path,rl as PathArrow,Ir as PathBounds,Ps as PathCommandDataHelper,Ie as PathCommandMap,vi as PathCommandNodeHelper,ss as PathConvert,Ur as PathCorner,Us as PathCreator,El as PathData,rr as PathDrawer,De as PathHelper,t as PathNodeHandleType,Xe as PathNumberCommandLengthMap,Ye as PathNumberCommandMap,Nd as Pen,Ll as PenData,qh as Picker,Zt as Platform,le as Plugin,_t as Point,at as PointHelper,Hd as PointerButton,nc as PointerEvent,pd as Polygon,Cl as PolygonData,Xo as PropertyEvent,ql as Rect,Pl as RectData,Ue as RectHelper,Xl as RectRender,ta as RenderEvent,jh as Renderer,Qo as ResizeEvent,tn as Resource,pc as RotateEvent,oe as Run,$h as Selector,xd as Star,Tl as StarData,cl as State,$t as StringNumberMap,gc as SwipeEvent,Qr as TaskItem,Jr as TaskProcessor,Fd as Text,el as TextConvert,Al as TextData,uc as TouchEvent,ul as Transition,yt as TwoPointBoundsHelper,Hl as UI,Fl as UIBounds,ue as UICreator,vl as UIData,jd as UIEvent,Nl as UIRender,sl as UnitConvert,qt as UnitConvertHelper,Co as WaitHelper,Jo as WatchEvent,Oh as Watcher,fc as ZoomEvent,Cn as affectRenderBoundsType,Sn as affectStrokeBoundsType,un as attr,yn as autoLayoutType,wn as boundsType,Gr as canvasPatch,Oe as canvasSizeAttrs,tl as createAttr,dn as createDescriptor,zn as cursorType,Nn as dataProcessor,pn as dataType,cn as decorateLeafAttr,Xn as defineDataProcessor,hn as defineKey,_n as defineLeafAttr,En as dimType,bn as doBoundsType,Pn as doStrokeType,Qh as effectType,i as emptyData,Wn as eraserType,Uo as extraPropertyEventMap,N as getBoundsData,ln as getDescriptor,Y as getMatrixData,z as getPointData,Fn as hitType,d as isArray,u as isData,_ as isEmptyData,o as isFinite,r as isNull,a as isNumber,c as isObject,n as isString,s as isUndefined,Yn as layoutProcessor,oa as leaferTransformAttrMap,In as maskType,xn as naturalBoundsType,Ln as opacityType,Hr as path,kn as pathInputType,Bn as pathType,jr as pen,gn as positionType,$n as registerUI,Qn as registerUIEvent,Jh as resizeType,Vn as rewrite,Gn as rewriteAble,vn as rotationType,mn as scaleType,fn as scrollType,Mn as sortType,Rn as strokeType,Tn as surfaceType,Gt as tempBounds,ft as tempMatrix,pt as tempPoint,l as tryToNumber,Eh as useCanvas,qn as useModule,Sh as version,On as visibleType,Zh as zoomLayerType};
//# sourceMappingURL=web.module.min.js.map
