{"version":3,"file":"web.min.cjs","sources":["../../../../src/leafer/packages/interface/src/path/IPathCommand.ts","../../../../src/leafer/packages/canvas/canvas-web/src/LeaferCanvas.ts","../../../../src/leafer/packages/canvas/canvas-web/src/index.ts","../../../../src/ui/packages/platform/web/src/core.ts","../../../../src/leafer/packages/partner/watcher/src/Watcher.ts","../../../../src/leafer/packages/partner/layouter/src/LayouterHelper.ts","../../../../src/leafer/packages/partner/layouter/src/LayoutBlockData.ts","../../../../src/leafer/packages/partner/layouter/src/Layouter.ts","../../../../src/leafer/packages/partner/renderer/src/Renderer.ts","../../../../src/leafer/packages/partner/selector/src/Picker.ts","../../../../src/leafer/packages/partner/selector/src/Selector.ts","../../../../src/leafer/packages/partner/partner/src/index.ts","../../../../src/ui/packages/interaction/interaction-web/src/PointerEventHelper.ts","../../../../src/ui/packages/interaction/interaction-web/src/KeyEventHelper.ts","../../../../src/ui/packages/interaction/interaction-web/src/Interaction.ts","../../../../src/ui/packages/partner/paint/src/Fill.ts","../../../../src/ui/packages/partner/paint/src/Stroke.ts","../../../../src/ui/packages/partner/paint/src/StrokeText.ts","../../../../src/ui/packages/partner/paint/src/Shape.ts","../../../../src/ui/packages/partner/paint/src/Compute.ts","../../../../src/ui/packages/partner/paint/src/index.ts","../../../../src/ui/packages/partner/paint/src/FillText.ts","../../../../src/ui/packages/partner/image/src/image.ts","../../../../src/ui/packages/partner/image/src/data.ts","../../../../src/ui/packages/partner/image/src/mode.ts","../../../node_modules/.pnpm/@rollup+plugin-typescript@11.1.6_rollup@4.44.2_tslib@2.8.1_typescript@5.8.3/node_modules/tslib/tslib.es6.js","../../../../src/ui/packages/partner/image/src/pattern.ts","../../../../src/ui/packages/partner/image/src/index.ts","../../../../src/ui/packages/partner/image/src/check.ts","../../../../src/ui/packages/partner/image/src/recycle.ts","../../../../src/ui/packages/partner/gradient/src/linear.ts","../../../../src/ui/packages/partner/gradient/src/radial.ts","../../../../src/ui/packages/partner/gradient/src/conic.ts","../../../../src/ui/packages/partner/gradient/src/index.ts","../../../../src/ui/packages/partner/effect/src/Shadow.ts","../../../../src/ui/packages/partner/effect/src/InnerShadow.ts","../../../../src/ui/packages/partner/effect/src/index.ts","../../../../src/ui/packages/partner/effect/src/Blur.ts","../../../../src/ui/packages/partner/effect/src/BackgroundBlur.ts","../../../../src/ui/packages/partner/mask/src/index.ts","../../../../src/ui/packages/partner/text/src/CharType.ts","../../../../src/ui/packages/partner/text/src/TextRowHelper.ts","../../../../src/ui/packages/partner/text/src/TextCase.ts","../../../../src/ui/packages/partner/text/src/TextRows.ts","../../../../src/ui/packages/partner/text/src/TextConvert.ts","../../../../src/ui/packages/partner/text/src/index.ts","../../../../src/ui/packages/partner/text/src/TextLayout.ts","../../../../src/ui/packages/partner/text/src/CharLayout.ts","../../../../src/ui/packages/partner/text/src/TextClip.ts","../../../../src/ui/packages/partner/text/src/TextDecoration.ts","../../../../src/ui/packages/partner/color/src/index.ts","../../../../src/ui/packages/partner/color/src/color.ts","../../../../src/ui/packages/partner/partner/src/index.ts","../../../../src/ui/packages/platform/web/src/index.ts"],"sourcesContent":["import { IPointData } from '../math/IMath'\n\ntype Command = number\ntype x = number\ntype y = number\ntype x1 = number\ntype y1 = number\ntype x2 = number\ntype y2 = number\ntype radiusX = number\ntype radiusY = number\ntype xAxisRotation = number\ntype largeArcFlag = number\ntype sweepFlag = number\n\n\nexport type MCommandData = [Command, x, y]\nexport type HCommandData = [Command, x]\nexport type VCommandData = [Command, y]\nexport type LCommandData = MCommandData\n\nexport type CCommandData = [Command, x1, y1, x2, y2, x, y]\nexport type SCommandData = [Command, x2, y2, x, y]\n\nexport type QCommandData = [Command, x1, y1, x, y]\nexport type TCommandData = [Command, x, y]\n\nexport type ZCommandData = [Command]\n\nexport type ACommandData = [Command, radiusX, radiusY, xAxisRotation, largeArcFlag, sweepFlag, x, y]\n\n\n// 非svg标准的canvas绘图命令\ntype width = number\ntype height = number\ntype rotation = number\ntype startAngle = number\ntype endAngle = number\ntype anticlockwise = boolean\ntype cornerRadius = number | number[]\ntype radius = number\n\nexport type RectCommandData = [Command, x, y, width, height]\nexport type RoundRectCommandData = [Command, x, y, width, height, cornerRadius]\nexport type EllipseCommandData = [Command, x, y, radiusX, radiusY, rotation, startAngle, endAngle, anticlockwise]\nexport type ArcCommandData = [Command, x, y, radius, startAngle, endAngle, anticlockwise]\nexport type ArcToCommandData = [Command, x1, y1, x2, y2, radius]\n\n\nexport type CanvasPathCommand = 1 | 2 | 5 | 7 | 11 // M | L | C | Q | Z   canvas可以绘制的命令\n\nexport type IPathCommandData = number[] // ...(MCommandData | LCommandData | CCommandData | QCommandData | ZCommandData)\n\n\n// 路径命令对象\nexport interface MoveToCommandObject {\n    name: 'M'\n    x: number\n    y: number\n}\nexport interface LineToCommandObject {\n    name: 'L'\n    x: number\n    y: number\n}\n\nexport interface BezierCurveToCommandObject {\n    name: 'C'\n    x1: number\n    y1: number\n    x2: number\n    y2: number\n    x: number\n    y: number\n}\n\nexport interface QuadraticCurveToCommandObject {\n    name: 'Q'\n    x1: number\n    y1: number\n    x: number\n    y: number\n}\n\nexport interface ClosePathCommandObject {\n    name: 'Z'\n}\n\nexport type IPathCommandObject = MoveToCommandObject | LineToCommandObject | BezierCurveToCommandObject | QuadraticCurveToCommandObject | ClosePathCommandObject // M | L | C | Q | Z   canvas可以绘制的命令\n\n\n// 可视化路径节点\n\nexport interface IPathCommandNodeBase {\n    name: 'M^' | 'L^' | 'C^' | 'Z^'\n    x: number\n    y: number\n    a?: IPointData // 第一个手柄，连接上一个节点\n    b?: IPointData // 第二个手柄，连接下一个节点\n    ab?: PathNodeHandleType // 手柄类型\n}\n\nexport interface MoveToCommandNode extends IPathCommandNodeBase {\n    name: 'M^'\n}\nexport interface LineToCommandNode extends IPathCommandNodeBase {\n    name: 'L^'\n}\n\nexport interface BezierCurveToCommandNode extends IPathCommandNodeBase {\n    name: 'C^'\n}\n\nexport interface ClosePathCommandNode {\n    name: 'Z^'\n    x?: number\n    y?: number\n    a?: IPointData\n    b?: IPointData\n    ab?: PathNodeHandleType\n}\n\nexport type IPathCommandNode = MoveToCommandNode | LineToCommandNode | BezierCurveToCommandNode | ClosePathCommandNode // M | L | C | Z   路径节点命令(适合可视化编辑)\n\nexport enum PathNodeHandleType { // 手柄类型\n    none = 1, // 无手柄\n    free = 2, // 每个手柄自由控制\n    mirrorAngle = 3, // 仅镜像角度\n    mirror = 4,  // 镜像角度和长度\n}\n\nexport type PathNodeHandleName = 'a' | 'b' // 手柄名称\n\nexport interface IPathNodeBase {\n    pathNode: IPathCommandNode\n}","import { IAutoBounds, ISizeData, IScreenSizeData, IResizeEventListener, IFunction } from '@leafer/interface'\nimport { LeaferCanvasBase, canvasSizeAttrs, ResizeEvent, DataHelper, Platform, Debug, isString, isUndefined } from '@leafer/core'\n\n\nconst debug = Debug.get('LeaferCanvas')\n\nexport class LeaferCanvas extends LeaferCanvasBase {\n\n    declare public view: HTMLCanvasElement\n    declare public parentView: HTMLElement\n\n    public set zIndex(zIndex: number) {\n        const { style } = this.view\n        style.zIndex = zIndex as unknown as string\n        this.setAbsolute(this.view)\n    }\n\n    public set childIndex(index: number) {\n        const { view, parentView } = this\n        if (view && parentView) {\n            const beforeNode = parentView.children[index]\n            if (beforeNode) {\n                this.setAbsolute(beforeNode as HTMLCanvasElement)\n                parentView.insertBefore(view, beforeNode)\n            } else {\n                parentView.appendChild(beforeNode)\n            }\n        }\n    }\n\n    protected resizeObserver: ResizeObserver\n    protected autoBounds: IAutoBounds\n    protected resizeListener: IResizeEventListener\n    protected windowListener: IFunction\n\n    public init(): void {\n        const { config } = this\n        const view = config.view || config.canvas\n\n        view ? this.__createViewFrom(view) : this.__createView()\n        const { style } = this.view\n        style.display || (style.display = 'block')\n        this.parentView = this.view.parentElement\n\n        if (this.parentView) {\n            const pStyle = this.parentView.style\n            pStyle.webkitUserSelect = pStyle.userSelect = 'none' // fix safari: use webkitUserSelect\n            this.view.classList.add('leafer-canvas-view')\n        }\n\n        if (Platform.syncDomFont && !this.parentView) { // fix: firefox default font\n            style.display = 'none'\n            if (document.body) document.body.appendChild(this.view)\n        }\n\n        this.__createContext()\n\n        if (!this.autoLayout) this.resize(config as IScreenSizeData)\n    }\n\n    public set backgroundColor(color: string) { this.view.style.backgroundColor = color }\n    public get backgroundColor(): string { return this.view.style.backgroundColor }\n\n    public set hittable(hittable: boolean) { this.view.style.pointerEvents = hittable ? 'auto' : 'none' }\n    public get hittable() { return this.view.style.pointerEvents !== 'none' }\n\n    protected __createView(): void {\n        this.view = document.createElement('canvas')\n    }\n\n    protected __createViewFrom(inputView: string | object): void {\n        let find: unknown = isString(inputView) ? document.getElementById(inputView) : inputView as HTMLElement\n        if (find) {\n            if (find instanceof HTMLCanvasElement) {\n\n                this.view = find\n\n            } else {\n\n                let parent = find as HTMLDivElement\n                if (find === window || find === document) {\n                    const div = document.createElement('div')\n                    const { style } = div\n                    style.position = 'absolute'\n                    style.top = style.bottom = style.left = style.right = '0px'\n                    document.body.appendChild(div)\n                    parent = div\n                }\n\n                this.__createView()\n                const view = this.view\n\n                if (parent.hasChildNodes()) {\n                    this.setAbsolute(view)\n                    parent.style.position || (parent.style.position = 'relative')\n                }\n\n                parent.appendChild(view)\n            }\n        } else {\n            debug.error(`no id: ${inputView}`)\n            this.__createView()\n        }\n    }\n\n    protected setAbsolute(view: HTMLCanvasElement): void {\n        const { style } = view\n        style.position = 'absolute'\n        style.top = style.left = '0px'\n    }\n\n    public updateViewSize(): void {\n        const { width, height, pixelRatio } = this\n        const { style } = this.view\n\n        style.width = width + 'px'\n        style.height = height + 'px'\n\n        if (!this.unreal) {\n            this.view.width = Math.ceil(width * pixelRatio)\n            this.view.height = Math.ceil(height * pixelRatio)\n        }\n    }\n\n\n    public updateClientBounds(): void {\n        if (this.view.parentElement) this.clientBounds = this.view.getBoundingClientRect()\n    }\n\n    public startAutoLayout(autoBounds: IAutoBounds, listener: IResizeEventListener): void {\n        this.resizeListener = listener\n\n        if (autoBounds) {  // check auto layout\n\n            this.autoBounds = autoBounds\n\n            if (this.resizeObserver) return\n\n            try {\n\n                this.resizeObserver = new ResizeObserver((entries) => {\n                    this.updateClientBounds()\n                    for (const entry of entries) this.checkAutoBounds(entry.contentRect)\n                })\n\n                const parent = this.parentView\n                if (parent) {\n                    this.resizeObserver.observe(parent)\n                    this.checkAutoBounds(parent.getBoundingClientRect())\n                } else {\n                    this.checkAutoBounds(this.view)\n                    debug.warn('no parent')\n                }\n\n            } catch {\n\n                this.imitateResizeObserver()\n\n            }\n\n            this.stopListenPixelRatio()\n\n        } else {\n\n            this.listenPixelRatio()\n            if (this.unreal) this.updateViewSize() // must update\n\n        }\n\n    }\n\n    protected imitateResizeObserver(): void {\n        if (this.autoLayout) {\n            if (this.parentView) this.checkAutoBounds(this.parentView.getBoundingClientRect())\n            Platform.requestRender(this.imitateResizeObserver.bind(this))\n        }\n    }\n\n    // check devicePixelRatio change\n\n    protected listenPixelRatio() {\n        if (!this.windowListener) window.addEventListener('resize', this.windowListener = () => {\n            const pixelRatio = Platform.devicePixelRatio\n            if (!this.config.pixelRatio && this.pixelRatio !== pixelRatio) {\n                const { width, height } = this\n                this.emitResize({ width, height, pixelRatio })\n            }\n        })\n    }\n\n    protected stopListenPixelRatio() {\n        if (this.windowListener) {\n            window.removeEventListener('resize', this.windowListener)\n            this.windowListener = null\n        }\n    }\n\n    protected checkAutoBounds(parentSize: ISizeData): void {\n        const view = this.view\n        const { x, y, width, height } = this.autoBounds.getBoundsFrom(parentSize)\n        const size = { width, height, pixelRatio: this.config.pixelRatio ? this.pixelRatio : Platform.devicePixelRatio } as IScreenSizeData\n        if (!this.isSameSize(size)) {\n            const { style } = view\n            style.marginLeft = x + 'px'\n            style.marginTop = y + 'px'\n            this.emitResize(size)\n        }\n    }\n\n    public stopAutoLayout(): void {\n        this.autoLayout = false\n        if (this.resizeObserver) this.resizeObserver.disconnect()\n        this.resizeListener = this.resizeObserver = null\n    }\n\n    protected emitResize(size: IScreenSizeData): void {\n        const oldSize = {} as IScreenSizeData\n        DataHelper.copyAttrs(oldSize, this, canvasSizeAttrs)\n        this.resize(size)\n        if (this.resizeListener && !isUndefined(this.width)) this.resizeListener(new ResizeEvent(size, oldSize))\n    }\n\n\n    public unrealCanvas(): void { // App needs to use\n        if (!this.unreal && this.parentView) { // canvas 替换成 div, 方便放入子canvas\n            let view = this.view\n            if (view) view.remove()\n\n            view = this.view = document.createElement('div') as any\n            this.parentView.appendChild(this.view)\n            view.classList.add('leafer-app-view')\n\n            this.unreal = true\n        }\n    }\n\n    public destroy(): void {\n        const { view } = this\n        if (view) {\n            this.stopAutoLayout()\n            this.stopListenPixelRatio()\n            if (view.parentElement) view.remove()\n            super.destroy()\n        }\n    }\n\n}","import { canvasPatch } from '@leafer/core'\n\nexport { LeaferCanvas } from './LeaferCanvas'\n\ncanvasPatch(CanvasRenderingContext2D.prototype)\ncanvasPatch(Path2D.prototype)","export * from '@leafer/core'\n\nexport * from '@leafer/canvas-web'\nexport * from '@leafer/image-web'\n\nimport { ICreator, IFunction, IExportImageType, IExportFileType, IObject, ICanvasType } from '@leafer/interface'\nimport { Platform, Creator, FileHelper, defineKey } from '@leafer/core'\n\nimport { LeaferCanvas } from '@leafer/canvas-web'\nimport { LeaferImage } from '@leafer/image-web'\n\n\nconst { mineType, fileType } = FileHelper\n\nObject.assign(Creator, {\n    canvas: (options?, manager?) => new LeaferCanvas(options, manager),\n    image: (options) => new LeaferImage(options)\n} as ICreator)\n\n\nexport function useCanvas(_canvasType: ICanvasType, _power?: IObject): void {\n    Platform.origin = {\n        createCanvas(width: number, height: number): HTMLCanvasElement {\n            const canvas = document.createElement('canvas')\n            canvas.width = width\n            canvas.height = height\n            return canvas\n        },\n        canvasToDataURL: (canvas: HTMLCanvasElement, type?: IExportImageType, quality?: number) => {\n            const imageType = mineType(type), url = canvas.toDataURL(imageType, quality)\n            return imageType === 'image/bmp' ? url.replace('image/png;', 'image/bmp;') : url\n        },\n        canvasToBolb: (canvas: HTMLCanvasElement, type?: IExportFileType, quality?: number) => new Promise((resolve) => canvas.toBlob(resolve, mineType(type), quality)),\n        canvasSaveAs: (canvas: HTMLCanvasElement, filename: string, quality?: any) => {\n            const url = canvas.toDataURL(mineType(fileType(filename)), quality)\n            return Platform.origin.download(url, filename)\n        },\n        download(url: string, filename: string): Promise<void> {\n            return new Promise((resolve) => {\n                let el = document.createElement('a')\n                el.href = url\n                el.download = filename\n                document.body.appendChild(el)\n                el.click()\n                document.body.removeChild(el)\n                resolve()\n            })\n        },\n        loadImage(src: any): Promise<HTMLImageElement> {\n            return new Promise((resolve, reject) => {\n                const img = new Platform.origin.Image()\n                const { crossOrigin } = Platform.image\n                if (crossOrigin) {\n                    img.setAttribute('crossOrigin', crossOrigin)\n                    img.crossOrigin = crossOrigin\n                }\n                img.onload = () => { resolve(img) }\n                img.onerror = (e: any) => { reject(e) }\n                img.src = Platform.image.getRealURL(src)\n            })\n        },\n        Image,\n        PointerEvent,\n        DragEvent\n    }\n\n    Platform.event = {\n        stopDefault(origin: Event): void { origin.preventDefault() },\n        stopNow(origin: Event): void { origin.stopImmediatePropagation() },\n        stop(origin: Event): void { origin.stopPropagation() }\n    }\n\n    Platform.canvas = Creator.canvas()\n    Platform.conicGradientSupport = !!Platform.canvas.context.createConicGradient\n}\n\nPlatform.name = 'web'\nPlatform.isMobile = 'ontouchstart' in window\nPlatform.requestRender = function (render: IFunction): void { window.requestAnimationFrame(render) }\ndefineKey(Platform, 'devicePixelRatio', { get() { return devicePixelRatio } })\n\n\n// same as worker\n\nconst { userAgent } = navigator\n\nif (userAgent.indexOf(\"Firefox\") > -1) {\n    Platform.conicGradientRotate90 = true\n    Platform.intWheelDeltaY = true\n    Platform.syncDomFont = true\n} else if (/iPhone|iPad|iPod/.test(navigator.userAgent) || (/Macintosh/.test(navigator.userAgent) && /Version\\/[\\d.]+.*Safari/.test(navigator.userAgent))) {\n    Platform.fullImageShadow = true // 苹果内核渲染阴影\n}\n\nif (userAgent.indexOf('Windows') > -1) {\n    Platform.os = 'Windows'\n    Platform.intWheelDeltaY = true\n} else if (userAgent.indexOf('Mac') > -1) {\n    Platform.os = 'Mac'\n} else if (userAgent.indexOf('Linux') > -1) {\n    Platform.os = 'Linux'\n}","import { ILeaf, IWatcher, IEventListenerId, ILeafList, IWatcherConfig } from '@leafer/interface'\nimport { PropertyEvent, ChildEvent, RenderEvent, WatchEvent, LeafList, DataHelper } from '@leafer/core'\n\n\nexport class Watcher implements IWatcher {\n\n    public target: ILeaf\n\n    public totalTimes: number = 0\n\n    public disabled: boolean\n    public running: boolean\n    public changed: boolean\n\n    public hasVisible: boolean\n    public hasAdd: boolean\n    public hasRemove: boolean\n    public get childrenChanged() { return this.hasAdd || this.hasRemove || this.hasVisible }\n\n    public config: IWatcherConfig = {}\n\n    public get updatedList(): ILeafList {\n        if (this.hasRemove && this.config.usePartLayout) {\n            const updatedList = new LeafList()\n            this.__updatedList.list.forEach(item => { if (item.leafer) updatedList.add(item) })\n            return updatedList\n        } else {\n            return this.__updatedList\n        }\n    }\n\n    protected __eventIds: IEventListenerId[]\n    protected __updatedList: ILeafList = new LeafList()\n\n    constructor(target: ILeaf, userConfig?: IWatcherConfig) {\n        this.target = target\n        if (userConfig) this.config = DataHelper.default(userConfig, this.config)\n        this.__listenEvents()\n    }\n\n    public start(): void {\n        if (this.disabled) return\n        this.running = true\n    }\n\n    public stop(): void {\n        this.running = false\n    }\n\n    public disable(): void {\n        this.stop()\n        this.__removeListenEvents()\n        this.disabled = true\n    }\n\n    public update(): void {\n        this.changed = true\n        if (this.running) this.target.emit(RenderEvent.REQUEST)\n    }\n\n    protected __onAttrChange(event: PropertyEvent): void {\n        if (this.config.usePartLayout) this.__updatedList.add(event.target as ILeaf)\n        this.update()\n    }\n\n    protected __onChildEvent(event: ChildEvent): void {\n        if (this.config.usePartLayout) {\n            if (event.type === ChildEvent.ADD) {\n                this.hasAdd = true\n                this.__pushChild(event.child)\n            } else {\n                this.hasRemove = true\n                this.__updatedList.add(event.parent)\n            }\n        }\n        this.update()\n    }\n\n    protected __pushChild(child: ILeaf): void {\n        this.__updatedList.add(child)\n        if (child.isBranch) this.__loopChildren(child)\n    }\n\n    protected __loopChildren(parent: ILeaf): void {\n        const { children } = parent\n        for (let i = 0, len = children.length; i < len; i++) this.__pushChild(children[i])\n    }\n\n    public __onRquestData(): void {\n        this.target.emitEvent(new WatchEvent(WatchEvent.DATA, { updatedList: this.updatedList }))\n        this.__updatedList = new LeafList()\n        this.totalTimes++\n        this.changed = this.hasVisible = this.hasRemove = this.hasAdd = false\n    }\n\n    protected __listenEvents(): void {\n        this.__eventIds = [\n            this.target.on_([\n                [PropertyEvent.CHANGE, this.__onAttrChange, this],\n                [[ChildEvent.ADD, ChildEvent.REMOVE], this.__onChildEvent, this],\n                [WatchEvent.REQUEST, this.__onRquestData, this]\n            ])\n        ]\n    }\n\n    protected __removeListenEvents(): void {\n        this.target.off_(this.__eventIds)\n    }\n\n    public destroy(): void {\n        if (this.target) {\n            this.stop()\n            this.__removeListenEvents()\n            this.target = this.__updatedList = null\n        }\n    }\n\n}","import { ILeafLayout, ILeafLevelList, ILeafList, ILeaf } from '@leafer/interface'\nimport { BranchHelper, LeafHelper } from '@leafer/core'\n\n\nconst { updateAllMatrix, updateBounds: updateOneBounds, updateChange: updateOneChange } = LeafHelper\nconst { pushAllChildBranch, pushAllParent } = BranchHelper\n\n\nexport function updateMatrix(updateList: ILeafList, levelList: ILeafLevelList): void {\n\n    let layout: ILeafLayout\n    updateList.list.forEach(leaf => {  // 更新矩阵, 所有子元素，和父元素都需要更新bounds\n        layout = leaf.__layout\n        if (levelList.without(leaf) && !layout.proxyZoom) { // 防止重复， 子元素可能已经被父元素更新过\n\n            if (layout.matrixChanged) {\n\n                updateAllMatrix(leaf, true)\n\n                levelList.add(leaf)\n                if (leaf.isBranch) pushAllChildBranch(leaf, levelList)\n                pushAllParent(leaf, levelList)\n\n            } else if (layout.boundsChanged) {\n\n                levelList.add(leaf)\n                if (leaf.isBranch) leaf.__tempNumber = 0  // 标识需要更新子Leaf元素的WorldBounds分支, 0表示不需要更新\n                pushAllParent(leaf, levelList)\n            }\n        }\n    })\n\n}\n\nexport function updateBounds(boundsList: ILeafLevelList): void {\n    let list: ILeaf[], branch: ILeaf, children: ILeaf[]\n    boundsList.sort(true)\n    boundsList.levels.forEach(level => {\n        list = boundsList.levelMap[level]\n        for (let i = 0, len = list.length; i < len; i++) {\n            branch = list[i]\n\n            // 标识了需要更新子元素\n            if (branch.isBranch && branch.__tempNumber) {\n                children = branch.children\n                for (let j = 0, jLen = children.length; j < jLen; j++) {\n                    if (!children[j].isBranch) {\n                        updateOneBounds(children[j])\n                    }\n                }\n            }\n            updateOneBounds(branch)\n        }\n    })\n}\n\n\nexport function updateChange(updateList: ILeafList): void {\n    updateList.list.forEach(updateOneChange)\n}","import { IBounds, ILayoutBlockData, ILeafList, ILeaf } from '@leafer/interface'\nimport { Bounds, LeafBoundsHelper, LeafList, isArray } from '@leafer/core'\n\n\nconst { worldBounds } = LeafBoundsHelper\n\nexport class LayoutBlockData implements ILayoutBlockData {\n\n    public updatedList: ILeafList\n    public updatedBounds: IBounds = new Bounds()\n\n    public beforeBounds: IBounds = new Bounds()\n    public afterBounds: IBounds = new Bounds()\n\n    constructor(list: ILeafList | ILeaf[]) {\n        if (isArray(list)) list = new LeafList(list)\n        this.updatedList = list\n    }\n\n    public setBefore(): void {\n        this.beforeBounds.setListWithFn(this.updatedList.list, worldBounds)\n    }\n\n    public setAfter(): void {\n        this.afterBounds.setListWithFn(this.updatedList.list, worldBounds)\n        this.updatedBounds.setList([this.beforeBounds, this.afterBounds])\n    }\n\n    public merge(data: ILayoutBlockData): void {\n        this.updatedList.addList(data.updatedList.list)\n        this.beforeBounds.add(data.beforeBounds)\n        this.afterBounds.add(data.afterBounds)\n        this.updatedBounds.add(data.updatedBounds)\n    }\n\n    public destroy(): void {\n        this.updatedList = null\n    }\n\n}","import { ILayouter, ILeaf, ILayoutBlockData, IEventListenerId, ILayouterConfig, ILeafList } from '@leafer/interface'\nimport { LayoutEvent, WatchEvent, LeafLevelList, LeafList, BranchHelper, LeafHelper, DataHelper, Run, Debug } from '@leafer/core'\n\nimport { updateMatrix, updateBounds, updateChange } from './LayouterHelper'\nimport { LayoutBlockData } from './LayoutBlockData'\n\n\nconst { updateAllMatrix, updateAllChange } = LeafHelper\n\nconst debug = Debug.get('Layouter')\n\nexport class Layouter implements ILayouter {\n\n    public target: ILeaf\n    public layoutedBlocks: ILayoutBlockData[]\n    public extraBlock: ILayoutBlockData // around / autoLayout\n\n    public totalTimes: number = 0\n    public times: number\n\n    public disabled: boolean\n    public running: boolean\n    public layouting: boolean\n\n    public waitAgain: boolean\n\n    public config: ILayouterConfig = { usePartLayout: true }\n\n    protected __updatedList: ILeafList\n    protected __levelList: LeafLevelList = new LeafLevelList()\n    protected __eventIds: IEventListenerId[]\n\n    constructor(target: ILeaf, userConfig?: ILayouterConfig) {\n        this.target = target\n        if (userConfig) this.config = DataHelper.default(userConfig, this.config)\n        this.__listenEvents()\n    }\n\n    public start(): void {\n        if (this.disabled) return\n        this.running = true\n    }\n\n    public stop(): void {\n        this.running = false\n    }\n\n    public disable(): void {\n        this.stop()\n        this.__removeListenEvents()\n        this.disabled = true\n    }\n\n    public layout(): void {\n        if (this.layouting || !this.running) return\n        const { target } = this\n        this.times = 0\n\n        try {\n            target.emit(LayoutEvent.START)\n            this.layoutOnce()\n            target.emitEvent(new LayoutEvent(LayoutEvent.END, this.layoutedBlocks, this.times))\n        } catch (e) {\n            debug.error(e)\n        }\n\n        this.layoutedBlocks = null\n    }\n\n    public layoutAgain(): void {\n        if (this.layouting) {\n            this.waitAgain = true\n        } else {\n            this.layoutOnce()\n        }\n    }\n\n    public layoutOnce(): void {\n        if (this.layouting) return debug.warn('layouting')\n        if (this.times > 3) return debug.warn('layout max times')\n\n        this.times++\n        this.totalTimes++\n\n        this.layouting = true\n\n        this.target.emit(WatchEvent.REQUEST)\n\n        if (this.totalTimes > 1 && this.config.usePartLayout) {\n            this.partLayout()\n        } else {\n            this.fullLayout()\n        }\n\n        this.layouting = false\n\n        if (this.waitAgain) {\n            this.waitAgain = false\n            this.layoutOnce()\n        }\n    }\n\n    public partLayout(): void {\n        if (!this.__updatedList?.length) return\n\n        const t = Run.start('PartLayout')\n        const { target, __updatedList: updateList } = this\n        const { BEFORE, LAYOUT, AFTER } = LayoutEvent\n\n        const blocks = this.getBlocks(updateList)\n        blocks.forEach(item => item.setBefore())\n        target.emitEvent(new LayoutEvent(BEFORE, blocks, this.times))\n\n        this.extraBlock = null\n        updateList.sort()\n        updateMatrix(updateList, this.__levelList)\n        updateBounds(this.__levelList)\n        updateChange(updateList)\n\n        if (this.extraBlock) blocks.push(this.extraBlock)\n        blocks.forEach(item => item.setAfter())\n\n        target.emitEvent(new LayoutEvent(LAYOUT, blocks, this.times))\n        target.emitEvent(new LayoutEvent(AFTER, blocks, this.times))\n\n        this.addBlocks(blocks)\n\n        this.__levelList.reset()\n        this.__updatedList = null\n        Run.end(t)\n    }\n\n    public fullLayout(): void {\n        const t = Run.start('FullLayout')\n\n        const { target } = this\n        const { BEFORE, LAYOUT, AFTER } = LayoutEvent\n\n        const blocks = this.getBlocks(new LeafList(target))\n        target.emitEvent(new LayoutEvent(BEFORE, blocks, this.times))\n\n        Layouter.fullLayout(target)\n\n        blocks.forEach(item => { item.setAfter() })\n        target.emitEvent(new LayoutEvent(LAYOUT, blocks, this.times))\n        target.emitEvent(new LayoutEvent(AFTER, blocks, this.times))\n\n        this.addBlocks(blocks)\n\n        Run.end(t)\n    }\n\n    static fullLayout(target: ILeaf): void {\n        updateAllMatrix(target, true)\n\n        if (target.isBranch) BranchHelper.updateBounds(target)\n        else LeafHelper.updateBounds(target)\n\n        updateAllChange(target)\n    }\n\n    public addExtra(leaf: ILeaf): void {\n        if (!this.__updatedList.has(leaf)) {\n            const { updatedList, beforeBounds } = this.extraBlock || (this.extraBlock = new LayoutBlockData([]))\n            updatedList.length ? beforeBounds.add(leaf.__world) : beforeBounds.set(leaf.__world)\n            updatedList.add(leaf)\n        }\n    }\n\n    public createBlock(data: ILeafList | ILeaf[]): ILayoutBlockData {\n        return new LayoutBlockData(data)\n    }\n\n    public getBlocks(list: ILeafList): ILayoutBlockData[] {\n        return [this.createBlock(list)]\n    }\n\n    public addBlocks(current: ILayoutBlockData[]) {\n        this.layoutedBlocks ? this.layoutedBlocks.push(...current) : this.layoutedBlocks = current\n    }\n\n    protected __onReceiveWatchData(event: WatchEvent): void {\n        this.__updatedList = event.data.updatedList\n    }\n\n    protected __listenEvents(): void {\n        this.__eventIds = [\n            this.target.on_([\n                [LayoutEvent.REQUEST, this.layout, this],\n                [LayoutEvent.AGAIN, this.layoutAgain, this],\n                [WatchEvent.DATA, this.__onReceiveWatchData, this]\n            ])\n        ]\n    }\n\n    protected __removeListenEvents(): void {\n        this.target.off_(this.__eventIds)\n    }\n\n    public destroy(): void {\n        if (this.target) {\n            this.stop()\n            this.__removeListenEvents()\n            this.target = this.config = null\n        }\n    }\n\n}\n\n\n","import { ILeaf, ILeaferBase, ILeaferCanvas, IRenderer, IRendererConfig, IEventListenerId, IBounds, IFunction, IRenderOptions, ILeafList } from '@leafer/interface'\nimport { LayoutEvent, RenderEvent, ResizeEvent, ImageManager, Bounds, DataHelper, Platform, Debug, Run } from '@leafer/core'\n\n\nconst debug = Debug.get('Renderer')\n\nexport class Renderer implements IRenderer {\n\n    public target: ILeaf\n    public canvas: ILeaferCanvas\n    public updateBlocks: IBounds[]\n\n    public FPS = 60\n    public totalTimes = 0\n    public times: number = 0\n\n    public running: boolean\n    public rendering: boolean\n\n    public waitAgain: boolean\n    public changed: boolean\n    public ignore: boolean\n\n    public config: IRendererConfig = {\n        usePartRender: true,\n        ceilPartPixel: true,\n        maxFPS: 120\n    }\n\n    static clipSpread = 10\n\n    protected renderBounds: IBounds\n    protected renderOptions: IRenderOptions\n    protected totalBounds: IBounds\n\n    protected requestTime: number\n    protected frameTime: number\n    protected frames: number[] = []\n    protected __eventIds: IEventListenerId[]\n\n    protected get needFill(): boolean { return !!(!this.canvas.allowBackgroundColor && this.config.fill) }\n\n    constructor(target: ILeaf, canvas: ILeaferCanvas, userConfig?: IRendererConfig) {\n        this.target = target\n        this.canvas = canvas\n        if (userConfig) this.config = DataHelper.default(userConfig, this.config)\n        this.__listenEvents()\n    }\n\n    public start(): void {\n        this.running = true\n        this.update(false)\n    }\n\n    public stop(): void {\n        this.running = false\n    }\n\n    public update(change = true): void {\n        if (!this.changed) this.changed = change\n        if (!this.requestTime) this.__requestRender()\n    }\n\n    public requestLayout(): void {\n        this.target.emit(LayoutEvent.REQUEST)\n    }\n\n    public checkRender(): void {\n        if (this.running) {\n            const { target } = this\n            if (target.isApp) {\n                target.emit(RenderEvent.CHILD_START, target);\n                (target.children as ILeaferBase[]).forEach(leafer => {\n                    leafer.renderer.FPS = this.FPS\n                    leafer.renderer.checkRender()\n                })\n                target.emit(RenderEvent.CHILD_END, target)\n            }\n\n            if (this.changed && this.canvas.view) this.render()\n            this.target.emit(RenderEvent.NEXT)\n        }\n    }\n\n    public render(callback?: IFunction): void {\n        if (!(this.running && this.canvas.view)) return this.update()\n\n        const { target } = this\n        this.times = 0\n        this.totalBounds = new Bounds()\n\n        debug.log(target.innerName, '--->')\n\n        try {\n            this.emitRender(RenderEvent.START)\n            this.renderOnce(callback)\n            this.emitRender(RenderEvent.END, this.totalBounds)\n\n            ImageManager.clearRecycled()\n        } catch (e) {\n            this.rendering = false\n            debug.error(e)\n        }\n\n        debug.log('-------------|')\n    }\n\n    public renderAgain(): void {\n        if (this.rendering) {\n            this.waitAgain = true\n        } else {\n            this.renderOnce()\n        }\n    }\n\n    public renderOnce(callback?: IFunction): void {\n        if (this.rendering) return debug.warn('rendering')\n        if (this.times > 3) return debug.warn('render max times')\n\n        this.times++\n        this.totalTimes++\n\n        this.rendering = true\n        this.changed = false\n        this.renderBounds = new Bounds()\n        this.renderOptions = {}\n\n        if (callback) {\n            this.emitRender(RenderEvent.BEFORE)\n            callback()\n        } else {\n            this.requestLayout()\n\n            if (this.ignore) {\n                this.ignore = this.rendering = false // 仍保留 updateBlocks 用于下次渲染\n                return\n            }\n\n            this.emitRender(RenderEvent.BEFORE)\n\n            if (this.config.usePartRender && this.totalTimes > 1) {\n                this.partRender()\n            } else {\n                this.fullRender()\n            }\n        }\n\n        this.emitRender(RenderEvent.RENDER, this.renderBounds, this.renderOptions)\n        this.emitRender(RenderEvent.AFTER, this.renderBounds, this.renderOptions)\n\n        this.updateBlocks = null\n        this.rendering = false\n\n        if (this.waitAgain) {\n            this.waitAgain = false\n            this.renderOnce()\n        }\n    }\n\n    public partRender(): void {\n        const { canvas, updateBlocks: list } = this\n        if (!list) return // debug.warn('PartRender: need update attr')\n\n        this.mergeBlocks()\n        list.forEach(block => { if (canvas.bounds.hit(block) && !block.isEmpty()) this.clipRender(block) })\n    }\n\n    public clipRender(block: IBounds): void {\n        const t = Run.start('PartRender')\n        const { canvas } = this, bounds = block.getIntersect(canvas.bounds), realBounds = new Bounds(bounds)\n\n        canvas.save()\n\n        bounds.spread(Renderer.clipSpread).ceil() // 局部渲染区域需扩大一些，避免出现残影\n\n        const { ceilPartPixel } = this.config\n        canvas.clipWorld(bounds, ceilPartPixel)\n        canvas.clearWorld(bounds, ceilPartPixel)\n\n        this.__render(bounds, realBounds)\n        canvas.restore()\n\n        Run.end(t)\n    }\n\n    public fullRender(): void {\n        const t = Run.start('FullRender')\n        const { canvas } = this\n\n        canvas.save()\n        canvas.clear()\n        this.__render(canvas.bounds)\n        canvas.restore()\n\n        Run.end(t)\n    }\n\n    protected __render(bounds: IBounds, realBounds?: IBounds): void {\n        const { canvas, target } = this, includes = bounds.includes(target.__world), options: IRenderOptions = includes ? { includes } : { bounds, includes }\n\n        if (this.needFill) canvas.fillWorld(bounds, this.config.fill)\n        if (Debug.showRepaint) Debug.drawRepaint(canvas, bounds)\n\n        if (this.config.useCellRender) options.cellList = this.getCellList()\n\n        Platform.render(target, canvas, options)\n\n        this.renderBounds = realBounds = realBounds || bounds\n        this.renderOptions = options\n        this.totalBounds.isEmpty() ? this.totalBounds = realBounds : this.totalBounds.add(realBounds)\n\n        canvas.updateRender(realBounds)\n    }\n\n    // need rewrite\n    getCellList(): ILeafList {\n        return undefined\n    }\n\n    public addBlock(block: IBounds): void {\n        if (!this.updateBlocks) this.updateBlocks = []\n        this.updateBlocks.push(block)\n    }\n\n    public mergeBlocks(): void {\n        const { updateBlocks: list } = this\n        if (list) {\n            const bounds = new Bounds()\n            bounds.setList(list)\n            list.length = 0\n            list.push(bounds)\n        }\n    }\n\n    protected __requestRender(): void {\n        const target = this.target as ILeaferBase\n        if (this.requestTime || !target) return\n        if (target.parentApp) return target.parentApp.requestRender(false) // App 模式下统一走 app 控制渲染帧\n\n        this.requestTime = this.frameTime || Date.now()\n\n        const render = () => {\n\n            const nowFPS = 1000 / ((this.frameTime = Date.now()) - this.requestTime)\n\n            const { maxFPS } = this.config\n            if (maxFPS && nowFPS > maxFPS) return Platform.requestRender(render)\n\n            const { frames } = this\n            if (frames.length > 30) frames.shift()\n            frames.push(nowFPS)\n            this.FPS = Math.round(frames.reduce((a, b) => a + b, 0) / frames.length) // 帧率采样\n            this.requestTime = 0\n\n            this.checkRender()\n\n        }\n\n        Platform.requestRender(render)\n    }\n\n    protected __onResize(e: ResizeEvent): void {\n        if (this.canvas.unreal) return\n        if (e.bigger || !e.samePixelRatio) {\n            const { width, height } = e.old\n            const bounds = new Bounds(0, 0, width, height)\n            if (!bounds.includes(this.target.__world) || this.needFill || !e.samePixelRatio) {\n                this.addBlock(this.canvas.bounds)\n                this.target.forceUpdate('surface')\n                return\n            }\n        }\n\n        // 需要象征性派发一下渲染事件\n        this.addBlock(new Bounds(0, 0, 1, 1))\n        this.update()\n    }\n\n    protected __onLayoutEnd(event: LayoutEvent): void {\n        if (event.data) event.data.map(item => {\n            let empty: boolean\n            if (item.updatedList) item.updatedList.list.some(leaf => {\n                empty = (!leaf.__world.width || !leaf.__world.height)\n                if (empty) {\n                    if (!leaf.isLeafer) debug.tip(leaf.innerName, ': empty')\n                    empty = (!leaf.isBranch || leaf.isBranchLeaf) // render object\n                }\n                return empty\n            })\n            this.addBlock(empty ? this.canvas.bounds : item.updatedBounds)\n        })\n    }\n\n    protected emitRender(type: string, bounds?: IBounds, options?: IRenderOptions): void {\n        this.target.emitEvent(new RenderEvent(type, this.times, bounds, options))\n    }\n\n    protected __listenEvents(): void {\n        this.__eventIds = [\n            this.target.on_([\n                [RenderEvent.REQUEST, this.update, this],\n                [LayoutEvent.END, this.__onLayoutEnd, this],\n                [RenderEvent.AGAIN, this.renderAgain, this],\n                [ResizeEvent.RESIZE, this.__onResize, this]\n            ])\n        ]\n    }\n\n    protected __removeListenEvents(): void {\n        this.target.off_(this.__eventIds)\n    }\n\n    public destroy(): void {\n        if (this.target) {\n            this.stop()\n            this.__removeListenEvents()\n            this.config = {}\n            this.target = this.canvas = null\n        }\n    }\n}","import { ILeaf, ILeafList, IPointData, IRadiusPointData, IPickResult, IPickOptions, ISelector, IPickBottom, IPicker, ILeaferBase, ILeafData } from '@leafer/interface'\nimport { BoundsHelper, LeafList, LeafHelper, PointHelper } from '@leafer/core'\n\n\nconst tempPoint = {} as IRadiusPointData\nconst { copyRadiusPoint } = PointHelper\nconst { hitRadiusPoint } = BoundsHelper\n\n\nexport class Picker implements IPicker {\n\n    protected target?: ILeaf\n    protected selector: ISelector\n\n    protected findList: ILeafList\n    protected exclude: ILeafList\n\n    protected point: IRadiusPointData\n\n    constructor(target: ILeaf, selector: ISelector) {\n        this.target = target\n        this.selector = selector\n    }\n\n    public getByPoint(hitPoint: IPointData, hitRadius: number, options?: IPickOptions): IPickResult {\n        if (!hitRadius) hitRadius = 0\n        if (!options) options = {}\n\n        const through = options.through || false\n        const ignoreHittable = options.ignoreHittable || false\n        const target = options.target || this.target\n        this.exclude = options.exclude || null\n\n        this.point = { x: hitPoint.x, y: hitPoint.y, radiusX: hitRadius, radiusY: hitRadius }\n        this.findList = new LeafList(options.findList)\n\n        // path\n        if (!options.findList) this.hitBranch(target.isBranchLeaf ? { children: [target] } as ILeaf : target)  // 包含through元素\n\n        const { list } = this.findList\n        const leaf = this.getBestMatchLeaf(list, options.bottomList, ignoreHittable, !!options.findList)\n        const path = ignoreHittable ? this.getPath(leaf) : this.getHitablePath(leaf)\n\n        this.clear()\n\n        return through ? { path, target: leaf, throughPath: list.length ? this.getThroughPath(list) : path } : { path, target: leaf }\n    }\n\n    public hitPoint(hitPoint: IPointData, hitRadius: number, options?: IPickOptions): boolean {\n        return !!this.getByPoint(hitPoint, hitRadius, options).target // 后期需进行优化 ！！！\n    }\n\n    public getBestMatchLeaf(list: ILeaf[], bottomList: IPickBottom[], ignoreHittable: boolean, allowNull?: boolean): ILeaf {\n        const findList = this.findList = new LeafList()\n\n        if (list.length) {\n            let find: ILeaf\n            const { x, y } = this.point\n            const point = { x, y, radiusX: 0, radiusY: 0 }\n            for (let i = 0, len = list.length; i < len; i++) {\n                find = list[i]\n                if (ignoreHittable || LeafHelper.worldHittable(find)) {\n                    this.hitChild(find, point)\n                    if (findList.length) {\n                        if (find.isBranchLeaf && list.some(item => item !== find && LeafHelper.hasParent(item, find))) {\n                            findList.reset()\n                            break // Frame / Box 同时碰撞到子元素时，忽略自身，优先选中子元素\n                        }\n                        return findList.list[0]\n                    }\n                }\n            }\n        }\n\n        if (bottomList) { // 底部虚拟元素，一般为编辑器的虚拟框\n            for (let i = 0, len = bottomList.length; i < len; i++) {\n                this.hitChild(bottomList[i].target, this.point, bottomList[i].proxy)\n                if (findList.length) return findList.list[0]\n            }\n        }\n\n        if (allowNull) return null\n        return ignoreHittable ? list[0] : list.find(item => LeafHelper.worldHittable(item))\n    }\n\n    public getPath(leaf: ILeaf): LeafList {\n        const path = new LeafList(), syncList = [], { target } = this\n\n        while (leaf) {\n            if (leaf.syncEventer) syncList.push(leaf.syncEventer)\n            path.add(leaf)\n            leaf = leaf.parent\n            if (leaf === target) break\n        }\n\n        // 存在同步触发\n        if (syncList.length) {\n            syncList.forEach(item => {\n                while (item) {\n                    if (item.__.hittable) path.add(item)\n                    item = item.parent\n                    if (item === target) break\n                }\n            })\n        }\n\n        if (target) path.add(target)\n        return path\n    }\n\n    public getHitablePath(leaf: ILeaf): LeafList {\n        const path = this.getPath(leaf && leaf.hittable ? leaf : null)\n        let item: ILeaf, hittablePath = new LeafList()\n        for (let i = path.list.length - 1; i > -1; i--) {\n            item = path.list[i]\n            if (!item.__.hittable) break\n            hittablePath.addAt(item, 0)\n            if (!item.__.hitChildren || (item.isLeafer && (item as ILeaferBase).mode === 'draw')) break\n        }\n        return hittablePath\n    }\n\n    public getThroughPath(list: ILeaf[]): LeafList {\n        const throughPath = new LeafList()\n        const pathList: ILeafList[] = []\n\n        for (let i = list.length - 1; i > -1; i--) {\n            pathList.push(this.getPath(list[i]))\n        }\n\n        let path: ILeafList, nextPath: ILeafList, leaf: ILeaf\n        for (let i = 0, len = pathList.length; i < len; i++) {\n            path = pathList[i], nextPath = pathList[i + 1]\n            for (let j = 0, jLen = path.length; j < jLen; j++) {\n                leaf = path.list[j]\n                if (nextPath && nextPath.has(leaf)) break\n                throughPath.add(leaf)\n            }\n        }\n\n        return throughPath\n    }\n\n    protected hitBranch(branch: ILeaf): void {\n        this.eachFind(branch.children, branch.__onlyHitMask)\n    }\n\n    protected eachFind(children: ILeaf[], hitMask: boolean): void {\n        let child: ILeaf, hit: boolean, data: ILeafData\n        const { point } = this, len = children.length\n        for (let i = len - 1; i > -1; i--) {\n            child = children[i], data = child.__\n            if (!data.visible || (hitMask && !data.mask)) continue\n            hit = hitRadiusPoint(child.__world, data.hitRadius ? copyRadiusPoint(tempPoint, point, data.hitRadius) : point)\n\n            if (child.isBranch) {\n                if (hit || child.__ignoreHitWorld) {\n                    if (child.isBranchLeaf && data.__clipAfterFill && !child.__hitWorld(point, true)) continue // 裁剪的Box需要先检测自身是否碰撞到\n                    if (child.topChildren) this.eachFind(child.topChildren, false) // 滚动条等覆盖物\n                    this.eachFind(child.children, child.__onlyHitMask)\n                    if (child.isBranchLeaf) this.hitChild(child, point) // Box / Frame\n                }\n            } else {\n                if (hit) this.hitChild(child, point)\n            }\n        }\n    }\n\n    protected hitChild(child: ILeaf, point: IRadiusPointData, proxy?: ILeaf): void {\n        if (this.exclude && this.exclude.has(child)) return\n        if (child.__hitWorld(point)) {\n            const { parent } = child\n            if (parent && parent.__hasMask && !child.__.mask) {\n\n                let findMasks: ILeaf[] = [], item: ILeaf\n                const { children } = parent\n\n                for (let i = 0, len = children.length; i < len; i++) {\n                    item = children[i]\n                    if (item.__.mask) findMasks.push(item)\n                    if (item === child) {\n                        if (findMasks && !findMasks.every(value => value.__hitWorld(point))) return // 遮罩上层的元素，与遮罩相交的区域才能响应事件\n                        break\n                    }\n                }\n\n            }\n            this.findList.add(proxy || child)\n        }\n    }\n\n    protected clear(): void {\n        this.point = null\n        this.findList = null\n        this.exclude = null\n    }\n\n    public destroy(): void {\n        this.clear()\n    }\n\n}","import { ILeaf, ISelector, ISelectorProxy, IPickResult, IPickOptions, IPointData, ISelectorConfig, IFinder, IFindMethod, IFindCondition, IPicker } from '@leafer/interface'\nimport { Creator, DataHelper, Plugin, Platform } from '@leafer/core'\n\nimport { Picker } from './Picker'\n\n\nexport class Selector implements ISelector {\n\n    public target?: ILeaf // target 不存在时，为临时选择器（不能缓存数据）\n    public proxy?: ISelectorProxy // editor\n\n    public config: ISelectorConfig = {}\n\n    public picker: IPicker\n    public finder?: IFinder\n\n    constructor(target: ILeaf, userConfig?: ISelectorConfig) {\n        if (userConfig) this.config = DataHelper.default(userConfig, this.config)\n        this.picker = new Picker(this.target = target, this)\n        this.finder = Creator.finder && Creator.finder()\n    }\n\n    public getByPoint(hitPoint: IPointData, hitRadius: number, options?: IPickOptions): IPickResult {\n        const { target, picker } = this\n        if (Platform.backgrounder) target && target.updateLayout()\n        return picker.getByPoint(hitPoint, hitRadius, options)\n    }\n\n    public hitPoint(hitPoint: IPointData, hitRadius: number, options?: IPickOptions): boolean {\n        return this.picker.hitPoint(hitPoint, hitRadius, options)\n    }\n\n    // @leafer-in/find will rewrite\n    public getBy(condition: number | string | IFindCondition | IFindMethod, branch?: ILeaf, one?: boolean, options?: any): ILeaf | ILeaf[] {\n        return this.finder ? this.finder.getBy(condition, branch, one, options) : Plugin.need('find')\n    }\n\n    public destroy(): void {\n        this.picker.destroy()\n        if (this.finder) this.finder.destroy()\n    }\n\n}","// leafer's partner, allow replace\nexport * from '@leafer/watcher'\nexport * from '@leafer/layouter'\nexport * from '@leafer/renderer'\nexport * from '@leafer/selector'\n\nimport { ICreator, ILeaf, ILeaferCanvas, IRenderOptions } from '@leafer/interface'\nimport { Creator, LeafList, Platform } from '@leafer/core'\n\nimport { Watcher } from '@leafer/watcher'\nimport { Layouter } from '@leafer/layouter'\nimport { Renderer } from '@leafer/renderer'\nimport { Selector } from '@leafer/selector'\n\n\nObject.assign(Creator, {\n    watcher: (target, options?) => new Watcher(target, options),\n    layouter: (target, options?) => new Layouter(target, options),\n    renderer: (target, canvas, options?) => new Renderer(target, canvas, options),\n    selector: (target?, options?) => new Selector(target, options)\n} as ICreator)\n\nPlatform.layout = Layouter.fullLayout\nPlatform.render = function (target: ILeaf, canvas: ILeaferCanvas, options: IRenderOptions): void {\n    const topOptions: IRenderOptions = { ...options, topRendering: true }\n    options.topList = new LeafList()\n    target.__render(canvas, options)\n    if (options.topList.length) options.topList.forEach(item => item.__render(canvas, topOptions))\n}","import { IPointData, IPointerEvent, PointerType } from '@leafer/interface'\nimport { InteractionHelper } from '@leafer-ui/core'\n\n\nexport const PointerEventHelper = {\n\n    convert(e: PointerEvent, local: IPointData): IPointerEvent {\n        const base = InteractionHelper.getBase(e), { x, y } = local\n        const data: IPointerEvent = {\n            ...base,\n            x,\n            y,\n            width: e.width,\n            height: e.height,\n            pointerType: e.pointerType as PointerType,\n            pressure: e.pressure,\n        }\n\n        if (data.pointerType === 'pen') {\n            data.tangentialPressure = e.tangentialPressure\n            data.tiltX = e.tiltX\n            data.tiltY = e.tiltY\n            data.twist = e.twist\n        }\n        return data\n    },\n\n    convertMouse(e: MouseEvent, local: IPointData): IPointerEvent {\n        const base = InteractionHelper.getBase(e), { x, y } = local\n        return {\n            ...base,\n            x,\n            y,\n            width: 1,\n            height: 1,\n            pointerType: 'mouse',\n            pressure: 0.5,\n        }\n    },\n\n    convertTouch(e: TouchEvent, local: IPointData): IPointerEvent {\n        const touch = PointerEventHelper.getTouch(e)\n        const base = InteractionHelper.getBase(e), { x, y } = local\n        return {\n            ...base,\n            x,\n            y,\n            width: 1,\n            height: 1,\n            pointerType: 'touch',\n            multiTouch: e.touches.length > 1,\n            pressure: touch.force,\n        }\n    },\n\n    getTouch(e: TouchEvent): Touch {\n        return e.targetTouches[0] || e.changedTouches[0]\n    }\n\n}","import { IKeyCodes, IKeyEvent } from '@leafer/interface'\nimport { InteractionHelper } from '@leafer-ui/core'\n\n\nexport const KeyEventHelper = {\n\n    convert(e: KeyboardEvent): IKeyEvent {\n        const base = InteractionHelper.getBase(e)\n        const data: IKeyEvent = {\n            ...base,\n            code: e.code as IKeyCodes,\n            key: e.key\n        }\n        return data\n    }\n\n}","import { IObject, IPointData, ITimer, IKeepTouchData, ICursorType, IClientPointData, IZoomEvent, IRotateEvent } from '@leafer/interface'\nimport { MathHelper, isArray, isObject, isString } from '@leafer/core'\nimport { InteractionBase, InteractionHelper, Cursor } from '@leafer-ui/core'\n\nimport { PointerEventHelper } from './PointerEventHelper'\nimport { KeyEventHelper } from './KeyEventHelper'\n\n\ninterface IGestureEvent extends IClientPointData, UIEvent {\n    scale: number\n    rotation: number\n    preventDefault(): void\n}\n\n\nconst { pathCanDrag } = InteractionHelper\n\nexport class Interaction extends InteractionBase {\n\n    protected view: HTMLElement\n\n    protected viewEvents: IObject\n    protected windowEvents: IObject\n\n    protected usePointer: boolean\n    protected useMultiTouch: boolean\n    protected useTouch: boolean\n\n    protected get notPointer(): boolean { const { p } = this; return p.type !== 'pointer' || p.touch || this.useMultiTouch }\n    protected get notTouch(): boolean { const { p } = this; return p.type === 'mouse' || this.usePointer }\n    protected get notMouse(): boolean { return this.usePointer || this.useTouch }\n\n    protected touchTimer: ITimer\n    protected touches?: Touch[]\n    protected lastGestureScale: number\n    protected lastGestureRotation: number\n\n    protected __listenEvents(): void {\n        super.__listenEvents()\n\n        const view = this.view = this.canvas.view as HTMLCanvasElement\n\n        // PointerEvent > TouchEvent > MouseEvent\n        this.viewEvents = {\n            'pointerdown': this.onPointerDown,\n            'mousedown': this.onMouseDown,\n            'touchstart': this.onTouchStart,\n            'pointerleave': this.onPointerLeave,\n\n            'contextmenu': this.onContextMenu,\n\n            'wheel': this.onWheel,\n            'gesturestart': this.onGesturestart,\n            'gesturechange': this.onGesturechange,\n            'gestureend': this.onGestureend\n        }\n\n        this.windowEvents = {\n            'pointermove': this.onPointerMove,\n            'pointerup': this.onPointerUp,\n            'pointercancel': this.onPointerCancel,\n\n            'mousemove': this.onMouseMove,\n            'mouseup': this.onMouseUp,\n\n            // touch / multitouch\n            'touchmove': this.onTouchMove,\n            'touchend': this.onTouchEnd,\n            'touchcancel': this.onTouchCancel,\n\n            'keydown': this.onKeyDown,\n            'keyup': this.onKeyUp,\n\n            'scroll': this.onScroll\n        }\n\n        const { viewEvents, windowEvents } = this\n\n        for (let name in viewEvents) {\n            viewEvents[name] = viewEvents[name].bind(this)\n            view.addEventListener(name, viewEvents[name])\n        }\n\n        for (let name in windowEvents) {\n            windowEvents[name] = windowEvents[name].bind(this)\n            window.addEventListener(name, windowEvents[name])\n        }\n    }\n\n    protected __removeListenEvents(): void {\n        super.__removeListenEvents()\n\n        const { viewEvents, windowEvents } = this\n\n        for (let name in viewEvents) {\n            this.view.removeEventListener(name, viewEvents[name])\n            this.viewEvents = {}\n        }\n\n        for (let name in windowEvents) {\n            window.removeEventListener(name, windowEvents[name])\n            this.windowEvents = {}\n        }\n    }\n\n    protected getTouches(touches: TouchList): Touch[] {\n        const list: Touch[] = []\n        for (let i = 0, len = touches.length; i < len; i++) {\n            list.push(touches[i])\n        }\n        return list\n    }\n\n\n    protected preventDefaultPointer(e: UIEvent): void {\n        const { pointer } = this.config\n        if (pointer.preventDefault) e.preventDefault()\n    }\n\n    protected preventDefaultWheel(e: UIEvent): void {\n        const { wheel } = this.config\n        if (wheel.preventDefault) e.preventDefault()\n    }\n\n    protected preventWindowPointer(e: UIEvent) {\n        return !this.downData && e.target !== this.view\n    }\n\n    // key\n    protected onKeyDown(e: KeyboardEvent): void {\n        this.keyDown(KeyEventHelper.convert(e))\n    }\n\n    protected onKeyUp(e: KeyboardEvent): void {\n        this.keyUp(KeyEventHelper.convert(e))\n    }\n\n    // context menu\n\n    protected onContextMenu(e: PointerEvent): void {\n        if (this.config.pointer.preventDefaultMenu) e.preventDefault()\n        this.menu(PointerEventHelper.convert(e, this.getLocal(e)))\n    }\n\n    protected onScroll(): void {\n        this.canvas.updateClientBounds()\n    }\n\n    // pointer\n    protected onPointerDown(e: PointerEvent): void {\n        this.preventDefaultPointer(e)\n\n        if (this.notPointer) return\n        this.usePointer || (this.usePointer = true)\n        this.pointerDown(PointerEventHelper.convert(e, this.getLocal(e)))\n    }\n\n    protected onPointerMove(e: PointerEvent, isLeave?: boolean): void {\n        if (this.notPointer || this.preventWindowPointer(e)) return\n        this.usePointer || (this.usePointer = true)\n        const data = PointerEventHelper.convert(e, this.getLocal(e, true))\n        isLeave ? this.pointerHover(data) : this.pointerMove(data)\n    }\n\n    protected onPointerLeave(e: PointerEvent): void {\n        this.onPointerMove(e, true)\n    }\n\n    protected onPointerUp(e: PointerEvent): void {\n        if (this.downData) this.preventDefaultPointer(e)\n        if (this.notPointer || this.preventWindowPointer(e)) return\n        this.pointerUp(PointerEventHelper.convert(e, this.getLocal(e)))\n    }\n\n    protected onPointerCancel(): void {\n        if (this.useMultiTouch) return\n        this.pointerCancel()\n    }\n\n\n    // mouse\n    protected onMouseDown(e: MouseEvent): void {\n        this.preventDefaultPointer(e)\n\n        if (this.notMouse) return\n        this.pointerDown(PointerEventHelper.convertMouse(e, this.getLocal(e)))\n    }\n\n    protected onMouseMove(e: MouseEvent): void {\n        if (this.notMouse || this.preventWindowPointer(e)) return\n        this.pointerMove(PointerEventHelper.convertMouse(e, this.getLocal(e, true)))\n    }\n\n    protected onMouseUp(e: MouseEvent): void {\n        if (this.downData) this.preventDefaultPointer(e)\n        if (this.notMouse || this.preventWindowPointer(e)) return\n        this.pointerUp(PointerEventHelper.convertMouse(e, this.getLocal(e)))\n    }\n\n    protected onMouseCancel(): void {\n        if (this.notMouse) return\n        this.pointerCancel()\n    }\n\n\n    // touch\n    protected onTouchStart(e: TouchEvent): void {\n        const touch = PointerEventHelper.getTouch(e)\n        const local = this.getLocal(touch, true)\n        const { preventDefault } = this.config.touch\n        if (preventDefault === true || (preventDefault === 'auto' && pathCanDrag(this.findPath(local)))) e.preventDefault()\n\n        this.multiTouchStart(e)\n\n        if (this.notTouch) return\n        if (this.touchTimer) {\n            window.clearTimeout(this.touchTimer)\n            this.touchTimer = 0\n        }\n        this.useTouch = true\n        this.pointerDown(PointerEventHelper.convertTouch(e, local))\n    }\n\n    protected onTouchMove(e: TouchEvent): void {\n        this.multiTouchMove(e)\n\n        if (this.notTouch || this.preventWindowPointer(e)) return\n        const touch = PointerEventHelper.getTouch(e)\n        this.pointerMove(PointerEventHelper.convertTouch(e, this.getLocal(touch)))\n    }\n\n    protected onTouchEnd(e: TouchEvent): void {\n        this.multiTouchEnd()\n\n        if (this.notTouch || this.preventWindowPointer(e)) return\n        if (this.touchTimer) clearTimeout(this.touchTimer)\n        this.touchTimer = setTimeout(() => {\n            this.useTouch = false\n        }, 500) // stop touch > mouse\n        const touch = PointerEventHelper.getTouch(e)\n        this.pointerUp(PointerEventHelper.convertTouch(e, this.getLocal(touch)))\n    }\n\n    protected onTouchCancel(): void {\n        if (this.notTouch) return\n        this.pointerCancel()\n    }\n\n\n    // multiTouch\n    protected multiTouchStart(e: TouchEvent): void {\n        this.useMultiTouch = (e.touches.length > 1)\n        this.touches = this.useMultiTouch ? this.getTouches(e.touches) : undefined\n        if (this.useMultiTouch) this.pointerCancel()\n    }\n\n    protected multiTouchMove(e: TouchEvent): void {\n        if (!this.useMultiTouch) return\n        if (e.touches.length > 1) {\n            const touches = this.getTouches(e.touches)\n            const list = this.getKeepTouchList(this.touches, touches)\n            if (list.length > 1) {\n                this.multiTouch(InteractionHelper.getBase(e), list)\n                this.touches = touches\n            }\n        }\n    }\n\n    protected multiTouchEnd(): void {\n        this.touches = null\n        this.useMultiTouch = false\n        this.transformEnd()\n    }\n\n    protected getKeepTouchList(old: Touch[], touches: Touch[]): IKeepTouchData[] {\n        let to: Touch\n        const list: IKeepTouchData[] = []\n        old.forEach(from => {\n            to = touches.find(touch => touch.identifier === from.identifier)\n            if (to) list.push({ from: this.getLocal(from), to: this.getLocal(to) })\n        })\n        return list\n    }\n\n    protected getLocalTouchs(points: Touch[]): IPointData[] {\n        return points.map(point => this.getLocal(point))\n    }\n\n\n    // wheel\n    protected onWheel(e: WheelEvent): void {\n        this.preventDefaultWheel(e)\n        this.wheel({\n            ...InteractionHelper.getBase(e),\n            ...this.getLocal(e),\n            deltaX: e.deltaX,\n            deltaY: e.deltaY\n        })\n    }\n\n\n    // safari \n    protected onGesturestart(e: IGestureEvent): void {\n        if (this.useMultiTouch) return\n        this.preventDefaultWheel(e)\n\n        this.lastGestureScale = 1\n        this.lastGestureRotation = 0\n    }\n\n    protected onGesturechange(e: IGestureEvent): void {\n        if (this.useMultiTouch) return\n        this.preventDefaultWheel(e)\n\n        const eventBase = InteractionHelper.getBase(e)\n        Object.assign(eventBase, this.getLocal(e))\n\n        const scale = (e.scale / this.lastGestureScale)\n        const rotation = (e.rotation - this.lastGestureRotation) / Math.PI * 180 * (MathHelper.within(this.config.wheel.rotateSpeed, 0, 1) / 4 + 0.1)\n\n        this.zoom({ ...eventBase, scale: scale * scale } as IZoomEvent)\n        this.rotate({ ...eventBase, rotation } as IRotateEvent)\n\n        this.lastGestureScale = e.scale\n        this.lastGestureRotation = e.rotation\n    }\n\n    protected onGestureend(e: IGestureEvent): void {\n        if (this.useMultiTouch) return\n        this.preventDefaultWheel(e)\n\n        this.transformEnd()\n    }\n\n\n    // cursor\n    public setCursor(cursor: ICursorType | ICursorType[]): void {\n        super.setCursor(cursor)\n        const list: ICursorType[] = []\n        this.eachCursor(cursor, list)\n        if (isObject(list[list.length - 1])) list.push('default')\n        this.canvas.view.style.cursor = list.map(item => (isObject(item)) ? `url(${item.url}) ${item.x || 0} ${item.y || 0}` : item).join(',')\n    }\n\n    protected eachCursor(cursor: ICursorType | ICursorType[], list: ICursorType[], level = 0): void {\n        level++\n        if (isArray(cursor)) {\n            cursor.forEach(item => this.eachCursor(item, list, level))\n        } else {\n            const custom = isString(cursor) && Cursor.get(cursor)\n            if (custom && level < 2) {\n                this.eachCursor(custom, list, level)\n            } else {\n                list.push(cursor)\n            }\n        }\n    }\n\n    public destroy(): void {\n        if (this.view) {\n            super.destroy()\n            this.view = null\n            this.touches = null\n        }\n    }\n\n}","import { ILeaferCanvas, IRenderOptions } from '@leafer/interface'\n\nimport { IImagePaint, ILeafPaint, IUI } from '@leafer-ui/interface'\nimport { PaintImage, Paint } from \"@leafer-ui/draw\"\n\n\nexport function fill(fill: string, ui: IUI, canvas: ILeaferCanvas, renderOptions: IRenderOptions): void {\n    canvas.fillStyle = fill\n    fillPathOrText(ui, canvas, renderOptions)\n}\n\n\nexport function fills(fills: ILeafPaint[], ui: IUI, canvas: ILeaferCanvas, renderOptions: IRenderOptions): void {\n    let item: ILeafPaint, originPaint: IImagePaint, countImage: number\n    for (let i = 0, len = fills.length; i < len; i++) {\n        item = fills[i], originPaint = item.originPaint as IImagePaint\n\n        if (item.image) {\n\n            countImage ? countImage++ : countImage = 1\n\n            if (PaintImage.checkImage(item, !ui.__.__font, ui, canvas, renderOptions)) continue\n\n            if (!item.style) {\n                if (countImage === 1 && item.image.isPlacehold) ui.drawImagePlaceholder(item, canvas, renderOptions) // 图片加载中或加载失败\n                continue\n            }\n\n        }\n\n        canvas.fillStyle = item.style\n\n        if (item.transform || originPaint.scaleFixed) {\n\n            canvas.save()\n            if (item.transform) canvas.transform(item.transform)\n            if (originPaint.scaleFixed) {\n                const { scaleX, scaleY } = ui.getRenderScaleData(true)\n                if (originPaint.scaleFixed === true || (originPaint.scaleFixed === 'zoom-in' && scaleX > 1 && scaleY > 1)) canvas.scale(1 / scaleX, 1 / scaleY)\n            }\n            if (originPaint.blendMode) canvas.blendMode = originPaint.blendMode\n            fillPathOrText(ui, canvas, renderOptions)\n            canvas.restore()\n\n        } else {\n\n            if (originPaint.blendMode) {\n\n                canvas.saveBlendMode(originPaint.blendMode)\n                fillPathOrText(ui, canvas, renderOptions)\n                canvas.restoreBlendMode()\n\n            } else fillPathOrText(ui, canvas, renderOptions)\n\n        }\n\n    }\n}\n\n\nexport function fillPathOrText(ui: IUI, canvas: ILeaferCanvas, renderOptions: IRenderOptions): void {\n    ui.__.__font ? Paint.fillText(ui, canvas, renderOptions) : (ui.__.windingRule ? canvas.fill(ui.__.windingRule) : canvas.fill())\n}","import { ILeaferCanvas, IRenderOptions } from '@leafer/interface'\nimport { LeafHelper, isObject } from \"@leafer/core\"\n\nimport { IUI, ILeafPaint } from '@leafer-ui/interface'\nimport { Paint } from '@leafer-ui/draw'\n\n\nexport function stroke(stroke: string, ui: IUI, canvas: ILeaferCanvas, renderOptions: IRenderOptions): void {\n    const data = ui.__\n    if (!data.__strokeWidth) return\n\n    if (data.__font) {\n\n        Paint.strokeText(stroke, ui, canvas, renderOptions)\n\n    } else {\n\n        switch (data.strokeAlign) {\n            case 'center':\n                drawCenter(stroke, 1, ui, canvas, renderOptions)\n                break\n            case 'inside':\n                drawInside(stroke, ui, canvas, renderOptions)\n                break\n            case 'outside':\n                drawOutside(stroke, ui, canvas, renderOptions)\n                break\n        }\n\n    }\n}\n\n\nexport function strokes(strokes: ILeafPaint[], ui: IUI, canvas: ILeaferCanvas, renderOptions: IRenderOptions): void {\n    Paint.stroke(strokes as any, ui, canvas, renderOptions)\n}\n\n\nfunction drawCenter(stroke: string | ILeafPaint[], strokeWidthScale: number, ui: IUI, canvas: ILeaferCanvas, renderOptions: IRenderOptions) {\n    const data = ui.__\n    if (isObject(stroke)) {\n        Paint.drawStrokesStyle(stroke, strokeWidthScale, false, ui, canvas, renderOptions)\n    } else {\n        canvas.setStroke(stroke, data.__strokeWidth * strokeWidthScale, data)\n        canvas.stroke()\n    }\n\n    if (data.__useArrow) Paint.strokeArrow(stroke, ui, canvas, renderOptions)\n}\n\nfunction drawInside(stroke: string | ILeafPaint[], ui: IUI, canvas: ILeaferCanvas, renderOptions: IRenderOptions) {\n    canvas.save()\n    canvas.clipUI(ui)\n\n    drawCenter(stroke, 2, ui, canvas, renderOptions)\n    canvas.restore()\n}\n\nfunction drawOutside(stroke: string | ILeafPaint[], ui: IUI, canvas: ILeaferCanvas, renderOptions: IRenderOptions) {\n    const data = ui.__\n    if (data.__fillAfterStroke) {\n\n        drawCenter(stroke, 2, ui, canvas, renderOptions)\n\n    } else {\n        const { renderBounds } = ui.__layout\n        const out = canvas.getSameCanvas(true, true)\n        ui.__drawRenderPath(out)\n\n        drawCenter(stroke, 2, ui, out, renderOptions)\n\n        out.clipUI(data)\n        out.clearWorld(renderBounds)\n\n        LeafHelper.copyCanvasByWorld(ui, canvas, out)\n\n        out.recycle(ui.__nowWorld)\n    }\n}\n","import { ILeaferCanvas, IRenderOptions } from '@leafer/interface'\nimport { LeafHelper, isObject } from \"@leafer/core\"\n\nimport { IUI, ITextRowData, ILeafPaint, IStrokeAlign, ILeafStrokePaint } from '@leafer-ui/interface'\nimport { PaintImage, Paint } from \"@leafer-ui/draw\"\n\n\nexport function strokeText(stroke: string | ILeafPaint[], ui: IUI, canvas: ILeaferCanvas, renderOptions: IRenderOptions): void {\n    switch (ui.__.strokeAlign) {\n        case 'center':\n            drawCenter(stroke, 1, ui, canvas, renderOptions)\n            break\n        case 'inside':\n            drawAlign(stroke, 'inside', ui, canvas, renderOptions)\n            break\n        case 'outside':\n            ui.__.__fillAfterStroke ? drawCenter(stroke, 2, ui, canvas, renderOptions) : drawAlign(stroke, 'outside', ui, canvas, renderOptions)\n            break\n    }\n}\n\nfunction drawCenter(stroke: string | ILeafPaint[], strokeWidthScale: number, ui: IUI, canvas: ILeaferCanvas, renderOptions: IRenderOptions): void {\n    const data = ui.__\n    if (isObject(stroke)) {\n        Paint.drawStrokesStyle(stroke, strokeWidthScale, true, ui, canvas, renderOptions)\n    } else {\n        canvas.setStroke(stroke, data.__strokeWidth * strokeWidthScale, data)\n        Paint.drawTextStroke(ui, canvas, renderOptions)\n    }\n}\n\nfunction drawAlign(stroke: string | ILeafPaint[], align: IStrokeAlign, ui: IUI, canvas: ILeaferCanvas, renderOptions: IRenderOptions): void {\n    const out = canvas.getSameCanvas(true, true)\n    out.font = ui.__.__font\n    drawCenter(stroke, 2, ui, out, renderOptions)\n\n    out.blendMode = align === 'outside' ? 'destination-out' : 'destination-in'\n    Paint.fillText(ui, out, renderOptions)\n    out.blendMode = 'normal'\n\n    LeafHelper.copyCanvasByWorld(ui, canvas, out)\n\n    out.recycle(ui.__nowWorld)\n}\n\n\nexport function drawTextStroke(ui: IUI, canvas: ILeaferCanvas, _renderOptions: IRenderOptions): void {\n\n    let row: ITextRowData, data = ui.__.__textDrawData\n    const { rows, decorationY } = data\n\n    for (let i = 0, len = rows.length; i < len; i++) {\n        row = rows[i]\n\n        if (row.text) canvas.strokeText(row.text, row.x, row.y)\n        else if (row.data) row.data.forEach(charData => { canvas.strokeText(charData.char, charData.x, row.y) })\n    }\n\n    if (decorationY) {\n        const { decorationHeight } = data\n        rows.forEach(row => decorationY.forEach(value => canvas.strokeRect(row.x, row.y + value, row.width, decorationHeight)))\n    }\n\n}\n\nexport function drawStrokesStyle(strokes: ILeafStrokePaint[], strokeWidthScale: number, isText: boolean, ui: IUI, canvas: ILeaferCanvas, renderOptions: IRenderOptions): void {\n    let item: ILeafStrokePaint\n    const data = ui.__, { __hasMultiStrokeStyle } = data\n    __hasMultiStrokeStyle || canvas.setStroke(undefined, data.__strokeWidth * strokeWidthScale, data)\n\n    for (let i = 0, len = strokes.length; i < len; i++) {\n        item = strokes[i]\n\n        if (item.image && PaintImage.checkImage(item, false, ui, canvas, renderOptions)) continue\n\n        if (item.style) {\n            if (__hasMultiStrokeStyle) {\n                const { strokeStyle } = item\n                strokeStyle ? canvas.setStroke(item.style, data.__getRealStrokeWidth(strokeStyle) * strokeWidthScale, data, strokeStyle) : canvas.setStroke(item.style, data.__strokeWidth * strokeWidthScale, data)\n            } else canvas.strokeStyle = item.style\n\n            if (item.originPaint.blendMode) {\n                canvas.saveBlendMode(item.originPaint.blendMode)\n                isText ? Paint.drawTextStroke(ui, canvas, renderOptions) : canvas.stroke()\n                canvas.restoreBlendMode()\n            } else {\n                isText ? Paint.drawTextStroke(ui, canvas, renderOptions) : canvas.stroke()\n            }\n        }\n    }\n}","import { IBoundsData, ILeaferCanvas, IRenderOptions, IMatrix } from '@leafer/interface'\nimport { BoundsHelper, FourNumberHelper, Matrix, Platform } from '@leafer/core'\n\nimport { IUI, ICachedShape } from '@leafer-ui/interface'\n\n\nconst { getSpread, copyAndSpread, toOuterOf, getOuterOf, getByMove, move, getIntersectData } = BoundsHelper\nconst tempBounds = {} as IBoundsData\n\nexport function shape(ui: IUI, current: ILeaferCanvas, options: IRenderOptions): ICachedShape {\n    const canvas = current.getSameCanvas()\n    const currentBounds = current.bounds, nowWorld = ui.__nowWorld, layout = ui.__layout\n    const nowWorldShapeBounds = ui.__nowWorldShapeBounds || (ui.__nowWorldShapeBounds = {} as IBoundsData)\n\n    toOuterOf(layout.strokeSpread ? (copyAndSpread(tempBounds, layout.boxBounds, layout.strokeSpread), tempBounds) : layout.boxBounds, nowWorld, nowWorldShapeBounds)\n\n    let bounds: IBoundsData, renderBounds: IBoundsData, matrix: IMatrix, fitMatrix: IMatrix, shapeBounds: IBoundsData, worldCanvas: ILeaferCanvas\n\n    let { scaleX, scaleY } = ui.getRenderScaleData(true)\n\n    if (currentBounds.includes(nowWorldShapeBounds)) {\n\n        worldCanvas = canvas\n        bounds = shapeBounds = nowWorldShapeBounds\n        renderBounds = nowWorld\n\n    } else {\n\n        let worldClipBounds: IBoundsData // 作为绘制阴影的裁剪形状\n\n        if (Platform.fullImageShadow) { // fix: iOS Safari 18.5 以上, 只裁剪部分区域渲染阴影会有问题\n            worldClipBounds = nowWorldShapeBounds\n        } else {\n\n            const spreadBounds = layout.renderShapeSpread ? getSpread(currentBounds, FourNumberHelper.swapAndScale(layout.renderShapeSpread, scaleX, scaleY)) : currentBounds  // spread需要反向交换值\n            worldClipBounds = getIntersectData(spreadBounds, nowWorldShapeBounds)\n        }\n\n        fitMatrix = currentBounds.getFitMatrix(worldClipBounds)\n        let { a: fitScaleX, d: fitScaleY } = fitMatrix\n\n        if (fitMatrix.a < 1) {\n            worldCanvas = current.getSameCanvas()\n            ui.__renderShape(worldCanvas, options)\n\n            scaleX *= fitScaleX\n            scaleY *= fitScaleY\n        }\n\n\n        shapeBounds = getOuterOf(nowWorldShapeBounds, fitMatrix)\n        bounds = getByMove(shapeBounds, -fitMatrix.e, -fitMatrix.f)\n\n        renderBounds = getOuterOf(nowWorld, fitMatrix)\n        move(renderBounds, -fitMatrix.e, -fitMatrix.f)\n\n\n        const userMatrix = options.matrix\n        if (userMatrix) {\n            matrix = new Matrix(fitMatrix) // 仅用于渲染\n            matrix.multiply(userMatrix)\n            fitScaleX *= userMatrix.scaleX\n            fitScaleY *= userMatrix.scaleY\n        } else matrix = fitMatrix\n\n        matrix.withScale(fitScaleX, fitScaleY)\n        options = { ...options, matrix }\n    }\n\n    ui.__renderShape(canvas, options)\n\n    return {\n        canvas, matrix, fitMatrix, bounds, renderBounds,\n        worldCanvas, shapeBounds, scaleX, scaleY\n    }\n}","import { DataHelper, isArray, isObject, isString, isUndefined } from '@leafer/core'\n\nimport { IUI, IPaint, ILeafPaint, IRGB, IBooleanMap, IObject, IPaintAttr, IStrokeComputedStyle } from '@leafer-ui/interface'\nimport { ColorConvert, PaintImage, PaintGradient } from '@leafer-ui/draw'\n\n\nlet recycleMap: IBooleanMap\nconst { stintSet } = DataHelper, { hasTransparent } = ColorConvert\n\nexport function compute(attrName: IPaintAttr, ui: IUI): void {\n    const data = ui.__, leafPaints: ILeafPaint[] = []\n\n    let paints: IPaint[] = data.__input[attrName], isAlphaPixel: boolean, isTransparent: boolean\n    if (!isArray(paints)) paints = [paints]\n\n    recycleMap = PaintImage.recycleImage(attrName, data)\n\n    let maxChildStrokeWidth: number\n\n    for (let i = 0, len = paints.length, item: ILeafPaint; i < len; i++) {\n        if (item = getLeafPaint(attrName, paints[i], ui)) {\n            leafPaints.push(item)\n\n            // 检测多个子描边样式和宽度\n            if (item.strokeStyle) {\n                maxChildStrokeWidth || (maxChildStrokeWidth = 1)\n                if (item.strokeStyle.strokeWidth) maxChildStrokeWidth = Math.max(maxChildStrokeWidth, item.strokeStyle.strokeWidth as number)\n            }\n        }\n    }\n\n    (data as IObject)['_' + attrName] = leafPaints.length ? leafPaints : undefined\n\n    if (leafPaints.length) {\n\n        if (leafPaints.every(item => item.isTransparent)) {\n            if (leafPaints.some(item => item.image)) isAlphaPixel = true\n            isTransparent = true\n        }\n\n        if (attrName === 'fill') {\n            stintSet(data, '__isAlphaPixelFill', isAlphaPixel)\n            stintSet(data, '__isTransparentFill', isTransparent)\n        } else {\n            stintSet(data, '__isAlphaPixelStroke', isAlphaPixel)\n            stintSet(data, '__isTransparentStroke', isTransparent)\n            stintSet(data, '__hasMultiStrokeStyle', maxChildStrokeWidth)\n        }\n\n    } else {\n        data.__removePaint(attrName, false)\n    }\n\n}\n\n\nfunction getLeafPaint(attrName: string, paint: IPaint, ui: IUI): ILeafPaint {\n    if (!isObject(paint) || paint.visible === false || paint.opacity === 0) return undefined\n\n    let leafPaint: ILeafPaint\n    const { boxBounds } = ui.__layout\n\n    switch (paint.type) {\n        case 'image':\n            if (!paint.url) return undefined\n            leafPaint = PaintImage.image(ui, attrName, paint, boxBounds, !recycleMap || !recycleMap[paint.url])\n            break\n        case 'linear':\n            leafPaint = PaintGradient.linearGradient(paint, boxBounds)\n            break\n        case 'radial':\n            leafPaint = PaintGradient.radialGradient(paint, boxBounds)\n            break\n        case 'angular':\n            leafPaint = PaintGradient.conicGradient(paint, boxBounds)\n            break\n        case 'solid':\n            const { type, color, opacity } = paint\n            leafPaint = { type, style: ColorConvert.string(color, opacity) }\n            break\n        default:\n            if (!isUndefined((paint as IRGB).r)) leafPaint = { type: 'solid', style: ColorConvert.string(paint) }\n    }\n\n    if (leafPaint) {\n        // 原始paint\n        leafPaint.originPaint = paint\n\n        // 描边样式\n        if (isString(leafPaint.style) && hasTransparent(leafPaint.style)) leafPaint.isTransparent = true\n        if (paint.style) {\n            if (paint.style.strokeWidth === 0) return undefined\n            leafPaint.strokeStyle = paint.style as IStrokeComputedStyle\n        }\n    }\n\n    return leafPaint\n}","import { IPaintModule } from '@leafer-ui/interface'\n\nimport { fill, fills, fillPathOrText } from './Fill'\nimport { fillText } from './FillText'\nimport { stroke, strokes } from './Stroke'\nimport { strokeText, drawTextStroke, drawStrokesStyle } from './StrokeText'\nimport { shape } from './Shape'\nimport { compute } from './Compute'\n\n\nexport const PaintModule: IPaintModule = {\n    compute,\n\n    fill,\n    fills,\n    fillPathOrText,\n    fillText,\n\n    stroke,\n    strokes,\n    strokeText,\n    drawTextStroke,\n    drawStrokesStyle,\n\n    shape\n}","import { ILeaferCanvas, IRenderOptions } from '@leafer/interface'\n\nimport { ITextRowData, IText } from '@leafer-ui/interface'\n\n\nexport function fillText(ui: IText, canvas: ILeaferCanvas, _renderOptions: IRenderOptions): void {\n\n    const data = ui.__, { rows, decorationY } = data.__textDrawData\n    if (data.__isPlacehold && data.placeholderColor) canvas.fillStyle = data.placeholderColor\n\n    let row: ITextRowData\n\n    for (let i = 0, len = rows.length; i < len; i++) {\n        row = rows[i]\n\n        if (row.text) canvas.fillText(row.text, row.x, row.y)\n        else if (row.data) row.data.forEach(charData => { canvas.fillText(charData.char, charData.x, row.y) })\n    }\n\n    if (decorationY) {\n        const { decorationColor, decorationHeight } = data.__textDrawData\n        if (decorationColor) canvas.fillStyle = decorationColor\n        rows.forEach(row => decorationY.forEach(value => canvas.fillRect(row.x, row.y + value, row.width, decorationHeight)))\n    }\n\n}\n","import { IBoundsData, IImageEvent, ILeaferImage, IObject } from '@leafer/interface'\nimport { Bounds, BoundsHelper, ImageEvent, ImageManager } from '@leafer/core'\n\nimport { IUI, IImagePaint, ILeafPaint } from '@leafer-ui/interface'\nimport { PaintImage } from \"@leafer-ui/draw\"\n\n\ninterface IImagePaintCache {\n    leafPaint: ILeafPaint\n    paint: IImagePaint\n    boxBounds: IBoundsData\n}\n\nlet cache: IImagePaintCache, box = new Bounds()\nconst { isSame } = BoundsHelper\n\nexport function image(ui: IUI, attrName: string, paint: IImagePaint, boxBounds: IBoundsData, firstUse: boolean): ILeafPaint {\n    let leafPaint: ILeafPaint, event: IImageEvent\n    const image = ImageManager.get(paint)\n\n    if (cache && paint === cache.paint && isSame(boxBounds, cache.boxBounds)) {\n        leafPaint = cache.leafPaint\n    } else {\n        leafPaint = { type: paint.type, image }\n        if (image.hasAlphaPixel) leafPaint.isTransparent = true\n\n        cache = image.use > 1 ? { leafPaint, paint, boxBounds: box.set(boxBounds) } : null // 只保留最后一个cache\n    }\n\n    if (firstUse || image.loading) event = { image, attrName, attrValue: paint }\n\n    if (image.ready) {\n\n        checkSizeAndCreateData(ui, attrName, paint, image, leafPaint, boxBounds)\n\n        if (firstUse) {\n            onLoad(ui, event)\n            onLoadSuccess(ui, event)\n        }\n\n    } else if (image.error) {\n\n        if (firstUse) onLoadError(ui, event, image.error)\n\n    } else { // need load\n\n        if (firstUse) {\n            ignoreRender(ui, true) // wait loaded\n            onLoad(ui, event)\n        }\n\n        leafPaint.loadId = image.load(\n            () => {\n                ignoreRender(ui, false)\n                if (!ui.destroyed) {\n                    if (checkSizeAndCreateData(ui, attrName, paint, image, leafPaint, boxBounds)) {\n                        if (image.hasAlphaPixel) ui.__layout.hitCanvasChanged = true\n                        ui.forceUpdate('surface')\n                    }\n                    onLoadSuccess(ui, event)\n                }\n                leafPaint.loadId = undefined\n            },\n            (error) => {\n                ignoreRender(ui, false)\n                onLoadError(ui, event, error)\n                leafPaint.loadId = undefined\n            },\n            paint.lod && image.getThumbSize(paint.lod)\n        )\n\n        if (ui.placeholderColor) {\n            if (!ui.placeholderDelay) image.isPlacehold = true\n            else setTimeout(() => {\n                if (!image.ready) {\n                    image.isPlacehold = true\n                    ui.forceUpdate('surface')\n                }\n            }, ui.placeholderDelay)\n        }\n\n    }\n\n    return leafPaint\n}\n\n\nfunction checkSizeAndCreateData(ui: IUI, attrName: string, paint: IImagePaint, image: ILeaferImage, leafPaint: ILeafPaint, boxBounds: IBoundsData): boolean {\n    if (attrName === 'fill' && !ui.__.__naturalWidth) {\n        const data = ui.__\n        data.__naturalWidth = image.width / data.pixelRatio\n        data.__naturalHeight = image.height / data.pixelRatio\n        if (data.__autoSide) {\n            ui.forceUpdate('width')\n            if (ui.__proxyData) {\n                ui.setProxyAttr('width', data.width)\n                ui.setProxyAttr('height', data.height)\n            }\n            return false\n        }\n    }\n\n    if (!leafPaint.data) PaintImage.createData(leafPaint, image, paint, boxBounds)\n    return true\n}\n\n\n\nfunction onLoad(ui: IUI, event: IImageEvent): void {\n    emit(ui, ImageEvent.LOAD, event)\n}\n\n\nfunction onLoadSuccess(ui: IUI, event: IImageEvent): void {\n    emit(ui, ImageEvent.LOADED, event)\n}\n\n\nfunction onLoadError(ui: IUI, event: IImageEvent, error: string | IObject,): void {\n    event.error = error\n    ui.forceUpdate('surface')\n    emit(ui, ImageEvent.ERROR, event)\n}\n\n\nfunction emit(ui: IUI, type: string, data: IImageEvent): void {\n    if (ui.hasEvent(type)) ui.emitEvent(new ImageEvent(type, data))\n}\n\nfunction ignoreRender(ui: IUI, value: boolean): void {\n    const { leafer } = ui\n    if (leafer && leafer.viewReady) leafer.renderer.ignore = value // prevent blink on hover\n}","import { IBoundsData, IGap, ILeaferImage, IPointData, IPointGap, IScaleData } from '@leafer/interface'\nimport { MatrixHelper, MathHelper, Bounds, AlignHelper, BoundsHelper, PointHelper, isObject, isString, isNumber } from '@leafer/core'\n\nimport { IImagePaint, ILeafPaint, ILeafPaintPatternData } from '@leafer-ui/interface'\nimport { PaintImage } from \"@leafer-ui/draw\"\n\n\nconst { get, translate } = MatrixHelper\nconst tempBox = new Bounds()\nconst tempScaleData = {} as IScaleData\nconst tempImage = {} as IBoundsData\n\nexport function createData(leafPaint: ILeafPaint, image: ILeaferImage, paint: IImagePaint, box: IBoundsData): void {\n    leafPaint.data = PaintImage.getPatternData(paint, box, image)\n}\n\nexport function getPatternData(paint: IImagePaint, box: IBoundsData, image: ILeaferImage): ILeafPaintPatternData {\n    if (paint.padding) box = tempBox.set(box).shrink(paint.padding)\n    if (paint.mode === 'strench' as string) paint.mode = 'stretch' // 兼容代码，后续可移除\n\n    const { width, height } = image\n    const { opacity, mode, align, offset, scale, size, rotation, skew, clipSize, repeat, gap, filters, interlace } = paint\n    const sameBox = box.width === width && box.height === height\n\n    const data: ILeafPaintPatternData = { mode }\n    const swapSize = align !== 'center' && (rotation || 0) % 180 === 90\n    BoundsHelper.set(tempImage, 0, 0, swapSize ? height : width, swapSize ? width : height)\n\n    let scaleX: number, scaleY: number\n\n    if (!mode || mode === 'cover' || mode === 'fit') { // mode 默认值为 cover\n        if (!sameBox || rotation) {\n            scaleX = scaleY = BoundsHelper.getFitScale(box, tempImage, mode !== 'fit')\n            BoundsHelper.put(box, image, align, scaleX, false, tempImage)\n            BoundsHelper.scale(tempImage, scaleX, scaleY, true)\n        }\n    } else {\n        if (scale || size) {\n            MathHelper.getScaleData(scale, size, image, tempScaleData)\n            scaleX = tempScaleData.scaleX\n            scaleY = tempScaleData.scaleY\n        }\n\n        if (align || gap || repeat) {\n            if (scaleX) BoundsHelper.scale(tempImage, scaleX, scaleY, true)\n            if (align) AlignHelper.toPoint(align, tempImage, box, tempImage, true, true)\n        }\n    }\n\n    if (offset) PointHelper.move(tempImage, offset)\n\n    switch (mode) {\n        case 'stretch':\n            if (!sameBox) {\n                scaleX = box.width / width, scaleY = box.height / height\n                PaintImage.stretchMode(data, box, scaleX, scaleY)\n            } else if (scaleX) scaleX = scaleY = undefined\n            break\n        case 'normal':\n        case 'clip':\n            if (tempImage.x || tempImage.y || scaleX || clipSize || rotation || skew) {\n                let clipScaleX: number, clipScaleY: number\n                if (clipSize) clipScaleX = box.width / clipSize.width, clipScaleY = box.height / clipSize.height\n                PaintImage.clipMode(data, box, tempImage.x, tempImage.y, scaleX, scaleY, rotation, skew, clipScaleX, clipScaleY)\n                if (clipScaleX) scaleX = scaleX ? scaleX * clipScaleX : clipScaleX, scaleY = scaleY ? scaleY * clipScaleY : clipScaleY\n            }\n            break\n        case 'repeat':\n            if (!sameBox || scaleX || rotation || skew) PaintImage.repeatMode(data, box, width, height, tempImage.x, tempImage.y, scaleX, scaleY, rotation, skew, align, paint.freeTransform)\n            if (!repeat) data.repeat = 'repeat'\n            const count = isObject(repeat)\n            if (gap || count) data.gap = getGapData(gap, count && repeat, tempImage.width, tempImage.height, box)\n            break\n        case 'fit':\n        case 'cover':\n        default:\n            if (scaleX) PaintImage.fillOrFitMode(data, box, tempImage.x, tempImage.y, scaleX, scaleY, rotation)\n    }\n\n    if (!data.transform) {\n        if (box.x || box.y) translate(data.transform = get(), box.x, box.y)\n    }\n\n    if (scaleX) {\n        data.scaleX = scaleX\n        data.scaleY = scaleY\n    }\n\n    if (opacity && opacity < 1) data.opacity = opacity\n    if (filters) data.filters = filters\n    if (repeat) data.repeat = isString(repeat) ? (repeat === 'x' ? 'repeat-x' : 'repeat-y') : 'repeat'\n    if (interlace) data.interlace = (isNumber(interlace) || interlace.type === 'percent') ? { type: 'x', offset: interlace } : interlace\n    return data\n}\n\n\nfunction getGapData(gap: IGap | IPointGap, repeat: IPointData, width: number, height: number, box: IBoundsData): IPointData {\n    let xGap: IGap, yGap: IGap\n    if (isObject(gap)) xGap = gap.x, yGap = gap.y\n    else xGap = yGap = gap\n    return { x: getGapValue(xGap, width, box.width, repeat && repeat.x), y: getGapValue(yGap, height, box.height, repeat && repeat.y) }\n}\n\nfunction getGapValue(gap: IGap, size: number, totalSize: number, rows: number): number {\n    const auto = isString(gap) || rows\n    const remain = rows ? totalSize - rows * size : totalSize % size\n    const value = auto ? remain / ((rows || Math.floor(totalSize / size)) - 1) : gap\n    return gap === 'auto' ? (value < 0 ? 0 : value) : value\n}","import { IBoundsData, IPointData, IMatrixData, IAlign } from '@leafer/interface'\nimport { getMatrixData, MatrixHelper } from '@leafer/core'\n\nimport { ILeafPaintPatternData } from '@leafer-ui/interface'\n\n\nlet origin = {} as IPointData, tempMatrix = getMatrixData()\nconst { get, set, rotateOfOuter, translate, scaleOfOuter, multiplyParent, scale: scaleHelper, rotate, skew: skewHelper } = MatrixHelper\n\nexport function stretchMode(data: ILeafPaintPatternData, box: IBoundsData, scaleX: number, scaleY: number): void {\n    const transform: IMatrixData = get(), { x, y } = box\n    if (x || y) translate(transform, x, y)\n    else transform.onlyScale = true\n    scaleHelper(transform, scaleX, scaleY)\n    data.transform = transform\n}\n\nexport function fillOrFitMode(data: ILeafPaintPatternData, box: IBoundsData, x: number, y: number, scaleX: number, scaleY: number, rotation: number): void {\n    const transform: IMatrixData = get()\n    translate(transform, box.x + x, box.y + y)\n    scaleHelper(transform, scaleX, scaleY)\n    if (rotation) rotateOfOuter(transform, { x: box.x + box.width / 2, y: box.y + box.height / 2 }, rotation)\n    data.transform = transform\n}\n\nexport function clipMode(data: ILeafPaintPatternData, box: IBoundsData, x: number, y: number, scaleX: number, scaleY: number, rotation: number, skew: IPointData, clipScaleX?: number, clipScaleY?: number): void {\n    const transform: IMatrixData = get()\n    layout(transform, box, x, y, scaleX, scaleY, rotation, skew)\n    if (clipScaleX) {\n        if (rotation || skew) {\n            set(tempMatrix)\n            scaleOfOuter(tempMatrix, box, clipScaleX, clipScaleY)\n            multiplyParent(transform, tempMatrix)\n        } else scaleOfOuter(transform, box, clipScaleX, clipScaleY)\n    }\n    data.transform = transform\n}\n\nexport function repeatMode(data: ILeafPaintPatternData, box: IBoundsData, width: number, height: number, x: number, y: number, scaleX: number, scaleY: number, rotation: number, skew: IPointData, align: IAlign, freeTransform?: boolean): void {\n    const transform = get()\n    if (freeTransform) { // 自由变换\n        layout(transform, box, x, y, scaleX, scaleY, rotation, skew)\n    } else {\n        if (rotation) {\n            if (align === 'center') {\n                rotateOfOuter(transform, { x: width / 2, y: height / 2 }, rotation)\n            } else {\n                rotate(transform, rotation)\n                switch (rotation) {\n                    case 90:\n                        translate(transform, height, 0)\n                        break\n                    case 180:\n                        translate(transform, width, height)\n                        break\n                    case 270:\n                        translate(transform, 0, width)\n                        break\n                }\n            }\n        }\n        origin.x = box.x + x\n        origin.y = box.y + y\n        translate(transform, origin.x, origin.y)\n        if (scaleX) scaleOfOuter(transform, origin, scaleX, scaleY)\n    }\n    data.transform = transform\n}\n\nfunction layout(transform: IMatrixData, box: IBoundsData, x: number, y: number, scaleX: number, scaleY: number, rotation: number, skew: IPointData) {\n    // rotate -> skew -> scale -> translate\n    if (rotation) rotate(transform, rotation)\n    if (skew) skewHelper(transform, skew.x, skew.y)\n    if (scaleX) scaleHelper(transform, scaleX, scaleY)\n    translate(transform, box.x + x, box.y + y)\n}\n","/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\r\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\r\n    function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nvar ownKeys = function(o) {\r\n    ownKeys = Object.getOwnPropertyNames || function (o) {\r\n        var ar = [];\r\n        for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\r\n        return ar;\r\n    };\r\n    return ownKeys(o);\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose, inner;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n            if (async) inner = dispose;\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    var r, s = 0;\r\n    function next() {\r\n        while (r = env.stack.pop()) {\r\n            try {\r\n                if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\r\n                if (r.dispose) {\r\n                    var result = r.dispose.call(r.value);\r\n                    if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n                }\r\n                else s |= 1;\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\r\n    if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\r\n        return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\r\n            return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\r\n        });\r\n    }\r\n    return path;\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __esDecorate: __esDecorate,\r\n    __runInitializers: __runInitializers,\r\n    __propKey: __propKey,\r\n    __setFunctionName: __setFunctionName,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n    __rewriteRelativeImportExtension: __rewriteRelativeImportExtension,\r\n};\r\n","import { ILeaferCanvas, IRenderOptions } from '@leafer/interface'\nimport { Platform, MatrixHelper, MathHelper, ImageManager } from '@leafer/core'\n\nimport { IUI, ILeafPaint, IMatrixData } from '@leafer-ui/interface'\nimport { PaintImage } from \"@leafer-ui/draw\"\n\n\nconst { get, scale, copy } = MatrixHelper\nconst { getFloorScale } = MathHelper, { abs } = Math\n\nexport function createPatternTask(paint: ILeafPaint, ui: IUI, canvas: ILeaferCanvas, renderOptions: IRenderOptions): void {\n    if (!paint.patternTask) {\n        paint.patternTask = ImageManager.patternTasker.add(async () => {\n            PaintImage.createPattern(paint, ui, canvas, renderOptions)\n            ui.forceUpdate('surface')\n        }, 0, () => {\n            paint.patternTask = null\n            return canvas.bounds.hit(ui.__nowWorld)\n        })\n    }\n}\n\nexport function createPattern(paint: ILeafPaint, ui: IUI, canvas: ILeaferCanvas, renderOptions: IRenderOptions): void {\n    let { scaleX, scaleY } = PaintImage.getImageRenderScaleData(paint, ui, canvas, renderOptions), id = scaleX + '-' + scaleY\n\n    if (paint.patternId !== id && !ui.destroyed) {\n        if (!(Platform.image.isLarge(paint.image, scaleX, scaleY) && !paint.data.repeat)) {\n\n            const { image, data } = paint, { transform, gap } = data, fixScale = PaintImage.getPatternFixScale(paint, scaleX, scaleY)\n            let imageMatrix: IMatrixData, xGap: number, yGap: number, { width, height } = image\n\n            if (fixScale) scaleX *= fixScale, scaleY *= fixScale\n\n            width *= scaleX\n            height *= scaleY\n\n            // 平铺间距\n            if (gap) {\n                xGap = gap.x * scaleX / abs(data.scaleX || 1)\n                yGap = gap.y * scaleY / abs(data.scaleY || 1)\n            }\n\n            if (transform || scaleX !== 1 || scaleY !== 1) {\n                scaleX *= getFloorScale(width + (xGap || 0)) // 缩放至floor画布宽高的状态\n                scaleY *= getFloorScale(height + (yGap || 0))\n\n                imageMatrix = get()\n                if (transform) copy(imageMatrix, transform)\n                scale(imageMatrix, 1 / scaleX, 1 / scaleY)\n            }\n\n            const imageCanvas = image.getCanvas(width, height, data.opacity, data.filters, xGap, yGap, ui.leafer && ui.leafer.config.smooth, data.interlace)\n            const pattern = image.getPattern(imageCanvas, data.repeat || (Platform.origin.noRepeat || 'no-repeat'), imageMatrix, paint)\n\n            paint.style = pattern\n            paint.patternId = id\n\n        }\n    }\n}\n\nexport function getPatternFixScale(paint: ILeafPaint, imageScaleX: number, imageScaleY: number): number {\n    const { image } = paint\n    let fixScale: number, maxSize = Platform.image.maxPatternSize, imageSize = image.width * image.height\n\n    if (image.isSVG) {\n        if (imageScaleX > 1) fixScale = Math.ceil(imageScaleX) / imageScaleX // fix: svg按整数倍放大，避免产生加深线条\n    } else {\n        if (maxSize > imageSize) maxSize = imageSize // 防止大于元素自身宽高\n    }\n\n    if ((imageSize *= imageScaleX * imageScaleY) > maxSize) fixScale = Math.sqrt(maxSize / imageSize)\n    return fixScale\n}","import { IPaintImageModule } from '@leafer-ui/interface'\n\nimport { image } from './image'\nimport { createData, getPatternData } from './data'\nimport { fillOrFitMode, clipMode, repeatMode, stretchMode } from './mode'\nimport { createPatternTask, createPattern, getPatternFixScale } from './pattern'\nimport { checkImage, drawImage, getImageRenderScaleData } from './check'\nimport { recycleImage } from './recycle'\n\n\nexport const PaintImageModule: IPaintImageModule = {\n    image,\n\n    checkImage,\n    drawImage,\n    getImageRenderScaleData,\n    recycleImage,\n\n    createPatternTask,\n    createPattern,\n    getPatternFixScale,\n\n    createData,\n    getPatternData,\n\n    stretchMode,\n    fillOrFitMode,\n    clipMode,\n    repeatMode\n}","import { ILeaferCanvas, IRenderOptions, IScaleData } from '@leafer/interface'\nimport { Platform, ResizeEvent } from '@leafer/core'\n\nimport { IUI, ILeafPaint, IImagePaint } from '@leafer-ui/interface'\nimport { PaintImage } from \"@leafer-ui/draw\"\n\n\nexport function checkImage(paint: ILeafPaint, drawImage: boolean, ui: IUI, canvas: ILeaferCanvas, renderOptions: IRenderOptions): boolean {\n    const { scaleX, scaleY } = PaintImage.getImageRenderScaleData(paint, ui, canvas, renderOptions)\n    const { image, data, originPaint } = paint, { exporting, snapshot } = renderOptions\n\n    if (!data || (paint.patternId === scaleX + '-' + scaleY && !exporting) || snapshot) {\n        return false // 生成图案中\n    } else {\n\n        if (drawImage) {\n            if (data.repeat) {\n                drawImage = false\n            } else if (!((originPaint as IImagePaint).changeful || (Platform.name === 'miniapp' && ResizeEvent.isResizing(ui)) || exporting)) { //  小程序resize过程中直接绘制原图（绕过垃圾回收bug)\n                drawImage = Platform.image.isLarge(image, scaleX, scaleY) || image.width * scaleX > 8096 || image.height * scaleY > 8096 // 大长图单边超过8096生成pattern会有问题\n            }\n        }\n\n        if (drawImage) {\n            if (ui.__.__isFastShadow) { // fix: 快速阴影时，直接 drawImage 会无阴影，需fill一下\n                canvas.fillStyle = paint.style || '#000'\n                canvas.fill()\n            }\n            PaintImage.drawImage(paint, scaleX, scaleY, ui, canvas, renderOptions) // 直接绘制图像，不生成图案\n            return true\n        } else {\n            if (!paint.style || (originPaint as IImagePaint).sync || exporting) PaintImage.createPattern(paint, ui, canvas, renderOptions)\n            else PaintImage.createPatternTask(paint, ui, canvas, renderOptions)\n            return false\n        }\n    }\n}\n\nexport function drawImage(paint: ILeafPaint, _imageScaleX: number, _imageScaleY: number, ui: IUI, canvas: ILeaferCanvas, _renderOptions: IRenderOptions): void {\n    const { data, image } = paint, { blendMode } = paint.originPaint as IImagePaint, { opacity, transform } = data, view = image.getFull(data.filters), u = ui.__\n    let { width, height } = image, clipUI: any\n\n    if ((clipUI = (transform && !transform.onlyScale) || u.path || u.cornerRadius) || opacity || blendMode) {\n        canvas.save()\n        clipUI && canvas.clipUI(ui)\n        blendMode && (canvas.blendMode = blendMode)\n        opacity && (canvas.opacity *= opacity)\n        transform && canvas.transform(transform)\n        canvas.drawImage(view, 0, 0, width, height) // svg need size\n        canvas.restore()\n    } else { // 简单矩形\n        if (data.scaleX) width *= data.scaleX, height *= data.scaleY\n        canvas.drawImage(view, 0, 0, width, height)\n    }\n\n}\n\nexport function getImageRenderScaleData(paint: ILeafPaint, ui: IUI, canvas?: ILeaferCanvas, _renderOptions?: IRenderOptions): IScaleData {\n    const scaleData = ui.getRenderScaleData(true, paint.originPaint.scaleFixed), { data } = paint\n    if (canvas) {\n        const { pixelRatio } = canvas\n        scaleData.scaleX *= pixelRatio\n        scaleData.scaleY *= pixelRatio\n    }\n    if (data && data.scaleX) {\n        scaleData.scaleX *= Math.abs(data.scaleX)\n        scaleData.scaleY *= Math.abs(data.scaleY)\n    }\n    return scaleData\n}","import { IBooleanMap, ILeaferImage, IObject } from '@leafer/interface'\nimport { ImageManager, isArray } from '@leafer/core'\n\nimport { IImagePaint, ILeafPaint, IPaintAttr, IUIData } from '@leafer-ui/interface'\n\n\nexport function recycleImage(attrName: IPaintAttr, data: IUIData): IBooleanMap {\n    const paints: ILeafPaint[] = (data as IObject)['_' + attrName]\n\n    if (isArray(paints)) {\n\n        let paint: ILeafPaint, image: ILeaferImage, recycleMap: IBooleanMap, input: IImagePaint[], url: string\n\n        for (let i = 0, len = paints.length; i < len; i++) {\n\n            paint = paints[i]\n            image = paint.image\n            url = image && image.url\n\n            if (url) {\n                if (!recycleMap) recycleMap = {}\n                recycleMap[url] = true\n                ImageManager.recyclePaint(paint)\n\n                // stop load\n                if (image.loading) {\n                    if (!input) {\n                        input = (data.__input && data.__input[attrName]) || []\n                        if (!isArray(input)) input = [input]\n                    }\n                    image.unload(paints[i].loadId, !input.some((item: IImagePaint) => item.url === url))\n                }\n            }\n\n        }\n\n        return recycleMap\n\n    }\n\n    return null\n}","import { IObject, IBoundsData, IPointData } from '@leafer/interface'\nimport { AroundHelper, Platform, isString } from '@leafer/core'\n\nimport { IGradientPaint, ILeafPaint, IColorStop, IColorString } from '@leafer-ui/interface'\nimport { ColorConvert } from '@leafer-ui/draw'\n\n\nconst { toPoint } = AroundHelper, { hasTransparent } = ColorConvert\nconst realFrom = {} as IPointData\nconst realTo = {} as IPointData\n\nexport function linearGradient(paint: IGradientPaint, box: IBoundsData): ILeafPaint {\n\n    let { from, to, type, opacity } = paint\n\n    toPoint(from || 'top', box, realFrom)\n    toPoint(to || 'bottom', box, realTo)\n\n    const style = Platform.canvas.createLinearGradient(realFrom.x, realFrom.y, realTo.x, realTo.y)\n    const data: ILeafPaint = { type, style }\n\n    applyStops(data, style, paint.stops, opacity)\n\n    return data\n\n}\n\nexport function applyStops(data: ILeafPaint, gradient: IObject, stops: IColorStop[] | IColorString[], opacity: number): void {\n    if (stops) {\n        let stop: IColorStop | string, color: string, offset: number, isTransparent: boolean\n        for (let i = 0, len = stops.length; i < len; i++) {\n            stop = stops[i]\n            if (isString(stop)) offset = i / (len - 1), color = ColorConvert.string(stop, opacity)\n            else offset = stop.offset, color = ColorConvert.string(stop.color, opacity)\n            gradient.addColorStop(offset, color)\n            if (!isTransparent && hasTransparent(color)) isTransparent = true\n        }\n        if (isTransparent) data.isTransparent = true\n    }\n}","import { IBoundsData } from '@leafer/interface'\nimport { Platform, PointHelper, MatrixHelper, AroundHelper } from '@leafer/core'\n\nimport { IGradientPaint, ILeafPaint, IMatrixData, IPointData } from '@leafer-ui/interface'\n\nimport { applyStops } from './linear'\n\n\nconst { getAngle, getDistance } = PointHelper\nconst { get, rotateOfOuter, scaleOfOuter } = MatrixHelper\n\nconst { toPoint } = AroundHelper\nconst realFrom = {} as IPointData\nconst realTo = {} as IPointData\n\nexport function radialGradient(paint: IGradientPaint, box: IBoundsData): ILeafPaint {\n\n    let { from, to, type, opacity, stretch } = paint\n\n    toPoint(from || 'center', box, realFrom)\n    toPoint(to || 'bottom', box, realTo)\n\n    const style = Platform.canvas.createRadialGradient(realFrom.x, realFrom.y, 0, realFrom.x, realFrom.y, getDistance(realFrom, realTo))\n    const data: ILeafPaint = { type, style }\n\n    applyStops(data, style, paint.stops, opacity)\n\n    const transform = getTransform(box, realFrom, realTo, stretch, true)\n    if (transform) data.transform = transform\n\n    return data\n\n}\n\nexport function getTransform(box: IBoundsData, from: IPointData, to: IPointData, stretch: number, rotate90: boolean): IMatrixData {\n    let transform: IMatrixData\n    const { width, height } = box\n\n    if (width !== height || stretch) {\n        const angle = getAngle(from, to)\n        transform = get()\n        if (rotate90) {\n            scaleOfOuter(transform, from, width / height * (stretch || 1), 1)\n            rotateOfOuter(transform, from, angle + 90)\n        } else {\n            scaleOfOuter(transform, from, 1, width / height * (stretch || 1))\n            rotateOfOuter(transform, from, angle)\n        }\n    }\n\n    return transform\n}","import { IPointData, IBoundsData } from '@leafer/interface'\nimport { Platform, PointHelper, AroundHelper } from '@leafer/core'\n\nimport { IGradientPaint, ILeafPaint } from '@leafer-ui/interface'\n\nimport { applyStops } from './linear'\nimport { getTransform } from './radial'\n\n\nconst { getDistance } = PointHelper\n\nconst { toPoint } = AroundHelper\nconst realFrom = {} as IPointData\nconst realTo = {} as IPointData\n\nexport function conicGradient(paint: IGradientPaint, box: IBoundsData): ILeafPaint {\n\n    let { from, to, type, opacity, stretch } = paint\n\n    toPoint(from || 'center', box, realFrom)\n    toPoint(to || 'bottom', box, realTo)\n\n    const style = Platform.conicGradientSupport ? Platform.canvas.createConicGradient(0, realFrom.x, realFrom.y) : Platform.canvas.createRadialGradient(realFrom.x, realFrom.y, 0, realFrom.x, realFrom.y, getDistance(realFrom, realTo))\n    const data: ILeafPaint = { type, style }\n\n    applyStops(data, style, paint.stops, opacity)\n\n    const transform = getTransform(box, realFrom, realTo, stretch || 1, Platform.conicGradientRotate90)\n    if (transform) data.transform = transform\n\n    return data\n\n}","import { IPaintGradientModule } from '@leafer-ui/interface'\n\nimport { linearGradient } from './linear'\nimport { radialGradient, getTransform } from './radial'\nimport { conicGradient } from './conic'\n\n\nexport const PaintGradientModule: IPaintGradientModule = {\n    linearGradient,\n    radialGradient,\n    conicGradient,\n    getTransform\n}","import { IBoundsData, IFourNumber, ILeaferCanvas, IMatrixData, IOffsetBoundsData } from '@leafer/interface'\nimport { BoundsHelper, LeafHelper, Matrix, Platform } from '@leafer/core'\n\nimport { IUI, ICachedShape, ILeafShadowEffect } from '@leafer-ui/interface'\nimport { ColorConvert, Effect } from '@leafer-ui/draw'\n\n\nconst { copy, move, toOffsetOutBounds } = BoundsHelper, { max, abs } = Math\nconst tempBounds = {} as IBoundsData, tempMatrix = new Matrix()\nconst offsetOutBounds = {} as IOffsetBoundsData\n\nexport function shadow(ui: IUI, current: ILeaferCanvas, shape: ICachedShape): void {\n\n    let copyBounds: IBoundsData, transform: IMatrixData\n\n    const { __nowWorld: nowWorld } = ui\n    const { shadow } = ui.__\n    const { worldCanvas, bounds, renderBounds, shapeBounds, scaleX, scaleY } = shape\n\n    const other = current.getSameCanvas()\n    const end = shadow.length - 1\n\n    toOffsetOutBounds(bounds, offsetOutBounds, renderBounds)\n\n    shadow.forEach((item, index) => {\n\n        let otherScale = 1 // 关联 scaleFixed 逻辑\n\n        if (item.scaleFixed) {\n            const sx = Math.abs(nowWorld.scaleX)\n            if (sx > 1) otherScale = 1 / sx\n        }\n\n        other.setWorldShadow((offsetOutBounds.offsetX + (item.x || 0) * scaleX * otherScale), (offsetOutBounds.offsetY + (item.y || 0) * scaleY * otherScale), (item.blur || 0) * scaleX * otherScale, ColorConvert.string(item.color))\n\n        transform = Effect.getShadowTransform(ui, other, shape, item, offsetOutBounds, otherScale)\n        if (transform) other.setTransform(transform)\n\n        drawWorldShadow(other, offsetOutBounds, shape)\n\n        if (transform) other.resetTransform()\n\n        copyBounds = renderBounds\n\n        if (item.box) {\n\n            other.restore() // remove shadow style\n            other.save()\n\n            if (worldCanvas) {\n                other.copyWorld(other, renderBounds, nowWorld, 'copy')\n                copyBounds = nowWorld\n            }\n\n            worldCanvas ? other.copyWorld(worldCanvas, nowWorld, nowWorld, 'destination-out') : other.copyWorld(shape.canvas, shapeBounds, bounds, 'destination-out')\n        }\n\n        LeafHelper.copyCanvasByWorld(ui, current, other, copyBounds, item.blendMode)\n\n        if (end && index < end) other.clearWorld(copyBounds)\n    })\n\n    other.recycle(copyBounds)\n\n}\n\nexport function getShadowRenderSpread(_ui: IUI, shadow: ILeafShadowEffect[]): IFourNumber {\n    let top = 0, right = 0, bottom = 0, left = 0, x: number, y: number, spread: number, blur: number\n    shadow.forEach(item => {\n        x = item.x || 0, y = item.y || 0, blur = (item.blur || 0) * 1.5, spread = abs(item.spread || 0) // must abs spread\n\n        top = max(top, spread + blur - y)\n        right = max(right, spread + blur + x)\n        bottom = max(bottom, spread + blur + y)\n        left = max(left, spread + blur - x)\n    })\n    return (top === right && right === bottom && bottom === left) ? top : [top, right, bottom, left]\n}\n\nexport function getShadowTransform(ui: IUI, canvas: ILeaferCanvas, _shape: ICachedShape, shadow: ILeafShadowEffect, outBounds: IBoundsData, otherScale: number, isInnerShaodw?: boolean): IMatrixData {\n    if (shadow.spread) {\n        const spread = shadow.spread * 2 * otherScale * (isInnerShaodw ? -1 : 1), { width, height } = ui.__layout.strokeBounds\n        tempMatrix.set().scaleOfOuter({ x: (outBounds.x + outBounds.width / 2) * canvas.pixelRatio, y: (outBounds.y + outBounds.height / 2) * canvas.pixelRatio }, 1 + spread / width, 1 + spread / height)\n        return tempMatrix\n    }\n    return undefined\n}\n\nexport function drawWorldShadow(canvas: ILeaferCanvas, outBounds: IBoundsData, shape: ICachedShape): void {\n    const { shapeBounds } = shape\n    let from: IBoundsData, to: IBoundsData\n\n    if (Platform.fullImageShadow) { // Safari\n        copy(tempBounds, canvas.bounds)\n        move(tempBounds, outBounds.x - shapeBounds.x, outBounds.y - shapeBounds.y)\n        from = canvas.bounds, to = tempBounds\n    } else {\n        from = shapeBounds, to = outBounds\n    }\n\n    canvas.copyWorld(shape.canvas, from, to)\n}","import { IBoundsData, IMatrixData, ILeaferCanvas, IOffsetBoundsData } from '@leafer/interface'\nimport { BoundsHelper, LeafHelper } from '@leafer/core'\n\nimport { IUI, ICachedShape } from '@leafer-ui/interface'\nimport { ColorConvert, Effect } from '@leafer-ui/draw'\n\nimport { drawWorldShadow, getShadowRenderSpread } from './Shadow'\n\n\nconst { toOffsetOutBounds } = BoundsHelper\nconst offsetOutBounds = {} as IOffsetBoundsData\n\nexport function innerShadow(ui: IUI, current: ILeaferCanvas, shape: ICachedShape): void {\n\n    let copyBounds: IBoundsData, transform: IMatrixData\n\n    const { __nowWorld: nowWorld } = ui\n    const { innerShadow } = ui.__\n    const { worldCanvas, bounds, renderBounds, shapeBounds, scaleX, scaleY } = shape\n\n    const other = current.getSameCanvas()\n    const end = innerShadow.length - 1\n\n    toOffsetOutBounds(bounds, offsetOutBounds, renderBounds)\n\n    innerShadow.forEach((item, index) => {\n\n        let otherScale = 1 // 关联 scaleFixed 逻辑\n\n        if (item.scaleFixed) {\n            const sx = Math.abs(nowWorld.scaleX)\n            if (sx > 1) otherScale = 1 / sx\n        }\n\n        other.save()\n\n        other.setWorldShadow((offsetOutBounds.offsetX + (item.x || 0) * scaleX * otherScale), (offsetOutBounds.offsetY + (item.y || 0) * scaleY * otherScale), (item.blur || 0) * scaleX * otherScale)\n\n        transform = Effect.getShadowTransform(ui, other, shape, item, offsetOutBounds, otherScale, true)\n        if (transform) other.setTransform(transform)\n\n        drawWorldShadow(other, offsetOutBounds, shape)\n\n        other.restore()\n\n        if (worldCanvas) {\n            other.copyWorld(other, renderBounds, nowWorld, 'copy')\n            other.copyWorld(worldCanvas, nowWorld, nowWorld, 'source-out')\n            copyBounds = nowWorld\n        } else {\n            other.copyWorld(shape.canvas, shapeBounds, bounds, 'source-out')\n            copyBounds = renderBounds\n        }\n\n        other.fillWorld(copyBounds, ColorConvert.string(item.color), 'source-in')\n\n        LeafHelper.copyCanvasByWorld(ui, current, other, copyBounds, item.blendMode)\n\n        if (end && index < end) other.clearWorld(copyBounds)\n\n    })\n\n    other.recycle(copyBounds)\n\n}\n\nexport const getInnerShadowSpread = getShadowRenderSpread","import { IEffectModule, ILeafShadowEffect } from '@leafer-ui/interface'\n\nimport { shadow, getShadowRenderSpread, getShadowTransform } from './Shadow'\nimport { innerShadow, getInnerShadowSpread } from './InnerShadow'\nimport { blur } from './Blur'\nimport { backgroundBlur } from './BackgroundBlur'\n\n\nexport const EffectModule: IEffectModule = {\n    shadow,\n    innerShadow,\n    blur,\n    backgroundBlur,\n\n    // @leafer-in/shadow will rewrite\n    getShadowRenderSpread,\n    getShadowTransform,\n    isTransformShadow(_shadow: ILeafShadowEffect): boolean { return undefined },\n\n    getInnerShadowSpread\n}","import { ILeaferCanvas } from '@leafer/interface'\n\nimport { IUI } from '@leafer-ui/interface'\n\nexport function blur(ui: IUI, current: ILeaferCanvas, origin: ILeaferCanvas): void {\n    const { blur } = ui.__\n    origin.setWorldBlur(blur * ui.__nowWorld.a)\n    origin.copyWorldToInner(current, ui.__nowWorld, ui.__layout.renderBounds)\n    origin.filter = 'none'\n}\n","import { ILeaferCanvas } from '@leafer/interface'\nimport { IUI, ICachedShape } from '@leafer-ui/interface'\n\nexport function backgroundBlur(_ui: IUI, _current: ILeaferCanvas, _shape: ICachedShape): void {\n\n}","import { IBlendMode, ILeaf, ILeaferCanvas, IMaskType, IRenderOptions } from '@leafer/interface'\nimport { LeafBoundsHelper } from '@leafer/core'\n\nimport { Group } from '@leafer-ui/draw'\n\n\ntype IMaskMode = 'path' | 'alpha' | 'grayscale' | 'opacity-path'\nconst { excludeRenderBounds } = LeafBoundsHelper\nlet usedGrayscaleAlpha: boolean\n\nGroup.prototype.__renderMask = function (canvas: ILeaferCanvas, options: IRenderOptions): void {\n\n    let child: ILeaf, maskCanvas: ILeaferCanvas, contentCanvas: ILeaferCanvas, maskOpacity: number, currentMask: IMaskMode, mask: boolean | IMaskType\n    const { children } = this\n\n    for (let i = 0, len = children.length; i < len; i++) {\n        child = children[i], mask = child.__.mask\n\n        if (mask) {\n\n            if (currentMask) {\n                maskEnd(this, currentMask, canvas, contentCanvas, maskCanvas, maskOpacity, undefined, true)\n                maskCanvas = contentCanvas = null\n            }\n\n            // mask start\n\n            if (mask === 'clipping' || mask === 'clipping-path') excludeRenderBounds(child, options) || child.__render(canvas, options) // 剪贴蒙版，需要渲染自身到原画布中，如果应用遮罩会造成透明度减半。clipping-path 支持渲染外描边。\n\n            maskOpacity = child.__.opacity\n            usedGrayscaleAlpha = false\n\n            if (mask === 'path' || mask === 'clipping-path') {\n\n                if (maskOpacity < 1) {\n\n                    currentMask = 'opacity-path'\n                    if (!contentCanvas) contentCanvas = getCanvas(canvas)\n\n                } else {\n                    currentMask = 'path'\n                    canvas.save()\n                }\n\n                child.__clip(contentCanvas || canvas, options)\n\n            } else { // pixel\n\n                currentMask = mask === 'grayscale' ? 'grayscale' : 'alpha'\n                if (!maskCanvas) maskCanvas = getCanvas(canvas)\n                if (!contentCanvas) contentCanvas = getCanvas(canvas)\n                child.__render(maskCanvas, options)\n\n            }\n\n            continue\n        }\n\n        const childBlendMode = maskOpacity === 1 && child.__.__blendMode\n\n        // 元素存在混合模式，将先前的内容绘制到原画布\n        if (childBlendMode) maskEnd(this, currentMask, canvas, contentCanvas, maskCanvas, maskOpacity, undefined, false)\n\n        excludeRenderBounds(child, options) || child.__render(contentCanvas || canvas, options)\n\n        // 元素存在混合模式，应用遮罩后直接与原画布混合\n        if (childBlendMode) maskEnd(this, currentMask, canvas, contentCanvas, maskCanvas, maskOpacity, childBlendMode as IBlendMode, false)\n\n    }\n\n    maskEnd(this, currentMask, canvas, contentCanvas, maskCanvas, maskOpacity, undefined, true)\n\n}\n\n\nfunction maskEnd(leaf: ILeaf, maskMode: IMaskMode, canvas: ILeaferCanvas, contentCanvas: ILeaferCanvas, maskCanvas: ILeaferCanvas, maskOpacity: number, blendMode: IBlendMode, recycle: boolean): void {\n    switch (maskMode) {\n        case 'grayscale':\n            if (!usedGrayscaleAlpha) usedGrayscaleAlpha = true, maskCanvas.useGrayscaleAlpha(leaf.__nowWorld)\n        case 'alpha':\n            usePixelMask(leaf, canvas, contentCanvas, maskCanvas, blendMode, recycle); break\n        case 'opacity-path':\n            copyContent(leaf, canvas, contentCanvas, maskOpacity, blendMode, recycle); break\n        case 'path':\n            if (recycle) canvas.restore()\n    }\n}\n\n\nfunction getCanvas(canvas: ILeaferCanvas): ILeaferCanvas {\n    return canvas.getSameCanvas(false, true)\n}\n\n\nfunction usePixelMask(leaf: ILeaf, canvas: ILeaferCanvas, content: ILeaferCanvas, mask: ILeaferCanvas, blendMode: IBlendMode, recycle: boolean): void {\n    const realBounds = leaf.__nowWorld\n    content.resetTransform()\n    content.opacity = 1\n    content.useMask(mask, realBounds)\n    if (recycle) mask.recycle(realBounds)\n\n    copyContent(leaf, canvas, content, 1, blendMode, recycle)\n}\n\n\nfunction copyContent(leaf: ILeaf, canvas: ILeaferCanvas, content: ILeaferCanvas, maskOpacity: number, blendMode: IBlendMode, recycle: boolean): void {\n    const realBounds = leaf.__nowWorld\n\n    canvas.resetTransform()\n    canvas.opacity = maskOpacity\n    canvas.copyWorld(content, realBounds, undefined, blendMode)\n\n    recycle ? content.recycle(realBounds) : content.clearWorld(realBounds)\n}","import { IBooleanMap } from '@leafer-ui/interface'\n\nconst money = '¥￥＄€£￡¢￠'\nconst letter = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz'\n\nconst langBefore = '《（「〈『〖【〔｛┌＜‘“＝' + money\nconst langAfter = '》）」〉』〗】〕｝┐＞’”！？，、。：；‰'\nconst langSymbol = '≮≯≈≠＝…'\nconst langBreak = '—／～｜┆·'\n\nconst beforeChar = '{[(<\\'\"' + langBefore\nconst afterChar = '>)]}%!?,.:;\\'\"' + langAfter\nconst symbolChar = afterChar + '_#~&*+\\\\=|' + langSymbol\nconst breakChar = '- ' + langBreak\n\nconst cjkRangeList = [\n    [0x4E00, 0x9FFF], // CJK Unified Ideographs\n    [0x3400, 0x4DBF], // CJK Unified Ideographs Extension A\n    [0x20000, 0x2A6DF], // CJK Unified Ideographs Extension B\n    [0x2A700, 0x2B73F], // CJK Unified Ideographs Extension C\n    [0x2B740, 0x2B81F], // CJK Unified Ideographs Extension D\n    [0x2B820, 0x2CEAF], // CJK Unified Ideographs Extension E\n    [0x2CEB0, 0x2EBEF], // CJK Unified Ideographs Extension F\n    [0x30000, 0x3134F], // CJK Unified Ideographs Extension G\n    [0x31350, 0x323AF], // CJK Unified Ideographs Extension H\n    [0x2E80, 0x2EFF], // CJK Radicals Supplement\n    [0x2F00, 0x2FDF], // Kangxi Radicals\n    [0x2FF0, 0x2FFF], // Ideographic Description Characters\n    [0x3000, 0x303F], // CJK Symbols and Punctuation\n    [0x31C0, 0x31EF], // CJK Strokes\n    [0x3200, 0x32FF], // Enclosed CJK Letters and Months\n    [0x3300, 0x33FF], // CJK Compatibility\n    [0xF900, 0xFAFF], // CJK Compatibility Ideographs\n    [0xFE30, 0xFE4F], // CJK Compatibility Forms\n    [0x1F200, 0x1F2FF], // Enclosed Ideographic Supplement\n    [0x2F800, 0x2FA1F], // CJK Compatibility Ideographs Supplement\n]\n\nconst cjkReg = new RegExp(cjkRangeList.map(([start, end]) => `[\\\\u${start.toString(16)}-\\\\u${end.toString(16)}]`).join('|'))\n\nfunction mapChar(str: string): IBooleanMap {\n    const map: IBooleanMap = {}\n    str.split('').forEach(char => map[char] = true)\n    return map\n}\n\nconst letterMap = mapChar(letter)\nconst beforeMap = mapChar(beforeChar)\nconst afterMap = mapChar(afterChar)\nconst symbolMap = mapChar(symbolChar)\nconst breakMap = mapChar(breakChar)\n\nexport enum CharType {\n    Letter, // en... number\n    Single, // cjk\n    Before, // (\n    After, // )\n    Symbol, // *\n    Break, // space\n}\n\nconst { Letter, Single, Before, After, Symbol, Break } = CharType\n\nexport function getCharType(char: string): CharType {\n\n    if (letterMap[char]) {\n        return Letter\n    } else if (breakMap[char]) {\n        return Break\n    } else if (beforeMap[char]) {\n        return Before\n    } else if (afterMap[char]) {\n        return After\n    } else if (symbolMap[char]) {\n        return Symbol\n    } else if (cjkReg.test(char)) {\n        return Single\n    } else {\n        return Letter\n    }\n\n}\n","import { ITextRowData, ITextCharData } from '@leafer-ui/interface'\n\n\nexport const TextRowHelper = {\n\n    trimRight(row: ITextRowData): void {\n        const { words } = row\n        let trimRight = 0, len = words.length, char: ITextCharData\n\n        for (let i = len - 1; i > -1; i--) {\n            char = words[i].data[0]\n            if (char.char === ' ') {\n                trimRight++\n                row.width -= char.width\n            } else {\n                break\n            }\n        }\n\n        if (trimRight) words.splice(len - trimRight, trimRight)\n    }\n\n}","import { ITextCase } from '@leafer-ui/interface'\n\nexport function getTextCase(char: string, textCase: ITextCase, firstChar?: boolean): string {\n    switch (textCase) {\n        case 'title':\n            return firstChar ? char.toUpperCase() : char\n        case 'upper':\n            return char.toUpperCase()\n        case 'lower':\n            return char.toLowerCase()\n        default:\n            return char\n    }\n}","import { Platform } from '@leafer/core'\n\nimport { IBoundsData, ITextData, ITextDrawData, ITextRowData, ITextWordData } from '@leafer-ui/interface'\n\nimport { CharType, getCharType } from './CharType'\nimport { TextRowHelper } from './TextRowHelper'\nimport { getTextCase } from './TextCase'\n\n\nconst { trimRight } = TextRowHelper\nconst { Letter, Single, Before, After, Symbol, Break } = CharType\n\nlet word: ITextWordData, row: ITextRowData, wordWidth: number, rowWidth: number, realWidth: number\nlet char: string, charWidth: number, startCharSize: number, charSize: number, charType: CharType, lastCharType: CharType, langBreak: boolean, afterBreak: boolean, paraStart: boolean\nlet textDrawData: ITextDrawData, rows: ITextRowData[] = [], bounds: IBoundsData, findMaxWidth: boolean\n\nexport function createRows(drawData: ITextDrawData, content: string, style: ITextData): void {\n\n    textDrawData = drawData\n    rows = drawData.rows\n    bounds = drawData.bounds\n    findMaxWidth = !bounds.width && !style.autoSizeAlign\n\n    const { __letterSpacing, paraIndent, textCase } = style\n    const { canvas } = Platform, { width } = bounds\n\n    if (style.__isCharMode) {\n\n        const wrap = style.textWrap !== 'none'\n        const breakAll = style.textWrap === 'break'\n\n        paraStart = true\n        lastCharType = null\n        startCharSize = charWidth = charSize = wordWidth = rowWidth = 0\n        word = { data: [] }, row = { words: [] }\n\n        if (__letterSpacing) content = [...content] as any // 防止切分表情等多个字符组成的字符，转成数组字符是最安全的\n\n        for (let i = 0, len = content.length; i < len; i++) {\n\n            char = content[i]\n\n            if (char === '\\n') {\n\n                if (wordWidth) addWord()\n                row.paraEnd = true\n                addRow()\n\n                paraStart = true\n\n            } else {\n\n                charType = getCharType(char)\n\n                if (charType === Letter && textCase !== 'none') char = getTextCase(char, textCase, !wordWidth)\n\n                charWidth = canvas.measureText(char).width\n                if (__letterSpacing) {\n                    if (__letterSpacing < 0) charSize = charWidth\n                    charWidth += __letterSpacing\n                }\n\n                langBreak = (charType === Single && (lastCharType === Single || lastCharType === Letter)) || (lastCharType === Single && charType !== After) // break  U字 文字 or 字U  字（  字*  exclude 字。\n                afterBreak = ((charType === Before || charType === Single) && (lastCharType === Symbol || lastCharType === After)) // split >(  =文 。哈  ;文\n\n                realWidth = paraStart && paraIndent ? width - paraIndent : width\n\n                if (wrap && (width && rowWidth + wordWidth + charWidth > realWidth)) { // wrap\n\n                    if (breakAll) {\n\n                        if (wordWidth) addWord() // break\n                        if (rowWidth) addRow()\n\n                    } else {\n                        if (!afterBreak) afterBreak = charType === Letter && lastCharType == After // split ，S  \n\n                        if (langBreak || afterBreak || charType === Break || charType === Before || charType === Single || (wordWidth + charWidth > realWidth)) {\n\n                            if (wordWidth) addWord() // break\n                            if (rowWidth) addRow()\n\n                        } else {\n\n                            if (rowWidth) addRow()\n                        }\n                    }\n\n                }\n\n                if (char === ' ' && paraStart !== true && (rowWidth + wordWidth) === 0) {\n\n                    // trim space\n\n                } else {\n\n                    if (charType === Break) {\n\n                        if (char === ' ' && wordWidth) addWord()\n                        addChar(char, charWidth)\n                        addWord()\n\n                    } else if (langBreak || afterBreak) {\n\n                        if (wordWidth) addWord()\n                        addChar(char, charWidth)\n\n                    } else {\n\n                        addChar(char, charWidth)\n\n                    }\n                }\n\n                lastCharType = charType\n\n            }\n\n        }\n\n        if (wordWidth) addWord()\n        if (rowWidth) addRow()\n\n        rows.length > 0 && (rows[rows.length - 1].paraEnd = true)\n\n    } else {\n\n        content.split('\\n').forEach(content => {\n            textDrawData.paraNumber++\n            rowWidth = canvas.measureText(content).width\n            rows.push({ x: paraIndent || 0, text: content, width: rowWidth, paraStart: true })\n            if (findMaxWidth) setMaxWidth()\n        })\n\n    }\n}\n\n\nfunction addChar(char: string, width: number): void {\n    if (charSize && !startCharSize) startCharSize = charSize\n    word.data.push({ char, width })\n    wordWidth += width\n}\n\nfunction addWord(): void {\n    rowWidth += wordWidth\n    word.width = wordWidth\n    row.words.push(word)\n    word = { data: [] }\n    wordWidth = 0\n}\n\nfunction addRow(): void {\n    if (paraStart) {\n        textDrawData.paraNumber++\n        row.paraStart = true\n        paraStart = false\n    }\n\n    if (charSize) { // letterSpacing < 0, like -20% -100%\n        row.startCharSize = startCharSize\n        row.endCharSize = charSize\n        startCharSize = 0\n    }\n\n    row.width = rowWidth\n    if (bounds.width) trimRight(row)\n    else if (findMaxWidth) setMaxWidth()\n    rows.push(row)\n    row = { words: [] }\n    rowWidth = 0\n}\n\nfunction setMaxWidth(): void {\n    if (rowWidth > (textDrawData.maxWidth || 0)) textDrawData.maxWidth = rowWidth\n}\n","import { Platform, Direction4, isString } from '@leafer/core'\n\nimport { ITextData, ITextDrawData } from '@leafer-ui/interface'\n\nimport { createRows } from './TextRows'\nimport { layoutChar } from './CharLayout'\nimport { layoutText } from './TextLayout'\nimport { clipText } from './TextClip'\nimport { decorationText } from './TextDecoration'\n\n\nconst { top, right, bottom, left } = Direction4\n\nexport function getDrawData(content: string | number, style: ITextData): ITextDrawData {\n\n    if (!isString(content)) content = String(content)\n\n    let x = 0, y = 0\n\n    let width = style.__getInput('width') || 0\n    let height = style.__getInput('height') || 0\n\n    const { __padding: padding } = style\n\n    if (padding) {\n        if (width) x = padding[left], width -= (padding[right] + padding[left]), !width && (width = 0.01) // 防止变为自动宽度\n        else if (!style.autoSizeAlign) x = padding[left]\n\n        if (height) y = padding[top], height -= (padding[top] + padding[bottom]), !height && (height = 0.01)\n        else if (!style.autoSizeAlign) y = padding[top]\n    }\n\n    const drawData: ITextDrawData = {\n        bounds: { x, y, width, height },\n        rows: [],\n        paraNumber: 0,\n        font: Platform.canvas.font = style.__font\n    }\n\n    createRows(drawData, content, style) // set rows, paraNumber\n\n    if (padding) padAutoText(padding, drawData, style, width, height)\n\n    layoutText(drawData, style) // set bounds\n\n    if (style.__isCharMode) layoutChar(drawData, style, width, height) // set char.x\n\n    if (drawData.overflow) clipText(drawData, style, x, width)\n\n    if (style.textDecoration !== 'none') decorationText(drawData, style)\n\n    return drawData\n\n}\n\n\nfunction padAutoText(padding: number[], drawData: ITextDrawData, style: ITextData, width: number, height: number): void {\n    if (!width && style.autoSizeAlign) {\n        switch (style.textAlign) {\n            case 'left': offsetText(drawData, 'x', padding[left]); break\n            case 'right': offsetText(drawData, 'x', -padding[right])\n        }\n    }\n\n    if (!height && style.autoSizeAlign) {\n        switch (style.verticalAlign) {\n            case 'top': offsetText(drawData, 'y', padding[top]); break\n            case 'bottom': offsetText(drawData, 'y', -padding[bottom])\n        }\n    }\n}\n\n\nfunction offsetText(drawData: ITextDrawData, attrName: 'x' | 'y', value: number): void {\n    const { bounds, rows } = drawData\n    bounds[attrName] += value\n    for (let i = 0; i < rows.length; i++) rows[i][attrName] += value\n}","import { ITextConvertModule } from '@leafer-ui/interface'\n\nimport { getDrawData } from './TextConvert'\n\nexport const TextConvertModule: ITextConvertModule = {\n    getDrawData\n}","import { ITextData, ITextDrawData, ITextRowData } from '@leafer-ui/interface'\n\n\nexport function layoutText(drawData: ITextDrawData, style: ITextData): void {\n\n    const { rows, bounds } = drawData, countRows = rows.length\n    const { __lineHeight, __baseLine, __letterSpacing, __clipText, textAlign, verticalAlign, paraSpacing, autoSizeAlign } = style\n\n    let { x, y, width, height } = bounds, realHeight = __lineHeight * countRows + (paraSpacing ? paraSpacing * (drawData.paraNumber - 1) : 0)\n    let starY: number = __baseLine\n\n    // verticalAlign\n\n    if (__clipText && realHeight > height) {\n        realHeight = Math.max(height, __lineHeight)\n        if (countRows > 1) drawData.overflow = countRows\n    } else if (height || autoSizeAlign) {\n        switch (verticalAlign) {\n            case 'middle': y += (height - realHeight) / 2; break\n            case 'bottom': y += (height - realHeight)\n        }\n    }\n    starY += y\n\n    // textAlign\n\n    let row: ITextRowData, rowX: number, rowWidth: number, layoutWidth = (width || autoSizeAlign) ? width : drawData.maxWidth\n\n    for (let i = 0, len = countRows; i < len; i++) {\n        row = rows[i]\n        row.x = x\n\n        if (row.width < width || (row.width > width && !__clipText)) {\n            switch (textAlign) {\n                case 'center': row.x += (layoutWidth - row.width) / 2; break\n                case 'right': row.x += layoutWidth - row.width\n            }\n        }\n\n        if (row.paraStart && paraSpacing && i > 0) starY += paraSpacing\n\n        row.y = starY\n\n        starY += __lineHeight\n\n        if (drawData.overflow > i && starY > realHeight) {\n            row.isOverflow = true\n            drawData.overflow = i + 1\n        }\n\n        rowX = row.x\n        rowWidth = row.width\n\n        if (__letterSpacing < 0) { // letterSpacing < 0, like -20% -100%\n            if (row.width < 0) {\n                rowWidth = -row.width + style.fontSize + __letterSpacing\n                rowX -= rowWidth\n                rowWidth += style.fontSize\n            } else {\n                rowWidth -= __letterSpacing\n            }\n        }\n\n        if (rowX < bounds.x) bounds.x = rowX\n        if (rowWidth > bounds.width) bounds.width = rowWidth\n\n        // clip nowrap\n        if (__clipText && width && width < rowWidth) {\n            row.isOverflow = true\n            if (!drawData.overflow) drawData.overflow = rows.length\n        }\n    }\n\n    bounds.y = y\n    bounds.height = realHeight\n\n}","import { ITextCharData, ITextData, ITextDrawData, ITextRowData } from '@leafer-ui/interface'\n\n\nconst CharMode = 0 // data: [{char:'a', x: 0}, {char:'b', x: 5}, {char:'d', x:20}]\nconst WordMode = 1 // data: [{ char:'ab', x: 0}, { char:'d', x:20}]\nconst TextMode = 2 // text: 'ab  c'\n\nexport function layoutChar(drawData: ITextDrawData, style: ITextData, width: number, _height: number): void {\n\n    const { rows } = drawData\n    const { textAlign, paraIndent, __letterSpacing } = style\n\n    const justifyLast = width && textAlign.includes('both')  // 最后一行是否两端对齐\n    const justify = justifyLast || (width && textAlign.includes('justify')) // 是否两端对齐文本\n    const justifyLetter = justify && textAlign.includes('letter') // 英文是否通过加大字符间距两端对齐\n\n    let charX: number, remainingWidth: number, addWordWidth: number, addLetterWidth: number, indentWidth: number, mode: number, wordChar: ITextCharData, wordsLength: number, isLastWord: boolean, canJustify: boolean\n\n    rows.forEach(row => {\n        if (row.words) {\n\n            indentWidth = paraIndent && row.paraStart ? paraIndent : 0, wordsLength = row.words.length\n            if (justify) {\n                canJustify = !row.paraEnd || justifyLast\n                remainingWidth = width - row.width - indentWidth\n                if (justifyLetter) addLetterWidth = remainingWidth / (row.words.reduce((total, item) => total + item.data.length, 0) - 1) //  remainingWidth / （lettersLength - 1）\n                else addWordWidth = wordsLength > 1 ? remainingWidth / (wordsLength - 1) : 0\n            }\n            mode = (__letterSpacing || row.isOverflow || justifyLetter) ? CharMode : (addWordWidth ? WordMode : TextMode)\n            if (row.isOverflow && !__letterSpacing) row.textMode = true\n\n            if (mode === TextMode) {\n\n                row.x += indentWidth\n                toTextChar(row)\n\n            } else {\n\n                row.x += indentWidth\n                charX = row.x\n                row.data = []\n\n                row.words.forEach((word, index) => {\n\n                    if (mode === WordMode) {\n\n                        wordChar = { char: '', x: charX }\n                        charX = toWordChar(word.data, charX, wordChar)\n                        if (row.isOverflow || wordChar.char !== ' ') row.data.push(wordChar)\n\n                    } else {\n\n                        charX = toChar(word.data, charX, row.data, row.isOverflow, canJustify && addLetterWidth)\n\n                    }\n\n                    if (canJustify) {\n                        isLastWord = index === wordsLength - 1\n\n                        if (addWordWidth) {\n                            if (!isLastWord) charX += addWordWidth, row.width += addWordWidth\n                        } else if (addLetterWidth) {\n                            row.width += addLetterWidth * (word.data.length - (isLastWord ? 1 : 0))\n                        }\n                    }\n\n                })\n            }\n\n            row.words = null\n        }\n    })\n\n}\n\nfunction toTextChar(row: ITextRowData): void {\n    row.text = ''\n    row.words.forEach(word => {\n        word.data.forEach(char => {\n            row.text += char.char\n        })\n    })\n}\n\nfunction toWordChar(data: ITextCharData[], charX: number, wordChar: ITextCharData): number {\n    data.forEach(char => {\n        wordChar.char += char.char\n        charX += char.width\n    })\n    return charX\n}\n\nfunction toChar(data: ITextCharData[], charX: number, rowData: ITextCharData[], isOverflow?: boolean, addLetterWidth?: number): number {\n    data.forEach(char => {\n        if (isOverflow || char.char !== ' ') {\n            char.x = charX\n            rowData.push(char)\n        }\n        charX += char.width\n        addLetterWidth && (charX += addLetterWidth)\n    })\n    return charX\n}","import { Platform } from '@leafer/core'\n\nimport { ITextCharData, ITextData, ITextDrawData, ITextRowData } from '@leafer-ui/interface'\n\n\nexport function clipText(drawData: ITextDrawData, style: ITextData, x: number, width: number): void {\n    if (!width) return\n\n    const { rows, overflow } = drawData\n    let { textOverflow } = style\n    rows.splice(overflow)\n\n    if (textOverflow && textOverflow !== 'show') {\n        if (textOverflow === 'hide') textOverflow = ''\n        else if (textOverflow === 'ellipsis') textOverflow = '...'\n\n        let char: ITextCharData, charRight: number\n        const ellipsisWidth = textOverflow ? Platform.canvas.measureText(textOverflow).width : 0\n        const right = x + width - ellipsisWidth\n        const list = style.textWrap === 'none' ? rows : [rows[overflow - 1]]\n\n        list.forEach(row => {\n\n            if (row.isOverflow && row.data) {\n\n                let end = row.data.length - 1\n\n                for (let i = end; i > -1; i--) {\n                    char = row.data[i]\n                    charRight = char.x + char.width\n                    if (i === end && charRight < right) {\n                        break\n                    } else if ((charRight < right && char.char !== ' ') || !i) { // 至少保留一个文字\n                        row.data.splice(i + 1)\n                        row.width -= char.width\n                        break\n                    }\n                    row.width -= char.width\n                }\n\n                row.width += ellipsisWidth\n                row.data.push({ char: textOverflow, x: charRight })\n\n                if (row.textMode) toTextChar(row)\n            }\n\n\n        })\n\n    }\n\n}\n\nfunction toTextChar(row: ITextRowData): void {\n    row.text = ''\n    row.data.forEach(char => {\n        row.text += char.char\n    })\n    row.data = null\n}","import { isObject } from '@leafer/core'\n\nimport { ITextData, ITextDecorationType, ITextDrawData } from '@leafer-ui/interface'\nimport { ColorConvert } from '@leafer-ui/draw'\n\n\nexport function decorationText(drawData: ITextDrawData, style: ITextData): void {\n    let type: ITextDecorationType, offset = 0\n    const { fontSize, textDecoration } = style\n    drawData.decorationHeight = fontSize / 11\n    if (isObject(textDecoration)) {\n        type = textDecoration.type\n        if (textDecoration.color) drawData.decorationColor = ColorConvert.string(textDecoration.color)\n        if (textDecoration.offset) offset = Math.min(fontSize * 0.3, Math.max(textDecoration.offset, -fontSize * 0.15))\n    } else type = textDecoration\n    switch (type) {\n        case 'under':\n            drawData.decorationY = [fontSize * 0.15 + offset]\n            break\n        case 'delete':\n            drawData.decorationY = [-fontSize * 0.35]\n            break\n        case 'under-delete':\n            drawData.decorationY = [fontSize * 0.15 + offset, -fontSize * 0.35]\n    }\n}","import { IColorConvertModule } from '@leafer-ui/interface'\n\nimport { string } from './color'\n\n\nexport const ColorConvertModule = {\n    string\n} as IColorConvertModule","import { isString, isNumber, isUndefined } from '@leafer/core'\n\nimport { IColor } from '@leafer-ui/interface'\nimport { ColorConvert } from '@leafer-ui/draw'\n\n\nexport function string(color: IColor, opacity?: number): string {\n    if (!color) return '#000'\n    const doOpacity = isNumber(opacity) && opacity < 1\n    if (isString(color)) {\n        if (doOpacity && ColorConvert.object) color = ColorConvert.object(color)\n        else return color\n    }\n    let a = isUndefined(color.a) ? 1 : color.a\n    if (doOpacity) a *= opacity\n    const rgb = color.r + ',' + color.g + ',' + color.b\n    return a === 1 ? 'rgb(' + rgb + ')' : 'rgba(' + rgb + ',' + a + ')'\n}","// leaferui's partner, allow replace\nimport { Paint, PaintImage, PaintGradient, Effect, TextConvert, ColorConvert } from '@leafer-ui/draw'\n\nimport { PaintModule } from '@leafer-ui/paint'\nimport { PaintImageModule } from '@leafer-ui/image'\nimport { PaintGradientModule } from '@leafer-ui/gradient'\nimport { EffectModule } from '@leafer-ui/effect'\nimport '@leafer-ui/mask'\n\nimport { TextConvertModule } from '@leafer-ui/text'\nimport { ColorConvertModule } from '@leafer-ui/color'\n\n\nObject.assign(TextConvert, TextConvertModule)\nObject.assign(ColorConvert, ColorConvertModule)\n\nObject.assign(Paint, PaintModule)\nObject.assign(PaintImage, PaintImageModule)\nObject.assign(PaintGradient, PaintGradientModule)\n\nObject.assign(Effect, EffectModule)","export * from '@leafer-ui/interface'\n\nexport * from './core'\nexport * from '@leafer/partner'\n\nexport * from '@leafer-ui/core'\nexport * from '@leafer-ui/interaction-web'\nexport * from '@leafer-ui/partner'\n\nimport { ICreator } from '@leafer/interface'\nimport { useCanvas, Creator, LeaferCanvas } from './core'\nimport { HitCanvasManager } from '@leafer-ui/core'\nimport { Interaction } from '@leafer-ui/interaction-web'\n\n\nObject.assign(Creator, {\n    interaction: (target, canvas, selector, options?) => new Interaction(target, canvas, selector, options),\n    hitCanvas: (options?, manager?) => new LeaferCanvas(options, manager),\n    hitCanvasManager: () => new HitCanvasManager()\n} as ICreator)\n\nuseCanvas('canvas')"],"names":["PathNodeHandleType","debug","Debug","get","LeaferCanvas","LeaferCanvasBase","zIndex","style","this","view","setAbsolute","childIndex","index","parentView","beforeNode","children","insertBefore","appendChild","init","config","canvas","__createViewFrom","__createView","display","parentElement","pStyle","webkitUserSelect","userSelect","classList","add","Platform","syncDomFont","document","body","__createContext","autoLayout","resize","backgroundColor","color","hittable","pointerEvents","createElement","inputView","find","isString","getElementById","HTMLCanvasElement","parent","window","div","position","top","bottom","left","right","hasChildNodes","error","updateViewSize","width","height","pixelRatio","unreal","Math","ceil","updateClientBounds","clientBounds","getBoundingClientRect","startAutoLayout","autoBounds","listener","resizeListener","resizeObserver","ResizeObserver","entries","entry","checkAutoBounds","contentRect","observe","warn","_a","imitateResizeObserver","stopListenPixelRatio","listenPixelRatio","requestRender","bind","windowListener","addEventListener","devicePixelRatio","emitResize","removeEventListener","parentSize","x","y","getBoundsFrom","size","isSameSize","marginLeft","marginTop","stopAutoLayout","disconnect","oldSize","DataHelper","copyAttrs","canvasSizeAttrs","isUndefined","ResizeEvent","unrealCanvas","remove","destroy","super","canvasPatch","CanvasRenderingContext2D","prototype","Path2D","mineType","fileType","FileHelper","useCanvas","_canvasType","_power","origin","createCanvas","canvasToDataURL","type","quality","imageType","url","toDataURL","replace","canvasToBolb","Promise","resolve","toBlob","canvasSaveAs","filename","download","el","href","click","removeChild","loadImage","src","reject","img","Image","crossOrigin","image","setAttribute","onload","onerror","e","getRealURL","PointerEvent","DragEvent","event","stopDefault","preventDefault","stopNow","stopImmediatePropagation","stop","stopPropagation","Creator","conicGradientSupport","context","createConicGradient","Object","assign","options","manager","LeaferImage","name","isMobile","render","requestAnimationFrame","defineKey","userAgent","navigator","indexOf","conicGradientRotate90","intWheelDeltaY","test","fullImageShadow","os","Watcher","childrenChanged","hasAdd","hasRemove","hasVisible","updatedList","usePartLayout","LeafList","__updatedList","list","forEach","item","leafer","constructor","target","userConfig","totalTimes","default","__listenEvents","start","disabled","running","disable","__removeListenEvents","update","changed","emit","RenderEvent","REQUEST","__onAttrChange","__onChildEvent","ChildEvent","ADD","__pushChild","child","isBranch","__loopChildren","i","len","length","__onRquestData","emitEvent","WatchEvent","DATA","__eventIds","on_","PropertyEvent","CHANGE","REMOVE","off_","updateAllMatrix","updateBounds","updateOneBounds","updateChange","updateOneChange","LeafHelper","pushAllChildBranch","pushAllParent","BranchHelper","worldBounds","LeafBoundsHelper","LayoutBlockData","updatedBounds","Bounds","beforeBounds","afterBounds","isArray","setBefore","setListWithFn","setAfter","setList","merge","data","addList","updateAllChange","Layouter","__levelList","LeafLevelList","layout","layouting","times","LayoutEvent","START","layoutOnce","END","layoutedBlocks","layoutAgain","waitAgain","partLayout","fullLayout","t","Run","updateList","BEFORE","LAYOUT","AFTER","blocks","getBlocks","extraBlock","sort","levelList","leaf","__layout","without","proxyZoom","matrixChanged","boundsChanged","__tempNumber","updateMatrix","boundsList","branch","levels","level","levelMap","j","jLen","push","addBlocks","reset","end","addExtra","has","__world","set","createBlock","current","__onReceiveWatchData","AGAIN","Renderer","needFill","allowBackgroundColor","fill","FPS","usePartRender","ceilPartPixel","maxFPS","frames","change","requestTime","__requestRender","requestLayout","checkRender","isApp","CHILD_START","renderer","CHILD_END","NEXT","callback","totalBounds","log","innerName","emitRender","renderOnce","ImageManager","clearRecycled","rendering","renderAgain","renderBounds","renderOptions","ignore","partRender","fullRender","RENDER","updateBlocks","mergeBlocks","block","bounds","hit","isEmpty","clipRender","getIntersect","realBounds","save","spread","clipSpread","clipWorld","clearWorld","__render","restore","clear","includes","fillWorld","showRepaint","drawRepaint","useCellRender","cellList","getCellList","updateRender","addBlock","parentApp","frameTime","Date","now","nowFPS","shift","round","reduce","a","b","__onResize","bigger","samePixelRatio","old","forceUpdate","__onLayoutEnd","map","empty","some","isLeafer","tip","isBranchLeaf","RESIZE","tempPoint","copyRadiusPoint","PointHelper","hitRadiusPoint","BoundsHelper","Picker","selector","getByPoint","hitPoint","hitRadius","through","ignoreHittable","exclude","point","radiusX","radiusY","findList","hitBranch","getBestMatchLeaf","bottomList","path","getPath","getHitablePath","throughPath","getThroughPath","allowNull","worldHittable","hitChild","hasParent","proxy","syncList","syncEventer","__","hittablePath","addAt","hitChildren","mode","pathList","nextPath","eachFind","__onlyHitMask","hitMask","visible","mask","__ignoreHitWorld","__clipAfterFill","__hitWorld","topChildren","__hasMask","findMasks","every","value","Selector","picker","finder","backgrounder","updateLayout","getBy","condition","one","Plugin","need","watcher","layouter","topOptions","topRendering","topList","PointerEventHelper","convert","local","base","InteractionHelper","getBase","pointerType","pressure","tangentialPressure","tiltX","tiltY","twist","convertMouse","convertTouch","touch","getTouch","multiTouch","touches","force","targetTouches","changedTouches","KeyEventHelper","code","key","pathCanDrag","Interaction","InteractionBase","notPointer","p","useMultiTouch","notTouch","usePointer","notMouse","useTouch","viewEvents","pointerdown","onPointerDown","mousedown","onMouseDown","touchstart","onTouchStart","pointerleave","onPointerLeave","contextmenu","onContextMenu","wheel","onWheel","gesturestart","onGesturestart","gesturechange","onGesturechange","gestureend","onGestureend","windowEvents","pointermove","onPointerMove","pointerup","onPointerUp","pointercancel","onPointerCancel","mousemove","onMouseMove","mouseup","onMouseUp","touchmove","onTouchMove","touchend","onTouchEnd","touchcancel","onTouchCancel","keydown","onKeyDown","keyup","onKeyUp","scroll","onScroll","getTouches","preventDefaultPointer","pointer","preventDefaultWheel","preventWindowPointer","downData","keyDown","keyUp","preventDefaultMenu","menu","getLocal","pointerDown","isLeave","pointerHover","pointerMove","pointerUp","pointerCancel","onMouseCancel","findPath","multiTouchStart","touchTimer","clearTimeout","multiTouchMove","multiTouchEnd","setTimeout","undefined","getKeepTouchList","transformEnd","to","from","identifier","getLocalTouchs","points","deltaX","deltaY","lastGestureScale","lastGestureRotation","eventBase","scale","rotation","PI","MathHelper","within","rotateSpeed","zoom","rotate","setCursor","cursor","eachCursor","isObject","join","custom","Cursor","fillPathOrText","ui","__font","Paint","fillText","windingRule","drawCenter","stroke","strokeWidthScale","drawStrokesStyle","setStroke","__strokeWidth","__useArrow","strokeArrow","drawTextStroke","drawAlign","align","out","getSameCanvas","font","blendMode","copyCanvasByWorld","recycle","__nowWorld","getSpread","copyAndSpread","toOuterOf","getOuterOf","getByMove","move","getIntersectData","tempBounds","recycleMap","stintSet","hasTransparent","ColorConvert","getLeafPaint","attrName","paint","opacity","leafPaint","boxBounds","PaintImage","PaintGradient","linearGradient","radialGradient","conicGradient","string","r","originPaint","isTransparent","strokeWidth","strokeStyle","PaintModule","compute","leafPaints","isAlphaPixel","maxChildStrokeWidth","paints","__input","recycleImage","max","__removePaint","fillStyle","fills","countImage","checkImage","isPlacehold","drawImagePlaceholder","transform","scaleFixed","scaleX","scaleY","getRenderScaleData","saveBlendMode","restoreBlendMode","_renderOptions","rows","decorationY","__textDrawData","row","__isPlacehold","placeholderColor","text","charData","char","decorationColor","decorationHeight","fillRect","strokeText","strokeAlign","clipUI","drawInside","__fillAfterStroke","__drawRenderPath","drawOutside","strokes","strokeRect","isText","__hasMultiStrokeStyle","__getRealStrokeWidth","shape","currentBounds","nowWorld","nowWorldShapeBounds","__nowWorldShapeBounds","matrix","fitMatrix","shapeBounds","worldCanvas","strokeSpread","worldClipBounds","spreadBounds","renderShapeSpread","FourNumberHelper","swapAndScale","getFitMatrix","fitScaleX","d","fitScaleY","__renderShape","f","userMatrix","Matrix","multiply","withScale","cache","box","isSame","checkSizeAndCreateData","__naturalWidth","__naturalHeight","__autoSide","__proxyData","setProxyAttr","createData","onLoad","ImageEvent","LOAD","onLoadSuccess","LOADED","onLoadError","ERROR","hasEvent","ignoreRender","viewReady","translate","MatrixHelper","tempBox","tempScaleData","tempImage","getGapValue","gap","totalSize","floor","tempMatrix","getMatrixData","rotateOfOuter","scaleOfOuter","multiplyParent","scaleHelper","skew","skewHelper","__awaiter","thisArg","_arguments","P","generator","fulfilled","step","next","rejected","result","done","then","apply","SuppressedError","copy","getFloorScale","abs","PaintImageModule","firstUse","hasAlphaPixel","use","loading","attrValue","ready","loadId","load","destroyed","hitCanvasChanged","lod","getThumbSize","placeholderDelay","drawImage","getImageRenderScaleData","exporting","snapshot","patternId","repeat","changeful","isResizing","isLarge","__isFastShadow","sync","createPattern","createPatternTask","_imageScaleX","_imageScaleY","getFull","filters","u","onlyScale","cornerRadius","scaleData","input","recyclePaint","unload","patternTask","patternTasker","id","fixScale","getPatternFixScale","imageMatrix","xGap","yGap","imageCanvas","getCanvas","smooth","interlace","pattern","getPattern","noRepeat","imageScaleX","imageScaleY","maxSize","maxPatternSize","imageSize","isSVG","sqrt","getPatternData","padding","shrink","offset","clipSize","sameBox","swapSize","getScaleData","AlignHelper","toPoint","getFitScale","put","stretchMode","clipScaleX","clipScaleY","clipMode","repeatMode","freeTransform","count","getGapData","fillOrFitMode","isNumber","AroundHelper","realFrom","realTo","applyStops","gradient","stops","addColorStop","getAngle","getDistance","getTransform","stretch","rotate90","angle","PaintGradientModule","createLinearGradient","createRadialGradient","toOffsetOutBounds","offsetOutBounds","getShadowRenderSpread","_ui","shadow","blur","drawWorldShadow","outBounds","copyWorld","getInnerShadowSpread","EffectModule","copyBounds","other","otherScale","sx","setWorldShadow","offsetX","offsetY","Effect","getShadowTransform","setTransform","resetTransform","innerShadow","setWorldBlur","copyWorldToInner","filter","backgroundBlur","_current","_shape","isInnerShaodw","strokeBounds","isTransformShadow","_shadow","excludeRenderBounds","usedGrayscaleAlpha","maskEnd","maskMode","contentCanvas","maskCanvas","maskOpacity","useGrayscaleAlpha","content","useMask","copyContent","usePixelMask","Group","__renderMask","currentMask","__clip","childBlendMode","__blendMode","afterChar","symbolChar","cjkReg","RegExp","toString","mapChar","str","split","letterMap","beforeMap","afterMap","symbolMap","breakMap","CharType","Letter","Single","Before","After","Symbol","Break","getCharType","TextRowHelper","trimRight","words","splice","getTextCase","textCase","firstChar","toUpperCase","toLowerCase","word","wordWidth","rowWidth","realWidth","charWidth","startCharSize","charSize","charType","lastCharType","langBreak","afterBreak","paraStart","textDrawData","findMaxWidth","addChar","addWord","addRow","paraNumber","endCharSize","setMaxWidth","maxWidth","Direction4","offsetText","drawData","TextConvertModule","getDrawData","String","__getInput","__padding","autoSizeAlign","__letterSpacing","paraIndent","__isCharMode","wrap","textWrap","breakAll","paraEnd","measureText","createRows","textAlign","verticalAlign","padAutoText","countRows","__lineHeight","__baseLine","__clipText","paraSpacing","realHeight","starY","overflow","rowX","layoutWidth","isOverflow","fontSize","layoutText","justifyLast","justify","justifyLetter","charX","remainingWidth","addWordWidth","addLetterWidth","indentWidth","wordChar","wordsLength","isLastWord","canJustify","total","textMode","toTextChar","toWordChar","rowData","toChar","layoutChar","textOverflow","charRight","ellipsisWidth","clipText","textDecoration","min","decorationText","ColorConvertModule","doOpacity","object","rgb","g","TextConvert","interaction","hitCanvas","hitCanvasManager","HitCanvasManager"],"mappings":"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","x_google_ignoreList":[25]}